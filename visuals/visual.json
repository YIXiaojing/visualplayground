{"visual":{"name":"barChart","displayName":"bar chart","guid":"PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7","visualClassName":"Visual","version":"1.0.0","description":"","supportUrl":"","gitHubUrl":""},"apiVersion":"1.1.0","author":{"name":"","email":""},"assets":{"icon":"assets/icon.png"},"externalJS":[],"style":"style/visual.less","capabilities":{"dataRoles":[{"displayName":"Category","name":"category","kind":0},{"displayName":"Values","name":"measure","kind":1}],"dataViewMappings":[{"categorical":{"categories":{"for":{"in":"category"}},"values":{"select":[{"bind":{"to":"measure"}}]}}}],"objects":{"enableAxis":{"displayName":"Axis","properties":{"show":{"displayName":"Enable Axis","type":{"bool":true}}}},"colorSelector":{"displayName":"Data Colors","properties":{"fill":{"displayName":"Color","type":{"fill":{"solid":{"color":true}}}}}}}},"content":{"js":"var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar powerbi;\r\n(function (powerbi) {\r\n    var extensibility;\r\n    (function (extensibility) {\r\n        var visual;\r\n        (function (visual) {\r\n            var PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7;\r\n            (function (PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7) {\r\n                function getValue(objects, objectName, propertyName, defaultValue) {\r\n                    if (objects) {\r\n                        var object = objects[objectName];\r\n                        if (object) {\r\n                            var property = object[propertyName];\r\n                            if (property !== undefined) {\r\n                                return property;\r\n                            }\r\n                        }\r\n                    }\r\n                    return defaultValue;\r\n                }\r\n                PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7.getValue = getValue;\r\n                function getCategoricalObjectValue(category, index, objectName, propertyName, defaultValue) {\r\n                    var categoryObjects = category.objects;\r\n                    if (categoryObjects) {\r\n                        var categoryObject = categoryObjects[index];\r\n                        if (categoryObject) {\r\n                            var object = categoryObject[objectName];\r\n                            if (object) {\r\n                                var property = object[propertyName];\r\n                                if (property !== undefined) {\r\n                                    return property;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    return defaultValue;\r\n                }\r\n                PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7.getCategoricalObjectValue = getCategoricalObjectValue;\r\n            })(PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7 = visual.PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7 || (visual.PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7 = {}));\r\n        })(visual = extensibility.visual || (extensibility.visual = {}));\r\n    })(extensibility = powerbi.extensibility || (powerbi.extensibility = {}));\r\n})(powerbi || (powerbi = {}));\r\nvar powerbi;\r\n(function (powerbi) {\r\n    var extensibility;\r\n    (function (extensibility) {\r\n        var visual;\r\n        (function (visual) {\r\n            var PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7;\r\n            (function (PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7) {\r\n                /**\r\n                 * Singleton reference of ColorPalette.\r\n                 *\r\n                 * @instance\r\n                 */\r\n                var colorManager;\r\n                /**\r\n                 * Factory method for creating a ColorPalette.\r\n                 *\r\n                 * @function\r\n                 * @param {IColorInfo[]} colors - Array of ColorInfo objects that contain\r\n                 *                                hex values for colors.\r\n                 */\r\n                function createColorPalette(colors) {\r\n                    if (!colorManager)\r\n                        colorManager = new ColorPalette(colors);\r\n                    return colorManager;\r\n                }\r\n                PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7.createColorPalette = createColorPalette;\r\n                var ColorPalette = (function () {\r\n                    function ColorPalette(colors) {\r\n                        this.colorPalette = {};\r\n                        this.colorIndex = 0;\r\n                        this.colors = colors;\r\n                    }\r\n                    /**\r\n                     * Gets color from colorPalette and returns an IColorInfo\r\n                     *\r\n                     * @function\r\n                     * @param {string} key - Key of assign color in colorPalette.\r\n                     */\r\n                    ColorPalette.prototype.getColor = function (key) {\r\n                        var color = this.colorPalette[key];\r\n                        if (color) {\r\n                            return color;\r\n                        }\r\n                        var colors = this.colors;\r\n                        color = this.colorPalette[key] = colors[this.colorIndex++];\r\n                        if (this.colorIndex >= colors.length) {\r\n                            this.colorIndex = 0;\r\n                        }\r\n                        return color;\r\n                    };\r\n                    /**\r\n                     * resets colorIndex to 0\r\n                     *\r\n                     * @function\r\n                     */\r\n                    ColorPalette.prototype.reset = function () {\r\n                        this.colorIndex = 0;\r\n                        return this;\r\n                    };\r\n                    /**\r\n                     * Clears colorPalette of cached keys and colors\r\n                     *\r\n                     * @function\r\n                     */\r\n                    ColorPalette.prototype.clear = function () {\r\n                        this.colorPalette = {};\r\n                    };\r\n                    return ColorPalette;\r\n                }());\r\n            })(PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7 = visual.PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7 || (visual.PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7 = {}));\r\n        })(visual = extensibility.visual || (extensibility.visual = {}));\r\n    })(extensibility = powerbi.extensibility || (powerbi.extensibility = {}));\r\n})(powerbi || (powerbi = {}));\r\n/*\r\n *  Power BI Visual CLI\r\n *\r\n *  Copyright (c) Microsoft Corporation\r\n *  All rights reserved.\r\n *  MIT License\r\n *\r\n *  Permission is hereby granted, free of charge, to any person obtaining a copy\r\n *  of this software and associated documentation files (the \"\"Software\"\"), to deal\r\n *  in the Software without restriction, including without limitation the rights\r\n *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n *  copies of the Software, and to permit persons to whom the Software is\r\n *  furnished to do so, subject to the following conditions:\r\n *\r\n *  The above copyright notice and this permission notice shall be included in\r\n *  all copies or substantial portions of the Software.\r\n *\r\n *  THE SOFTWARE IS PROVIDED *AS IS*, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n *  THE SOFTWARE.\r\n */\r\nvar powerbi;\r\n(function (powerbi) {\r\n    var extensibility;\r\n    (function (extensibility) {\r\n        var visual;\r\n        (function (visual) {\r\n            var PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7;\r\n            (function (PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7) {\r\n                function logExceptions() {\r\n                    return function (target, key, value) {\r\n                        return {\r\n                            value: function () {\r\n                                var p = window.performance.now();\r\n                                var result;\r\n                                try {\r\n                                    result = value.value.apply(this, arguments);\r\n                                }\r\n                                catch (e) {\r\n                                    console.error(e);\r\n                                    throw e;\r\n                                }\r\n                                return result;\r\n                            }\r\n                        };\r\n                    };\r\n                }\r\n                PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7.logExceptions = logExceptions;\r\n                ;\r\n                ;\r\n                function visualTransform(options, host) {\r\n                    var dataViews = options.dataViews;\r\n                    var viewModel = {\r\n                        dataPoints: [],\r\n                        dataMax: 0,\r\n                        settings: { enableAxis: { show: false } }\r\n                    };\r\n                    if (!dataViews\r\n                        || !dataViews[0]\r\n                        || !dataViews[0].categorical\r\n                        || !dataViews[0].categorical.categories\r\n                        || !dataViews[0].categorical.categories[0].source\r\n                        || !dataViews[0].categorical.values)\r\n                        return viewModel;\r\n                    var categorical = dataViews[0].categorical;\r\n                    var category = categorical.categories[0];\r\n                    var dataValue = categorical.values[0];\r\n                    var colors = PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7.createColorPalette(host.colors).reset();\r\n                    var barChartDataPoints = [];\r\n                    var dataMax;\r\n                    for (var i = 0, len = Math.max(category.values.length, dataValue.values.length); i < len; i++) {\r\n                        var defaultColor = {\r\n                            solid: {\r\n                                color: colors.getColor(category.values[i]).value\r\n                            }\r\n                        };\r\n                        barChartDataPoints.push({\r\n                            category: category.values[i],\r\n                            value: dataValue.values[i],\r\n                            color: PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7.getCategoricalObjectValue(category, i, 'colorSelector', 'fill', defaultColor).solid.color,\r\n                            selectionId: host.createSelectionIdBuilder()\r\n                                .withCategory(category, i)\r\n                                .createSelectionId()\r\n                        });\r\n                    }\r\n                    dataMax = dataValue.maxLocal;\r\n                    return {\r\n                        dataPoints: barChartDataPoints,\r\n                        dataMax: dataMax,\r\n                        settings: {\r\n                            enableAxis: {\r\n                                show: PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7.getValue(dataViews[0].metadata.objects, 'enableAxis', 'show', false),\r\n                            }\r\n                        }\r\n                    };\r\n                }\r\n                var Visual = (function () {\r\n                    function Visual(options) {\r\n                        this.host = options.host;\r\n                        var svg = this.svg = d3.select(options.element)\r\n                            .append('svg')\r\n                            .classed('barChart', true);\r\n                        this.barContainer = svg.append('g')\r\n                            .classed('barContainer', true);\r\n                        this.xAxis = svg.append('g')\r\n                            .classed('xAxis', true);\r\n                        this.selectionManger = options.host.createSelectionManager();\r\n                    }\r\n                    Visual.prototype.update = function (options, vm) {\r\n                        var width = options.viewport.width;\r\n                        var height = options.viewport.height;\r\n                        var margin = { top: 0, bottom: 25, left: 0, right: 0 };\r\n                        console.log(vm);\r\n                        var viewModel = this.vm = vm ? vm : visualTransform(options, this.host);\r\n                        this.svg.attr({\r\n                            width: width,\r\n                            height: height\r\n                        });\r\n                        if (viewModel.settings.enableAxis.show)\r\n                            height -= margin.bottom;\r\n                        var yScale = d3.scale.linear()\r\n                            .domain([0, viewModel.dataMax])\r\n                            .range([height, 0]);\r\n                        var xScale = d3.scale.ordinal()\r\n                            .domain(viewModel.dataPoints.map(function (d) { return d.category; }))\r\n                            .rangeRoundBands([0, width], 0.1);\r\n                        var xAxis = d3.svg.axis()\r\n                            .scale(xScale)\r\n                            .orient('bottom');\r\n                        this.xAxis.attr('transform', 'translate(0, ' + height + ')')\r\n                            .call(xAxis);\r\n                        var bars = this.barContainer.selectAll('.bar').data(viewModel.dataPoints);\r\n                        bars.enter()\r\n                            .append('rect')\r\n                            .classed('bar', true);\r\n                        bars.attr({\r\n                            width: xScale.rangeBand(),\r\n                            height: function (d) { return height - yScale(d.value); },\r\n                            y: function (d) { return yScale(d.value); },\r\n                            x: function (d) { return xScale(d.category); },\r\n                            fill: function (d) { return d.color; }\r\n                        });\r\n                        var selectionManager = this.selectionManger;\r\n                        bars.on('click', function (d) {\r\n                            var _this = this;\r\n                            selectionManager.select(d.selectionId).then(function (ids) {\r\n                                bars.attr({\r\n                                    'fill-opacity': ids.length > 0 ? 0.5 : 1\r\n                                });\r\n                                d3.select(_this).attr({\r\n                                    'fill-opacity': 1\r\n                                });\r\n                            });\r\n                            d3.event.stopPropagation();\r\n                        });\r\n                        bars.exit()\r\n                            .remove();\r\n                    };\r\n                    Visual.prototype.enumerateObjectInstances = function (options) {\r\n                        var objectName = options.objectName;\r\n                        var objectEnumeration = [];\r\n                        switch (objectName) {\r\n                            case 'enableAxis':\r\n                                objectEnumeration.push({\r\n                                    objectName: objectName,\r\n                                    properties: {\r\n                                        show: this.vm.settings.enableAxis.show,\r\n                                    },\r\n                                    selector: null\r\n                                });\r\n                            case 'colorSelector':\r\n                                for (var _i = 0, _a = this.vm.dataPoints; _i < _a.length; _i++) {\r\n                                    var barDataPoint = _a[_i];\r\n                                    objectEnumeration.push({\r\n                                        objectName: objectName,\r\n                                        displayName: barDataPoint.category,\r\n                                        properties: {\r\n                                            fill: {\r\n                                                solid: {\r\n                                                    color: barDataPoint.color\r\n                                                }\r\n                                            }\r\n                                        },\r\n                                        selector: barDataPoint.selectionId.getSelector()\r\n                                    });\r\n                                }\r\n                                break;\r\n                        }\r\n                        ;\r\n                        return objectEnumeration;\r\n                    };\r\n                    __decorate([\r\n                        logExceptions(), \r\n                        __metadata('design:type', Function), \r\n                        __metadata('design:paramtypes', [Object, Object]), \r\n                        __metadata('design:returntype', void 0)\r\n                    ], Visual.prototype, \"update\", null);\r\n                    return Visual;\r\n                }());\r\n                PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7.Visual = Visual;\r\n            })(PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7 = visual.PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7 || (visual.PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7 = {}));\r\n        })(visual = extensibility.visual || (extensibility.visual = {}));\r\n    })(extensibility = powerbi.extensibility || (powerbi.extensibility = {}));\r\n})(powerbi || (powerbi = {}));\r\nvar powerbi;\r\n(function (powerbi) {\r\n    var visuals;\r\n    (function (visuals) {\r\n        var plugins;\r\n        (function (plugins) {\r\n            plugins.PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7 = {\r\n                name: 'PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7',\r\n                displayName: 'bar chart',\r\n                class: 'Visual',\r\n                version: '1.0.0',\r\n                apiVersion: '1.1.0',\r\n                create: function (options) { return new powerbi.extensibility.visual.PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7.Visual(options); },\r\n                custom: true\r\n            };\r\n        })(plugins = visuals.plugins || (visuals.plugins = {}));\r\n    })(visuals = powerbi.visuals || (powerbi.visuals = {}));\r\n})(powerbi || (powerbi = {}));\r\n//# sourceMappingURL=visual.js.map","css":".visual-PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7 .xAxis path {\n  display: none;\n}\n.visual-PBI_CV_6AFFA888_14EE_423F_9ECA_056EAED415D7 .xAxis text {\n  font-size: 12px;\n}\n","iconBase64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpBOEJGMzkxN0NBRDNFMDExQTcxQ0JFODI3ODBCQUE5RSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo3NEY1QjA1NUQ0OTAxMUUwQTgxREI2NjMxMkNEMUNEMyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo3NEY1QjA1NEQ0OTAxMUUwQTgxREI2NjMxMkNEMUNEMyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IFdpbmRvd3MiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5Mjk5RDU1ODBGRDRFMDExQTcxQ0JFODI3ODBCQUE5RSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBOEJGMzkxN0NBRDNFMDExQTcxQ0JFODI3ODBCQUE5RSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpDoNX0AAAI3SURBVHjarJRLSFVRFIY9t7SiRDGLoEEPCRJRaCSYkxCiFCXCF+LIMExQLkilgumgwkbdBuWDRC2EomhURCOjgagkXEgKLUKhidobM6H0+i34rxyPnuvEA5/rXPda/1l7739vJxKJxG3ls93+hEKhTILxJhgMftmsiPxdhHw4CfepeR8dCyjWwwB0kZy3iVgCoQ2ewnmXxhrBD7Cgr/ZQVA17fDRPw2UYhzK6G99IsBse6/0QNME+H8FT4EA/YiPqOgA1q4IMzBNuw6iKjkCpj+Av+AdnEEmD3bxfhzvuDk30HaEaLsEkXCO53rN+Bwg5qsvTuj/TjGYtx9nINhRmEx7AYWiFW7AXOuEcbPOUvIZ2mnrl+PkQUbNEh4QHNKUSDdsSBWEOlmxTEfvs26FL9Khe211if6Acgee+xo7xzMgBxfq9qPe3fgWBGN2lEnqtG9nExM7CV3jp3bDos2bKJB0nHFRxAxRpA/5CIXyHh5ABv6GZqd9dJ6iz2SjbxMMypGhJFtTlNzu3kK7xgDxpove8U66FK2A+s6nul5gVVMEL+Ak7lG/T+g9JcIOGar2CRUoogxMwpP/bLTJMB9bRhDbkk5bBUU0y3ES0xS04CBfN9RSHiY90vJK0BHaSzG9h2eejS3RJeVfdtrGzuGyd8CX7Yq6ExuCH63jaVMPkFOv6OibB6DKs2+VEQp+WYBoqERn2sVWWRNN0YurIfeL14U6YkpkLYCSG6e0yqdCxvKBLIm5FgAEAV0nKuwMYRUsAAAAASUVORK5CYII="}}
