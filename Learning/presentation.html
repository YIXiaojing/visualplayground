<!DOCTYPE html>
<meta charset="utf-8" xmlns="http://www.w3.org/1999/html">
<meta name="viewport" content="width=device-width">
<style>
    @import url(http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz:400,700);

    .axis text {
        font: 0.5em sans-serif;
        fill: #fff;
    }

    .axis path, .axis line {
        fill: none;
        stroke: #FFF;
        shape-rendering: crispEdges;
    }


    rect.bar, circle.dot {
        fill: purple
    }

    section {
        background: #000;
        color: #fff;
        padding: 2em;
        font-family: 'Yanone Kaffeesatz', sans-serif;
    }

    .grey {
        color: #777;
    }

    .blue {
        color: #00A0B0;
    }

    .highlighted {
        font-weight: 700;
        border-bottom: 0.1em solid mediumpurple;
    }

    .purple {
        color: mediumpurple;
    }

    .variable {
        color: yellowgreen;
    }

    .function, .keyword {
        color: cornflowerblue;
    }

    .string {
        color: #ff8621;
    }

    a:link,
    a:visited {
        color: orange;
        text-decoration: none;
    }

    a:hover {
        text-decoration: underline;
    }

    h1 {
        font-size: 2.5em;
        font-weight: 700;
    }

    h2 {
        font-weight: 400;
    }

    .svgDemo {
        height: 13em;
        width: 35em;
    }

    .svgDemoEnd {
        height: 9em;
        width: 35em;
    }

    img {
        padding-top: 1em;
        padding-left: 7em;
        height: 17em;
    }

</style>

<section style="text-align:center;padding-top:5em;">
    <h1 class="blue">d3.basic (fundamentals)</h1>

    <h2 class="grey">by Sachin Patney</h2>
</section>

<section style="text-align:center;padding-top:5em;">
    <h1 class="blue">What is this D3?</h1>

    <h2 class="grey">oh! tell me, tell me please</h2>
</section>

<section>
    <img src="d3.min.screen.png"/>
</section>

<section style="text-align:center;padding-top:5em;">
    <h1 class="blue">D3 === C++</h1>

    <h2 class="grey">[HTML] [CSS] [JAVASCRIPT] [SVG] [DOM]</h2>
</section>

<section style="text-align:center;padding-top:5em;">
    <h1 class="blue">Hello Array !!</h1>
    <code>
        <span class="keyword">var</span> data = [10, 40, 30, 20, 60];
    </code>
</section>
<section>
    <h1 class="blue">Data Join + enter()</h1>
    <pre>
        <code class="javascript">
<span class="keyword">var</span> data = [10, 40, 30, 20, 60];

<span class="keyword">var</span> svg = d3.select(<span class="string">'#svgCircles'</span>);
<span class="keyword">var</span> selection = svg.selectAll(<span class="string">'.happycircles'</span>).<span class="highlighted">data(data)</span>;

selection.enter()
    .append(<span class="string">'circle'</span>)
    .classed(<span class="string">'happycircles'</span>, <span class="keyword">true</span>);
        </code>
    </pre>
</section>

<section>
    <h1 class="blue">Update()</h1>
    <pre>
    <code class="javascript">
selection
    .attr({
        <span class="variable">cx</span>: <span class="function">function</span>(d, i){ <span class="keyword">return</span> (i + 1) * 100; },
        <span class="variable">cy</span>: 150,
        <span class="variable">r</span>: <span class="function">function</span>(d) { <span class="keyword">return</span> d; },
        <span class="variable">fill</span>: 'purple'
    });
    </code>
        </pre>
</section>

<section id="circles">
    <h1 class="blue">Happy Circles</h1>
    <svg class="svgDemo" id="svgCircles"></svg>
</section>

<section>
    <h1 class="blue">Setting things in Motion</h1>
<pre>
<code class="javascript">
selection.enter()
    .append(<span class="string">'circle'</span>)
    .attr({
        <span class="highlighted"><span class="variable">cx</span>: 0,</span>
        <span class="highlighted"><span class="variable">fill</span>: 'yellow'</span>
    })
    .classed(<span class="string">'happycircles'</span>, <span class="keyword">true</span>);
</code>
</pre>
</section>

<section>
    <h1 class="blue">Just two more lines ... </h1>
<pre>
<code class="javascript">
selection
    <span class="highlighted">.transition()</span>
    <span class="highlighted">.duration(5000)</span>
    .attr({
        <span class="variable">cx</span>: <span class="function">function</span>(d, i){ <span class="keyword">return</span> (i + 1) * 100; },
        <span class="variable">cy</span>: 150,
        <span class="variable">r</span>: <span class="function">function</span>(d) { <span class="keyword">return</span> d; },
        <span class="variable">fill</span>: 'purple'
    });
</code>
</pre>
</section>

<section id="aniCircles">
    <h1 class="blue">... aaaaaand Action!</h1>
    <svg class="svgDemo" id="svgAniCircles"></svg>
</section>

<section>
    <h1 class="blue">Scales</h1>
</section>

<section>
    <h1 class="blue">Axis</h1>
</section>

<section id="scatterPlot">
    <h1 class="blue">Scatter Plot</h1>
    <svg class="svgDemo" id="svgScatterPlot"></svg>
</section>

<section id="barChart">
    <h1 class="blue">Bar Chart</h1>
    <svg class="svgDemo" id="svgBarChart"></svg>
</section>

<section id="theend" style="text-align:center;padding-top:4em;">
    <h1 class="blue">The End</h1>
    <h2 class="grey">Questions ?</h2>
    <svg class="svgDemoEnd" id="svgForce"></svg>
</section>

<script src="//d3js.org/d3.v3.min.js" type="text/javascript"></script>
<script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="stack.js"></script>
<script>
    var callbacks = [];
    var forceLayoutIntervalId = 0;
    window.requestAnimationFrame = function(callback) {
        callbacks.push(callback);
    };

    var flushAnimationFrames = function() {
        var now = Date.now;
        Date.now = function() { return Infinity; };
        callbacks.forEach(function(callback) { try { callback(); } catch (e) { console.error(e); } });
        callbacks = [];
        Date.now = now;
    };

    stack()
            .on("activate", activate)
            .on("deactivate", deactivate);

    var section = d3.selectAll("section"),
            cir = d3.select("#circles"),
            cirIndex = section[0].indexOf(cir.node());
            aniCir = d3.select("#aniCircles"),
            aniCirIndex = section[0].indexOf(aniCir.node()),
                    theEnd = d3.select("#theend"),
                    theEndIndex = section[0].indexOf(theEnd.node());

    /*cir.on('click', function(){
        removeCircles();
        createCircles();
    });*/

    createCircles();
    createDots();
    createBar();


    aniCir.on('click', function(){
        removeAnimatedCircles();
        createAnimatedCircles();
    });

    theEnd.on('click', function(){
        killForceLayout();
        createForceLayout();
    });

    function activate(d, i) {
        console.log('a: ' + i);
        if (i === aniCirIndex) {
            createAnimatedCircles();
        }
        else if(i===cirIndex){
            //createCircles()
        }else if(i=== theEndIndex){
            createForceLayout();
        }
    }

    function deactivate(d, i) {
        console.log('b: ' + i);
        if(i===aniCirIndex){
            removeAnimatedCircles();
        }else if(i===cirIndex){
            //removeCircles();
        }else if(i=== theEndIndex){
            killForceLayout();
        }
    }

    function createCircles() {
        var data = [10, 40, 30, 20, 60];
        var svg = d3.select('#svgCircles');

        var selection = svg.selectAll('.happycircles').data(data);
        selection.enter().append('circle')
                .classed('happycircles', true);
        selection
                .attr({
                    cx: function (d, i) {
                        return (i + 1) * 100 * (1/32) + 'em';
                    },
                    cy: 150/32 + 'em',
                    r: function (d) {
                        return d * 1/32 + 'em';
                    },
                    fill: 'purple'
                });
    }

    function removeCircles(){
        flushAnimationFrames();
        d3.select('#svgCircles').selectAll('*').remove();
    }

    function createAnimatedCircles() {
        var data = [10, 40, 30, 20, 60];
        var svg = d3.select('#svgAniCircles');

        var selection = svg.selectAll('.happycircles').data(data);
        selection.enter().append('circle')
                .attr({cx: 0, fill: 'yellow'})
                .classed('happycircles', true);
        selection
                .transition()
                .duration(5000)
                .attr({
                    cx: function (d, i) {
                        return (i + 1) * 100 * (1/32) + 'em';
                    },
                    cy: 150/32 + 'em',
                    r: function (d) {
                        return d * 1/32 + 'em';
                    },
                    fill: 'purple'
                });
    }

    function removeAnimatedCircles(){
        flushAnimationFrames();
        d3.select('#svgAniCircles').selectAll('*').remove();
    }

    function removeBar(){
        $('#svgBarChart').empty();
    }

    function removeDots(){
        $('#svgScatterPlot').empty();
    }
    function createBar(){
        var data = [1, 1, 2, 3, 5, 8];

        var margin = {top: 40, right: 40, bottom: 40, left: 40},
                width = $('#svgBarChart').width(),
                height =$('#svgBarChart').height();

        var x = d3.scale.linear()
                .domain([0, d3.max(data)])
                .range([0, width - margin.left - margin.right]);

        var y = d3.scale.ordinal()
                .domain(d3.range(data.length))
                .rangeRoundBands([height - margin.top - margin.bottom, 0], .2);

        var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom")
                .tickPadding(8);

        var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")
                .tickSize(0)
                .tickPadding(8);

        var svg = d3.select("#svgBarChart").append("svg")
                .attr("width", width)
                .attr("height", height)
                .attr("class", "bar chart")
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        svg.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("y", function(d, i) { return y(i); })
                .attr("width", x)
                .attr("height", y.rangeBand());

        svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + y.rangeExtent()[1] + ")")
                .call(xAxis);

        svg.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .selectAll("text")
                .text(function(d) { return String.fromCharCode(d + 65); });
    }

    function createDots(){
        var data = [
            {x: 10.0, y: 9.14},
            {x:  8.0, y: 8.14},
            {x: 13.0, y: 8.74},
            {x:  9.0, y: 8.77},
            {x: 11.0, y: 9.26},
            {x: 14.0, y: 8.10},
            {x:  6.0, y: 6.13},
            {x:  4.0, y: 3.10},
            {x: 12.0, y: 9.13},
            {x:  7.0, y: 7.26},
            {x:  5.0, y: 4.74},
        ];

        var scatter = $('#svgScatterPlot');
        var margin = {top: 40, right: 40, bottom: 40, left: 40},
                width = scatter.width(),
                height = scatter.height();

        var x = pad(d3.scale.linear()
                .domain(d3.extent(data, function(d) { return d.x; }))
                .range([0, width - margin.left - margin.right]), 40);

        var y = pad(d3.scale.linear()
                .domain(d3.extent(data, function(d) { return d.y; }))
                .range([height - margin.top - margin.bottom, 0]), 40);

        var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom")
                .tickPadding(8);

        var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")
                .tickPadding(8);

        var svg = d3.select(scatter.get(0)).append("svg")
                .attr("width", width)
                .attr("height", height)
                .attr("class", "dot chart")
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        svg.selectAll(".dot")
                .data(data)
                .enter().append("circle")
                .attr("class", "dot")
                .attr("cx", function(d) { return x(d.x); })
                .attr("cy", function(d) { return y(d.y); })
                .attr("r", '0.4em');

        svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + y.range()[0] + ")")
                .call(xAxis);

        svg.append("g")
                .attr("class", "y axis")
                .call(yAxis);

        function pad(scale, k) {
            var range = scale.range();
            if (range[0] > range[1]) k *= -1;
            return scale.domain([range[0] - k, range[1] + k].map(scale.invert)).nice();
        }
    }

    function createForceLayout(){
        var fly = $('#svgForce');
        var width = fly.width(),
                height = fly.height();

        var fill = d3.scale.category10().range(["#C7F464", "#00A0B0" , "#F56991"]);;

        var nodes = [],
                foci = [{x: width/4, y: height/2}, {x: width/4*2, y: height/2}, {x: width/4*3, y: height/2}];

        var svg = d3.select(fly.get(0)).append("svg")
                .attr("width", width)
                .attr("height", height);

        var force = d3.layout.force()
                .nodes(nodes)
                .links([])
                .gravity(0)
                .size([width, height])
                .on("tick", tick);

        var node = svg.selectAll("circle");

        function tick(e) {
            var k = .1 * e.alpha;

            // Push nodes toward their designated focus.
            nodes.forEach(function(o, i) {
                o.y += (foci[o.id].y - o.y) * k;
                o.x += (foci[o.id].x - o.x) * k;
            });

            node
                    .attr("cx", function(d) { return d.x; })
                    .attr("cy", function(d) { return d.y; });
        }

        forceLayoutIntervalId = setInterval(function(){
            nodes.push({id: ~~(Math.random() * foci.length)});
            force.start();

            node = node.data(nodes);

            node.enter().append("circle")
                    .attr("class", "node")
                    .attr("cx", function(d) { return d.x; })
                    .attr("cy", function(d) { return d.y; })
                    .attr("r", '0.25em')
                    .style("fill", function(d) { return fill(d.id); })
                    .style("stroke", function(d) { return d3.rgb(fill(d.id)).darker(2); })
                    .call(force.drag);
        }, 250);
    }

    function killForceLayout(){
        clearInterval(forceLayoutIntervalId);
        var fly = $('#svgForce');
        fly.empty();
    }

</script>
