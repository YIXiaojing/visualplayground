!function(e){function t(a){if(i[a])return i[a].exports;var r=i[a]={exports:{},id:a,loaded:!1};return e[a].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){e.exports=i(18)},,,,,,,,,,,,,,,,,,function(e,t,i){function a(e){return e.keys().map(e)}window.jsCommon,window.powerbi,window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;window.jsCommon=window.jsCommon||{},window.powerbi=window.powerbi||{},window.debug=window.debug||{},window.InJs=window.InJs||{},a(i(19)),i(43),i(44),i(45),i(46),i(47),i(48),i(49),i(50),i(51),i(52),i(53),i(54),i(55),i(56),i(57),i(58),i(59),i(60),i(61),i(62),i(63),i(64)},function(e,t,i){function a(e){return i(r(e))}function r(e){return o[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var o={"./styles/styles.less":20,"./visuals/areaRangeChart/visual/styles/areaRangeChart.less":22,"./visuals/asterPlot/visual/styles/asterPlot.less":23,"./visuals/bulletChart/visual/styles/bulletChart.less":24,"./visuals/chicletSlicer/visual/styles/chicletSlicer.less":25,"./visuals/chordChart/visual/styles/chordChart.less":26,"./visuals/dotPlot/visual/styles/dotPlot.less":27,"./visuals/enhancedScatterChart/visual/styles/enhancedScatterChart.less":28,"./visuals/forceGraph/visual/styles/forceGraph.less":29,"./visuals/gantt/visual/styles/gantt.less":30,"./visuals/globeMap/visual/styles/globeMap.less":31,"./visuals/histogram/visual/styles/histogram.less":32,"./visuals/lineDotChart/visual/styles/lineDotChart.less":33,"./visuals/mekkoChart/visual/styles/mekkoChart.less":34,"./visuals/pulseChart/visual/styles/pulseChart.less":35,"./visuals/radarChart/visual/styles/radarChart.less":36,"./visuals/sandDance/visual/styles/sandDance.less":37,"./visuals/sankeyDiagram/visual/styles/sankeyDiagram.less":38,"./visuals/streamGraph/visual/styles/streamGraph.less":39,"./visuals/timeline/visual/styles/timeline.less":40,"./visuals/tornadoChart/visual/styles/tornadoChart.less":41,"./visuals/wordCloud/visual/styles/wordCloud.less":42};a.keys=function(){return Object.keys(o)},a.resolve=r,e.exports=a,a.id=19},function(e,t){},,function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=a.CssConstants.createClassAndSelector,o=a.PixelConverter,n=e.visuals.valueFormatter,s="asterPlot",l=.9,c=.9,h=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.selection=e.selection,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.hasHighlights=e.hasHighlights,this.selection.on("click",function(e,i){t.handleSelection(e.data,d3.event.ctrlKey)}),this.clearCatcher.on("click",function(){t.handleClearSelection()}),this.renderSelection(this.interactivityService.hasSelection())},e.prototype.renderSelection=function(e){var i=this;this.selection.style("fill-opacity",function(a){return t.ColumnUtil.getFillOpacity(a.data.selected,a.data.highlight,e,i.hasHighlights)})},e}(),u=function(){function e(e){this.message=e}return Object.defineProperty(e.prototype,"code",{get:function(){return"AsterPlotWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){return{message:this.message,title:e.get(""),detail:e.get("")}},e}();i.AsterPlotWarning=u;var p=function(){function e(e,t){this.defaultViewport=e||{width:0,height:0},this.defaultMargin=t||{top:0,bottom:0,right:0,left:0}}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.viewportValue||(this.viewportValue=this.defaultViewport)},set:function(t){var i=this;this.previousOriginalViewportValue=_.clone(this.originalViewportValue),this.originalViewportValue=_.clone(t),this.setUpdateObject(t,function(e){return i.viewportValue=e},function(t){return e.restrictToMinMax(t,i.minViewport)})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportCopy",{get:function(){return _.clone(this.viewport)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minViewport",{get:function(){return this.minViewportValue||{width:0,height:0}},set:function(t){var i=this;this.setUpdateObject(t,function(e){return i.minViewportValue=e},e.restrictToMinMax)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"margin",{get:function(){return this.marginValue||(this.marginValue=this.defaultMargin)},set:function(t){var i=this;this.setUpdateObject(t,function(e){return i.marginValue=e},e.restrictToMinMax)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportChanged",{get:function(){return!(!this.originalViewportValue||this.previousOriginalViewportValue&&this.previousOriginalViewportValue.height===this.originalViewportValue.height&&this.previousOriginalViewportValue.width===this.originalViewportValue.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportInIsZero",{get:function(){return 0===this.viewportIn.width||0===this.viewportIn.height},enumerable:!0,configurable:!0}),e.prototype.resetMargin=function(){this.margin=this.defaultMargin},e.prototype.update=function(){this.viewportInValue=e.restrictToMinMax({width:this.viewport.width-(this.margin.left+this.margin.right),height:this.viewport.height-(this.margin.top+this.margin.bottom)},this.minViewportValue)},e.prototype.setUpdateObject=function(t,i,a){var r=this;t=_.clone(t),i(e.createNotifyChangedObject(t,function(e){a&&a(t),r.update()})),a&&a(t),this.update()},e.createNotifyChangedObject=function(e,t){var i={};return _.keys(e).forEach(function(a){return Object.defineProperty(i,a,{get:function(){return e[a]},set:function(i){e[a]=i,t(e,a)},enumerable:!0,configurable:!0})}),i},e.restrictToMinMax=function(e,t){return _.keys(e).forEach(function(i){return e[i]=Math.max(t&&t[i]||0,e[i])}),e},e}(),d=function(){function e(){}return e.setAttrThroughTransitionIfNotResized=function(e,t,i,a,r,o){o?e.attr(i,a):t(e.transition()).attrTween(i,r)},e.interpolateArc=function(e){return function(t){if(!this.oldData)return this.oldData=t,function(){return e(t)};var i=d3.interpolate(this.oldData,t);return this.oldData=i(0),function(t){return e(i(t))}}},e.addContext=function(e,t){return function(){return t.apply(e,[this].concat(_.toArray(arguments)))}},e}(),m=function(){function i(){this.legend={show:!1,position:t.LegendPosition[t.LegendPosition.Top],showTitle:!0,titleText:"",labelColor:t.LegendData.DefaultLegendLabelFillColor,fontSize:8},this.labels={show:!1,color:t.dataLabelUtils.defaultLabelColor,displayUnits:0,precision:t.dataLabelUtils.defaultLabelPrecision,fontSize:t.dataLabelUtils.DefaultFontSizeInPt},this.outerLine={show:!1,thickness:1}}return Object.defineProperty(i,"Default",{get:function(){return new this},enumerable:!0,configurable:!0}),i.parse=function(e,t){var i=new this;if(!e||!e.metadata||!e.metadata.objects)return i;var a=this.getProperties(t);for(var r in t.objects)for(var o in t.objects[r].properties)if(i[r]&&_.has(i[r],o)){var n=t.objects[r].properties[o].type,s=this.getValueFnByType(n);i[r][o]=s(e.metadata.objects,a[r][o],i[r][o])}return i},i.getProperties=function(e){var t=_.merge({general:{properties:{formatString:{}}}},e.objects),i={};for(var a in t){i[a]={};for(var r in t[a].properties)i[a][r]={objectName:a,propertyName:r}}return i},i.createEnumTypeFromEnum=function(t){var i=!1;return e.createEnumType(Object.keys(t).filter(function(e,a){return!!(a%2)===i&&t[e]===e&&!void(i=!i)||!!(a%2)!==i}).map(function(e){return{value:e,displayName:e}}))},i.getValueFnByType=function(t){switch(_.keys(t)[0]){case"fill":return e.DataViewObjects.getFillColor;default:return e.DataViewObjects.getValue}},i.enumerateObjectInstances=function(e,i,a){void 0===e&&(e=new this);var r=new t.ObjectEnumerationBuilder,o=e&&e[i.objectName];if(!o)return r;var n={objectName:i.objectName,selector:null,properties:{}};for(var s in o)_.has(o,s)&&(n.properties[s]=o[s]);return r.pushInstance(n),r},i.prototype.createOriginalSettings=function(){this.originalSettings=_.cloneDeep(this)},i}();i.AsterPlotSettings=m;var g=function(){function e(){this.Category=null,this.Y=null}return e.getColumnSources=function(e){return this.getColumnSourcesT(e)},e.getTableValues=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&_.mapValues(i,function(e,i){return e&&t.rows.map(function(t){return t[e.index]})})},e.getTableRows=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&t.rows.map(function(e){return _.mapValues(i,function(t,i){return t&&e[t.index]})})},e.getCategoricalValues=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[],r=t&&a.source&&this.getSeriesValues(e);return t&&_.mapValues(new this,function(e,t){return _.toArray(i).concat(_.toArray(a)).filter(function(e){return e.source.roles&&e.source.roles[t]}).map(function(e){return e.values})[0]||a.source&&a.source.roles&&a.source.roles[t]&&r})},e.getSeriesValues=function(e){return e&&e.categorical&&e.categorical.values&&e.categorical.values.map(function(e){return t.converterHelper.getSeriesName(e.source)})},e.getCategoricalColumns=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[];return t&&_.mapValues(new this,function(e,t){return i.filter(function(e){return e.source.roles&&e.source.roles[t]})[0]||a.source&&a.source.roles&&a.source.roles[t]||a.filter(function(e){return e.source.roles&&e.source.roles[t]})})},e.getColumnSourcesT=function(e){var t=e&&e.metadata&&e.metadata.columns;return t&&_.mapValues(new this,function(e,i){return t.filter(function(e){return e.roles&&e.roles[i]})[0]})},e.Roles=Object.freeze(_.mapValues(new e,function(e,t){return t})),e}();i.AsterPlotColumns=g;var f=function(){function i(){}return i.converter=function(e,a){var r=g.getCategoricalColumns(e),s=g.getCategoricalValues(e);if(r&&r.Category&&!_.isEmpty(r.Category.values)&&!_.isEmpty(r.Y)&&!_.isEmpty(r.Y[0].values)){for(var l=i.parseSettings(e,r.Category.source),c=m.getProperties(i.capabilities),h=[],u=[],p={dataPoints:[],title:null,fontSize:m.Default.legend.fontSize,labelColor:t.LegendData.DefaultLegendLabelFillColor},d=new t.ColorHelper(a),f=!!r.Y[0].highlights,y=Math.max(d3.min(r.Y[0].values)),v=Math.min(0,d3.min(r.Y[0].values)),x=n.create({format:n.getFormatString(r.Y[0].source,c.general.formatString),precision:l.labels.precision,value:0===l.labels.displayUnits&&null!=y?y:l.labels.displayUnits}),E=t.valueFormatter.getFormatString(r.Category.source,c.general.formatString),b=o.fromPoint(l.labels.fontSize),T=0;T<s.Category.length;T++){var w=t.valueFormatter.format(s.Category[T],E),S=r.Y[0].values[T],R=t.TooltipBuilder.createTooltipInfo(c.general.formatString,e.categorical,w,S,null,null,0);if(r.Y.length>1){var C=t.TooltipBuilder.createTooltipInfo(c.general.formatString,e.categorical,w,r.Y[1].values[T],null,null,1)[1];C&&R.push(C),S+=r.Y[1].values[T]}var A=r.Category.identity[T],M=d.getColorForMeasure(r.Category.objects&&r.Category.objects[T],A.key),H=t.SelectionId.createWithId(A),P=Math.max(0,r.Y.length>1?r.Y[1].values[T]:1);if(P>0&&h.push({sliceHeight:r.Y[0].values[T]-v,sliceWidth:P,label:x.format(S),color:M,identity:H,selected:!1,tooltipInfo:R,labelFontSize:b,highlight:!1}),l.legend.show&&p.dataPoints.push({label:w,color:M,icon:t.LegendIcon.Box,selected:!1,identity:H}),f){var D=t.SelectionId.createWithHighlight(H),L=null!=r.Y[0].highlights[T];if(S=L?r.Y[0].highlights[T]:0,R=t.TooltipBuilder.createTooltipInfo(c.general.formatString,e.categorical,w,S,null,null,0),r.Y.length>1){var C=t.TooltipBuilder.createTooltipInfo(c.general.formatString,e.categorical,w,r.Y[1].highlights[T],null,null,1)[1];C&&R.push(C),S+=null!==r.Y[1].highlights[T]?r.Y[1].highlights[T]:0}u.push({sliceHeight:L?r.Y[0].highlights[T]-v:null,sliceWidth:Math.max(0,r.Y.length>1&&null!==r.Y[1].highlights[T]?r.Y[1].highlights[T]:P),label:x.format(S),color:M,identity:D,selected:!1,tooltipInfo:R,labelFontSize:b,highlight:!0})}}return h.length&&{dataPoints:h,settings:l,hasHighlights:f,legendData:p,highlightedDataPoints:u,labelFormatter:x,centerText:r.Category.source.displayName}}},i.parseSettings=function(e,t){var a=m.parse(e,i.capabilities);return a.labels.precision=Math.min(17,Math.max(0,a.labels.precision)),a.outerLine.thickness=Math.min(300,Math.max(1,a.outerLine.thickness)),a.createOriginalSettings(),_.isEmpty(a.legend.titleText)&&(a.legend.titleText=t.displayName),a},Object.defineProperty(i.prototype,"settings",{get:function(){return this.data&&this.data.settings},enumerable:!0,configurable:!0}),i.prototype.init=function(e){this.hostServices=e.host,this.hostServices.canSelect=function(e){return!(e.data&&e.data.length>1&&e.data.some(function(e){return e&&e.data&&e.data.length>1}))},this.layout=new p(e.viewport,{top:10,right:10,bottom:15,left:10});var a=e.element,r=this.svg=d3.select(a.get(0)).append("svg").classed(s,!0).style("position","absolute");this.colors=e.style.colorPalette.dataColors,this.mainGroupElement=r.append("g"),this.mainLabelsElement=r.append("g"),this.behavior=new h,this.clearCatcher=t.appendClearCatcher(this.mainGroupElement),this.slicesElement=this.mainGroupElement.append("g").classed(i.AsterSlices["class"],!0);var o=e.interactivity;this.interactivityService=t.createInteractivityService(this.hostServices),this.legend=t.createLegend(a,o&&o.isInteractiveLegend,this.interactivityService,!0)},i.prototype.update=function(e){if(e&&e.dataViews&&e.dataViews[0]){this.layout.viewport=e.viewport;var a=e.suppressAnimations?0:t.AnimatorCommon.MinervaAnimationDuration,r=i.converter(e.dataViews[0],this.colors);if(!r)return void this.clear();this.data=r,this.interactivityService&&(this.interactivityService.applySelectionStateToData(this.data.dataPoints),this.interactivityService.applySelectionStateToData(this.data.highlightedDataPoints)),this.renderLegend(),this.updateViewPortAccordingToLegend(),this.svg.attr(this.layout.viewport);var o=(this.layout.viewportIn.width+this.layout.margin.right)/2,n=(this.layout.viewportIn.height+this.layout.margin.bottom)/2;if(this.mainGroupElement.attr("transform",t.SVGUtil.translate(o,n)),this.mainLabelsElement.attr("transform",t.SVGUtil.translate(o,n)),this.clearCatcher.attr("transform",t.SVGUtil.translate(-o,-n)),t.dataLabelUtils.cleanDataLabels(this.mainLabelsElement,!0),this.renderArcsAndLabels(a),this.data.hasHighlights?this.renderArcsAndLabels(a,!0):this.slicesElement.selectAll(i.AsterHighlightedSlice.selector).remove(),this.interactivityService){var s={selection:this.slicesElement.selectAll(i.AsterSlice.selector+", "+i.AsterHighlightedSlice.selector),clearCatcher:this.clearCatcher,interactivityService:this.interactivityService,hasHighlights:this.data.hasHighlights};this.interactivityService.bind(this.data.dataPoints.concat(this.data.highlightedDataPoints),this.behavior,s)}}},i.prototype.renderArcsAndLabels=function(e,a){var r=this;void 0===a&&(a=!1);var o=Math.min(this.layout.viewportIn.width,this.layout.viewportIn.height)/2,n=.3*(this.settings.labels.show?o*l:o),s=d3.max(this.data.dataPoints,function(e){return e.sliceHeight}),c=d3.sum(this.data.dataPoints,function(e){return e.sliceWidth}),h=d3.layout.pie().sort(null).value(function(e){return(e&&!isNaN(e.sliceWidth)?e.sliceWidth:0)/c}),u=d3.svg.arc().innerRadius(n).outerRadius(function(e){var t=(o-n)*(e&&e.data&&!isNaN(e.data.sliceHeight)?e.data.sliceHeight:1)/s,i=n+(r.settings.labels.show?t*l:t);return Math.max(i,n)}),p=h(a?this.data.highlightedDataPoints:this.data.dataPoints),m=a?i.AsterHighlightedSlice:i.AsterSlice,g=this.slicesElement.selectAll(m.selector).data(p,function(e,t){return e.data?e.data.identity.getKey():t});if(g.enter().append("path").classed(m["class"],!0).attr("stroke","#333"),g.attr("fill",function(e){return e.data.color}).call(function(t){return d.setAttrThroughTransitionIfNotResized(t,function(t){return t.duration(e)},"d",u,d.interpolateArc(u),r.layout.viewportChanged)}),g.exit().remove(),t.TooltipManager.addTooltip(g,function(e){return e.data.data.tooltipInfo}),this.settings.labels.show&&(!this.data.hasHighlights||this.data.hasHighlights&&a)){var f=function(e){var t=o*(e&&!isNaN(e.sliceHeight)?e.sliceHeight:1)/s+n;return Math.max(t,n)},y=d3.svg.arc().innerRadius(function(e){return f(e.data)}).outerRadius(function(e){return f(e.data)}),v=function(e){var t=(o-n)*(e&&!isNaN(e.sliceHeight)?e.sliceHeight:1)/s;return t=n+t*l,Math.max(t,n)},x=d3.svg.arc().innerRadius(function(e){return v(e.data)}).outerRadius(function(e){return v(e.data)}),E=this.getLabelLayout(y,this.layout.viewport);this.drawLabels(p.filter(function(e){return!a||null!==e.data.sliceHeight}),this.mainLabelsElement,E,this.layout.viewport,x,y)}else t.dataLabelUtils.cleanDataLabels(this.mainLabelsElement,!0);return a||(this.drawCenterText(n),this.drawOuterLine(n,_.max(p.map(function(e){return u.outerRadius()(e)})),p)),g},i.prototype.getLabelLayout=function(i,a){var r=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2},n={fontFamily:t.dataLabelUtils.StandardFontFamily,fontSize:o.fromPoint(this.settings.labels.fontSize),text:""},s=function(t){var r=i.centroid(t);n.text=t.data.label;var o=e.TextMeasurementService.measureSvgTextWidth(n),s=a.width/2-Math.abs(r[0]),l=e.TextMeasurementService.estimateSvgTextHeight(n),c=a.height/2-Math.abs(r[1]);return t.isLabelHasConflict=o>s||l>c,t.isLabelHasConflict};return{labelText:function(t){n.text=t.data.label;var r=i.centroid(t),o=s(t)?r[0]*c:r[0],l=a.width/2-Math.abs(o);return e.TextMeasurementService.getTailoredTextOrDefault(n,l)},labelLayout:{x:function(e){var t=i.centroid(e);n.text=e.data.label;var a=e.isLabelHasConflict?t[0]*c:t[0];return a},y:function(e){var t=i.centroid(e),a=e.isLabelHasConflict?t[1]*c:t[1];return a}},filter:function(e){return null!=e&&!_.isEmpty(e.data.label)},style:{fill:this.settings.labels.color,"font-size":n.fontSize,"text-anchor":function(e){return r(e)<Math.PI?"start":"end"}}}},i.prototype.drawLabels=function(a,r,o,n,s,l){var c=this,h=new e.DataLabelManager,u=h.hideCollidedLabels(n,a,o,!0);if(0===u.length)return void t.dataLabelUtils.cleanDataLabels(r,!0);r.select(i.labelGraphicsContextClass.selector).empty()&&r.append("g").classed(i.labelGraphicsContextClass["class"],!0);var p=r.select(i.labelGraphicsContextClass.selector).selectAll(".data-labels").data(u,function(e){return e.data.identity.getKey()});if(p.enter().append("text").classed("data-labels",!0),p){p.attr({x:function(e){return e.labelX},y:function(e){return e.labelY},dy:".35em"}).text(function(e){return e.labeltext}).style(o.style),p.exit().remove(),r.select(i.linesGraphicsContextClass.selector).empty()&&r.append("g").classed(i.linesGraphicsContextClass["class"],!0),u=_.filter(u,function(e){return null!==e.data.sliceHeight&&0!==e.data.sliceHeight});var d=r.select(i.linesGraphicsContextClass.selector).selectAll("polyline").data(u,function(e){return e.data.identity.getKey()}),m=4,g=1.02,f=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2};d.enter().append("polyline").classed("line-label",!0),d.attr("points",function(e){var t=[e.labelX,e.labelY];t[0]=t[0]+(f(e)<Math.PI?-1:1)*m;var i=s.centroid(e);return i[0]*=g,i[1]*=g,[i,t]}).style({opacity:.5,"fill-opacity":0,stroke:function(e){return c.settings.labels.color}}),d.exit().remove()}},i.prototype.renderLegend=function(){if(this.settings.legend.show){var e=_.clone(this.settings.legend);e.labelColor={solid:{color:e.labelColor}},t.LegendData.update(this.data.legendData,e),this.legend.changeOrientation(t.LegendPosition[this.settings.legend.position])}this.legend.drawLegend(this.data.legendData,this.layout.viewportCopy),t.Legend.positionChartArea(this.svg,this.legend)},i.prototype.updateViewPortAccordingToLegend=function(){if(this.settings.legend.show){var e=this.legend.getMargins(),i=t.LegendPosition[this.settings.legend.position];switch(i){case t.LegendPosition.Top:case t.LegendPosition.TopCenter:case t.LegendPosition.Bottom:case t.LegendPosition.BottomCenter:this.layout.viewport.height-=e.height;break;case t.LegendPosition.Left:case t.LegendPosition.LeftCenter:case t.LegendPosition.Right:case t.LegendPosition.RightCenter:this.layout.viewport.width-=e.width}}},i.prototype.drawOuterLine=function(e,t,a){var r=this.mainGroupElement,o=d3.svg.arc().innerRadius(e).outerRadius(t);if(this.settings.outerLine.show){var n=this.settings.outerLine.thickness+"px",s=r.selectAll(i.OuterLine.selector).data(a);s.enter().append("path"),s.attr("fill","none").attr({stroke:"#333","stroke-width":n,d:o}).style("opacity",1).classed(i.OuterLine["class"],!0),s.exit().remove()}else r.selectAll(i.OuterLine.selector).remove()},i.prototype.drawCenterText=function(a){if(_.isEmpty(this.data.centerText))return void this.mainGroupElement.select(i.CenterLabelClass.selector).remove();var r={fontFamily:t.dataLabelUtils.StandardFontFamily,fontWeight:"bold",fontSize:o.toString(a*i.CenterTextFontHeightCoefficient),text:this.data.centerText};this.mainGroupElement.select(i.CenterLabelClass.selector).empty()&&(this.centerText=this.mainGroupElement.append("text").classed(i.CenterLabelClass["class"],!0)),this.centerText.style({"line-height":1,"font-weight":r.fontWeight,"font-size":r.fontSize,fill:this.settings.labels.color}).attr({dy:"0.35em","text-anchor":"middle"}).text(e.TextMeasurementService.getTailoredTextOrDefault(r,a*i.CenterTextFontWidthCoefficient))},i.prototype.clear=function(){this.mainGroupElement.selectAll("path").remove(),this.mainGroupElement.select(i.CenterLabelClass.selector).remove(),t.dataLabelUtils.cleanDataLabels(this.mainLabelsElement,!0),this.legend.drawLegend({dataPoints:[]},this.layout.viewportCopy)},i.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},i.prototype.enumerateObjectInstances=function(e){var t=m.enumerateObjectInstances(this.settings&&this.settings.originalSettings,e,i.capabilities);return t.complete()},i.capabilities={dataRoles:[{displayName:"Category",name:g.Roles.Category,kind:e.VisualDataRoleKind.Grouping},{displayName:"Y Axis",name:g.Roles.Y,kind:e.VisualDataRoleKind.Measure}],dataViewMappings:[{conditions:[{Category:{max:1},Y:{max:2}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:"Y"}}]}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},legend:{displayName:"Legend",description:"Display legend options",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",description:"Select the location for the legend",type:{enumeration:t.legendPosition.type}},showTitle:{displayName:"Title",description:"Display a title for legend symbols",type:{bool:!0}},titleText:{displayName:"Legend Name",description:"Title text",type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},label:{displayName:"Center Label",properties:{fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}}}},labels:{displayName:"Detail Labels",properties:{show:{type:{bool:!0}},color:{displayName:"Color",type:{fill:{solid:{color:!0}}}},displayUnits:{displayName:"Display Units",type:{formatting:{displayUnits:!0}}},precision:{displayName:"Decimal Places",placeHolderText:"Auto",type:{numeric:!0}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},outerLine:{displayName:"Outer line",properties:{show:{displayName:"Show",type:{bool:!0}},thickness:{displayName:"Thickness",type:{numeric:!0}}}}},supportsHighlight:!0},i.AsterSlices=r("asterSlices"),i.AsterSlice=r("asterSlice"),i.AsterHighlightedSlice=r("asterHighlightedSlice"),i.OuterLine=r("outerLine"),i.labelGraphicsContextClass=r("labels"),i.linesGraphicsContextClass=r("lines"),i.CenterLabelClass=r("centerLabel"),i.CenterTextFontHeightCoefficient=.4,i.CenterTextFontWidthCoefficient=1.9,i}();i.AsterPlot=f}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){function r(){return new l}var o=a.PixelConverter,n=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.columns=e.columns,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.columns.on("click",function(e,i){t.handleSelection(e,d3.event.ctrlKey)}),this.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var i=this.interactivityService.hasSelection();this.columns.style("fill-opacity",function(a){return t.ColumnUtil.getFillOpacity(a.selected,a.highlight,!a.highlight&&e,!a.selected&&i)})},e}(),s=function(){function e(e,t,i,a,r){this.scrollYBrush=d3.svg.brush(),this.getRoot=e,this.getViewport=t,this.isScrollable=r,this.getPrefferedHeight=a}return Object.defineProperty(e.prototype,"scrollViewport",{get:function(){return{height:this.viewport.height,width:this.viewport.width-(this.isYScrollBarVisible&&this.isScrollable?c.ScrollBarWidth:0)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this.getViewport()},enumerable:!0,configurable:!0}),e.prototype.renderY=function(e,t){var i=this;if(this.isYScrollBarVisible=this.isScrollable&&this.getPrefferedHeight()>this.viewport.height&&this.viewport.height>0&&this.viewport.width>0,this.brushGraphicsContextY=this.createOrRemoveScrollbar(this.isYScrollBarVisible,this.brushGraphicsContextY,"y brush"),!this.isYScrollBarVisible)return void t.call(this,jQuery.extend(!0,{},e),0,1);var a=this.viewport.height,r=this.getExtentData(this.getPrefferedHeight(),a),o=function(o){void 0===o&&(o=0);var n=i.scrollYBrush.extent();if(0!==o){var s=(n[1]-n[0])/2;if(n[0]+=o>0?s:-s,n[1]+=o>0?s:-s,n[0]<0){var l=0-n[0];n[0]+=l,n[1]+=l}if(n[1]>a){var l=n[1]-a;n[0]-=l,n[1]-=l}i.scrollYBrush.extent(n),i.brushGraphicsContextY.select(".extent").attr("y",n[0])}var c=r.toScrollPosition(n,a);t.call(i,jQuery.extend(!0,{},e),c[0],c[1]),i.setScrollBarSize(i.brushGraphicsContextY,r.value[1],!0)},n=d3.scale.ordinal().rangeBands([0,a]);this.scrollYBrush.y(n).extent(r.value),this.renderScrollbar(this.scrollYBrush,this.brushGraphicsContextY,this.viewport.width,o),o()},e.prototype.createOrRemoveScrollbar=function(e,t,i){return e&&this.isScrollable?t||this.root.append("g").classed(i,!0):t?void t.remove():void 0},e.prototype.renderScrollbar=function(e,i,a,r){var o=this;e.on("brush",function(){return window.requestAnimationFrame(function(){return r(0)})}),this.root.on("wheel",function(){if(o.isYScrollBarVisible){var e=d3.event;r(e.deltaY)}}),i.attr({transform:t.SVGUtil.translate(a,0),"drag-resize-disabled":"true"}),i.call(e),i.selectAll(".resize").remove(),i.select(".background").remove(),i.selectAll(".extent").style({"fill-opacity":.125,cursor:"default"})},e.prototype.setScrollBarSize=function(e,t,i){e.selectAll("rect").attr(i?"width":"height",c.ScrollBarWidth),e.selectAll("rect").attr(i?"height":"width",t)},e.prototype.getExtentData=function(t,i){var a=i*i/t,r=e.ScrollBarMinLength<=a?1:a/e.ScrollBarMinLength;a=Math.max(a,e.ScrollBarMinLength);var o=function(e,t){var i=e[1]-e[0],a=e[0]/(t-i);i*=r;var o=a*(t-i),n=o+i;return[o/t,n/t]};return{value:[0,a],toScrollPosition:o}},e.prototype.clearData=function(){this.brushGraphicsContextY&&this.brushGraphicsContextY.selectAll("*").remove()},e.ScrollBarMinLength=15,e}(),l=function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"TornadoChartWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){var t,i="This visual requires two distinct values to be returned for the Legend field.",a="",r="";return t={message:i,title:e.get(a),detail:e.get(r)}},e}();i.TornadoChartWarning=l,i.getTornadoChartWarning=r;var c=function(){function i(e){this.textOptions={},this.columnPadding=5,this.leftLabelMargin=4,this.InnerTextHeightDelta=2,this.margin={top:10,right:5,bottom:10,left:10},this.heightColumn=0,e&&(this.svg=e.svg||this.svg,this.margin=e.margin||this.margin,this.columnPadding=e.columnPadding||this.columnPadding,this.animator=e.animator)}return i.getProperties=function(e){var t={};for(var i in e.objects){t[i]={};for(var a in e.objects[i].properties)t[i][a]={objectName:i,propertyName:a}}return t},i.converter=function(a,r,n){if(!(a&&a.categorical&&a.categorical.categories&&a.categorical.categories[0]&&a.categorical.categories[0].source&&a.categorical.values&&a.categorical.values[0]))return null;var s=a.categorical,l=s.categories||[],c=s.values,h=l[0],u=i.Properties.general.formatString,p=d3.max(c[0].values),d=i.parseSettings(a.metadata.objects,p,n),m=!!c.source,g=!!(c.length>0&&c[0].highlights),f=e.TextMeasurementService.estimateSvgTextHeight({fontFamily:t.dataLabelUtils.StandardFontFamily,fontSize:o.fromPoint(d.labelSettings.fontSize)}),y=[],v=[],x=[],E=t.valueFormatter.getFormatString(h.source,u),b=h.values.map(function(e){var a=t.valueFormatter.format(e,E);return i.getTextData(a,r,!0)}),T=c.grouped?c.grouped():null,w=Math.min(d3.min(c[0].values),0);c.length===i.MaxSeries&&(w=d3.min([w,d3.min(c[1].values)]),p=d3.max([p,d3.max(c[1].values)]));for(var S=0;S<c.length;S++){var R=T&&T.length>S&&T[S].values?T[S]:null,C=i.parseSeries(c,S,m,R,n);y.push(C);for(var A=c[S],M=A.source.queryName,H=0;H<h.values.length;H++){var P,D=null==A.values[H]||isNaN(A.values[H])?0:A.values[H],L=t.SelectionIdBuilder.builder().withCategory(h,H).withSeries(c,R).withMeasure(M).createSelectionId(),N=b[H].text;P=t.TooltipBuilder.createTooltipInfo(u,s,N,D,null,null,S,H,null);var V=C.categoryAxisEnd?Math.min(C.categoryAxisEnd,p):p,z=a.categorical.values[S].source.format;if(v.push({value:D,minValue:w,maxValue:V,formatString:z,color:C.fill,selected:!1,identity:L,tooltipData:P,categoryIndex:H}),g){var I=t.SelectionId.createWithHighlight(L),F=A.highlights[H],O=null!=F?F:0;P=t.TooltipBuilder.createTooltipInfo(u,s,N,D,null,null,S,H,O),x.push({value:O,minValue:w,maxValue:V,formatString:z,color:C.fill,selected:!1,identity:I,tooltipData:P,categoryIndex:H,highlight:!0})}}}return{categories:b,series:y,settings:d,legend:i.getLegendData(y,m),dataPoints:v,highlightedDataPoints:x,maxLabelsWidth:_.max(b.map(function(e){return e.width})),hasDynamicSeries:m,hasHighlights:g,labelHeight:f,legendObjectProperties:e.DataViewObjects.getObject(a.metadata.objects,"legend",{})}},i.parseSeries=function(e,a,r,o,n){var s,l,c=e?e[a]:null,h=c?c.source:null,u=o?o.identity:null,p=h?h.queryName:null,d=u?t.SelectionId.createWithId(u):t.SelectionIdBuilder.builder().withSeries(e,o).withMeasure(p).createSelectionId(),m=h?h.groupName?h.groupName:h.displayName:null;r&&o?(l=o.objects?o.objects.categoryAxis:null,s=o.objects):h&&(s=h.objects,l=s?s.categoryAxis:null);var g=i.getColor(i.Properties.dataPoint.fill,["purple","teal"][a],s,n),f=l?l.end:null;return{fill:g,name:m,selectionId:d,categoryAxisEnd:f}},i.getColor=function(e,i,a,r){var o=new t.ColorHelper(r,e,i);return o.getColorForMeasure(a,"")},i.getTextData=function(t,i,a,r,n){void 0===a&&(a=!1),void 0===r&&(r=!1);var s,l,c=0,h=0;return t=t||"",s=n?o.fromPoint(n):""+i.fontSize+i.sizeUnit,l={text:t,fontFamily:i.fontFamily,fontSize:s},a&&(c=e.TextMeasurementService.measureSvgTextWidth(l)),r&&(h=e.TextMeasurementService.estimateSvgTextHeight(l)),{text:t,width:c,height:h,textProperties:l}},Object.defineProperty(i.prototype,"allLabelsWidth",{get:function(){return(this.dataView.settings.showCategories?Math.min(this.dataView.maxLabelsWidth,this.scrolling.scrollViewport.width/2):3)+i.CategoryLabelMargin;
},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"allColumnsWidth",{get:function(){return this.scrolling.scrollViewport.width-this.allLabelsWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"columnWidth",{get:function(){return this.dataView.series.length===i.MaxSeries?this.allColumnsWidth/2:this.allColumnsWidth},enumerable:!0,configurable:!0}),i.prototype.init=function(e){var a,r=this,o=e.style;this.hostService=e.host;var l=e.element;this.colors=o.colorPalette.dataColors;var c=e.interactivity;this.interactivityService=t.createInteractivityService(this.hostService);var h;this.svg?this.root=h=this.svg:this.root=h=d3.select(l.get(0)).append("svg"),h.classed(i.ClassName,!0).style("position","absolute"),a=h.style("font-size"),this.textOptions.sizeUnit=a.slice(a.length-2),this.textOptions.fontSize=Number(a.slice(0,a.length-2)),this.textOptions.fontFamily=h.style("font-family"),this.viewport=e.viewport,this.scrolling=new s(function(){return h},function(){return r.viewport},function(){return r.margin},function(){return r.dataView.categories.length*i.CategoryMinHeight},!0);var u=this.main=h.append("g");this.clearCatcher=t.appendClearCatcher(u),this.columns=u.append("g").classed(i.Columns["class"],!0),this.axes=u.append("g").classed(i.Axes["class"],!0),this.labels=u.append("g").classed(i.Labels["class"],!0),this.categories=u.append("g").classed(i.Categories["class"],!0),this.behavior=new n,this.legend=t.createLegend(l,c&&c.isInteractiveLegend,this.interactivityService,!0)},i.prototype.update=function(e){if(e&&e.dataViews&&e.dataViews[0]){if(this.viewport={height:Math.max(0,e.viewport.height-this.margin.top-this.margin.bottom),width:Math.max(0,e.viewport.width-this.margin.left-this.margin.right)},this.animator?this.durationAnimations=t.AnimatorCommon.GetAnimationDuration(this.animator,e.suppressAnimations):this.durationAnimations=e.suppressAnimations?0:250,this.dataView=i.converter(this.validateDataView(e.dataViews[0]),this.textOptions,this.colors),!this.dataView||this.scrolling.scrollViewport.height<i.CategoryMinHeight)return void this.clearData();this.dataView&&this.interactivityService&&(this.interactivityService.applySelectionStateToData(this.dataView.dataPoints),this.interactivityService.applySelectionStateToData(this.dataView.highlightedDataPoints)),this.render()}},i.prototype.validateDataView=function(e){return e&&e.categorical&&e.categorical.values?e.categorical.values.length>i.MaxSeries?(this.hostService.setWarnings([r()]),null):e:null},i.prototype.updateElements=function(){var e=t.SVGUtil.translate(this.allLabelsWidth,0);this.root.attr({height:this.viewport.height+this.margin.top+this.margin.bottom,width:this.viewport.width+this.margin.left+this.margin.right}),this.columns.attr("transform",e),this.labels.attr("transform",e),this.axes.attr("transform",e)},i.parseSettings=function(a,r,o){var n=i.getPrecision(a),s=e.DataViewObjects.getValue(a,i.Properties.labels.labelDisplayUnits,i.DefaultTornadoChartSettings.labelSettings.displayUnits),l=i.DefaultTornadoChartSettings.labelSettings,c=function(e){return t.valueFormatter.create({format:e,precision:n,value:0===s&&null!=r?r:s})};return{labelOutsideFillColor:i.getColor(i.Properties.labels.outsideFill,i.DefaultTornadoChartSettings.labelOutsideFillColor,a,o),labelSettings:{show:e.DataViewObjects.getValue(a,i.Properties.labels.show,l.show),precision:n,fontSize:e.DataViewObjects.getValue(a,i.Properties.labels.fontSize,l.fontSize),displayUnits:s,labelColor:i.getColor(i.Properties.labels.insideFill,l.labelColor,a,o)},showCategories:e.DataViewObjects.getValue(a,i.Properties.categories.show,i.DefaultTornadoChartSettings.showCategories),showLegend:e.DataViewObjects.getValue(a,i.Properties.legend.show,i.DefaultTornadoChartSettings.showLegend),legendFontSize:e.DataViewObjects.getValue(a,i.Properties.legend.fontSize,i.DefaultTornadoChartSettings.legendFontSize),legendColor:i.getColor(i.Properties.legend.labelColor,i.DefaultTornadoChartSettings.legendColor,a,o),categoriesFillColor:i.getColor(i.Properties.categories.fill,i.DefaultTornadoChartSettings.categoriesFillColor,a,o),getLabelValueFormatter:c}},i.getPrecision=function(t){var a=e.DataViewObjects.getValue(t,i.Properties.labels.labelPrecision,i.DefaultTornadoChartSettings.labelSettings.precision);return Math.min(Math.max(0,a),i.MaxPrecision)},i.getLegendData=function(e,i){var a=[];return i&&(a=e.map(function(e){return{label:e.name,color:e.fill,icon:t.LegendIcon.Box,selected:!1,identity:e.selectionId}})),{dataPoints:a}},i.prototype.render=function(){this.updateElements(),this.renderLegend(),this.scrolling.renderY(this.dataView,this.renderWithScrolling.bind(this))},i.prototype.clearData=function(){this.columns.selectAll("*").remove(),this.axes.selectAll("*").remove(),this.labels.selectAll("*").remove(),this.categories.selectAll("*").remove(),this.legend.drawLegend({dataPoints:[]},this.viewport),this.scrolling.clearData()},i.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},i.prototype.renderWithScrolling=function(e,t,a){if(this.dataView&&this.dataView.settings){var r=e.categories.length,o=t*r,n=a*r,s=Math.floor(o),l=Math.floor(n),c=Math.floor(this.scrolling.scrollViewport.height/i.CategoryMinHeight);1>a-t&&l-s>c&&(o-s>n-l?s++:n--),this.interactivityService&&(this.interactivityService.applySelectionStateToData(e.dataPoints),this.interactivityService.applySelectionStateToData(e.highlightedDataPoints)),e.categories=e.categories.slice(s,l),e.dataPoints=_.filter(e.dataPoints,function(e){return e.categoryIndex>=s&&e.categoryIndex<l}),e.highlightedDataPoints=_.filter(e.highlightedDataPoints,function(e){return e.categoryIndex>=s&&e.categoryIndex<l}),this.dataView=e,this.computeHeightColumn(),this.renderMiddleSection(),this.renderAxes(),this.renderCategories()}},i.prototype.updateViewport=function(){var e,i=this.legend.getMargins();switch(e=t.LegendPosition[this.dataView.legendObjectProperties[t.legendProps.position]]){case t.LegendPosition.Top:case t.LegendPosition.TopCenter:case t.LegendPosition.Bottom:case t.LegendPosition.BottomCenter:this.viewport.height-=i.height;break;case t.LegendPosition.Left:case t.LegendPosition.LeftCenter:case t.LegendPosition.Right:case t.LegendPosition.RightCenter:this.viewport.width-=i.width}},i.prototype.computeHeightColumn=function(){var e=this.dataView.categories.length;this.heightColumn=(this.scrolling.scrollViewport.height-(e-1)*this.columnPadding)/e},i.prototype.renderMiddleSection=function(){var e=this.dataView;this.calculateDataPoints(e.dataPoints),this.calculateDataPoints(e.highlightedDataPoints);var t=e.dataPoints.concat(e.highlightedDataPoints);this.renderColumns(t,2===e.series.length),this.renderLabels(this.dataView.hasHighlights?e.highlightedDataPoints:e.dataPoints,e.settings.labelSettings)},i.prototype.calculateDataPoints=function(e){for(var t=this.dataView.categories.length,a=this.dataView.settings,r=Math.max(this.heightColumn,0),o=r/2,n=r*i.HighlightedShapeFactor/2,s=this.dataView.series.length===i.MaxSeries,l=0;l<e.length;l++){var c=e[l],h=t>l&&s,u=l>t-1,p=this.getColumnWidth(c.value,c.minValue,c.maxValue,this.columnWidth),d=(this.columnWidth-p)*Number(h)+this.columnWidth*Number(u);d=Math.max(d,0);var m=this.dataView.hasHighlights&&c.highlight,g=m?r*(1-i.HighlightedShapeFactor)/2:0,f=(r+this.columnPadding)*(l%t)+g,y=this.getLabelData(c.value,d,p,h,c.formatString,a);c.dx=d,c.dy=f,c.px=p/2,c.py=m?n:o,c.angle=h?180:0,c.width=p,c.height=m?r*i.HighlightedShapeFactor:r,c.label=y}},i.prototype.renderColumns=function(e,a){var r=this;void 0===a&&(a=!1);var o=this.interactivityService&&this.interactivityService.hasSelection(),n=this.columns.selectAll(i.Column.selector).data(e);n.enter().append("svg:rect").classed(i.Column["class"],!0),n.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,e.highlight,o,r.dataView.hasHighlights)}).attr("transform",function(e){return t.SVGUtil.translateAndRotate(e.dx,e.dy,e.px,e.py,e.angle)}).attr("height",function(e){return e.height}).attr("width",function(e){return e.width}),n.exit().remove();var s=this.interactivityService;if(s){s.applySelectionStateToData(e);var l={columns:n,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService};s.bind(e,this.behavior,l)}this.renderTooltip(n)},i.prototype.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipData})},i.prototype.getColumnWidth=function(e,t,i,a){if(t===i)return a;var r=a*(e-t)/(i-t);return Math.max(0,Math.min(a,r))},i.prototype.getLabelData=function(a,r,n,s,l,c){var h,u=c?c:this.dataView.settings,p=u.labelSettings,d=p.fontSize,m=p.labelColor,g=s?r-this.leftLabelMargin:this.allColumnsWidth-(r+n+this.leftLabelMargin),f=Math.max(g,n-this.leftLabelMargin),y={fontFamily:t.dataLabelUtils.StandardFontFamily,fontSize:o.fromPoint(d),text:u.getLabelValueFormatter(l).format(a)},v=e.TextMeasurementService.getTailoredTextOrDefault(y,f),x=i.getTextData(v,this.textOptions,!0,!1,d);return n>x.width+i.LabelPadding?h=r+n/2-x.width/2:(h=s?r-this.leftLabelMargin-x.width:r+n+this.leftLabelMargin,m=u.labelOutsideFillColor),{dx:h,source:a,value:v,color:m}},i.prototype.renderAxes=function(){var e,t,a=this.main.select(i.Axes.selector).selectAll(i.Axis.selector);return this.dataView.series.length!==i.MaxSeries?void a.remove():(e=this.generateAxesData(),t=a.data(e),t.enter().append("svg:line").classed(i.Axis["class"],!0),t.attr("x1",function(e){return e.x1}).attr("y1",function(e){return e.y1}).attr("x2",function(e){return e.x2}).attr("y2",function(e){return e.y2}),void t.exit().remove())},i.prototype.generateAxesData=function(){var e,t,i;return e=this.allColumnsWidth/2,t=0,i=this.scrolling.scrollViewport.height,[{x1:e,y1:t,x2:e,y2:i}]},i.prototype.renderLabels=function(e,a){var r,n=this,s=this.main.select(i.Labels.selector).selectAll(i.Label.selector).data(_.filter(e,function(e){return e.label.dx>=0}));if(!a.show||this.dataView.labelHeight>=this.heightColumn)return void this.labels.selectAll("*").remove();var l=o.fromPoint(a.fontSize),c=this.heightColumn/2+this.dataView.labelHeight/2-this.InnerTextHeightDelta,h=this.dataView.categories.length;r=s.enter().append("g"),r.append("svg:title").classed(i.LabelTitle["class"],!0),r.append("svg:text").attr("dy",t.dataLabelUtils.DefaultDy).classed(i.LabelText["class"],!0),s.attr("pointer-events","none").classed(i.Label["class"],!0),s.select(i.LabelTitle.selector).text(function(e){return e.label.source}),s.attr("transform",function(e,i){var a=(n.heightColumn+n.columnPadding)*(i%h);return t.SVGUtil.translate(e.label.dx,a+c)}),s.select(i.LabelText.selector).attr("fill",function(e){return e.label.color}).attr("font-size",function(e){return l}).text(function(e){return e.label.value}),s.exit().remove()},i.prototype.renderCategories=function(){var a,r,o=this,n=this.dataView.settings,s=n.categoriesFillColor,l=this.main.select(i.Categories.selector).selectAll(i.Category.selector);return n.showCategories?(r=l.data(this.dataView.categories),a=r.enter().append("g"),a.append("svg:title").classed(i.CategoryTitle["class"],!0),a.append("svg:text").classed(i.CategoryText["class"],!0),r.attr("transform",function(e,a){var r=(o.heightColumn+o.columnPadding)*a+o.heightColumn/2,n=i.getTextData(e,o.textOptions,!1,!0);return r=r+n.height/2-o.InnerTextHeightDelta,t.SVGUtil.translate(0,r)}).classed(i.Category["class"],!0),r.select(i.CategoryTitle.selector).text(function(e){return e.text}),r.select(i.CategoryText.selector).attr("fill",s).text(function(t){return o.dataView.settings.showCategories?e.TextMeasurementService.getTailoredTextOrDefault(i.getTextData(t.text,o.textOptions).textProperties,o.allLabelsWidth):""}),void r.exit().remove()):void l.remove()},i.prototype.renderLegend=function(){var e=this.dataView.legend;if(e){var i=this.dataView.settings,a={title:e.title,dataPoints:e.dataPoints,fontSize:i.legendFontSize,labelColor:i.legendColor};if(this.dataView.legendObjectProperties){var r;t.LegendData.update(a,this.dataView.legendObjectProperties),r=this.dataView.legendObjectProperties[t.legendProps.position],r&&this.legend.changeOrientation(t.LegendPosition[r])}var o={height:this.viewport.height+this.margin.top+this.margin.bottom,width:this.viewport.width+this.margin.left+this.margin.right};this.legend.drawLegend(a,o),t.Legend.positionChartArea(this.root,this.legend),a.dataPoints.length>0&&i.showLegend&&this.updateViewport()}},i.prototype.enumerateObjectInstances=function(i){var a,r=new t.ObjectEnumerationBuilder;if(!this.dataView||!this.dataView.settings)return[];switch(a=this.dataView.settings,i.objectName){case"dataPoint":this.enumerateDataPoint(r);break;case"categoryAxis":this.enumerateCategoryAxis(r);break;case"labels":var o=a.labelSettings,n={objectName:"labels",displayName:"Labels",selector:null,properties:{show:o.show,fontSize:o.fontSize,labelPrecision:o.precision,labelDisplayUnits:o.displayUnits,insideFill:o.labelColor,outsideFill:a.labelOutsideFillColor}};r.pushInstance(n);break;case"legend":if(!this.dataView.hasDynamicSeries)return;var s,l=!0,c="";l=e.DataViewObject.getValue(this.dataView.legendObjectProperties,t.legendProps.showTitle,l),c=e.DataViewObject.getValue(this.dataView.legendObjectProperties,t.legendProps.titleText,c),s={objectName:"legend",displayName:"Legend",selector:null,properties:{show:a.showLegend,position:t.LegendPosition[this.legend.getOrientation()],showTitle:l,titleText:c,fontSize:a.legendFontSize,labelColor:a.legendColor}},r.pushInstance(s);break;case"categories":var h={objectName:"categories",displayName:"Categories",selector:null,properties:{show:a.showCategories,fill:a.categoriesFillColor}};r.pushInstance(h)}return r.complete()},i.prototype.enumerateDataPoint=function(e){if(this.dataView&&this.dataView.series)for(var i=this.dataView.series,a=0,r=i.length;r>a;a++)e.pushInstance({objectName:"dataPoint",displayName:i[a].name,selector:t.ColorHelper.normalizeSelector(i[a].selectionId.getSelector(),!1),properties:{fill:{solid:{color:i[a].fill}}}})},i.prototype.enumerateCategoryAxis=function(e){if(this.dataView&&this.dataView.series)for(var t=this.dataView.series,i=0,a=t.length;a>i;i++)e.pushInstance({objectName:"categoryAxis",displayName:t[i].name,selector:t[i].selectionId?t[i].selectionId.getSelector():null,properties:{end:t[i].categoryAxisEnd}})},i.prototype.destroy=function(){this.root=null},i.ClassName="tornado-chart",i.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Group")},{name:"Series",kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Legend")},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Values")}],dataViewMappings:[{conditions:[{Category:{max:1},Values:{min:0,max:1},Series:{min:0,max:1}},{Category:{max:1},Values:{min:2,max:2},Series:{max:0}}],categorical:{categories:{"for":{"in":"Category"}},values:{group:{by:"Series",select:[{"for":{"in":"Values"}}],dataReductionAlgorithm:{top:{}}}}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}}}},dataPoint:{displayName:"Data Colors",properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}},categoryAxis:{displayName:"X-Axis",properties:{end:{displayName:"End",type:{numeric:!0},suppressFormatPainterCopy:!0}}},labels:{displayName:"Data Labels",properties:{show:{displayName:"Show",type:{bool:!0}},labelPrecision:{displayName:"Decimal Places",placeHolderText:"Auto",type:{numeric:!0}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}},labelDisplayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}},insideFill:{displayName:"Inside fill",type:{fill:{solid:{color:!0}}}},outsideFill:{displayName:"Outside fill",type:{fill:{solid:{color:!0}}}}}},legend:{displayName:"Legend",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",description:e.data.createDisplayNameGetter("Visual_LegendPositionDescription"),type:{enumeration:t.legendPosition.type}},showTitle:{displayName:"Title",description:e.data.createDisplayNameGetter("Visual_LegendShowTitleDescription"),type:{bool:!0}},titleText:{displayName:"Legend Name",description:e.data.createDisplayNameGetter("Visual_LegendNameDescription"),type:{text:!0}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"TextSize",type:{formatting:{fontSize:!0}}}}},categories:{displayName:"Group",properties:{show:{displayName:"Show",type:{bool:!0}},fill:{displayName:"Color",type:{fill:{solid:{color:!0}}}}}}},supportsHighlight:!0},i.Properties=i.getProperties(i.capabilities),i.Columns={"class":"columns",selector:".columns"},i.Column={"class":"column",selector:".column"},i.Axes={"class":"axes",selector:".axes"},i.Axis={"class":"axis",selector:".axis"},i.Labels={"class":"labels",selector:".labels"},i.Label={"class":"label",selector:".label"},i.LabelTitle={"class":"label-title",selector:".label-title"},i.LabelText={"class":"label-text",selector:".label-text"},i.Categories={"class":"categories",selector:".categories"},i.Category={"class":"category",selector:".category"},i.CategoryTitle={"class":"category-title",selector:".category-title"},i.CategoryText={"class":"category-text",selector:".category-text"},i.MaxSeries=2,i.MaxPrecision=17,i.LabelPadding=2.5,i.CategoryMinHeight=25,i.DefaultFontSize=9,i.DefaultLegendFontSize=8,i.HighlightedShapeFactor=.5,i.CategoryLabelMargin=10,i.ScrollBarWidth=22,i.DefaultTornadoChartSettings={labelOutsideFillColor:t.dataLabelUtils.defaultLabelColor,labelSettings:{show:!0,precision:null,fontSize:i.DefaultFontSize,displayUnits:0,labelColor:t.dataLabelUtils.defaultInsideLabelColor},showCategories:!0,showLegend:!0,legendFontSize:i.DefaultLegendFontSize,legendColor:t.LegendData.DefaultLegendLabelFillColor,categoriesFillColor:"#777"},i}();i.TornadoChart=c}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){function r(e,i,r,o,n,s,l,c,h,u,p,d,m,g,f){var y=35,v=n.x,x=n.y1,E=n.y2,b=v.values,T=x.values,w=0,S=0,R=0,C=0,A=0,M=v.categoryThickness?v.categoryThickness/2:0,H=t.AxisHelper.isOrdinalScale(v.scale),P=0;if(void 0!==v.outerPadding?P=v.outerPadding:void 0!==v.xLabelMaxWidth&&(P=Math.max(0,(e.width-v.xLabelMaxWidth*b.length)/2)),0!==t.AxisHelper.getRecommendedNumberOfTicksForXAxis(e.width)||0!==t.AxisHelper.getRecommendedNumberOfTicksForYAxis(e.height)){var D;if(D=p?t.AxisHelper.LabelLayoutStrategy.DefaultRotationWithScrollbar:t.AxisHelper.LabelLayoutStrategy.DefaultRotation,g)for(var _=0,L=T.length;L>_;_++)c.text=T[_],R=Math.max(R,r(c));if(E&&f)for(var N=E.values,_=0,L=N.length;L>_;_++)h.text=N[_],C=Math.max(C,r(h));var V=o(l),z=Math.floor(s/V),I=v.scale,F=I.domain();if(m&&b.length>0){for(var _=0,L=b.length;L>_;_++){var O;l.text=b[_];var k=r(l);if(v.willLabelsWordBreak){var j=a.WordBreaker.splitByWidth(l.text,l,r,v.xLabelMaxWidth,z);O=j.length*V,k=v.xLabelMaxWidth}else!v.willLabelsFit&&H?(O=k*D.sine,k*=D.cosine):O=V;if(0===_){if(H)w=v.willLabelsFit?k/2-M-P:k-M-P,w=Math.max(w,0);else if(F.length>1){var B=I(F[0]);w=k/2-B,w=Math.max(w,0)}}else if(_===L-1)if(H)(v.willLabelsFit||v.willLabelsWordBreak)&&(S=k/2-M-P,S=Math.max(S,0));else if(F.length>1){var B=I(F[1]);S=k/2-(e.width-B),S=Math.max(S,0)}A=Math.max(A,O)}w=u?Math.min(w,y):0,S=u?Math.min(S,y):0}}var G=0,U=0,W=Math.min(Math.ceil(A),s);return d?(U=Math.min(Math.max(w,C),i),G=Math.min(Math.max(S,R),i)):(U=Math.min(Math.max(w,R),i),G=Math.min(Math.max(S,C),i)),{xMax:Math.ceil(W),yLeft:Math.ceil(U),yRight:Math.ceil(G)}}function o(e,t,i){return i>1?e&&e.length>t?[e[t]]:[]:e}function n(e,t,i){return 0===e&&!!t&&!!t.showAxisTitle||1===e&&!i&&!!t&&!!t.secShowAxisTitle}function s(e,i,a,r,o,s,l){var c={viewport:i,margin:a,forcedXDomain:[r?r.start:null,r?r.end:null],forceMerge:o&&o.secShow===!1,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:r&&null!=r.axisScale?r.axisScale:t.axisScale.linear,valueAxisScaleType:o&&null!=o.axisScale?o.axisScale:t.axisScale.linear,trimOrdinalDataOnOverflow:!1},h=!1;o&&(c.forcedYDomain=t.AxisHelper.applyCustomizedDomain([o.start,o.end],c.forcedYDomain));for(var u,p=0,d=e.length;d>p;p++){var m=e[p];c.showCategoryAxisLabel=!!r&&!!r.showAxisTitle,c.showValueAxisLabel=n(p,o,h);var g=m.calculateAxesProperties(c);0===p&&(u={x:g[0],y1:g[1]}),u.x.willLabelsFit=!1,u.x.willLabelsWordBreak=!1}return u}function l(e,i,a,r,o){void 0===o&&(o=!0);var n=[],s={isScrollable:o,animator:r,interactivityService:a};return n.push(c(t.ColumnChartType.hundredPercentStackedColumn,s)),n}function c(e,t){var i={animator:t.animator,interactivityService:t.interactivityService,isScrollable:t.isScrollable,chartType:e};return new E(i)}var h=a.CssConstants.createClassAndSelector,u=e.visuals.NewDataLabelUtils,p=function(){function e(e,t){this.data=e,this.isScalar=t}return e.prototype.lookupXValue=function(e,i){var a=t.AxisHelper.isDateTime(i);if(a&&this.isScalar)return new Date(e);var r=this.data;if(i.text)return r.categories[e];var o=r.series[0];if(o){var n=o.data;if(n){this.data.hasHighlights&&(e=2*e);var s=n[e];if(s)return a?new Date(s.categoryValue):s.categoryValue}}return e},e}();i.MekkoDataWrapper=p;var d=function(){function i(){}return i.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight,this.viewportWidth=e.viewportWidth},i.prototype.setData=function(e){this.data=e},i.createFormatter=function(e,i,a,r,o,n,s,l,c){void 0===c&&(c=!1);var h;if(a.dateTime)if(r){var u=new Date(e[0]),p=new Date(e[1]);1===n&&(u=p=new Date(i[0])),h=t.valueFormatter.create({format:o,value:u,value2:p,tickCount:n})}else{var d=l(0,a),m=l(e.length-1,a);h=t.valueFormatter.create({format:o,value:d,value2:m,tickCount:n})}else if(c&&r&&s.length>1){var g=s[1]-s[0],f=0;h=t.valueFormatter.create({format:o,value:g,value2:f,allowFormatBeautification:!0})}else h=t.valueFormatter.createDefaultFormatter(o,!0);return h},i.formatAxisTickValues=function(e,t,i,a,r,o){var n=[];return i?!o||a.numeric&&r?(e.tickFormat(function(e){return i.format(e)}),n=t.map(function(e){return i.format(e)})):(e.tickFormat(function(e){return i.format(o(e,a))}),n=t.map(function(e){return i.format(o(e,a))})):n=t.map(function(e){return o(e,a)}),n},i.prototype.createAxis=function(e){var a=e.pixelSpan,r=e.dataDomain,o=e.metaDataColumn,n=e.formatStringProp,s=e.outerPadding||0,l=!!e.isCategoryAxis,c=!!e.isScalar,h=!!e.isVertical,u=!!e.useTickIntervalForDisplayUnits,p=e.getValueFn,d=e.categoryThickness,g=t.valueFormatter.getFormatString(o,n),f=t.AxisHelper.getCategoryValueType(o,c),y=t.AxisHelper.isLogScalePossible(r,f),v=d3.scale.linear(),x=[0,1],b=r.length||1,T=E.getBorderWidth(e.borderSettings),w=a-T*(b-1);w<m.MinOrdinalRectThickness&&(w=m.MinOrdinalRectThickness),v.domain(x).range([0,w]);var S=r,R=i.createFormatter(x,r,f,c,g,b,S,p,u),C=d3.svg.axis().scale(v).tickSize(6,0).orient(h?"left":"bottom").ticks(b).tickValues(r),A=[];o&&(A=i.formatAxisTickValues(C,S,R,f,c,p));var M;if(!c&&d)M=Math.max(1,d-2*t.CartesianChart.TickLabelPadding);else{var H=S.length>1?S.length+1:S.length;M=H>1?a/H:a,M=Math.max(1,M-2*t.CartesianChart.TickLabelPadding)}return{scale:v,axis:C,formatter:R,values:A,axisType:f,axisLabel:null,isCategoryAxis:l,xLabelMaxWidth:M,categoryThickness:d,outerPadding:s,usingDefaultDomain:!1,isLogScaleAllowed:y}},i.prototype.getCategoryAxis=function(e,i,a,r,o,n,s){var l=a.categoryThickness,c=a.isScalar,h=a.outerPaddingRatio,u=new p(e,c),d=[];if(e.series&&e.series.length>0&&e.series[0].data&&e.series[0].data.length>0){var m=e.series[0].data.map(function(e){return e.originalPosition+e.value/2});d=m.filter(function(e,t){return m.indexOf(e)===t})}var g=this.createAxis({pixelSpan:i,dataDomain:d,metaDataColumn:e.categoryMetadata,formatStringProp:t.columnChartProps.general.formatString,outerPadding:l*h,isCategoryAxis:!0,isScalar:c,isVertical:r,categoryThickness:l,useTickIntervalForDisplayUnits:!0,getValueFn:function(e,t){var i=d.indexOf(e),a=u.lookupXValue(i,t);return a},scaleType:s,borderSettings:e.borderSettings});return a.categoryThickness=g.categoryThickness,g},i.prototype.setXScale=function(e,t,i,a){var r,o,n=this.width;i&&2===i.length&&(r=i[0],o=i[1]);var s=this.xProps=this.getCategoryAxis(this.data,n,this.categoryLayout,!1,r,o,a);return s},i.prototype.setYScale=function(e,i,a,r){var o=this.viewportHeight,n=t.StackedUtil.calcValueDomain(this.data.series,e),s=[n.min,n.max],l=t.AxisHelper.combineDomain(a,s),c=t.AxisHelper.scaleShouldClamp(l,s),h=this.data.valuesMetadata[0],u=e?this.graphicsContext.hostService.getLocalizedString("Percentage"):t.valueFormatter.getFormatString(h,t.columnChartProps.general.formatString),p={pixelSpan:o,dataDomain:l,metaDataColumn:h,formatString:u,outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:i,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:r,axisDisplayUnits:0,axisPrecision:0,is100Pct:e,shouldClamp:c,formatStringProp:void 0};return this.yProps=t.AxisHelper.createAxis(p),this.yProps},i.prototype.drawColumns=function(e){var a=this.data;this.columnsCenters=null;var r,o,n={columnWidth:0,xScale:this.xProps.scale,yScale:this.yProps.scale,isScalar:this.categoryLayout.isScalar,margin:this.margin},s=this.layout=i.getLayout(a,n),l=this.createMekkoLabelDataPoints(),c=t.ColumnUtil.drawSeries(a,this.graphicsContext.mainGraphicsContext,n);return this.animator&&e&&(r=this.animator.animate({viewModel:a,series:c,layout:s,itemCS:i.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}}),o=r.shapes),this.animator&&e&&!r.failed||(o=i.drawDefaultShapes(a,c,s,i.classes.item,!this.animator,this.interactivityService&&this.interactivityService.hasSelection())),t.ColumnUtil.applyInteractivity(o,this.graphicsContext.onDragStart),{shapesSelection:o,viewport:{height:this.height,width:this.width},axisOptions:n,labelDataPoints:l}},i.drawDefaultShapes=function(e,i,a,r,o,n){var s="rect";o=!1;var l;l=o?function(e){var t=_.filter(e.data,function(e){return!!e.value});return t}:function(e){return e.data};var c=i.selectAll(r.selector),h=c.data(l,function(e){return e.key});h.enter().append(s).attr("class",function(e){return r["class"].concat(e.highlight?" highlight":"")}),h.style("fill",function(e){return e.color}).style("fill-opacity",function(i){return t.ColumnUtil.getFillOpacity(i.selected,i.highlight,n,e.hasHighlights)}).attr(a.shapeLayout),h.exit().remove();var u=i.selectAll(E.BorderClass.selector),p=u.data(l,function(e){return e.key}),d=E.getBorderColor(e.borderSettings);return p.enter().append(s).classed(E.BorderClass["class"],!0),p.style("fill",function(e){return d}).style("fill-opacity",function(i){return e.hasHighlights?t.ColumnUtil.DimmedOpacity:t.ColumnUtil.DefaultOpacity}).attr(a.shapeBorder),p.exit().remove(),h},i.prototype.selectColumn=function(e,a){t.ColumnUtil.setChosenColumnOpacity(this.graphicsContext.mainGraphicsContext,i.classes.item.selector,e,a),this.moveHandle(e)},i.prototype.getClosestColumnIndex=function(e,i){return t.ColumnUtil.getClosestColumnIndex(e,this.getColumnsCenters())},i.prototype.getColumnsCenters=function(){var e=this;if(!this.columnsCenters){var i=this.categoryLayout.categoryThickness*(1-t.CartesianChart.InnerPaddingRatio);if(this.data.series.length>0){var a=0;this.categoryLayout.isScalar||(a=i/2);var r=this.data.series[0];r&&r.data&&(this.columnsCenters=r.data.map(function(t){return e.xProps.scale(e.categoryLayout.isScalar?t.categoryValue:t.categoryIndex)+a}))}}return this.columnsCenters},i.prototype.moveHandle=function(e){var t=this.getColumnsCenters(),i=t[e];if(this.columnSelectionLineHandle){var a=this.columnSelectionLineHandle;a.select("line").attr({x1:i,x2:i}),a.select("circle").attr({cx:i})}else{var a=this.columnSelectionLineHandle=this.graphicsContext.mainGraphicsContext.append("g");a.append("line").classed("interactive-hover-line",!0).attr({x1:i,x2:i,y1:0,y2:this.height}),a.append("circle").attr({cx:i,cy:this.height,r:"6px"}).classed("drag-handle",!0)}},i.getLayout=function(e,i){var a=i.xScale,r=i.yScale,o=r(0),n=a(0),s=E.getBorderWidth(e.borderSettings),l=function(e){var i=t.AxisHelper.diffScaled(a,e.value,0);return i},c=function(e){var i=n+t.AxisHelper.diffScaled(a,e.originalPosition,0)+s*e.categoryIndex;return i},h=function(e){var i=n+t.AxisHelper.diffScaled(a,e.originalPosition,0)+t.AxisHelper.diffScaled(a,e.value,0)+s*e.categoryIndex;return i};return{shapeLayout:{width:l,x:c,y:function(e){return o+t.AxisHelper.diffScaled(r,e.position,0)},height:function(e){return t.StackedUtil.getSize(r,e.valueAbsolute)}},shapeBorder:{width:function(e){return s},x:h,y:function(e){return o+t.AxisHelper.diffScaled(r,e.position,0)},height:function(e){return t.StackedUtil.getSize(r,e.valueAbsolute)}},shapeLayoutWithoutHighlights:{width:l,x:c,y:function(e){return o+t.AxisHelper.diffScaled(r,e.position,0)},height:function(e){return t.StackedUtil.getSize(r,e.originalValueAbsolute)}},zeroShapeLayout:{width:l,x:c,y:function(e){return o+t.AxisHelper.diffScaled(r,e.position,0)+t.StackedUtil.getSize(r,e.valueAbsolute)},height:function(e){return 0}},shapeXAxis:{width:l,x:c,y:function(e){return o+t.AxisHelper.diffScaled(r,e.position,0)},height:function(e){return t.StackedUtil.getSize(r,e.valueAbsolute)}}}},i.prototype.createMekkoLabelDataPoints=function(){for(var t=[],a=this.data,r=a.series,o=u.createColumnFormatterCacheManager(),n=this.layout.shapeLayout,s=0,l=r.length;l>s;s++){var c=r[s],h=c.labelSettings?c.labelSettings:a.labelSettings;if(h.show&&c.data)for(var p=u.getDisplayUnitValueFromAxisFormatter(this.yProps.formatter,h),d=0;d<c.data.length;d++){var m=c.data[d];if((!a.hasHighlights||m.highlight)&&null!=m.value){var g={left:n.x(m),top:n.y(m),width:n.width(m),height:n.height(m)},f=null,y=m.valueOriginal;h.displayUnits||(f=u.hundredPercentFormat,y=m.valueAbsolute);var v=o.getOrCreate(f,h,p),x=u.getLabelFormattedText(v.format(y)),E={text:x,fontFamily:u.LabelTextProperties.fontFamily,fontSize:u.LabelTextProperties.fontSize,fontWeight:u.LabelTextProperties.fontWeight},b=e.TextMeasurementService.measureSvgTextWidth(E),T=e.TextMeasurementService.estimateSvgTextHeight(E);t.push({isPreferred:!0,text:x,textSize:{width:b,height:T},outsideFill:h.labelColor?h.labelColor:u.defaultLabelColor,insideFill:h.labelColor?h.labelColor:u.defaultInsideLabelColor,isParentRect:!0,parentShape:{rect:g,orientation:1,validPositions:i.validLabelPositions},identity:m.identity,parentType:1})}}}return t},i.classes={item:h("column"),highlightItem:h("highlightColumn")},i.validLabelPositions=[1],i}();i.MekkoColumnChartStrategy=d;var m=function(){function i(e){this.isScrollable=!1,e?(this.type=e.chartType,e.isScrollable&&(this.isScrollable=e.isScrollable),this.animator=e.animator,e.cartesianSmallViewPortProperties&&(this.cartesianSmallViewPortProperties=e.cartesianSmallViewPortProperties),e.behavior&&(this.behavior=e.behavior)):this.behavior=new T([new t.ColumnChartWebBehavior])}return i.getTextProperties=function(e){return void 0===e&&(e=i.FontSize),{fontFamily:"wf_segoe-ui_normal",fontSize:a.PixelConverter.toString(e)}},i.prototype.init=function(e){this.visualInitOptions=e,this.layers=[];var a=this.element=e.element,r=this.currentViewport=e.viewport;this.hostServices=e.host,this.brush=d3.svg.brush(),a.addClass(i.ClassName),this.margin={top:1,right:1,bottom:1,left:1},this.yAxisOrientation=t.yAxisPosition.left,this.adjustMargins(r),this.sharedColorPalette=new t.SharedColorPalette(e.style.colorPalette.dataColors);
var o=!0,n=!0,s=this.svg=d3.select(a.get(0)).append("svg");s.style("position","absolute");var l=this.axisGraphicsContext=s.append("g").classed(i.AxisGraphicsContextClassName,!0);this.svgScrollable=s.append("svg").classed("svgScrollable",!0).style("overflow","hidden");var c=this.axisGraphicsContextScrollable=this.svgScrollable.append("g").classed(i.AxisGraphicsContextClassName,!0);this.labelGraphicsContextScrollable=this.svgScrollable.append("g").classed(u.labelGraphicsContextClass["class"],!0),this.behavior&&(this.clearCatcher=t.appendClearCatcher(this.axisGraphicsContextScrollable));var h=o?c:l;this.xAxisGraphicsContext=o?l.append("g").attr("class","x axis"):c.append("g").attr("class","x axis"),this.y1AxisGraphicsContext=h.append("g").attr("class","y axis"),this.y2AxisGraphicsContext=h.append("g").attr("class","y axis"),this.xAxisGraphicsContext.classed("showLinesOnAxis",o),this.y1AxisGraphicsContext.classed("showLinesOnAxis",n),this.y2AxisGraphicsContext.classed("showLinesOnAxis",n),this.xAxisGraphicsContext.classed("hideLinesOnAxis",!o),this.y1AxisGraphicsContext.classed("hideLinesOnAxis",!n),this.y2AxisGraphicsContext.classed("hideLinesOnAxis",!n),this.behavior&&(this.interactivityService=t.createInteractivityService(this.hostServices)),this.legend=t.createLegend(a,e.interactivity&&e.interactivity.isInteractiveLegend,this.interactivityService,!0)},i.prototype.renderAxesLabels=function(a){this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove();var r=this.margin,o=a.viewport.width-(r.left+r.right),n=a.viewport.height,s=i.FontSize,l=s,c=this.yAxisOrientation===t.yAxisPosition.right;if(!a.hideXAxisTitle){var h=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(a.axisLabels.x).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"xAxisLabel",transform:t.SVGUtil.translate(o/2,n-l)})})});h.style("fill",a.xLabelColor?a.xLabelColor.solid.color:null),h.call(t.AxisHelper.LabelLayoutStrategy.clip,o,e.TextMeasurementService.svgEllipsis)}if(!a.hideYAxisTitle){var u=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(a.axisLabels.y).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"yAxisLabel",transform:"rotate(-90)",y:c?o+r.right-s:-r.left,x:-((n-r.top-a.legendMargin)/2),dy:"1em"})})});u.style("fill",a.yLabelColor?a.yLabelColor.solid.color:null),u.call(t.AxisHelper.LabelLayoutStrategy.clip,n-(r.bottom+r.top),e.TextMeasurementService.svgEllipsis)}if(!a.hideY2AxisTitle&&a.axisLabels.y2){var p=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(a.axisLabels.y2).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"yAxisLabel",transform:"rotate(-90)",y:c?-r.left:o+r.right-s,x:-((n-r.top-a.legendMargin)/2),dy:"1em"})})});p.style("fill",a.y2LabelColor?a.y2LabelColor.solid.color:null),p.call(t.AxisHelper.LabelLayoutStrategy.clip,n-(r.bottom+r.top),e.TextMeasurementService.svgEllipsis)}},i.prototype.adjustMargins=function(e){var i=this.margin,a=e.width-(i.left+i.right),r=e.height-(i.top+i.bottom),o=this.element.find(".x.axis");0===t.AxisHelper.getRecommendedNumberOfTicksForXAxis(a)&&0===t.AxisHelper.getRecommendedNumberOfTicksForYAxis(r)?(this.margin={top:0,right:0,bottom:0,left:0},o.hide()):o.show()},i.prototype.translateAxes=function(e){this.adjustMargins(e);var a=this.margin,r=e.width-(a.left+a.right),o=e.height-(a.top+a.bottom),n=this.yAxisOrientation===t.yAxisPosition.right;this.xAxisGraphicsContext.attr("transform",t.SVGUtil.translate(0,o)),this.y1AxisGraphicsContext.attr("transform",t.SVGUtil.translate(n?r:0,0)),this.y2AxisGraphicsContext.attr("transform",t.SVGUtil.translate(n?0:r,0)),this.svg.attr({width:e.width,height:e.height}),this.svg.style("top",this.legend.isVisible()?this.legend.getMargins().height+"px":0),this.svgScrollable.attr({width:e.width,height:e.height}),this.svgScrollable.attr({x:0}),this.axisGraphicsContext.attr("transform",t.SVGUtil.translate(a.left,a.top)),this.axisGraphicsContextScrollable.attr("transform",t.SVGUtil.translate(a.left,a.top)),this.labelGraphicsContextScrollable.attr("transform",t.SVGUtil.translate(a.left,a.top)),this.isXScrollBarVisible?(this.svgScrollable.attr({x:this.margin.left}),this.axisGraphicsContextScrollable.attr("transform",t.SVGUtil.translate(0,a.top)),this.labelGraphicsContextScrollable.attr("transform",t.SVGUtil.translate(0,a.top)),this.svgScrollable.attr("width",r),this.svg.attr("width",e.width).attr("height",e.height+i.ScrollBarWidth)):this.isYScrollBarVisible&&(this.svgScrollable.attr("height",o+a.top),this.svg.attr("width",e.width+i.ScrollBarWidth).attr("height",e.height))},i.getIsScalar=function(i,a,r){var o=e.DataViewObjects.getValue(i,a);return i&&void 0!==o?o===t.axisType.scalar&&!t.AxisHelper.isOrdinal(r):!t.AxisHelper.isOrdinal(r)},i.prototype.populateObjectProperties=function(i){if(i&&i.length>0){var a=i[0].metadata;if(a?(this.legendObjectProperties=e.DataViewObjects.getObject(a.objects,"legend",{}),this.borderObjectProperties=e.DataViewObjects.getObject(a.objects,"columnBorder",{})):(this.legendObjectProperties={},this.borderObjectProperties={}),this.categoryAxisProperties=t.CartesianHelper.getCategoryAxisProperties(a),this.valueAxisProperties=t.CartesianHelper.getValueAxisProperties(a),a&&a.objects){var r=a.objects.categoryAxis,o=a.objects.valueAxis;r&&(this.categoryAxisProperties.showBorder=r.showBorder,this.categoryAxisProperties.fontSize=r.fontSize),o&&(this.valueAxisProperties.fontSize=o.fontSize)}var n=this.valueAxisProperties.position;this.yAxisOrientation=n?n.toString():t.yAxisPosition.left}},i.prototype.update=function(e){var a=this.dataViews=e.dataViews;if(this.currentViewport=e.viewport,!a)return void this.clearViewport();if(this.currentViewport.width<i.MinWidth||this.currentViewport.height<i.MinHeight)return void this.clearViewport();0===this.layers.length&&(this.layers=this.createAndInitLayers(a));var r=this.layers;if(a&&a.length>0){var n=t.getInvalidValueWarnings(a,!1,!1,!1);n&&n.length>0&&this.hostServices.setWarnings(n),this.populateObjectProperties(a)}this.sharedColorPalette.clearPreferredScale();for(var s=0,l=r.length;l>s;s++)r[s].setData(o(a,s,l)),l>1&&this.sharedColorPalette.rotateScale();this.visualInitOptions.interactivity&&this.visualInitOptions.interactivity.isInteractiveLegend||this.renderLegend(),this.render(!this.hasSetData||e.suppressAnimations),this.hasSetData=this.hasSetData||a&&a.length>0},i.prototype.clearViewport=function(){this.legend.reset(),this.setVisibility(!1)},i.prototype.setVisibility=function(e){void 0===e&&(e=!0),this.svg.style("display",e?"block":"none"),this.element.find(".legend").toggle(e)},i.parseLabelSettings=function(e){var a=t.dataLabelUtils.getDefaultColumnLabelSettings(!0),r=e.labels,o=i.DefaultSettings.labelSettings.minPrecision,n=i.DefaultSettings.labelSettings.maxPrecision;return t.dataLabelUtils.updateLabelSettingsFromLabelsObject(r,a),a.precision<o&&(a.precision=o),a.precision>n&&(a.precision=n),a},i.parseBorderSettings=function(t){var a=e.DataViewObjects.getValue(t,i.properties.columnBorder.show,i.DefaultSettings.columnBorder.show),r=e.DataViewObjects.getFillColor(t,i.properties.columnBorder.color,i.DefaultSettings.columnBorder.color),o=e.DataViewObjects.getValue(t,i.properties.columnBorder.width,i.DefaultSettings.columnBorder.width),n=i.DefaultSettings.columnBorder.maxWidth;return o>n?o=n:0>o&&(o=0),a||(o=0),{show:a,color:r,width:o}},i.prototype.enumerateBorder=function(t){var a={columnBorder:this.borderObjectProperties},r=e.DataViewObjects.getValue(a,i.properties.columnBorder.show,i.DefaultSettings.columnBorder.show),o=e.DataViewObjects.getFillColor(a,i.properties.columnBorder.color,i.DefaultSettings.columnBorder.color),n=e.DataViewObjects.getValue(a,i.properties.columnBorder.width,i.DefaultSettings.columnBorder.width),s=i.DefaultSettings.columnBorder.maxWidth;n>s?n=s:0>n&&(n=0);var l={objectName:"columnBorder",selector:null,properties:{show:r,color:o,width:n}};t.pushInstance(l)},i.prototype.enumerateObjectInstances=function(i){var a=new t.ObjectEnumerationBuilder,r=this.layers?this.layers.length:0;if("columnBorder"===i.objectName)this.enumerateBorder(a);else if("legend"===i.objectName){if(!this.shouldShowLegendCard())return;var o=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.show,this.legend.isVisible()),n=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.showTitle,!0),s=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.titleText,this.layerLegendData&&this.layerLegendData.title?this.layerLegendData.title:""),l=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.fontSize,this.layerLegendData&&this.layerLegendData.fontSize?this.layerLegendData.fontSize:u.DefaultLabelFontSizeInPt);a.pushInstance({selector:null,properties:{show:o,position:t.LegendPosition[this.legend.getOrientation()],showTitle:n,titleText:s,fontSize:l},objectName:i.objectName})}else"categoryAxis"===i.objectName&&this.hasCategoryAxis?this.getCategoryAxisValues(a):"valueAxis"===i.objectName&&this.getValueAxisValues(a);for(var c=0,h=r;h>c;c++){var p=this.layers[c];p.enumerateObjectInstances&&p.enumerateObjectInstances(a,i)}return a.complete()},i.prototype.shouldShowLegendCard=function(){var e=this.layers,t=this.dataViews;if(e&&t)for(var i=e.length,a=0,r=0;i>r;r++){if(e[r].hasLegend())return!0;var o=t[r];if(o&&o.categorical&&o.categorical.values&&o.categorical.values.length>0&&(a++,a>1))return!0}return!1},i.prototype.getCategoryAxisValues=function(e){var i=t.axisType.both,a=!1,r=!!this.axes.x.isLogScaleAllowed,o=[t.axisScale.log,t.axisScale.linear];this.layers&&this.layers[0].getSupportedCategoryAxisType&&(i=this.layers[0].getSupportedCategoryAxisType(),a=i===t.axisType.scalar?!0:t.CartesianHelper.isScalar(i===t.axisType.both,this.categoryAxisProperties)),a||this.categoryAxisProperties&&(this.categoryAxisProperties.start=null,this.categoryAxisProperties.end=null);var n={selector:null,properties:{},objectName:"categoryAxis",validValues:{axisScale:o}};n.properties.show=this.categoryAxisProperties&&null!=this.categoryAxisProperties.show?this.categoryAxisProperties.show:!0,this.yAxisIsCategorical&&(n.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:t.yAxisPosition.left),i===t.axisType.both&&(n.properties.axisType=a?t.axisType.scalar:t.axisType.categorical),a&&(n.properties.axisScale=this.categoryAxisProperties&&null!=this.categoryAxisProperties.axisScale&&r?this.categoryAxisProperties.axisScale:t.axisScale.linear,n.properties.start=this.categoryAxisProperties?this.categoryAxisProperties.start:null,n.properties.end=this.categoryAxisProperties?this.categoryAxisProperties.end:null),n.properties.showAxisTitle=this.categoryAxisProperties&&null!=this.categoryAxisProperties.showAxisTitle?this.categoryAxisProperties.showAxisTitle:!1,n.properties.showBorder=this.categoryAxisProperties&&null!=this.categoryAxisProperties.showBorder?this.categoryAxisProperties.showAxisTitle:!1,n.properties.fontSize=this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:u.DefaultLabelFontSizeInPt,e.pushInstance(n).pushInstance({selector:null,properties:{axisStyle:this.categoryAxisProperties&&this.categoryAxisProperties.axisStyle?this.categoryAxisProperties.axisStyle:t.axisStyle.showTitleOnly,labelColor:this.categoryAxisProperties?this.categoryAxisProperties.labelColor:null,fontSize:this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:u.DefaultLabelFontSizeInPt},objectName:"categoryAxis",validValues:{axisStyle:this.categoryAxisHasUnitType?[t.axisStyle.showTitleOnly,t.axisStyle.showUnitOnly,t.axisStyle.showBoth]:[t.axisStyle.showTitleOnly]}})},i.prototype.getValueAxisValues=function(e){var i=[t.axisScale.log,t.axisScale.linear],a=!!this.axes.y1.isLogScaleAllowed,r={selector:null,properties:{},objectName:"valueAxis",validValues:{axisScale:i,secAxisScale:i}};r.properties.show=this.valueAxisProperties&&null!=this.valueAxisProperties.show?this.valueAxisProperties.show:!0,this.yAxisIsCategorical||(r.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:t.yAxisPosition.left),r.properties.axisScale=this.valueAxisProperties&&null!=this.valueAxisProperties.axisScale&&a?this.valueAxisProperties.axisScale:t.axisScale.linear,r.properties.start=this.valueAxisProperties?this.valueAxisProperties.start:null,r.properties.end=this.valueAxisProperties?this.valueAxisProperties.end:null,r.properties.showAxisTitle=this.valueAxisProperties&&null!=this.valueAxisProperties.showAxisTitle?this.valueAxisProperties.showAxisTitle:!1,r.properties.fontSize=this.valueAxisProperties&&null!=this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:u.DefaultLabelFontSizeInPt,e.pushInstance(r).pushInstance({selector:null,properties:{axisStyle:this.valueAxisProperties&&null!=this.valueAxisProperties.axisStyle?this.valueAxisProperties.axisStyle:t.axisStyle.showTitleOnly,labelColor:this.valueAxisProperties?this.valueAxisProperties.labelColor:null,fontSize:this.valueAxisProperties&&null!=this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:u.DefaultLabelFontSizeInPt},objectName:"valueAxis",validValues:{axisStyle:this.valueAxisHasUnitType?[t.axisStyle.showTitleOnly,t.axisStyle.showUnitOnly,t.axisStyle.showBoth]:[t.axisStyle.showTitleOnly]}}),2===this.layers.length&&(r.properties.secShow=this.valueAxisProperties&&null!=this.valueAxisProperties.secShow?this.valueAxisProperties.secShow:this.y2AxisExists,r.properties.secShow&&(r.properties.axisLabel=""))},i.prototype.onClearSelection=function(){if(this.hasSetData)for(var e=0,t=this.layers.length;t>e;e++){var i=this.layers[e];i.onClearSelection(),i.render(!0)}},i.prototype.createAndInitLayers=function(t){var i,a=this;if(t&&t.length>0){var r=t[0].metadata;r&&(i=r.objects)}var o=l(this.type,i,this.interactivityService,this.animator,this.isScrollable),n=e.Prototype.inherit(this.visualInitOptions);n.svg=this.axisGraphicsContextScrollable,n.cartesianHost={updateLegend:function(e){return a.legend.drawLegend(e,a.currentViewport)},getSharedColors:function(){return a.sharedColorPalette},triggerRender:void 0};for(var s=0,c=o.length;c>s;s++)o[s].init(n);return o},i.prototype.renderLegend=function(){for(var e=this.layers,i={title:"",dataPoints:[]},a=0,r=e.length;r>a;a++)this.layerLegendData=e[a].calculateLegend(),this.layerLegendData&&(i.title=0===a?this.layerLegendData.title||"":i.title,i.dataPoints=i.dataPoints.concat(this.layerLegendData.dataPoints||[]),this.layerLegendData.grouped&&(i.grouped=!0));var o=this.legendObjectProperties;if(o){o.fontSize||(o.fontSize=u.DefaultLabelFontSizeInPt),t.LegendData.update(i,o);var n=o[t.legendProps.position];n&&this.legend.changeOrientation(t.LegendPosition[n])}else this.legend.changeOrientation(t.LegendPosition.Top);(1===i.dataPoints.length&&!i.grouped||this.hideLegends())&&(i.dataPoints=[]),this.legend.drawLegend(i,this.currentViewport)},i.prototype.hideLegends=function(){return!!(this.cartesianSmallViewPortProperties&&this.cartesianSmallViewPortProperties.hideLegendOnSmallViewPort&&this.currentViewport.height<this.cartesianSmallViewPortProperties.MinHeightLegendVisible)},i.prototype.addUnitTypeToAxisLabel=function(e){var a=i.getUnitType(e,function(e){return e.x});if(e.x.isCategoryAxis?this.categoryAxisHasUnitType=null!==a:this.valueAxisHasUnitType=null!==a,e.x.axisLabel&&a&&(e.x.isCategoryAxis?e.x.axisLabel=t.AxisHelper.createAxisLabel(this.categoryAxisProperties,e.x.axisLabel,a):e.x.axisLabel=t.AxisHelper.createAxisLabel(this.valueAxisProperties,e.x.axisLabel,a)),a=i.getUnitType(e,function(e){return e.y1}),e.y1.isCategoryAxis?this.categoryAxisHasUnitType=null!==a:this.valueAxisHasUnitType=null!==a,e.y1.axisLabel&&a&&(e.y1.isCategoryAxis?e.y1.axisLabel=t.AxisHelper.createAxisLabel(this.categoryAxisProperties,e.y1.axisLabel,a):e.y1.axisLabel=t.AxisHelper.createAxisLabel(this.valueAxisProperties,e.y1.axisLabel,a)),e.y2){var a=i.getUnitType(e,function(e){return e.y2});this.secValueAxisHasUnitType=null!==a,e.y2.axisLabel&&a&&this.valueAxisProperties&&this.valueAxisProperties.secAxisStyle&&(this.valueAxisProperties.secAxisStyle===t.axisStyle.showBoth?e.y2.axisLabel=e.y2.axisLabel+" ("+a+")":this.valueAxisProperties.secAxisStyle===t.axisStyle.showUnitOnly&&(e.y2.axisLabel=a))}},i.prototype.shouldRenderSecondaryAxis=function(e){return e&&(!this.valueAxisProperties||null==this.valueAxisProperties.secShow||this.valueAxisProperties.secShow)?e.values&&e.values.length>0:!1},i.prototype.shouldRenderAxis=function(e,t){return void 0===t&&(t="show"),e?(!e.isCategoryAxis||this.categoryAxisProperties&&null!=this.categoryAxisProperties[t]&&!this.categoryAxisProperties[t])&&(e.isCategoryAxis||this.valueAxisProperties&&null!=this.valueAxisProperties[t]&&!this.valueAxisProperties[t])?!1:e.values&&e.values.length>0:!1},i.prototype.render=function(a){this.setVisibility(!0);var o=this.legendMargins=this.legend.getMargins(),n={height:this.currentViewport.height-o.height,width:this.currentViewport.width-o.width},l=this.getMaxMarginFactor(),c=this.leftRightMarginLimit=n.width*l;this.bottomMarginLimit=Math.max(i.MinBottomMargin,Math.ceil(n.height*l));var h=i.getTextProperties(this.categoryAxisProperties&&parseFloat(this.categoryAxisProperties.fontSize)||void 0),u=i.getTextProperties(this.valueAxisProperties&&parseFloat(this.valueAxisProperties.fontSize)||void 0),p=this.margin;p.top=parseFloat(u.fontSize)/2,p.bottom=i.MinBottomMargin,p.right=0;var d=this.axes=s(this.layers,n,p,this.categoryAxisProperties,this.valueAxisProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,null);this.yAxisIsCategorical=d.y1.isCategoryAxis,this.hasCategoryAxis=this.yAxisIsCategorical?d.y1&&d.y1.values.length>0:d.x&&d.x.values.length>0;var m,g,f=this.shouldRenderAxis(d.x),y=this.shouldRenderAxis(d.y1),v=this.shouldRenderSecondaryAxis(d.y2),x=n.width-(p.left+p.right),E=!1;this.isXScrollBarVisible=!1,this.isYScrollBarVisible=!1;var b=this.yAxisOrientation,T=b===t.yAxisPosition.right;if(this.layers&&(this.layers[0].getVisualCategoryAxisIsScalar&&(E=this.layers[0].getVisualCategoryAxisIsScalar()),!E&&this.isScrollable&&this.layers[0].getPreferredPlotArea)){var w=this.scrollX?d.x.categoryThickness:d.y1.categoryThickness,S=this.scrollX?d.x.values.length:d.y1.values.length;g=this.layers[0].getPreferredPlotArea(E,S,w),this.scrollX&&g&&g.width>n.width&&(this.isXScrollBarVisible=!0,n.height-=i.ScrollBarWidth),this.scrollY&&g&&g.height>n.height&&(this.isYScrollBarVisible=!0,n.width-=i.ScrollBarWidth,x=n.width-(p.left+p.right))}this.isXScrollBarVisible||this.isYScrollBarVisible?this.brushGraphicsContext||(this.brushGraphicsContext=this.svg.append("g").classed("x brush",!0)):(this.svg.selectAll(".brush").remove(),this.brushGraphicsContext=void 0),d=s(this.layers,n,p,this.categoryAxisProperties,this.valueAxisProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,null);for(var R=!1,C=2,A=0,M=void 0,H=void 0,P=void 0;!R&&C>A;){A++,M=r({width:x,height:n.height},c,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.estimateSvgTextHeight,d,this.bottomMarginLimit,h,u,null,!1,this.isXScrollBarVisible||this.isYScrollBarVisible,T,f,y,v);var D=T?M.yRight:M.yLeft,_=T?M.yLeft:M.yRight,L=f?M.xMax/1.8:0;D+=i.LeftPadding,_+=i.RightPadding,L+=i.BottomPadding,this.hideAxisLabels(o)&&(d.x.axisLabel=null,d.y1.axisLabel=null,d.y2&&(d.y2.axisLabel=null)),this.addUnitTypeToAxisLabel(d),P={x:d.x.axisLabel,y:d.y1.axisLabel,y2:d.y2?d.y2.axisLabel:null},H=null!=P.x||null!=P.y||null!=P.y2,null!=P.x&&(L+=i.XAxisLabelPadding),null!=P.y&&(D+=i.YAxisLabelPadding),null!=P.y2&&(_+=i.YAxisLabelPadding),p.left=T?_:D,p.right=T?D:_,p.bottom=L,this.margin=p,x=n.width-(p.left+p.right);var N=d.y1.values.length,V=d.y2&&d.y2.values.length;d=s(this.layers,n,p,this.categoryAxisProperties,this.valueAxisProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,d),d.y1.values.length!==N||d.y2&&d.y2.values.length!==V||(R=!0)}this.renderChart(m,d,x,M,H,P,n,a)},i.prototype.hideAxisLabels=function(e){return!(!(this.cartesianSmallViewPortProperties&&this.cartesianSmallViewPortProperties.hideAxesOnSmallViewPort&&this.currentViewport.height+e.height<this.cartesianSmallViewPortProperties.MinHeightAxesVisible)||this.visualInitOptions.interactivity.isInteractiveLegend)},i.getUnitType=function(e,t){return t(e).formatter&&t(e).formatter.displayUnit&&t(e).formatter.displayUnit.value>1?t(e).formatter.displayUnit.title:null},i.prototype.getMaxMarginFactor=function(){return this.visualInitOptions.style.maxMarginFactor||i.MaxMarginFactor},i.getChartViewport=function(e,t){return{width:e.width-t.left-t.right,height:e.height-t.top-t.bottom}},i.wordBreak=function(t,i,a,r,o){t.each(function(t,o){var n,s,l=d3.select(this);a.length>=o?(n=a[o],s=i.scale(n)):s=i.xLabelMaxWidth,l.style("text-anchor","middle").attr({dx:"0em",dy:"1em",transform:"rotate(0)"}),e.TextMeasurementService.wordBreak(this,s,i.willLabelsWordBreak?r:0)})},i.prototype.renderChart=function(a,r,o,n,s,l,c,h,p,d){var m,g,f,y,v,x=this.bottomMarginLimit,E=this.leftRightMarginLimit,b=this.layers,T=t.AnimatorCommon.GetAnimationDuration(this.animator,h),w=i.getChartViewport(c,this.margin);if(this.shouldRenderAxis(r.x)){r.x.isCategoryAxis?(m=this.categoryAxisProperties&&this.categoryAxisProperties.labelColor?this.categoryAxisProperties.labelColor:null,y=this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:u.DefaultLabelFontSizeInPt):(m=this.valueAxisProperties&&this.valueAxisProperties.labelColor?this.valueAxisProperties.labelColor:null,y=this.valueAxisProperties&&this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:u.DefaultLabelFontSizeInPt),r.x.axis.orient("bottom"),r.x.willLabelsFit||r.x.axis.tickPadding(i.TickPaddingRotatedX);var S=this.xAxisGraphicsContext;T?S.transition().duration(T).call(r.x.axis):S.call(r.x.axis),S.call(i.darkenZeroLine).call(i.setAxisLabelColor,m).call(i.setAxisLabelFontSize,y);var R=S.selectAll("text"),C=[],A=0;this.layers&&this.layers.length&&(C=this.layers[0].getColumnsWidth(),A=this.layers[0].getBorderWidth()),S.call(i.moveBorder,r.x.scale,A,y/2-8),R.call(i.wordBreak,r.x,C,x,A)}else this.xAxisGraphicsContext.selectAll("*").remove();if(this.shouldRenderAxis(r.y1)){r.y1.isCategoryAxis?(g=this.categoryAxisProperties&&this.categoryAxisProperties.labelColor?this.categoryAxisProperties.labelColor:null,v=this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:u.DefaultLabelFontSizeInPt):(g=this.valueAxisProperties&&this.valueAxisProperties.labelColor?this.valueAxisProperties.labelColor:null,v=this.valueAxisProperties&&null!=this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:u.DefaultLabelFontSizeInPt);var M=this.yAxisOrientation,H=M===t.yAxisPosition.right;r.y1.axis.tickSize(-o).tickPadding(i.TickPaddingY).orient(M.toLowerCase());var P=this.y1AxisGraphicsContext;T?P.transition().duration(T).call(r.y1.axis):P.call(r.y1.axis),P.call(i.darkenZeroLine).call(i.setAxisLabelColor,g).call(i.setAxisLabelFontSize,v),n.yLeft>=E&&P.selectAll("text").call(t.AxisHelper.LabelLayoutStrategy.clip,E-i.LeftPadding,e.TextMeasurementService.svgEllipsis),!r.y2||this.valueAxisProperties&&null!=this.valueAxisProperties.secShow&&!this.valueAxisProperties.secShow?this.y2AxisGraphicsContext.selectAll("*").remove():(f=this.valueAxisProperties&&this.valueAxisProperties.secLabelColor?this.valueAxisProperties.secLabelColor:null,r.y2.axis.tickPadding(i.TickPaddingY).orient(H?t.yAxisPosition.left.toLowerCase():t.yAxisPosition.right.toLowerCase()),T?this.y2AxisGraphicsContext.transition().duration(T).call(r.y2.axis):this.y2AxisGraphicsContext.call(r.y2.axis),this.y2AxisGraphicsContext.call(i.darkenZeroLine).call(i.setAxisLabelColor,f),n.yRight>=E&&this.y2AxisGraphicsContext.selectAll("text").call(t.AxisHelper.LabelLayoutStrategy.clip,E-i.RightPadding,e.TextMeasurementService.svgEllipsis))}else this.y1AxisGraphicsContext.selectAll("*").remove(),this.y2AxisGraphicsContext.selectAll("*").remove();if(s){var D=!this.shouldRenderAxis(r.x,"showAxisTitle"),_=!this.shouldRenderAxis(r.y1,"showAxisTitle"),L=this.valueAxisProperties&&null!=this.valueAxisProperties.secShowAxisTitle&&this.valueAxisProperties.secShowAxisTitle===!1,N={axisLabels:l,legendMargin:this.legendMargins.height,viewport:c,hideXAxisTitle:D,hideYAxisTitle:_,hideY2AxisTitle:L,xLabelColor:m,yLabelColor:g,y2LabelColor:f,margin:void 0};this.renderAxesLabels(N)}else this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove();this.translateAxes(c);var V=[],z=[],I=[];if(this.behavior){for(var F=0,O=b.length;O>F;F++){var k=b[F].render(h);if(k)if(V=V.concat(k.dataPoints),z.push(k.behaviorOptions),k.labelDataPointGroups)for(var j=k.labelDataPointGroups,B=0,G=j.length;G>B;B++){var U=j[B];I.push({labelDataPoints:U.labelDataPoints,maxNumberOfLabels:U.maxNumberOfLabels})}else{var W=k.labelDataPoints,X=W;I.push({labelDataPoints:X,maxNumberOfLabels:X.length})}}var Y={maximumOffset:u.maxLabelOffset,startingOffset:u.startingLabelOffset},K=new e.LabelLayout(Y),q=K.layout(I,w);if(b.length>1&&u.drawLabelBackground(this.labelGraphicsContextScrollable,q,"#FFFFFF",.7),this.animator&&!h?u.animateDefaultLabels(this.labelGraphicsContextScrollable,q,this.animator.getDuration()):u.drawDefaultLabels(this.labelGraphicsContextScrollable,q),this.labelGraphicsContextScrollable.selectAll("text.label").style("pointer-events","none"),this.interactivityService){var Z={layerOptions:z,clearCatcher:this.clearCatcher};this.interactivityService.bind(V,this.behavior,Z)}}},i.darkenZeroLine=function(e){var t=e.selectAll("g.tick").filter(function(e){return 0===e}).node();t&&d3.select(t).select("line").classed("zero-line",!0)},i.setAxisLabelColor=function(e,t){e.selectAll("g.tick text").style("fill",t?t.solid.color:null)},i.setAxisLabelFontSize=function(e,t){var i=a.PixelConverter.toString(t);e.selectAll("g.tick text").attr("font-size",i)},i.moveBorder=function(e,i,a,r){void 0===r&&(r=0),e.selectAll("g.tick").attr("transform",function(e,o){return t.SVGUtil.translate(i(e)+a*o,r)})},i.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Series",kind:e.VisualDataRoleKind.Grouping,displayName:"Series"},{name:"Y",kind:e.VisualDataRoleKind.Measure,displayName:"Y Axis"},{name:"Width",kind:e.VisualDataRoleKind.Measure,displayName:"Axis width"}],objects:{columnBorder:{displayName:"Column Border",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),description:e.data.createDisplayNameGetter("Visual_LabelsFillDescription"),type:{fill:{solid:{color:!0}}}},width:{displayName:"Width",type:{numeric:!0}}}},labels:{displayName:e.data.createDisplayNameGetter("Visual_DataPointsLabels"),description:e.data.createDisplayNameGetter("Visual_DataPointsLabelsDescription"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},showSeries:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),description:e.data.createDisplayNameGetter("Visual_LabelsFillDescription"),type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:e.data.createDisplayNameGetter("Visual_DisplayUnits"),description:e.data.createDisplayNameGetter("Visual_DisplayUnitsDescription"),type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},labelPrecision:{displayName:e.data.createDisplayNameGetter("Visual_Precision"),description:e.data.createDisplayNameGetter("Visual_PrecisionDescription"),placeHolderText:e.data.createDisplayNameGetter("Visual_Precision_Auto"),type:{numeric:!0},suppressFormatPainterCopy:!0},showAll:{displayName:e.data.createDisplayNameGetter("Visual_ShowAll"),type:{bool:!0}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},legend:{displayName:e.data.createDisplayNameGetter("Visual_Legend"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_LegendPosition"),type:{formatting:{legendPosition:!0}}},showTitle:{displayName:e.data.createDisplayNameGetter("Visual_LegendShowTitle"),type:{bool:!0}},titleText:{displayName:"Title text",type:{text:!0}},fontSize:{displayName:"Text size",type:{formatting:{fontSize:!0}}}}},categoryAxis:{displayName:e.data.createDisplayNameGetter("Visual_XAxis"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_YAxis_Position"),type:{formatting:{yAxisPosition:!0}}},axisScale:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Scale"),type:{formatting:{axisScale:!0}}},axisType:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Type"),type:{formatting:{axisType:!0}}},showAxisTitle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Title"),type:{bool:!0}},axisStyle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Style"),type:{formatting:{axisStyle:!0}}},labelColor:{displayName:e.data.createDisplayNameGetter("Visual_Axis_LabelColor"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},valueAxis:{displayName:e.data.createDisplayNameGetter("Visual_YAxis"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_YAxis_Position"),type:{formatting:{yAxisPosition:!0}}},axisScale:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Scale"),type:{formatting:{axisScale:!0}}},intersection:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Intersection"),type:{numeric:!0}},showAxisTitle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Title"),type:{bool:!0}},axisStyle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Style"),type:{formatting:{axisStyle:!0}}},labelColor:{displayName:e.data.createDisplayNameGetter("Visual_Axis_LabelColor"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),properties:{defaultColor:{displayName:e.data.createDisplayNameGetter("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint_Show_All"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fillRule:{displayName:e.data.createDisplayNameGetter("Visual_Gradient"),type:{fillRule:{}},rule:{inputRole:"Gradient",output:{property:"fill",selector:["Category"]}}}}}},dataViewMappings:[{conditions:[{Category:{min:0,max:1},Series:{min:0,max:1},Y:{min:0,max:1},Width:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{"for":{"in":"Y"}},{"for":{"in":"Width"}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:1,max:1},supported:{min:0}}}}],supportsHighlight:!0,sorting:{"default":{}},drilldown:{roles:["Category"]}},i.properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},columnBorder:{show:{objectName:"columnBorder",propertyName:"show"},color:{objectName:"columnBorder",propertyName:"color"},width:{objectName:"columnBorder",propertyName:"width"}}},i.DefaultSettings={columnBorder:{show:!0,color:"#fff",width:2,maxWidth:5},labelSettings:{maxPrecision:4,minPrecision:0}},i.MinOrdinalRectThickness=20,
i.MinScalarRectThickness=2,i.OuterPaddingRatio=.4,i.InnerPaddingRatio=.2,i.TickLabelPadding=2,i.ClassName="cartesianChart",i.AxisGraphicsContextClassName="axisGraphicsContext",i.MaxMarginFactor=.25,i.MinBottomMargin=50,i.LeftPadding=10,i.RightPadding=10,i.BottomPadding=16,i.YAxisLabelPadding=20,i.XAxisLabelPadding=20,i.TickPaddingY=10,i.TickPaddingRotatedX=5,i.FontSize=11,i.MaxNumberOfLabels=100,i.MinWidth=100,i.MinHeight=100,i.ScrollBarWidth=10,i}();i.MekkoChart=m,i.createLayers=l;var g=a.EnumExtensions,f=a.ArrayExtensions,y=2,v=16,x={category:"Category",series:"Series",y:"Y",width:"Width"},E=function(){function i(e){var t=e.chartType;this.chartType=t,this.categoryAxisType=null,this.animator=e.animator,this.isScrollable=e.isScrollable,this.interactivityService=e.interactivityService}return i.prototype.init=function(e){this.svg=e.svg,this.unclippedGraphicsContext=this.svg.append("g").classed("columnChartUnclippedGraphicsContext",!0),this.mainGraphicsContext=this.unclippedGraphicsContext.append("svg").classed("columnChartMainGraphicsContext",!0),this.labelGraphicsContext=this.svg.append("g").classed(u.labelGraphicsContextClass["class"],!0),this.style=e.style,this.currentViewport=e.viewport,this.hostService=e.host,this.interactivity=e.interactivity,this.colors=this.style.colorPalette.dataColors,this.cartesianVisualHost=e.cartesianHost,this.options=e,this.supportsOverflow=!g.hasFlag(this.chartType,v);var t=this.element=e.element;t.addClass(i.ColumnChartClassName),this.columnChart=new d},i.prototype.getCategoryLayout=function(e,i){var a=this.currentViewport.width-(this.margin.left+this.margin.right),r=this.data?this.data.categoryMetadata:void 0,o=t.AxisHelper.getCategoryValueType(r),n=this.data?this.data.scalarCategoryAxis:!1,s=t.AxisHelper.createDomain(this.data.series,o,n,i.forcedXDomain);return t.CartesianChart.getLayout(this.data,{availableWidth:a,categoryCount:e,domain:s,isScalar:n,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:!1})},i.getBorderWidth=function(e){if(!e||!e.show||!e.width)return 0;var t=e.width;return 0>t?0:t>e.maxWidth?e.maxWidth:t},i.getBorderColor=function(e){return e?e.color:m.DefaultSettings.columnBorder.color},i.converter=function(a,r,o,n,s,l,c){void 0===o&&(o=!1),void 0===n&&(n=!1),void 0===s&&(s=!1),void 0===l&&(l=null);var h=t.CartesianHelper.getCategoryAxisProperties(l),u=t.CartesianHelper.getValueAxisProperties(l);n=t.CartesianHelper.isScalar(n,h),a=t.ColumnUtil.applyUserMinMax(n,a,h);var p=new b(a),d=t.converterHelper.getPivotedCategories(a,t.columnChartProps.general.formatString),g=d.categories,f=d.categoryFormatter,y=d.categoryIdentities,v=a.categories&&a.categories.length>0?a.categories[0].source:void 0,E=m.DefaultSettings.columnBorder,T=t.dataLabelUtils.getDefaultColumnLabelSettings(!0),w=void 0,S=void 0;if(l&&l.objects){var R=l.objects;w=e.DataViewObjects.getFillColor(R,t.columnChartProps.dataPoint.defaultColor),S=e.DataViewObjects.getValue(R,t.columnChartProps.dataPoint.showAllDataPoints),T=m.parseLabelSettings(R),E=m.parseBorderSettings(R)}for(var C=p.getLegend(r,w),A=C.legend.dataPoints,M=C.seriesSources,H=i.createDataPoints(a,g,y,A,C.seriesObjects,p,T,o,n,s,t.converterHelper.categoryIsAlsoSeriesRole(a,x.series,x.category),d.categoryObjects,w,c,v),P=H.series,D=[],_=0,L=A.length;L>_;_++)D.push(M[_]);var N=t.converterHelper.createAxesLabels(h,u,v,D);return{categories:g,categoriesWidth:H.categoriesWidth,categoryFormatter:f,series:P,valuesMetadata:D,legendData:C.legend,hasHighlights:H.hasHighlights,categoryMetadata:v,scalarCategoryAxis:n,borderSettings:E,labelSettings:T,axesLabels:{x:N.xAxisLabel,y:N.yAxisLabel},hasDynamicSeries:H.hasDynamicSeries,defaultDataPointColor:w,showAllDataPoints:S,isMultiMeasure:!1}},i.getStackedMultiplier=function(e,i,a,r){for(var o=0,n=0,s=0;a>s;s++){var l=e[s][i];l=t.AxisHelper.normalizeNonFiniteNumber(l),l>0?o+=l:0>l&&(n-=l)}var c=o+n;return{pos:o?o/c/o:1,neg:n?n/c/n:1}},i.createDataPoints=function(a,r,o,n,s,l,c,h,u,p,d,m,f,y,E){void 0===h&&(h=!1),void 0===u&&(u=!1),void 0===p&&(p=!1);var b=a&&a.values?a.values.grouped():void 0,T=r.length,w=n.length,S=[];if(1>w||1>T||null===r[0])return{series:S,hasHighlights:!1,hasDynamicSeries:!1,categoriesWidth:[]};var R=a.categories;E=R&&R.length>0?R[0].source:null;var C=t.AxisHelper.getCategoryValueType(E),A=t.AxisHelper.isDateTime(C),M=[],H=[],P=[],D=[],_=!(!a.values||!a.values.source),L=[],N=-1,V=0,z=!1,I=l.hasHighlightValues(0);for(V=0;V<a.values.length;V++)if(a.values[V].source.roles&&a.values[V].source.roles[x.width]&&!a.values[V].source.roles[x.y]){N=V;for(var F=a.values[V].values,O=0,k=F.length;k>O;O++)L[O]=d3.sum([0,L[O],F[O]])}else{for(var j=[],B=[],G=0;T>G;G++){var U=l.getValueBySeriesAndCategory(V,G);if(j[G]=U,I){var W=l.getHighlightBySeriesAndCategory(V,G);B[G]=W,U>=0&&W>=0&&U>=W||0>=U&&0>=W&&W>=U||(z=!0)}}P.push(j),I&&D.push(B)}if(z&&!p&&(z=!1,I=!1,P=D),L.length<1)for(V=0;V<a.values.length;V++)if(a.values[V].source.roles&&a.values[V].source.roles[x.width]){N=V;for(var F=a.values[V].values,O=0,k=F.length;k>O;O++)L[O]=d3.sum([0,L[O],F[O]])}else;if(L.length<1)for(V=0;T>V;V++)L.push(1);var X=d3.sum(L),Y=d3.scale.linear().domain([0,X]).range([0,1]),K=[0],q=[];for(V=0;T-1>V;V++){var Z=K[K.length-1]+(L[V]||0);K.push(Z)}for(V=0;T>V;V++)K[V]=Y(K[V]),q[V]=Y(L[V]);var Q=m,J=t.columnChartProps.general.formatString;for(V=0;w>V;V++){var $,ee=[],te=n[V];if(!_){var ie=b&&b.length>0&&b[0].values?b[0].values[V]:null,ae=ie&&ie.source&&ie.source.objects?ie.source.objects.labels:null;ae&&($=e.Prototype.inherit(c),t.dataLabelUtils.updateLabelSettingsFromLabelsObject(ae,$))}var re={displayName:te.label,key:"series"+V,index:V,data:ee,identity:te.identity,color:te.color,labelSettings:$};w>1&&(Q=s[V]);for(var oe=a.values[V].source,G=0;T>G;G++){0===V&&(M.push(0),H.push(0));var U=t.AxisHelper.normalizeNonFiniteNumber(P[V][G]);if(!(null==U&&V>0)){var ne=U,se=r[G];if(A&&se&&(se=se.getTime()),!u||null!=se&&!isNaN(se)){var le;h&&(le=i.getStackedMultiplier(P,G,w,T));var ce=U,he=0>U;le&&(U*=he?le.neg:le.pos);var ue,pe=Math.abs(U);he?(ue=H[G],isNaN(pe)||(H[G]-=pe)):(isNaN(pe)||(M[G]+=pe),ue=M[G]);var de=b&&b.length>V&&b[V].values?b[V]:null,me=a.categories&&a.categories.length>0?a.categories[0]:null,ge=t.SelectionIdBuilder.builder().withCategory(me,G).withSeries(a.values,de).withMeasure(l.getMeasureNameByIndex(V)).createSelectionId(),fe=r[G],ye=i.getDataPointColor(te,G,Q),ve=[];if(de){var xe={values:[],source:a.values.source};ve.push({value:de.name,metadata:xe});for(var Ee=0;Ee<de.values.length;Ee++){var be=de.values[Ee];ve.push({value:be.values[G],metadata:be})}}var Te=t.TooltipBuilder.createTooltipInfo(J,null,fe,ne,[me],ve,null,G),we=re&&re.labelSettings?re.labelSettings:c,Se=we.labelColor,Re=void 0;g.hasFlag(y,v)&&(Re=this.getStackedLabelColor(he,V,w,G,P),Se=Re||V===w-1&&!he?Se:t.dataLabelUtils.defaultInsideLabelColor),U=q[G];var Ce=K[G],Ae={categoryValue:se,value:U,position:ue,valueAbsolute:pe,valueOriginal:ce,seriesIndex:V,labelSettings:we,categoryIndex:G,color:ye,selected:!1,originalValue:U,originalPosition:Ce,originalValueAbsolute:pe,identity:ge,key:ge.getKey(),tooltipInfo:Te,labelFill:Se,labelFormatString:oe.format,lastSeries:Re,chartType:y};if(ee.push(Ae),I){var Me=D[V][G],He=Me,Pe=!0;null===Me&&(Me=0,Pe=!1),h&&(Me*=le.pos);var De=Math.abs(Me),_e=ue;Me>0?_e-=pe-De:0===Me&&U>0&&(_e-=pe);var Le=t.SelectionId.createWithHighlight(ge),fe=r[G];Pe&&(Ae.tooltipInfo=Te);var Ne={categoryValue:se,value:U,position:_e,valueAbsolute:De,valueOriginal:He,seriesIndex:V,labelSettings:we,categoryIndex:G,color:ye,selected:!1,highlight:!0,originalValue:U,originalPosition:Ce,originalValueAbsolute:pe,drawThinner:z,identity:Le,key:Le.getKey(),tooltipInfo:Te,labelFormatString:oe.format,labelFill:Se,lastSeries:Re,chartType:y};ee.push(Ne)}}}}S.push(re)}return{series:S,categoriesWidth:q,hasHighlights:I,hasDynamicSeries:_}},i.getDataPointColor=function(i,a,r){if(r){var o=e.DataViewObjects.getFillColor(r[a],t.columnChartProps.dataPoint.fill);if(o)return o}return i.color},i.getStackedLabelColor=function(e,i,a,r,o){for(var n=!(e&&i===a-1&&1!==a),s=i+1;a>s;s++){var l=t.AxisHelper.normalizeNonFiniteNumber(o[s][r]);if(null!==l&&((!e||e&&0===i)&&l>0||e&&0!==i)){n=!1;break}}return n},i.sliceSeries=function(t,i,a){void 0===a&&(a=0);var r=[];if(t&&t.length>0)for(var o=0,n=t.length;n>o;o++){var s=r[o]=e.Prototype.inherit(t[o]);s.data=t[o].data.filter(function(e){return e.categoryIndex>=a&&e.categoryIndex<i})}return r},i.getInteractiveColumnChartDomElement=function(e){return e.children("svg").get(0)},i.prototype.getColumnsWidth=function(){var e=this.data;return e&&e.series&&e.series[0]&&e.series[0].data?e.categoriesWidth:[]},i.prototype.getBorderWidth=function(){return i.getBorderWidth(this.data.borderSettings)},i.prototype.setData=function(e){var a=!0;if(this.data={categories:[],categoriesWidth:[],categoryFormatter:null,series:[],valuesMetadata:[],legendData:null,hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!1,borderSettings:null,labelSettings:t.dataLabelUtils.getDefaultColumnLabelSettings(a),axesLabels:{x:null,y:null},hasDynamicSeries:!1,defaultDataPointColor:null,isMultiMeasure:!1},e.length>0){var r=e[0];if(r&&r.categorical){var o=this.dataViewCat=r.categorical;this.data=i.converter(o,this.cartesianVisualHost.getSharedColors(),!0,!1,this.supportsOverflow,r.metadata,this.chartType);for(var n=this.data.series,s=0,l=n.length;l>s;s++){var c=n[s];this.interactivityService&&this.interactivityService.applySelectionStateToData(c.data)}}}},i.prototype.calculateLegend=function(){if(this.interactivity&&this.interactivity.isInteractiveLegend)return this.createInteractiveMekkoLegendDataPoints(0);var e=this.data?this.data.legendData:null,t=e?e.dataPoints:[];return f.isUndefinedOrEmpty(t)?null:e},i.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||this.data.series&&this.data.series.length>1)},i.prototype.enumerateObjectInstances=function(e,i){switch(i.objectName){case"dataPoint":t.GradientUtils.hasGradientRole(this.dataViewCat)||this.enumerateDataPoints(e);break;case"labels":this.enumerateDataLabels(e)}},i.prototype.enumerateDataLabels=function(e){var i=this.data,a=this.data.labelSettings,r=i.series.length;if(t.dataLabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,a,!1)),0!==r&&!i.hasDynamicSeries&&(r>1||!i.categoryMetadata))for(var o=0;r>o;o++){var n=i.series[o],a=n.labelSettings?n.labelSettings:this.data.labelSettings;t.dataLabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,a,!0,n))}},i.prototype.getLabelSettingsOptions=function(e,t,i,a){var r=!0;return{enumeration:e,dataLabelsSettings:t,show:!i,displayUnits:r,precision:!0,selector:a&&a.identity?a.identity.getSelector():null}},i.prototype.enumerateDataPoints=function(e){var i=this.data;if(i&&i.series){var a=i.series.length;if(0!==a)if(i.hasDynamicSeries||a>1||!i.categoryMetadata)for(var r=0;a>r;r++){var o=i.series[r];e.pushInstance({objectName:"dataPoint",displayName:o.displayName,selector:t.ColorHelper.normalizeSelector(o.identity.getSelector()),properties:{fill:{solid:{color:o.color}}}})}else{var n=i.series[0].data,s=i.categoryFormatter;e.pushInstance({objectName:"dataPoint",selector:null,properties:{defaultColor:{solid:{color:i.defaultDataPointColor||this.colors.getColorByIndex(0).value}}}}).pushInstance({objectName:"dataPoint",selector:null,properties:{showAllDataPoints:!!i.showAllDataPoints}});for(var r=0;r<n.length;r++){var l=n[r],c=i.categories[r];e.pushInstance({objectName:"dataPoint",displayName:s?s.format(c):c,selector:t.ColorHelper.normalizeSelector(l.identity.getSelector(),!0),properties:{fill:{solid:{color:l.color}}}})}}}},i.prototype.calculateAxesProperties=function(e){var i=this.data;this.currentViewport=e.viewport;var a=this.margin=e.margin,r=i&&i.categories?i.categories.length:0,o=i?this.getCategoryLayout(r,e):{categoryCount:0,categoryThickness:t.CartesianChart.MinOrdinalRectThickness,outerPaddingRatio:t.CartesianChart.OuterPaddingRatio,isScalar:!1};this.categoryAxisType=o.isScalar?t.axisType.scalar:null,this.columnChart.setData(i);var n=this.getPreferredPlotArea(o.isScalar,o.categoryCount,o.categoryThickness);n.width===this.currentViewport.width&&(n.width-=a.left+a.right),n.height-=a.top+a.bottom;var s=!0,l={height:n.height,width:n.width,duration:0,hostService:this.hostService,unclippedGraphicsContext:this.unclippedGraphicsContext,mainGraphicsContext:this.mainGraphicsContext,labelGraphicsContext:this.labelGraphicsContext,margin:this.margin,layout:o,animator:this.animator,interactivityService:this.interactivityService,viewportHeight:this.currentViewport.height-(a.top+a.bottom),viewportWidth:this.currentViewport.width-(a.left+a.right),is100Pct:s,isComboChart:!0};this.ApplyInteractivity(l),this.columnChart.setupVisualProps(l);var c=g.hasFlag(this.chartType,y);if(c){var h=e.forcedXDomain;e.forcedXDomain=e.forcedYDomain,e.forcedYDomain=h}return this.xAxisProperties=this.columnChart.setXScale(s,e.forcedTickCount,e.forcedXDomain,c?e.valueAxisScaleType:e.categoryAxisScaleType),this.yAxisProperties=this.columnChart.setYScale(s,e.forcedTickCount,e.forcedYDomain,c?e.categoryAxisScaleType:e.valueAxisScaleType),e.showCategoryAxisLabel&&this.xAxisProperties.isCategoryAxis||e.showValueAxisLabel&&!this.xAxisProperties.isCategoryAxis?this.xAxisProperties.axisLabel=i.axesLabels.x:this.xAxisProperties.axisLabel=null,e.showValueAxisLabel&&!this.yAxisProperties.isCategoryAxis||e.showCategoryAxisLabel&&this.yAxisProperties.isCategoryAxis?this.yAxisProperties.axisLabel=i.axesLabels.y:this.yAxisProperties.axisLabel=null,[this.xAxisProperties,this.yAxisProperties]},i.prototype.getPreferredPlotArea=function(e,i,a){var r={height:this.currentViewport.height,width:this.currentViewport.width};if(this.isScrollable&&!e){var o=t.CartesianChart.getPreferredCategorySpan(i,a);g.hasFlag(this.chartType,y)?r.height=Math.max(o,r.height):r.width=Math.max(o,r.width)}return r},i.prototype.ApplyInteractivity=function(e){var i=this,a=this.interactivity;if(a&&(a.dragDataPoint&&(e.onDragStart=function(e){e.identity&&i.hostService.onDragStart({event:d3.event,data:{data:e.identity.getSelector()}})}),a.isInteractiveLegend)){var r=function(){var e=d3.mouse(i.mainGraphicsContext[0][0]),t=e[0],a=e[1],r=i.columnChart.getClosestColumnIndex(t,a);i.selectColumn(r)},o=t.ColumnChart.getInteractiveColumnChartDomElement(this.element);this.svg.on("click",r),d3.select(o).on("click",r);var n=d3.behavior.drag().origin(Object).on("drag",r);this.svg.call(n),d3.select(o).call(n)}},i.prototype.selectColumn=function(e,t){if(void 0===t&&(t=!1),t||this.lastInteractiveSelectedColumnIndex!==e){var i=this.createInteractiveMekkoLegendDataPoints(e),a=i.dataPoints;this.cartesianVisualHost.updateLegend(i),a.length>0&&this.columnChart.selectColumn(e,this.lastInteractiveSelectedColumnIndex),this.lastInteractiveSelectedColumnIndex=e}},i.prototype.createInteractiveMekkoLegendDataPoints=function(e){var i=this.data;if(!i||f.isUndefinedOrEmpty(i.series))return{dataPoints:[]};for(var a=t.columnChartProps.general.formatString,r=[],o=i.categories&&i.categories[e],n=i.series,s=i.legendData&&i.legendData.dataPoints,l=new b(this.dataViewCat),c=0,h=n.length;h>c;c++){var u,p=l.getValueBySeriesAndCategory(c,e),d=i.valuesMetadata[c],m=t.converterHelper.getFormattedLegendLabel(d,this.dataViewCat.values,a);if(1===n.length){var g=n[0];u=g.data.length>e&&g.data[e].color}else u=s.length>c&&s[c].color;r.push({color:u,icon:t.LegendIcon.Box,label:m,category:i.categoryFormatter?i.categoryFormatter.format(o):o,measure:t.valueFormatter.format(p,t.valueFormatter.getFormatString(d,a)),identity:t.SelectionId.createNull(),selected:!1})}return{dataPoints:r}},i.prototype.overrideXScale=function(e){this.xAxisProperties=e},i.prototype.render=function(e){var i=this.columnChart.drawColumns(!e),a=this.data,r=this.margin,o=this.currentViewport,n=o.height-(r.top+r.bottom),s=o.width-(r.left+r.right);this.mainGraphicsContext.attr("height",n).attr("width",s),t.TooltipManager.addTooltip(i.shapesSelection,function(e){return e.data.tooltipInfo});var l=[],c=void 0;if(this.interactivityService){for(var h=0,u=a.series.length;u>h;h++)l=l.concat(a.series[h].data);c={datapoints:l,bars:i.shapesSelection,hasHighlights:a.hasHighlights,eventGroup:this.mainGraphicsContext,mainGraphicsContext:this.mainGraphicsContext,viewport:i.viewport,axisOptions:i.axisOptions,showLabel:a.labelSettings.show}}return this.interactivity&&this.interactivity.isInteractiveLegend&&this.data.series.length>0&&this.selectColumn(0,!0),t.SVGUtil.flushAllD3TransitionsIfNeeded(this.options),{dataPoints:l,behaviorOptions:c,labelDataPoints:i.labelDataPoints,labelsAreNumeric:!0}},i.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},i.prototype.getVisualCategoryAxisIsScalar=function(){return this.data?this.data.scalarCategoryAxis:!1},i.prototype.getSupportedCategoryAxisType=function(){var e=this.data?this.data.categoryMetadata:void 0,i=t.AxisHelper.getCategoryValueType(e),a=t.AxisHelper.isOrdinal(i);return a?t.axisType.categorical:t.axisType.both},i.prototype.setFilteredData=function(i,a){var r=e.Prototype.inherit(this.data);return r.series=t.ColumnChart.sliceSeries(r.series,a,i),r.categories=r.categories.slice(i,a),this.columnChart.setData(r),r},i.ColumnChartClassName="columnChart",i.SeriesClasses=h("series"),i.BorderClass=h("mekkoborder"),i}();i.MekkoColumnChart=E;var b=function(){function e(e){this.dataView=e}return e.hasRole=function(e,t){var i=e.roles;return i&&i[t]},e.prototype.getLegend=function(i,a){var r=[],o=[],n=[],s=!1,l=new t.ColorHelper(i,t.columnChartProps.dataPoint.fill,a),c=void 0;if(this.dataView&&this.dataView.values){for(var h=this.dataView.values,u=h.grouped(),p=!(!h||!h.source),d=t.columnChartProps.general.formatString,m=0,g=u.length;g>m;m++)for(var f=u[m],y=f.objects,v=f.values,x=0,E=v.length;E>x;x++){var b=v[x],T=b.source;if(!e.hasRole(T,"Width")||e.hasRole(T,"Y")){o.push(T),n.push(b.objects);var w=b.identity?t.SelectionId.createWithIdAndMeasure(b.identity,T.queryName):t.SelectionId.createWithMeasure(this.getMeasureNameByIndex(x)),S=t.converterHelper.getFormattedLegendLabel(T,h,d),R=p?l.getColorForSeriesValue(y||T.objects,h.identityFields,T.groupName):l.getColorForMeasure(y||T.objects,T.queryName);r.push({icon:t.LegendIcon.Box,color:R,label:S,identity:w,selected:!1}),b.identity&&void 0!==T.groupName&&(s=!0)}}var C=this.dataView.values;c=C&&C.source?C.source.displayName:""}var A={title:c,dataPoints:r,grouped:s};return{legend:A,seriesSources:o,seriesObjects:n}},e.prototype.getValueBySeriesAndCategory=function(e,t){return this.dataView.values[e].values[t]},e.prototype.getMeasureNameByIndex=function(e){return this.dataView.values[e].source.queryName},e.prototype.hasHighlightValues=function(e){var t=this.dataView&&this.dataView.values?this.dataView.values[e]:void 0;return t&&!!t.highlights},e.prototype.getHighlightBySeriesAndCategory=function(e,t){return this.dataView.values[e].highlights[t]},e}(),T=function(){function e(e){this.behaviors=e}return e.prototype.bindEvents=function(e,t){for(var i=this.behaviors,a=0,r=i.length;r>a;a++)i[a].bindEvents(e.layerOptions[a],t);e.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){for(var t=0;t<this.behaviors.length;t++)this.behaviors[t].renderSelection(e)},e}();i.MekkoChartBehavior=T}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=t.utility.SelectionManager,o=e.visuals.valueFormatter,n=a.PixelConverter.fromPoint,s=function(){function i(e){this.margin={top:10,right:10,bottom:10,left:10},this.nodeWidth=21.5,this.curvatureOfLinks=.5,e&&(this.svg=e.svg,this.margin=e.margin||this.margin,this.curvatureOfLinks=e.curvatureOfLinks||this.curvatureOfLinks)}return i.getProperties=function(e){var t={};for(var i in e.objects){t[i]={};for(var a in e.objects[i].properties)t[i][a]={objectName:i,propertyName:a}}return t},Object.defineProperty(i.prototype,"textProperties",{get:function(){return{fontFamily:this.root.style("font-family"),fontSize:n(this.dataView?this.dataView.settings.fontSize:i.DefaultSettings.fontSize)}},enumerable:!0,configurable:!0}),i.prototype.init=function(e){this.svg?this.root=this.svg:this.root=d3.select(e.element.get(0)).append("svg"),this.selectionManager=new r({hostServices:e.host});var a=e.style;this.colours=a&&a.colorPalette?a.colorPalette.dataColors:new t.DataColorPalette,this.root.classed(i.ClassName,!0),this.main=this.root.append("g"),this.links=this.main.append("g").classed(i.Links["class"],!0),this.nodes=this.main.append("g").classed(i.Nodes["class"],!0)},i.prototype.update=function(e){if(e&&e.dataViews){var t,i=e.dataViews[0];this.updateViewport(e.viewport),t=this.converter(i),this.computePositions(t),this.dataView=t,this.render(t)}},i.prototype.updateViewport=function(e){var t,i;t=this.getPositiveNumber(e.height),i=this.getPositiveNumber(e.width),this.viewport={height:this.getPositiveNumber(t-this.margin.top-this.margin.bottom),width:this.getPositiveNumber(i-this.margin.left-this.margin.right)},this.updateElements(t,i)},i.prototype.getPositiveNumber=function(e){return 0>e||isNaN(e)||null===e||e===1/0||e===-(1/0)?0:e},i.prototype.updateElements=function(e,i){this.root.attr({height:e,width:i}),this.main.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top))},i.prototype.converter=function(a){var r=this;if(!(a&&a.categorical&&a.categorical.categories&&a.categorical.categories[0]&&a.categorical.categories[1]&&a.categorical.categories[0].values&&a.categorical.categories[1].values))return{nodes:[],links:[],columns:[],settings:{scale:{x:1,y:1},colourOfLabels:i.DefaultSettings.colourOfLabels,fontSize:i.DefaultSettings.fontSize}};var n,s,l,c,h,u,p,d=[],m=[],g=[],f=a.categorical.categories[0].values,y=a.categorical.categories[1].values,v=a.categorical.values&&a.categorical.values[0],x=[],E="g",b=a.categorical.categories[0].objects||[],T=[];return v&&v.values&&v.values.map&&(x=v.values.map(function(e){return e?e:0})),a.categorical.categories[0].identity&&(T=T.concat(a.categorical.categories[0].identity)),a.categorical.categories[1].identity&&(T=T.concat(a.categorical.categories[1].identity)),c=this.getObjectsFromDataView(a),h=this.getColour(i.Properties.labels.fill,i.DefaultSettings.colourOfLabels,c),v&&v.source&&(E=o.getFormatString(v.source,i.Properties.general.formatString)),g=f.map(function(e,t){return{source:e,destination:y[t],weigth:v?Math.max(x[t]||0,0):1}}),n=f.concat(y),s=o.create({format:o.getFormatString(a.categorical.categories[0].source,i.Properties.general.formatString),value:n[0],value2:n[n.length-1]}),l=o.create({format:E,value:Math.max(d3.max(x)||1,1)}),n.forEach(function(a,o){if(!d.some(function(e){return a===e.label.name?(e.selectionIds.push(t.SelectionId.createWithId(T[o])),!0):!1})){var n,l,c=s.format(a),u={text:c,fontFamily:r.textProperties.fontFamily,fontSize:r.textProperties.fontSize};n={name:a,formattedName:s.format(a),width:e.TextMeasurementService.measureSvgTextWidth(u),height:e.TextMeasurementService.estimateSvgTextHeight(u),colour:h},l=t.SelectionId.createWithId(T[o]),d.push({label:n,links:[],inputWeight:0,outputWeight:0,width:r.nodeWidth,height:0,colour:i.DefaultColourOfNode,tooltipData:[],selectionIds:[l]})}}),p=this.colours.getAllColors().length/d.length,d.forEach(function(e,t){e.colour=r.colours.getColorByIndex(Math.floor(t*p)).value}),g.forEach(function(e,a){var o,n,s,c;e.source!==e.destination&&(d.forEach(function(t){t.label.name===e.source&&(o=t),t.label.name===e.destination&&(n=t)}),c=r.getColour(i.Properties.links.fill,i.DefaultColourOfLink,b[a]),s={source:o,destination:n,weigth:e.weigth,height:e.weigth,colour:c,tooltipData:r.getTooltipDataForLink(l,o.label.formattedName,n.label.formattedName,e.weigth),selectionId:t.SelectionId.createWithId(T[a])},m.push(s),o.links.push(s),n.links.push(s),r.updateValueOfNode(o),r.updateValueOfNode(n),o.tooltipData=r.getTooltipForNode(l,o.label.formattedName,o.inputWeight?o.inputWeight:o.outputWeight),n.tooltipData=r.getTooltipForNode(l,n.label.formattedName,n.inputWeight?n.inputWeight:n.outputWeight))}),u=this.parseSettings(c),u.colourOfLabels=h,{nodes:d,links:m,settings:u,columns:[]}},i.prototype.getObjectsFromDataView=function(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.objects?e.metadata.objects:null},i.prototype.getColour=function(e,i,a){var r;return r=new t.ColorHelper(this.colours,e,i),r.getColorForMeasure(a,"")},i.prototype.getTooltipDataForLink=function(e,t,a,r){var o;return o=e&&e.format?e.format(r):r.toString(),[{displayName:i.RoleNames.rows,value:t},{displayName:i.RoleNames.columns,value:a},{displayName:i.RoleNames.values,value:o}]},i.prototype.updateValueOfNode=function(e){e.inputWeight=e.links.reduce(function(t,i){return t+(i.destination===e?i.weigth:0)},0),e.outputWeight=e.links.reduce(function(t,i){return t+(i.source===e?i.weigth:0)},0)},i.prototype.getTooltipForNode=function(e,t,a){var r;return r=e&&e.format?e.format(a):a.toString(),[{displayName:"Name",value:t},{displayName:i.RoleNames.values,value:r}]},i.prototype.parseSettings=function(t){var a=!1;return a=e.DataViewObjects.getValue(t,i.Properties.labels.show,i.DefaultSettings.isVisibleLabels),{isVisibleLabels:a,scale:{x:i.DefaultSettings.scale.x,y:i.DefaultSettings.scale.y},colourOfLabels:i.DefaultSettings.colourOfLabels,fontSize:e.DataViewObjects.getValue(t,i.Properties.labels.fontSize,i.DefaultSettings.fontSize)}},i.prototype.computePositions=function(e){var t,i,a;t=this.computeXPositions(e),this.sortNodesByX(e.nodes),a=this.getColumns(e.nodes),i=this.getMaxColumn(a),e.settings.scale.x=this.getScaleByAxisX(t),e.settings.scale.y=this.getScaleByAxisY(i.sumValueOfNodes),this.scalePositionsByAxes(e.nodes,a,e.settings.scale,this.viewport.height),this.computeYPosition(e.nodes,e.settings.scale.y)},i.prototype.computeXPositions=function(e){for(var t=e.nodes,i=[],a=[],r=0,o=!1;t.length>0;)i=[],t.forEach(function(e){e.x=r,e.links.forEach(function(t){e===t.source&&e!==t.destination&&i.every(function(e){return e!==t.destination})&&i.push(t.destination)})}),o=i.length===a.length&&a.every(function(e){return i.some(function(t){return t===e})}),o?(a.forEach(function(e){e.x=r,r++}),t=[]):(t=i,a=t,r++);return r-1},i.prototype.getScaleByAxisX=function(e){return void 0===e&&(e=1),this.getPositiveNumber((this.viewport.width-this.nodeWidth)/e)},i.prototype.sortNodesByX=function(e){return e.sort(function(e,t){return e.x-t.x})},i.prototype.getColumns=function(e){var t=[],i=-Number.MAX_VALUE;return e.forEach(function(e,a){i!==e.x&&(t.push({countOfNodes:0,sumValueOfNodes:0}),i=e.x),t[e.x]&&(t[e.x].sumValueOfNodes+=Math.max(e.inputWeight,e.outputWeight),t[e.x].countOfNodes++)}),t},i.prototype.getMaxColumn=function(e){void 0===e&&(e=[]);var t={sumValueOfNodes:0,countOfNodes:0};return e.forEach(function(e){e&&e.sumValueOfNodes>t.sumValueOfNodes&&(t=e)}),t},i.prototype.getScaleByAxisY=function(e){return this.getPositiveNumber((this.viewport.height-this.getAvailableSumNodeMarginByY())/e)},i.prototype.getAvailableSumNodeMarginByY=function(){return this.viewport?this.viewport.height*i.NodeBottomMargin/100:0},i.prototype.scalePositionsByAxes=function(e,t,i,a){var r=0,o=0,n=0;e.forEach(function(e){var s=0,l=0;o!==e.x&&(o=e.x,r=0,n=0),t[o]&&(l=a-t[o].sumValueOfNodes*i.y,s=l/t[o].countOfNodes),e.x*=i.x,e.height=Math.max(e.inputWeight,e.outputWeight)*i.y,e.y=r+s*n,r+=e.height,n++})},i.prototype.computeYPosition=function(e,t){e.forEach(function(e){e.links=e.links.sort(function(t,i){var a,r;return a=t.source===e?t.destination.y:t.source.y,r=i.source===e?i.destination.y:i.source.y,a-r});var i=0,a=0;e.links.forEach(function(r){var o=0;r.height=r.weigth*t,r.source.x<e.x||r.destination.x<e.x?(o=i,i+=r.height):(r.source.x>e.x||r.destination.x>e.x)&&(o=a,a+=r.height),r.source===e?r.dySource=o:r.destination===e&&(r.dyDestination=o)})})},i.prototype.render=function(e){var t,i;i=this.renderLinks(e),this.renderTooltip(i),t=this.renderNodes(e),this.renderTooltip(t),this.bindSelectionHandler(e,t,i)},i.prototype.renderNodes=function(a){var r,o,n,s=this;return n=this.main.select(i.Nodes.selector).selectAll(i.Node.selector),o=n.data(a.nodes.filter(function(e){return e.height>0})),r=o.enter().append("g"),o.attr("transform",function(e){return t.SVGUtil.translate(e.x,e.y)}).classed(i.Node["class"],!0),r.append("rect").classed(i.NodeRect["class"],!0),r.append("text").classed(i.NodeLabel["class"],!0),o.select(i.NodeRect.selector).style({fill:function(e){return e.colour},stroke:function(e){return d3.rgb(e.colour).darker(1.5)}}).attr({x:0,y:0,height:function(e){return e.height},width:function(e){return e.width}}),o.select(i.NodeLabel.selector).attr({x:function(e){return s.getLabelPositionByAxisX(e)},y:function(e){return e.height/2},dy:"0.35em"}).style("fill",function(e){return e.label.colour}).style("font-size",this.textProperties.fontSize).style("display",function(e){var t=!1,r=s.getCurrentPositionOfLabelByAxisX(e);return t=r>=s.viewport.width||0>=r||e.height+i.NodeMargin<e.label.height,t||!a.settings.isVisibleLabels||a.settings.scale.x/2<i.MinWidthOfLabel?"none":null}).style("text-anchor",function(e){return s.isLabelLargerThanWidth(e)?"end":null}).text(function(t){var r=a.settings.scale.x/2-t.width-i.NodeMargin;return s.getCurrentPositionOfLabelByAxisX(t)>r?e.TextMeasurementService.getTailoredTextOrDefault({text:t.label.formattedName,fontFamily:s.textProperties.fontFamily,fontSize:s.textProperties.fontSize},r):t.label.formattedName}),o.exit().remove(),o},i.prototype.getLabelPositionByAxisX=function(e){return this.isLabelLargerThanWidth(e)?-i.LabelMargin:e.width+i.LabelMargin},i.prototype.isLabelLargerThanWidth=function(e){var t=e.x+e.width+i.LabelMargin;return t+e.label.width>this.viewport.width},i.prototype.getCurrentPositionOfLabelByAxisX=function(e){var t=this.getLabelPositionByAxisX(e);return t=t>0?t+e.x+e.label.width+e.width:e.x+t-e.label.width-e.width},i.prototype.renderLinks=function(e){var t,a,r=this;return a=this.main.select(i.Links.selector).selectAll(i.Link.selector),t=a.data(e.links.filter(function(e){return e.height>0})),t.enter().append("path").classed(i.Link["class"],!0),t.attr("d",function(e){return r.getSvgPath(e)}).style({"stroke-width":function(e){return e.height},stroke:function(e){return e.colour}}),t.exit().remove(),t},i.prototype.getSvgPath=function(e){var t,i,a,r,o,n,s;return e.destination.x<e.source.x?(t=e.source.x,i=e.destination.x+e.destination.width):(t=e.source.x+e.source.width,i=e.destination.x),a=d3.interpolateNumber(t,i),r=a(this.curvatureOfLinks),o=a(1-this.curvatureOfLinks),n=e.source.y+e.dySource+e.height/2,s=e.destination.y+e.dyDestination+e.height/2,"M "+t+" "+n+" C "+r+" "+n+", "+o+" "+s+", "+i+" "+s},i.prototype.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipData})},i.prototype.bindSelectionHandler=function(e,t,i){var a=this;t.on("click",function(e){var r=_.isEqual(e.selectionIds.map(function(e){return e.getKey()}),a.selectionManager.getSelectionIds().map(function(e){return e.getKey()}))?[]:e.selectionIds;a.selectMany(r,!0).then(function(){return a.setSelection(t,i)}),d3.event.stopPropagation()}),i.on("click",function(e){a.selectionManager.select(e.selectionId,d3.event.ctrlKey).then(function(){return a.setSelection(t,i)}),d3.event.stopPropagation()}),this.root.on("click",function(){a.selectionManager.clear().then(function(){return a.setSelection(t,i)})}),this.setSelection(t,i)},i.prototype.selectMany=function(e,t){var i=this;if(void 0===t&&(t=!1),t)return this.selectionManager.clear().then(function(){return i.selectMany(e,!1)});var a=e.map(function(e){return i.selectionManager.select(e,!0)});return $.when.apply(null,a)},i.prototype.setSelection=function(e,t){var i=this.selectionManager.getSelectionIds();if(e.classed("selected",i.length>0),t.classed("selected",!1),0!==i.length){var a=e.filter(function(e){
return i.some(function(t){return e.selectionIds.some(function(e){return e.getKey()===t.getKey()})})}),r=t.filter(function(e){return i.some(function(t){return t.getKey()===e.selectionId.getKey()})});a.classed("selected",!1),r.classed("selected",!0)}},i.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;if(!this.dataView)return[];switch(e.objectName){case"labels":this.enumerateLabels(i);break;case"links":this.enumerateLinks(i)}return i.complete()},i.prototype.enumerateLabels=function(e){var t,i=this.dataView.settings;i&&(t={objectName:"labels",displayName:"labels",selector:null,properties:{show:i.isVisibleLabels,fill:i.colourOfLabels,fontSize:i.fontSize}},e.pushInstance(t))},i.prototype.enumerateLinks=function(e){var i=this.dataView.links;i&&i.length>0&&i.forEach(function(i){e.pushInstance({objectName:"links",displayName:i.source.label.formattedName+" - "+i.destination.label.formattedName,selector:t.ColorHelper.normalizeSelector(i.selectionId.getSelector(),!1),properties:{fill:{solid:{color:i.colour}}}})})},i.ClassName="sankeyDiagram",i.Nodes={"class":"nodes",selector:".nodes"},i.Node={"class":"node",selector:".node"},i.NodeRect={"class":"nodeRect",selector:".nodeRect"},i.NodeLabel={"class":"nodeLabel",selector:".nodeLabel"},i.Links={"class":"links",selector:".links"},i.Link={"class":"link",selector:".link"},i.DefaultColourOfNode="rgb(62, 187, 162)",i.DefaultColourOfLink="black",i.DefaultSettings={isVisibleLabels:!0,scale:{x:1,y:1},colourOfLabels:"black",fontSize:12},i.MinWidthOfLabel=35,i.NodeBottomMargin=5,i.NodeMargin=5,i.LabelMargin=4,i.RoleNames={rows:"Source",columns:"Destination",values:"Weight"},i.capabilities={dataRoles:[{name:i.RoleNames.rows,kind:e.VisualDataRoleKind.Grouping,displayName:i.RoleNames.rows},{name:i.RoleNames.columns,kind:e.VisualDataRoleKind.Grouping,displayName:i.RoleNames.columns},{name:i.RoleNames.values,kind:e.VisualDataRoleKind.Measure,displayName:i.RoleNames.values}],dataViewMappings:[{conditions:[{Source:{min:0,max:1},Destination:{min:0,max:1},Weight:{min:0,max:0}},{Source:{min:0,max:1},Destination:{min:0,max:1},Weight:{min:1,max:1}}],categorical:{categories:{"for":{"in":i.RoleNames.rows},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:i.RoleNames.columns}},{bind:{to:i.RoleNames.values}}]}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},labels:{displayName:e.data.createDisplayNameGetter("Visual_DataPointsLabels"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},links:{displayName:"Links",properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}}}},i.Properties=i.getProperties(i.capabilities),i}();i.SankeyDiagram=s}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=a.PixelConverter;i.bulletChartProps={values:{targetValue:{objectName:"values",propertyName:"targetValue"},minimumPercent:{objectName:"values",propertyName:"minimumPercent"},needsImprovementPercent:{objectName:"values",propertyName:"needsImprovementPercent"},satisfactoryPercent:{objectName:"values",propertyName:"satisfactoryPercent"},goodPercent:{objectName:"values",propertyName:"goodPercent"},veryGoodPercent:{objectName:"values",propertyName:"veryGoodPercent"},maximumPercent:{objectName:"values",propertyName:"maximumPercent"},targetValue2:{objectName:"values",propertyName:"targetValue2"},secondTargetVisibility:{objectName:"values",propertyName:"secondTargetVisibility"}},orientation:{orientation:{objectName:"orientation",propertyName:"orientation"}},colors:{badColor:{objectName:"colors",propertyName:"badColor"},needsImprovementColor:{objectName:"colors",propertyName:"needsImprovementColor"},satisfactoryColor:{objectName:"colors",propertyName:"satisfactoryColor"},goodColor:{objectName:"colors",propertyName:"goodColor"},veryGoodColor:{objectName:"colors",propertyName:"veryGoodColor"},bulletColor:{objectName:"colors",propertyName:"bulletColor"}},axis:{axis:{objectName:"axis",propertyName:"axis"},axisColor:{objectName:"axis",propertyName:"axisColor"},measureUnits:{objectName:"axis",propertyName:"measureUnits"},unitsColor:{objectName:"axis",propertyName:"unitsColor"}},formatString:{objectName:"general",propertyName:"formatString"},labels:{fontSize:{objectName:"labels",propertyName:"fontSize"},show:{objectName:"labels",propertyName:"show"},labelColor:{objectName:"labels",propertyName:"labelColor"}}},i.bulletChartRoleNames={value:"Value",targetValue:"TargetValue",minValue:"Minimum",needsImprovementValue:"NeedsImprovement",satisfactoryValue:"Satisfactory",goodValue:"Good",veryGoodValue:"VeryGood",maxValue:"Maximum",targetValue2:"TargetValue2"};var o;!function(t){t.HORIZONTALLEFT="Horizontal Left",t.HORIZONTALRIGHT="Horizontal Right",t.VERTICALTOP="Vertical Top",t.VERTICALBOTTOM="Vertical Bottom",t.type=e.createEnumType([{value:t.HORIZONTALLEFT,displayName:t.HORIZONTALLEFT},{value:t.HORIZONTALRIGHT,displayName:t.HORIZONTALRIGHT},{value:t.VERTICALTOP,displayName:t.VERTICALTOP},{value:t.VERTICALBOTTOM,displayName:t.VERTICALBOTTOM}])}(o||(o={}));var n=function(){function a(){this.baselineDelta=0}return Object.defineProperty(a.prototype,"reverse",{get:function(){return this.model.bulletChartSettings.orientation.reverse},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"vertical",{get:function(){return this.model.bulletChartSettings.orientation.vertical},enumerable:!0,configurable:!0}),a.DefaultStyleProperties=function(){return{values:{targetValue:0,targetValue2:0,minimumPercent:0,needsImprovementPercent:25,satisfactoryPercent:50,goodPercent:100,veryGoodPercent:125,maximumPercent:200,secondTargetVisibility:!1},orientation:{orientation:o.HORIZONTALLEFT,reverse:!1,vertical:!1},colors:{badColor:"Darkred",needsImprovementColor:"Red",satisfactoryColor:"Yellow",goodColor:"Green",veryGoodColor:"Darkgreen",bulletColor:"Black"},axis:{axis:!0,axisColor:"Grey",measureUnits:"",unitsColor:"Grey"},labelSettings:{fontSize:11,show:!0,labelColor:"Black"}}},Object.defineProperty(a.prototype,"viewportIn",{get:function(){return{width:this.viewport.width,height:this.viewport.height}},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"viewportScroll",{get:function(){var e=this.viewportIn;return{width:e.width-a.ScrollBarSize,height:e.height-a.ScrollBarSize}},enumerable:!0,configurable:!0}),a.getTextProperties=function(e,t){return{fontFamily:a.FontFamily,fontSize:r.fromPoint(t),text:e}},a.converter=function(n,s){var l=a.DefaultStyleProperties(),c={bulletValueFormatString:null,bulletChartSettings:l,bars:[],barRects:[],valueRects:[],targetValues:[],viewportLength:0};if(!(n&&n.categorical&&n.categorical.values&&0!==n.categorical.values.length&&n.metadata&&n.metadata.columns&&0!==n.metadata.columns.length))return c;var h=n.metadata.objects,u=c.bulletChartSettings;h&&(u.values.targetValue=e.DataViewObjects.getValue(h,i.bulletChartProps.values.targetValue,l.values.targetValue),u.values.targetValue2=e.DataViewObjects.getValue(h,i.bulletChartProps.values.targetValue2,l.values.targetValue2),u.values.secondTargetVisibility=e.DataViewObjects.getValue(h,i.bulletChartProps.values.secondTargetVisibility,l.values.secondTargetVisibility),u.values.minimumPercent=e.DataViewObjects.getValue(h,i.bulletChartProps.values.minimumPercent,l.values.minimumPercent),u.values.needsImprovementPercent=e.DataViewObjects.getValue(h,i.bulletChartProps.values.needsImprovementPercent,l.values.needsImprovementPercent),u.values.satisfactoryPercent=e.DataViewObjects.getValue(h,i.bulletChartProps.values.satisfactoryPercent,l.values.satisfactoryPercent),u.values.goodPercent=e.DataViewObjects.getValue(h,i.bulletChartProps.values.goodPercent,l.values.goodPercent),u.values.veryGoodPercent=e.DataViewObjects.getValue(h,i.bulletChartProps.values.veryGoodPercent,l.values.veryGoodPercent),u.values.maximumPercent=e.DataViewObjects.getValue(h,i.bulletChartProps.values.maximumPercent,l.values.maximumPercent),u.orientation.orientation=e.DataViewObjects.getValue(h,i.bulletChartProps.orientation.orientation,l.orientation.orientation),u.colors.badColor=e.DataViewObjects.getFillColor(h,i.bulletChartProps.colors.badColor,l.colors.badColor),u.colors.needsImprovementColor=e.DataViewObjects.getFillColor(h,i.bulletChartProps.colors.needsImprovementColor,l.colors.needsImprovementColor),u.colors.satisfactoryColor=e.DataViewObjects.getFillColor(h,i.bulletChartProps.colors.satisfactoryColor,l.colors.satisfactoryColor),u.colors.goodColor=e.DataViewObjects.getFillColor(h,i.bulletChartProps.colors.goodColor,l.colors.goodColor),u.colors.veryGoodColor=e.DataViewObjects.getFillColor(h,i.bulletChartProps.colors.veryGoodColor,l.colors.veryGoodColor),u.colors.bulletColor=e.DataViewObjects.getFillColor(h,i.bulletChartProps.colors.bulletColor,l.colors.bulletColor),u.axis.axis=e.DataViewObjects.getValue(h,i.bulletChartProps.axis.axis,l.axis.axis),u.axis.axisColor=e.DataViewObjects.getFillColor(h,i.bulletChartProps.axis.axisColor,l.axis.axisColor),u.axis.measureUnits=e.TextMeasurementService.getTailoredTextOrDefault(a.getTextProperties(e.DataViewObjects.getValue(h,i.bulletChartProps.axis.measureUnits,l.axis.measureUnits),a.DefaultSubtitleFontSizeInPt),a.MaxLabelWidth),u.axis.unitsColor=e.DataViewObjects.getFillColor(h,i.bulletChartProps.axis.unitsColor,l.axis.unitsColor),u.labelSettings.fontSize=e.DataViewObjects.getValue(h,i.bulletChartProps.labels.fontSize,l.labelSettings.fontSize),u.labelSettings.show=e.DataViewObjects.getValue(h,i.bulletChartProps.labels.show,l.labelSettings.show),u.labelSettings.labelColor=e.DataViewObjects.getFillColor(h,i.bulletChartProps.labels.labelColor,l.labelSettings.labelColor)),u.orientation.orientation!==o.HORIZONTALRIGHT&&u.orientation.orientation!==o.VERTICALBOTTOM||(u.orientation.reverse=!0),u.orientation.orientation!==o.VERTICALTOP&&u.orientation.orientation!==o.VERTICALBOTTOM||(u.orientation.vertical=!0);var p,d,m,g=1;n.categorical.categories&&(p=n.categorical.categories[0],d=p.values,g=d.length,m=t.valueFormatter.getFormatString(p.source,i.bulletChartProps.formatString)),c.labelHeight=(u.labelSettings.show||0)&&parseFloat(r.fromPoint(u.labelSettings.fontSize)),c.labelHeightTop=(u.labelSettings.show||0)&&parseFloat(r.fromPoint(u.labelSettings.fontSize))/1.4,c.spaceRequiredForBarHorizontally=Math.max(60,c.labelHeight+20),c.bulletValueFormatString=t.valueFormatter.getFormatString(n.categorical.values[0].source,i.bulletChartProps.formatString),c.viewportLength=(u.orientation.vertical?s.viewport.height-c.labelHeightTop-a.SubtitleMargin-20-2*a.YMarginVertical:s.viewport.width-a.MaxLabelWidth-3*a.XMarginHorizontal)-a.ScrollBarSize;for(var f=0;g>f;f++){var y=[],v=void 0,x=void 0,E=void 0,b=void 0,T=void 0,w=void 0,S=void 0,R=void 0,C=void 0,A=void 0,M=!1,H=void 0;if(d){var P=d[f];v=t.valueFormatter.format(P,m),H=p.identity?p.identity[f]:null;var D=a.getTextProperties(v,u.labelSettings.fontSize);v=e.TextMeasurementService.getTailoredTextOrDefault(D,a.MaxLabelWidth)}var _=n.categorical.values;E=u.values.targetValue,b=u.values.targetValue2,c.hasHighlights=!!(_.length>0&&_[0].highlights);for(var L=0;L<_.length;L++){var N=_[L].source,V=_[L].values[f]||0;N&&N.roles&&(N.roles[i.bulletChartRoleNames.value]?(_[L].highlights&&(M=null!==_[L].highlights[f]),y.push({value:V,metadata:_[L]}),x=V):N.roles[i.bulletChartRoleNames.targetValue]?(y.push({value:V,metadata:_[L]}),E=V):N.roles[i.bulletChartRoleNames.targetValue2]?(y.push({value:V,metadata:_[L]}),b=V):N.roles[i.bulletChartRoleNames.minValue]?T=V:N.roles[i.bulletChartRoleNames.needsImprovementValue]?C=V:N.roles[i.bulletChartRoleNames.satisfactoryValue]?w=V:N.roles[i.bulletChartRoleNames.goodValue]?S=V:N.roles[i.bulletChartRoleNames.veryGoodValue]?A=V:N.roles[i.bulletChartRoleNames.maxValue]&&(R=V))}T||(T=u.values.minimumPercent*E/100),C||(C=u.values.needsImprovementPercent*E/100),w||(w=u.values.satisfactoryPercent*E/100),S||(S=u.values.goodPercent*E/100),A||(A=u.values.veryGoodPercent*E/100),R||(R=u.values.maximumPercent*E/100);var z=[T,C,w,S,A,R].sort(d3.descending),I=d3.scale.linear().clamp(!0).domain([T,Math.max(z[0],E,x)]).range(u.orientation.vertical?[c.viewportLength,0]:[0,c.viewportLength]),F=I(T),O=I(C),k=I(w),j=I(S),B=I(A),G=I(R),U=I(x),W=u.colors.badColor,X=u.colors.needsImprovementColor,Y=u.colors.satisfactoryColor,K=u.colors.goodColor,q=u.colors.veryGoodColor;a.addItemToBarArray(c.barRects,f,F,O,W,y,H,M),a.addItemToBarArray(c.barRects,f,O,k,X,y,H,M),a.addItemToBarArray(c.barRects,f,k,j,Y,y,H,M),a.addItemToBarArray(c.barRects,f,j,B,K,y,H,M),a.addItemToBarArray(c.barRects,f,B,G,q,y,H,M),a.addItemToBarArray(c.valueRects,f,F,U,u.colors.bulletColor,y,H,M),c.targetValues.push({barIndex:f,value:I(E),fill:u.colors.bulletColor,key:t.SelectionId.createWithIdAndMeasure(H,I(E).toString()).getKey(),value2:I(b)});var Z=null;if(u.axis.axis){Z=d3.svg.axis(),Z.orient(u.orientation.vertical?"left":"bottom");var Q=Math.round(Math.max(3,c.viewportLength/100)),J=[x,E,S,w,R,T,C,A].filter(function(e){return!isNaN(e)});Z.tickFormat(t.valueFormatter.create({format:c.bulletValueFormatString,value:J.length?Math.max.apply(null,J):0}).format),Z.ticks(Q),Z.scale(I)}var $={scale:I,barIndex:f,categoryLabel:v,x:u.orientation.vertical?a.XMarginVertical+a.SpaceRequiredForBarVertically*f:a.XMarginHorizontal,y:u.orientation.vertical?a.YMarginVertical:a.YMarginHorizontal+c.spaceRequiredForBarHorizontally*f,axis:Z,key:t.SelectionId.createWithIdAndMeasure(H,f.toString()).getKey()};c.bars.push($)}return c},a.addItemToBarArray=function(e,a,r,o,n,s,l,c){isNaN(r)||isNaN(o)||e.push({barIndex:a,start:r,end:o,fill:n,tooltipInfo:t.TooltipBuilder.createTooltipInfo(i.bulletChartProps.formatString,null,null,null,null,s),selected:!1,identity:t.SelectionId.createWithId(l),key:t.SelectionId.createWithIdAndMeasure(l,r+" "+o).getKey(),highlight:c})},a.prototype.init=function(e){var i=d3.select(e.element.get(0));this.hostService=e.host,this.bulletBody=i.append("div").classed("bulletChart",!0).attr("drag-resize-disabled",!0),this.scrollContainer=this.bulletBody.append("svg").classed("bullet-scroll-region",!0),this.clearCatcher=t.appendClearCatcher(this.scrollContainer),this.labelGraphicsContext=this.scrollContainer.append("g"),this.bulletGraphicsContext=this.scrollContainer.append("g"),this.behavior=new l,this.interactivityService=t.createInteractivityService(e.host)},a.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){var t=e.dataViews[0];this.viewport=e.viewport,this.model=a.converter(t,e),this.baselineDelta=s.estimateSvgTextBaselineDelta(a.getTextProperties("1",this.model.bulletChartSettings.labelSettings.fontSize)),this.ClearViewport(),this.model&&(this.interactivityService&&this.interactivityService.applySelectionStateToData(this.model.barRects),this.bulletBody.style({height:this.viewportIn.height+"px",width:this.viewportIn.width+"px"}),this.vertical?this.scrollContainer.attr({width:this.model.bars.length*a.SpaceRequiredForBarVertically+a.XMarginVertical+"px",height:this.viewportScroll.height+"px"}):this.scrollContainer.attr({height:this.model.bars.length*this.model.spaceRequiredForBarHorizontally+"px",width:this.viewportScroll.width+"px"}),this.vertical?this.setUpBulletsVertically(this.bulletBody,this.model,this.reverse):this.setUpBulletsHorizontally(this.bulletBody,this.model,this.reverse))}},a.prototype.ClearViewport=function(){this.labelGraphicsContext.selectAll("text").remove(),this.bulletGraphicsContext.selectAll("rect").remove(),this.bulletGraphicsContext.selectAll("text").remove(),this.bulletGraphicsContext.selectAll("axis").remove(),this.bulletGraphicsContext.selectAll("path").remove(),this.bulletGraphicsContext.selectAll("line").remove(),this.bulletGraphicsContext.selectAll("tick").remove(),this.bulletGraphicsContext.selectAll("g").remove()},a.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},a.prototype.calculateLabelWidth=function(e,t,i){return(i?0:e.x+a.MaxLabelWidth)+a.XMarginHorizontal+(t?t.start:0)},a.prototype.calculateLabelHeight=function(e,t,i){return a.YMarginVertical+(i?5:e.y+this.model.labelHeightTop+a.BarMargin+a.SubtitleMargin)+(t?t.end:0)},a.prototype.setUpBulletsHorizontally=function(i,o,n){var s=this,l=o.bars,c=o.barRects,h=o.valueRects,u=o.targetValues,p=this.labelGraphicsContext.selectAll("text").data(l,function(e){return e.key}),d=this.bulletGraphicsContext.selectAll("rect.range").data(c,function(e){return e.key}),m=this.interactivityService&&this.interactivityService.hasSelection(),g=o.hasHighlights,f=d.enter().append("rect").attr({x:function(e){return s.calculateLabelWidth(l[e.barIndex],e,n)},y:function(e){return l[e.barIndex].y-a.BulletSize/2},width:function(e){return e.end-e.start},height:a.BulletSize}).classed("range",!0).style({fill:function(e){return e.fill},opacity:function(e){return t.ColumnUtil.getFillOpacity(e.selected,e.highlight,m,g)}});d.exit();var y=this.bulletGraphicsContext.selectAll("rect").data(h,function(e){return e.key});y.enter().append("rect").attr({x:function(e){return s.calculateLabelWidth(l[e.barIndex],e,n)},y:function(e){return l[e.barIndex].y-a.BulletSize/8},width:function(e){return e.end-e.start},height:1*a.BulletSize/4}).classed("value",!0).style({fill:function(e){return e.fill},opacity:function(e){return t.ColumnUtil.getFillOpacity(e.selected,e.highlight,m,g)}}),y.exit();var v=this.bulletGraphicsContext.selectAll("values").data(u,function(e){return isNaN(e.value)||isNaN(e.value2)?void 0:e.key});if(v.enter().append("line").attr({x1:function(e){return s.calculateLabelWidth(l[e.barIndex],null,n)+e.value},x2:function(e){return s.calculateLabelWidth(l[e.barIndex],null,n)+e.value},y1:function(e){return l[e.barIndex].y-a.MarkerMarginHorizontal},y2:function(e){return l[e.barIndex].y+a.MarkerMarginHorizontal}}).style({stroke:function(e){return e.fill},"stroke-width":2}),o.bulletChartSettings.values.secondTargetVisibility&&this.drawSecondTarget(v.enter(),function(e){return s.calculateLabelWidth(l[e.barIndex],null,n)+e.value2},function(e){return l[e.barIndex].y}),v.exit(),o.bulletChartSettings.axis.axis)for(var x=0;x<l.length;x++){var E=l[x];this.bulletGraphicsContext.append("g").attr({transform:function(){var e=s.calculateLabelWidth(E,null,n),t=E.y+a.BulletSize/2;return"translate("+e+","+t+")"}}).classed("axis",!0).call(E.axis.scale(E.scale)).style({fill:o.bulletChartSettings.axis.axisColor,"font-size":r.fromPoint(a.AxisFontSizeInPt)}).selectAll("line").style({stroke:o.bulletChartSettings.axis.axisColor})}o.bulletChartSettings.labelSettings.show&&p.enter().append("text").classed("title",!0).attr({x:function(e){return n?2*a.XMarginHorizontal+o.viewportLength:e.x},y:function(e){return e.y+s.baselineDelta},fill:o.bulletChartSettings.labelSettings.labelColor,"font-size":r.fromPoint(o.bulletChartSettings.labelSettings.fontSize)}).text(function(e){return e.categoryLabel});var b=e.TextMeasurementService.getTailoredTextOrDefault(a.getTextProperties(o.bulletChartSettings.axis.measureUnits,a.DefaultSubtitleFontSizeInPt),a.MaxMeasureUnitWidth);if(o.bulletChartSettings.axis.measureUnits&&p.enter().append("text").attr({x:function(e){return n?2*a.XMarginHorizontal+o.viewportLength+a.SubtitleMargin:e.x-a.SubtitleMargin},y:function(e){return e.y+s.model.labelHeight/2+12},fill:o.bulletChartSettings.axis.unitsColor,"font-size":r.fromPoint(a.DefaultSubtitleFontSizeInPt)}).text(b),this.interactivityService){var T={rects:f,valueRects:y,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService,bulletChartSettings:this.model.bulletChartSettings,hasHighlights:!1},w=this.model.barRects.concat(this.model.valueRects);this.interactivityService.bind(w,this.behavior,T)}p.exit(),t.TooltipManager.addTooltip(y,function(e){return e.data.tooltipInfo},!0),t.TooltipManager.addTooltip(d,function(e){return e.data.tooltipInfo},!0)},a.prototype.setUpBulletsVertically=function(i,o,n){var s=this,l=o.bars,c=o.barRects,h=o.valueRects,u=o.targetValues,p=this.labelGraphicsContext.selectAll("text").data(l,function(e){return e.key}),d=this.bulletGraphicsContext.selectAll("rect.range").data(c,function(e){return e.key}),m=this.interactivityService&&this.interactivityService.hasSelection(),g=o.hasHighlights,f=d.enter().append("rect").attr({x:function(e){return l[e.barIndex].x},y:function(e){return s.calculateLabelHeight(l[e.barIndex],e,n)},height:function(e){return e.start-e.end},width:a.BulletSize}).classed("range",!0).style({fill:function(e){return e.fill},opacity:function(e){return t.ColumnUtil.getFillOpacity(e.selected,e.highlight,m,g)}});d.exit();var y=this.bulletGraphicsContext.selectAll("rect").data(h,function(e){return e.key});y.enter().append("rect").attr({x:function(e){return l[e.barIndex].x+a.BulletSize/3},y:function(e){return s.calculateLabelHeight(l[e.barIndex],e,n)},height:function(e){return e.start-e.end},width:1*a.BulletSize/4}).classed("value",!0).style({fill:function(e){return e.fill},opacity:function(e){return t.ColumnUtil.getFillOpacity(e.selected,e.highlight,m,g)}}),y.exit();var v=this.bulletGraphicsContext.selectAll("values").data(u,function(e){return isNaN(e.value)||isNaN(e.value2)?void 0:e.key});if(v.enter().append("line").attr({x2:function(e){return l[e.barIndex].x+3*a.MarkerMarginVertical},x1:function(e){return l[e.barIndex].x+a.MarkerMarginVertical},y2:function(e){return s.calculateLabelHeight(l[e.barIndex],null,n)+e.value},y1:function(e){return s.calculateLabelHeight(l[e.barIndex],null,n)+e.value}}).style({stroke:function(e){return e.fill},"stroke-width":2}),o.bulletChartSettings.values.secondTargetVisibility&&this.drawSecondTarget(v.enter(),function(e){return l[e.barIndex].x+a.BulletSize/3+a.BulletSize/8},function(e){return s.calculateLabelHeight(l[e.barIndex],null,n)+e.value2}),v.exit(),o.bulletChartSettings.axis.axis)for(var x=0;x<l.length;x++){var E=l[x];this.bulletGraphicsContext.append("g").attr({transform:function(){var e=E.x,t=s.calculateLabelHeight(E,null,n);return"translate("+e+","+t+")"}}).classed("axis",!0).call(E.axis.scale(E.scale)).style({fill:o.bulletChartSettings.axis.axisColor,"font-size":r.fromPoint(a.AxisFontSizeInPt)}).selectAll("line").style({stroke:o.bulletChartSettings.axis.axisColor})}var b=a.YMarginVertical+(n?o.viewportLength+15:0)+this.model.labelHeightTop;o.bulletChartSettings.labelSettings.show&&p.enter().append("text").classed("title",!0).attr({x:function(e){return e.x},y:function(e){return b},fill:o.bulletChartSettings.labelSettings.labelColor,"font-size":r.fromPoint(o.bulletChartSettings.labelSettings.fontSize)}).text(function(e){return e.categoryLabel});var T=e.TextMeasurementService.getTailoredTextOrDefault(a.getTextProperties(o.bulletChartSettings.axis.measureUnits,a.DefaultSubtitleFontSizeInPt),a.MaxMeasureUnitWidth);if(o.bulletChartSettings.axis.measureUnits&&p.enter().append("text").attr({x:function(e){return e.x+a.BulletSize},y:function(e){return b+a.SubtitleMargin+12},fill:o.bulletChartSettings.axis.unitsColor,"font-size":r.fromPoint(a.DefaultSubtitleFontSizeInPt)}).text(T),this.interactivityService){var w={rects:f,valueRects:y,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService,bulletChartSettings:this.model.bulletChartSettings,hasHighlights:!1},S=this.model.barRects.concat(this.model.valueRects);this.interactivityService.bind(S,this.behavior,w)}p.exit(),t.TooltipManager.addTooltip(y,function(e){return e.data.tooltipInfo},!0),t.TooltipManager.addTooltip(d,function(e){return e.data.tooltipInfo},!0)},a.prototype.drawSecondTarget=function(e,t,i){var r={stroke:function(e){return e.fill},"stroke-width":2};e.append("line").attr({x1:function(e){return t(e)-a.SecondTargetLineSize},y1:function(e){return i(e)-a.SecondTargetLineSize},x2:function(e){return t(e)+a.SecondTargetLineSize},y2:function(e){return i(e)+a.SecondTargetLineSize}}).style(r),e.append("line").attr({x1:function(e){return t(e)+a.SecondTargetLineSize},y1:function(e){return i(e)-a.SecondTargetLineSize},x2:function(e){return t(e)-a.SecondTargetLineSize},y2:function(e){return i(e)+a.SecondTargetLineSize}}).style(r)},a.prototype.destroy=function(){},a.prototype.enumerateObjectInstances=function(e){var t=this.model;if(t){var i=e.objectName;switch(i){case"labels":return this.enumerateLabels(t);case"values":return this.enumerateValues(t);case"orientation":return this.enumerateOrientation(t);case"axis":return this.enumerateAxis(t);case"colors":return this.enumerateColors(t)}}},a.prototype.enumerateLabels=function(e){return[{selector:null,objectName:"labels",properties:{show:this.model.bulletChartSettings.labelSettings.show,labelColor:this.model.bulletChartSettings.labelSettings.labelColor,fontSize:this.model.bulletChartSettings.labelSettings.fontSize}}]},a.prototype.enumerateValues=function(e){return[{selector:null,objectName:"values",properties:{targetValue:this.model.bulletChartSettings.values.targetValue,targetValue2:this.model.bulletChartSettings.values.targetValue2,secondTargetVisibility:this.model.bulletChartSettings.values.secondTargetVisibility,minimumPercent:this.model.bulletChartSettings.values.minimumPercent,needsImprovementPercent:this.model.bulletChartSettings.values.needsImprovementPercent,satisfactoryPercent:this.model.bulletChartSettings.values.satisfactoryPercent,goodPercent:this.model.bulletChartSettings.values.goodPercent,veryGoodPercent:this.model.bulletChartSettings.values.veryGoodPercent,maximumPercent:this.model.bulletChartSettings.values.maximumPercent}}]},a.prototype.enumerateOrientation=function(e){return[{selector:null,objectName:"orientation",properties:{orientation:this.model.bulletChartSettings.orientation.orientation}}]},a.prototype.enumerateAxis=function(e){return[{selector:null,objectName:"axis",properties:{axis:this.model.bulletChartSettings.axis.axis,axisColor:this.model.bulletChartSettings.axis.axisColor,measureUnits:this.model.bulletChartSettings.axis.measureUnits,unitsColor:this.model.bulletChartSettings.axis.unitsColor}}]},a.prototype.enumerateColors=function(e){return[{selector:null,objectName:"colors",properties:{badColor:this.model.bulletChartSettings.colors.badColor,needsImprovementColor:this.model.bulletChartSettings.colors.needsImprovementColor,satisfactoryColor:this.model.bulletChartSettings.colors.satisfactoryColor,goodColor:this.model.bulletChartSettings.colors.goodColor,veryGoodColor:this.model.bulletChartSettings.colors.veryGoodColor,bulletColor:this.model.bulletChartSettings.colors.bulletColor}}]},a.ScrollBarSize=22,a.SpaceRequiredForBarVertically=100,a.XMarginHorizontal=20,a.YMarginHorizontal=30,a.XMarginVertical=50,a.YMarginVertical=10,a.BulletSize=25,a.DefaultSubtitleFontSizeInPt=9,a.BarMargin=10,a.MaxLabelWidth=80,a.MaxMeasureUnitWidth=a.MaxLabelWidth-20,a.SubtitleMargin=10,a.AxisFontSizeInPt=8,a.SecondTargetLineSize=7,a.MarkerMarginHorizontal=a.BulletSize/3,a.MarkerMarginVertical=a.BulletSize/4,a.FontFamily="Segoe UI",a.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Value",kind:e.VisualDataRoleKind.Measure,displayName:"Value"},{name:"TargetValue",kind:e.VisualDataRoleKind.Measure,displayName:"Target Value"},{name:"Minimum",kind:e.VisualDataRoleKind.Measure,displayName:"Minimum"},{name:"NeedsImprovement",kind:e.VisualDataRoleKind.Measure,displayName:"Needs Improvement"},{name:"Satisfactory",kind:e.VisualDataRoleKind.Measure,displayName:"Satisfactory"},{name:"Good",kind:e.VisualDataRoleKind.Measure,displayName:"Good"},{name:"VeryGood",kind:e.VisualDataRoleKind.Measure,displayName:"Very Good"},{name:"Maximum",kind:e.VisualDataRoleKind.Measure,displayName:"Maximum"},{name:"TargetValue2",kind:e.VisualDataRoleKind.Measure,displayName:"Target Value 2"}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},values:{displayName:"Data values",properties:{targetValue:{displayName:"Target Value",type:{numeric:!0}},targetValue2:{displayName:"Target Value 2",type:{numeric:!0}},secondTargetVisibility:{displayName:"Second Target Visibility",type:{bool:!0}},minimumPercent:{displayName:"Minimum %",type:{numeric:!0}},needsImprovementPercent:{displayName:"Needs Improvement %",type:{numeric:!0}},satisfactoryPercent:{displayName:"Satisfactory %",type:{numeric:!0}},goodPercent:{displayName:"Good %",type:{numeric:!0}},veryGoodPercent:{displayName:"Very Good %",type:{numeric:!0}},maximumPercent:{displayName:"Maximum %",type:{numeric:!0}}}},labels:{displayName:"Category labels",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},labelColor:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),description:e.data.createDisplayNameGetter("Visual_LabelsFillDescription"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},orientation:{displayName:"Orientation",properties:{orientation:{displayName:"Orientation",type:{enumeration:o.type}}}},colors:{displayName:"Colors",properties:{badColor:{type:{fill:{solid:{color:!0}}},displayName:"Bad Color"},needsImprovementColor:{type:{fill:{solid:{color:!0}}},displayName:"Needs Improvement Color"},satisfactoryColor:{type:{fill:{solid:{color:!0}}},displayName:"Satisfactory Color"},goodColor:{type:{fill:{solid:{color:!0}}},displayName:"Good Color"},veryGoodColor:{type:{fill:{solid:{color:!0}}},displayName:"Very Good Color"},bulletColor:{type:{fill:{solid:{color:!0}}},displayName:"Bullet Color"}}},axis:{displayName:"Axis",properties:{axis:{displayName:"Axis",type:{bool:!0}},axisColor:{type:{fill:{solid:{color:!0}}},displayName:"Axis Color"},measureUnits:{type:{text:!0},displayName:"Measure Units "},unitsColor:{type:{fill:{solid:{color:!0}}},displayName:"Units Color"}}}},dataViewMappings:[{conditions:[{Category:{max:1},Value:{max:1},TargetValue:{max:1},Minimum:{max:1},NeedsImprovement:{max:1},Satisfactory:{max:1},Good:{max:1},VeryGood:{max:1},Maximum:{max:1},TargetValue2:{max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:"Value"}},{bind:{to:"TargetValue"}},{bind:{to:"TargetValue2"}},{bind:{to:"Minimum"}},{bind:{to:"NeedsImprovement"}},{bind:{to:"Satisfactory"}},{bind:{to:"Good"}},{bind:{to:"VeryGood"}},{bind:{to:"Maximum"}}]}}}],supportsHighlight:!0,sorting:{"default":{}},drilldown:{roles:["Category"]}},a}();i.BulletChart=n;var s;!function(e){function t(e){var t=r(e);return t.y+t.height}function i(){o||(o=$("<span/>"),$("body").append(o),n=d3.select($("body").get(0)).append("svg").style({height:"0px",width:"0px",position:"absolute"}).append("text"),s=$("<canvas/>").get(0).getContext("2d"))}function a(e){return i(),n.style(null),n.text(e.text).attr({visibility:"hidden","font-family":e.fontFamily,"font-size":e.fontSize,"font-weight":e.fontWeight,"font-style":e.fontStyle,"white-space":e.whiteSpace||"nowrap"}),n.node().getBBox()}function r(e){var t={fontFamily:e.fontFamily,fontSize:e.fontSize,text:"M"},i=a(t);return i}var o,n,s;e.estimateSvgTextBaselineDelta=t}(s=i.TextMeasurementHelper||(i.TextMeasurementHelper={}));var l=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.options=e;var i=e.clearCatcher;e.valueRects.on("click",function(e,i){d3.event.stopPropagation(),t.handleSelection(e,d3.event.ctrlKey)}),e.rects.on("click",function(e,i){d3.event.stopPropagation(),t.handleSelection(e,d3.event.ctrlKey)}),i.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var i=this.options,a=i.hasHighlights;i.valueRects.style("opacity",function(i){
return t.ColumnUtil.getFillOpacity(i.selected,i.highlight,!i.highlight&&e,!i.selected&&a)}),i.rects.style("opacity",function(i){return t.ColumnUtil.getFillOpacity(i.selected,i.highlight,!i.highlight&&e,!i.selected&&a)})},e}();i.BulletWebBehavior=l}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,i=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var a=e.visuals.valueFormatter,r=t.AnimatorCommon.GetAnimationDuration;!function(e){e[e.logn=0]="logn",e[e.sqrt=1]="sqrt",e[e.value=2]="value"}(i.WordCloudScaleType||(i.WordCloudScaleType={}));var o=i.WordCloudScaleType,n=function(){function e(e,t){this.defaultViewport=e||{width:0,height:0},this.defaultMargin=t||{top:0,bottom:0,right:0,left:0}}return Object.defineProperty(e.prototype,"margin",{get:function(){return this.marginValue||(this.margin=this.defaultMargin)},set:function(t){this.marginValue=e.restrictToMinMax(t),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this.viewportValue||(this.viewportValue=this.defaultViewport)},set:function(t){this.viewportValue=e.restrictToMinMax(t),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportInIsZero",{get:function(){return 0===this.viewportIn.width||0===this.viewportIn.height},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.viewportInValue=e.restrictToMinMax({width:this.viewport.width-(this.margin.left+this.margin.right),height:this.viewport.height-(this.margin.top+this.margin.bottom)})},e.restrictToMinMax=function(e){var t=$.extend({},e);return d3.keys(e).forEach(function(i){return t[i]=Math.max(0,e[i])}),t},e}(),s=function(){function i(e){this.durationAnimations=500,this.fakeViewport={width:1500,height:1e3},this.canvasViewport={width:128,height:2048},e&&(this.svg=e.svg||this.svg,this.layout=new n(null,e.margin||i.DefaultMargin),e.animator&&(this.animator=e.animator)),this.isUpdating=!1}return i.prototype.init=function(e){var a=this;this.svg?this.root=this.svg:this.root=d3.select(e.element.get(0)).append("svg"),i.colors=e.style.colorPalette.dataColors,this.hostService=e.host,this.selectionManager=new t.utility.SelectionManager({hostServices:this.hostService}),this.layout||(this.layout=new n(null,i.DefaultMargin)),this.root.classed(i.ClassName,!0),this.root.on("click",function(){a.selectionManager.clear(),a.setSelection(a.wordsSelection)}),this.fontFamily=this.root.style("font-family"),this.main=this.root.append("g"),this.wordsContainerSelection=this.main.append("g").classed(i.Words["class"],!0),this.canvas=document.createElement("canvas")},i.prototype.converter=function(e){var a=this;if(!(e&&e.categorical&&e.categorical.categories&&e.categorical.categories[0]&&e.categorical.categories[0].values&&e.categorical.categories[0].values.length&&e.categorical.categories[0].values.length>0))return null;var r,o,n=e.categorical.categories[0].values,s=i.parseSettings(e,n[0]);return s?(_.isEmpty(e.categorical.values)||_.isEmpty(e.categorical.values[0])||_.isEmpty(e.categorical.values[0].values)||(r=e.categorical.values[0].values),o=n.map(function(o,n){var s,c=e.categorical.categories[0];return s=c.objects&&c.objects[n]?a.getColor(i.Properties.dataPoint.fill,l.util.getRandomColor(),c.objects[n]):a.wordCloudTexts&&a.wordCloudTexts[n]?a.wordCloudTexts[n].color:l.util.getRandomColor(),{text:o,count:r&&r[n]&&!isNaN(r[n])?r[n]:1,index:n,selectionId:t.SelectionId.createWithId(e.categorical.categories[0].identity[n]),color:s}}),{settings:s,texts:o}):null},i.prototype.getColor=function(e,a,r){var o;return o=new t.ColorHelper(i.colors,e,a),l.util.hexToRgb(o.getColorForMeasure(r,""))},i.parseSettings=function(t,r){if(!(t&&t.metadata&&t.metadata.columns&&t.metadata.columns[0]))return null;var o,n,s,l,c,h,u,p,d,m=t.metadata.objects,g=!1,f=!0,y=!0,v=!1;return d=i.getNumberFromObjects(m,i.Properties.general.maxNumberOfWords,i.DefaultSettings.maxNumberOfWords),n=i.getNumberFromObjects(m,i.Properties.general.minFontSize,i.DefaultSettings.minFontSize),s=i.getNumberFromObjects(m,i.Properties.general.maxFontSize,i.DefaultSettings.maxFontSize),l=i.getNumberFromObjects(m,i.Properties.rotateText.minAngle,i.DefaultSettings.minAngle),c=i.getNumberFromObjects(m,i.Properties.rotateText.maxAngle,i.DefaultSettings.maxAngle),g=e.DataViewObjects.getValue(m,i.Properties.rotateText.show,i.DefaultSettings.isRotateText),h=i.getNumberFromObjects(m,i.Properties.rotateText.maxNumberOfOrientations,i.DefaultSettings.maxNumberOfOrientations),o=a.create({format:a.getFormatString(t.categorical.categories[0].source,i.Properties.general.formatString),value:r}),f=e.DataViewObjects.getValue(m,i.Properties.general.isBrokenText,i.DefaultSettings.isBrokenText),y=e.DataViewObjects.getValue(m,i.Properties.stopWords.show,i.DefaultSettings.isRemoveStopWords),u=e.DataViewObjects.getValue(m,i.Properties.stopWords.words,i.DefaultSettings.stopWords),p="string"==typeof u?u.split(i.StopWordsDelemiter):i.DefaultSettings.stopWordsArray,v=e.DataViewObjects.getValue(m,i.Properties.stopWords.isDefaultStopWords,i.DefaultSettings.isDefaultStopWords),{minFontSize:n,maxFontSize:s,minAngle:l,maxAngle:c,maxNumberOfOrientations:h,valueFormatter:o,isRotateText:g,isBrokenText:f,isRemoveStopWords:y,stopWords:u,stopWordsArray:p,isDefaultStopWords:v,maxNumberOfWords:d}},i.getNumberFromObjects=function(t,i,a){return t?e.DataViewObjects.getValue(t,i,a):a},i.prototype.parseNumber=function(e,t,i,a){void 0===t&&(t=0),void 0===i&&(i=-Number.MAX_VALUE),void 0===a&&(a=Number.MAX_VALUE);var r=Number(e);return isNaN(r)||"string"==typeof e&&0===e.length?t:i>r?i:r>a?a:r},i.prototype.computePositions=function(e,t){var a,r=this,o=this.getCanvasContext(),n=[],s=null;if(!(e&&e.length>0))return null;a=Math.abs(this.parseNumber(this.settings.maxNumberOfWords,i.DefaultSettings.maxNumberOfWords,-1*e.length,e.length)),e.length>a&&(e=e.slice(0,a));for(var l=void 0;l<(this.specialViewport.width>>5)*this.specialViewport.height;l++)n[l]=0;setTimeout(function(){return r.computeCycle(e,o,n,s,t,[],0)},0)},i.prototype.computeCycle=function(e,t,i,a,r,o,n){void 0===o&&(o=[]),void 0===n&&(n=0);var s=e[n],l=1;e.length<=10?l=5:e.length<=25?l=3:e.length<=75?l=1.5:e.length<=100&&(l=1.25),s.x=this.specialViewport.width/l*(Math.random()+.5)>>1,s.y=this.specialViewport.height/l*(Math.random()+.5)>>1,this.generateSprites(t,s,e,n),s.sprite&&this.findPosition(i,s,a)&&(o.push(s),a=this.updateBorders(s,a),s.x-=this.specialViewport.width>>1,s.y-=this.specialViewport.height>>1),++n<e.length&&this.root?this.computeCycle(e,t,i,a,r,o,n):r({data:o,leftBorder:a&&a[0],rightBorder:a&&a[1]})},i.prototype.updateBorders=function(e,t){if(t&&2===t.length){var i=t[0],a=t[1];e.x+e.x0<i.x&&(i.x=e.x+e.x0),e.y+e.y0<i.y&&(i.y=e.y+e.y0),e.x+e.x1>a.x&&(a.x=e.x+e.x1),e.y+e.y1>a.y&&(a.y=e.y+e.y1)}else t=[{x:e.x+e.x0,y:e.y+e.y0},{x:e.x+e.x1,y:e.y+e.y1}];return t},i.prototype.generateSprites=function(e,t,a,r){if(!t.sprite){e.clearRect(0,0,this.canvasViewport.width<<5,this.canvasViewport.height);for(var o,n=0,s=0,l=0,c=a.length,h=[],u=r;c>u;u++){var p=a[u],d=0,m=0;if(e.save(),e.font="normal normal "+(p.size+1)+i.Size+" "+this.fontFamily,d=e.measureText(p.text+"m").width,m=p.size<<1,p.rotate){var g=Math.sin(p.rotate*i.Radians),f=Math.cos(p.rotate*i.Radians),y=d*f,v=d*g,x=m*f,E=m*g;d=Math.max(Math.abs(y+E),Math.abs(y-E))+31>>5<<5,m=Math.floor(Math.max(Math.abs(v+x),Math.abs(v-x)))}else d=d+31>>5<<5;m>l&&(l=m),n+d>=this.canvasViewport.width<<5&&(n=0,s+=l,l=0),e.translate(n+(d>>1),s+(m>>1)),p.rotate&&e.rotate(p.rotate*i.Radians),e.fillText(p.text,0,0),p.padding&&(e.lineWidth=2*p.padding,e.strokeText(p.text,0,0)),e.restore(),p.width=d,p.height=m,p.xOff=n,p.yOff=s,p.x1=d>>1,p.y1=m>>1,p.x0=-p.x1,p.y0=-p.y1,n+=d}o=e.getImageData(0,0,this.canvasViewport.width<<5,this.canvasViewport.height).data,h=[];for(var u=c-1;u>=0;u--){var p=a[u],b=p.width,T=b>>5,w=p.y1-p.y0,S=0,R=0,C=0,A=0;if(p.xOff+b>=this.canvasViewport.width<<5||p.yOff+w>=this.canvasViewport.height)p.sprite=null;else{for(var M=0;w*T>M;M++)h[M]=0;if(null===p.xOff)return;S=p.xOff,R=p.yOff,C=0,A=-1;for(var M=0;w>M;M++){for(var H=0;b>H;H++){var P=T*M+(H>>5),D=(R+M)*(this.canvasViewport.width<<5)+(S+H)<<2,_=o[D]?1<<31-H%32:0;h[P]|=_,C|=_}C?A=M:(p.y0++,w--,M--,R++)}p.y1=p.y0+A,p.sprite=h.slice(0,(p.y1-p.y0)*T)}}}},i.prototype.findPosition=function(e,t,i){for(var a,r,o,n={x:t.x,y:t.y},s=Math.sqrt(this.specialViewport.width*this.specialViewport.width+this.specialViewport.height*this.specialViewport.height),l=Math.random()<.5?1:-1,c=-l;;){if(c+=l,a=this.archimedeanSpiral(c),r=Math.floor(a.x),o=Math.floor(a.y),Math.min(Math.abs(r),Math.abs(o))>=s)break;if(t.x=n.x+r,t.y=n.y+o,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>this.specialViewport.width||t.y+t.y1>this.specialViewport.height)&&(!i||!this.checkIntersect(t,e))&&(!i||this.checkIntersectOfRectangles(t,i[0],i[1]))){for(var h=t.sprite,u=t.width>>5,p=this.specialViewport.width>>5,d=t.x-(u<<4),m=127&d,g=32-m,f=t.y1-t.y0,y=(t.y+t.y0)*p+(d>>5),v=0;f>v;v++){for(var x=0,E=0;u>=E;E++){var b=x<<g,T=void 0;u>E&&(x=h[v*u+E]),T=u>E?x>>>m:0,e[y+E]|=b|T}y+=p}return t.sprite=null,!0}}return!1},i.prototype.archimedeanSpiral=function(e){var t=this.specialViewport.width/this.specialViewport.height;return e=.1*e,{x:t*e*Math.cos(e),y:e*Math.sin(e)}},i.prototype.checkIntersect=function(e,t){for(var i=this.specialViewport.width>>5,a=e.sprite,r=e.width>>5,o=e.x-(r<<4),n=127&o,s=32-n,l=e.y1-e.y0,c=(e.y+e.y0)*i+(o>>5),h=0;l>h;h++){for(var u=0,p=0;r>=p;p++){var d=0,m=void 0,g=0;if(m=u<<s,r>p&&(u=a[h*r+p]),d=r>p?u>>>n:0,g=(m|d)&t[c+p])return!0}c+=i}return!1},i.prototype.checkIntersectOfRectangles=function(e,t,i){return e.x+e.x1>t.x&&e.x+e.x0<i.x&&e.y+e.y1>t.y&&e.y+e.y0<i.y},i.prototype.getCanvasContext=function(){if(!this.canvasViewport)return null;this.canvas.width=1,this.canvas.height=1;var e=this.canvas.getContext("2d");return this.canvas.width=this.canvasViewport.width<<5,this.canvas.height=this.canvasViewport.height,e=this.canvas.getContext("2d"),e.fillStyle=e.strokeStyle="red",e.textAlign="center",e},i.prototype.getReducedText=function(e){var t=[];return 1===e.length?this.isSingleSentence=!0:this.isSingleSentence=!1,t=this.getBrokenWords(e),t.reduce(function(e,t){return e.some(function(e){return e.index!==t.index&&e.text===t.text?(e.count+=t.count,!0):!1})||e.push(t),e},[])},i.prototype.getBrokenWords=function(e){var t,a=this,r=[],o=/\s/;return this.settings.isBrokenText?(t=new RegExp("["+i.Punctuation.join("\\")+"]","gim"),e.forEach(function(e){if("string"==typeof e.text){var n;if(n=e.text.replace(t," ").split(o),a.settings.isRemoveStopWords){var s=a.settings.stopWordsArray;a.settings.isDefaultStopWords&&(s=s.concat(i.StopWords)),n=n.filter(function(e){return e.length>0&&!s.some(function(t){return e.toLocaleLowerCase()===t.toLocaleLowerCase()})})}n.forEach(function(t){t.length>0&&!o.test(t)&&r.push({text:t,count:e.count,index:e.index,selectionId:e.selectionId,color:e.color})})}else r.push(e)}),r):e},i.prototype.getWords=function(e){var t,i=this,a=0,r=0,o=this.settings.valueFormatter;if(!(e&&e.length>=1))return[];t=e.sort(function(e,t){return t.count-e.count}),a=t[t.length-1].count,r=t[0].count;var n=e.map(function(e){return{text:o.format(e.text),size:i.getFontSize(e.count,a,r),x:0,y:0,rotate:i.getAngle(),padding:1,width:0,height:0,xOff:0,yOff:0,x0:0,y0:0,x1:0,y1:0,color:e.color,selectionId:e.selectionId,wordIndex:e.index}});return this.dataBeforeRender=n,n},i.prototype.getFontSize=function(e,t,a,r){void 0===r&&(r=o.value);var n,s,l,c;if(c=Math.abs(this.parseNumber(this.settings.minFontSize,i.DefaultSettings.minFontSize)),l=Math.abs(this.parseNumber(this.settings.maxFontSize,i.DefaultSettings.maxFontSize)),l>this.layout.viewportIn.width/2&&(l=this.layout.viewportIn.width/2),this.isSingleSentence)return l;if(c>l){var h=c;c=l,l=h}switch(r){case o.logn:n=Math.log(e);case o.sqrt:n=Math.sqrt(e);case o.value:n=e}return s=n>t&&a-t!==0?l*(n-t)/(a-t):0,s=100*s/l,s=s*(l-c)/100+c},i.prototype.getAngle=function(){if(!this.settings||!this.settings.isRotateText)return 0;var e,t,a,r;if(a=Math.abs(this.parseNumber(this.settings.maxNumberOfOrientations,0)),e=this.parseNumber(this.settings.minAngle,0,i.MinAngle,i.MaxAngle),t=this.parseNumber(this.settings.maxAngle,0,i.MinAngle,i.MaxAngle),e>t){var o=e;e=t,t=o}return r=Math.abs((t-e)/a*Math.floor(Math.random()*a)),0!==a?e+r:0},i.prototype.update=function(e){var t=this;if(e&&e.viewport&&e.dataViews&&e.dataViews[0]&&e.viewport&&e.viewport.height>=0&&e.viewport.width>=0&&(e!==this.visualUpdateOptions&&(this.incomingUpdateOptions=e),!this.isUpdating&&this.incomingUpdateOptions!==this.visualUpdateOptions)){this.visualUpdateOptions=this.incomingUpdateOptions,this.layout.viewport=this.visualUpdateOptions.viewport;var i=e.dataViews[0];if(this.layout.viewportInIsZero)return;if(this.durationAnimations=r(this.animator,e.suppressAnimations),this.UpdateSize(),this.data=this.converter(i),!this.data)return;this.settings=this.data.settings,this.wordCloudTexts=this.data.texts,this.computePositions(this.getWords(this.getReducedText(this.data.texts)),function(e){return t.render(e)})}},i.prototype.UpdateSize=function(){var e,t,i;i=Math.sqrt(this.fakeViewport.width*this.fakeViewport.height/(this.layout.viewportIn.width*this.layout.viewportIn.height)),isNaN(i)?t=e=1:(t=this.layout.viewportIn.height*i,e=this.layout.viewportIn.width*i),this.specialViewport={height:t,width:e},this.root.attr({height:this.layout.viewport.height,width:this.layout.viewport.width})},i.prototype.render=function(e){var a=this;if(e&&e.data){this.wordCloudDataView=e;var r,o=this.main.select(i.Words.selector).selectAll(i.Word.selector);this.wordsSelection=o.data(e.data),this.animation(this.wordsSelection,this.durationAnimations).attr("transform",function(e){return t.SVGUtil.translate(e.x,e.y)+" rotate("+e.rotate+")"}).style({"font-size":function(e){return""+e.size+i.Size},fill:function(e){return e.color}}),r=this.wordsSelection.enter().append("svg:text").attr("transform",function(e){return t.SVGUtil.translate(e.x,e.y)+" rotate("+e.rotate+")"}).style("font-size","1px"),this.wordsSelection.on("click",function(e){a.selectionManager.select(e.selectionId,d3.event.ctrlKey).then(function(){return a.setSelection(a.wordsSelection)}),d3.event.stopPropagation()}),this.animation(r,this.durationAnimations).style({"font-size":function(e){return""+e.size+i.Size},fill:function(e){return e.color}}),this.wordsSelection.text(function(e){return e.text}).classed(i.Word["class"],!0),this.wordsSelection.exit().remove(),this.setSelection(this.wordsSelection),setTimeout(function(){a.root&&a.scaleMainView(e,o[0].length&&a.durationAnimations),a.isUpdating=!1,a.incomingUpdateOptions!==a.visualUpdateOptions&&a.update(a.incomingUpdateOptions)},this.durationAnimations+i.RenderDelay)}},i.prototype.setSelection=function(e){var t=this.selectionManager.getSelectionIds();if(t.some(function(t){return!e.data().some(function(e){return e.selectionId.getKey()===t.getKey()})})&&(this.selectionManager.clear(),t=[]),!t.length)return void this.setOpacity(e,i.MaxOpacity,!0);var a=e.filter(function(e){return t.some(function(t){return t.getKey()===e.selectionId.getKey()})});this.setOpacity(e,i.MinOpacity),this.setOpacity(a,i.MaxOpacity)},i.prototype.setOpacity=function(e,t,a){void 0===a&&(a=!1);var r=a?e:this.animation(e);r.style("fill-opacity",t),this.main&&(this.main.style("line-height","14px"),this.animation(this.main,0,this.durationAnimations+i.MinDelay).style("line-height","15px"))},i.prototype.scaleMainView=function(e,i){if(void 0===i&&(i=0),e&&e.leftBorder&&e.rightBorder){var a,r,o,n,s=1,l=this.main.node().getBBox(),c=e.leftBorder,h=e.rightBorder;o=this.layout.viewportIn.width/Math.abs(c.x-h.x),n=this.layout.viewportIn.height/Math.abs(c.y-h.y),s=Math.min(o,n),a=this.layout.margin.left+l.x*s*-1+(this.layout.viewportIn.width-l.width*s)/2,r=this.layout.margin.top+l.y*s*-1+(this.layout.viewportIn.height-l.height*s)/2,this.main.style("line-height","5px"),this.animation(this.main,i).attr("transform",t.SVGUtil.translate(a,r)+" scale("+s+")").style("line-height","10px")}},i.prototype.enumerateObjectInstances=function(e){var a=this,r=[];if(!this.settings)return r;switch(e.objectName){case"general":var o={objectName:"general",displayName:"general",selector:null,properties:{maxNumberOfWords:this.settings.maxNumberOfWords,minFontSize:this.settings.minFontSize,maxFontSize:this.settings.maxFontSize,isBrokenText:this.settings.isBrokenText}};r.push(o);break;case"dataPoint":if(!this.wordCloudDataView||!this.wordCloudDataView.data)return;var n=this.dataBeforeRender,s=[];n.forEach(function(e){-1===s.indexOf(e.wordIndex)&&(s.push(e.wordIndex),r.push({objectName:"dataPoint",displayName:a.data.texts[e.wordIndex].text,selector:t.ColorHelper.normalizeSelector(e.selectionId.getSelector(),!1),properties:{fill:{solid:{color:e.color}}}}))});break;case"rotateText":var l={objectName:"rotateText",displayName:"Rotate Text",selector:null,properties:{show:this.settings.isRotateText,minAngle:this.settings.minAngle,maxAngle:this.settings.maxAngle,maxNumberOfOrientations:this.settings.maxNumberOfOrientations}};r.push(l);break;case"stopWords":var c={objectName:"stopWords",displayName:"Stop Words",selector:null,properties:{show:this.settings.isRemoveStopWords,isDefaultStopWords:this.settings.isDefaultStopWords,words:this.settings.stopWords||this.settings.stopWordsArray.join(i.StopWordsDelemiter)}};r.push(c)}return r},i.prototype.animation=function(e,t,i,a){return void 0===t&&(t=0),void 0===i&&(i=0),e.transition().delay(i).duration(t).each("end",a)},i.prototype.destroy=function(){this.root=null,this.canvas=null},i.ClassName="wordCloud",i.Properties={general:{formatString:{objectName:"general",propertyName:"formatString"},maxNumberOfWords:{objectName:"general",propertyName:"maxNumberOfWords"},minFontSize:{objectName:"general",propertyName:"minFontSize"},maxFontSize:{objectName:"general",propertyName:"maxFontSize"},isBrokenText:{objectName:"general",propertyName:"isBrokenText"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},stopWords:{show:{objectName:"stopWords",propertyName:"show"},isDefaultStopWords:{objectName:"stopWords",propertyName:"isDefaultStopWords"},words:{objectName:"stopWords",propertyName:"words"}},rotateText:{show:{objectName:"rotateText",propertyName:"show"},minAngle:{objectName:"rotateText",propertyName:"minAngle"},maxAngle:{objectName:"rotateText",propertyName:"maxAngle"},maxNumberOfOrientations:{objectName:"rotateText",propertyName:"maxNumberOfOrientations"}}},i.Words={"class":"words",selector:".words"},i.Word={"class":"word",selector:".word"},i.Size="px",i.StopWordsDelemiter=" ",i.Radians=Math.PI/180,i.MinAngle=-180,i.MaxAngle=180,i.MaxNumberOfWords=2500,i.MinOpacity=.2,i.MaxOpacity=1,i.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Category:{min:1,max:1},Values:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{count:i.MaxNumberOfWords}}},values:{"for":{"in":"Values"}}}}],sorting:{implicit:{clauses:[{role:"Values",direction:2}]}},objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},maxNumberOfWords:{displayName:"Max number of words",type:{numeric:!0}},minFontSize:{displayName:"Min Font",type:{numeric:!0}},maxFontSize:{displayName:"Max Font",type:{numeric:!0}},isBrokenText:{displayName:"Word-breaking",type:{bool:!0}},isRemoveStopWords:{displayName:"Stop Words",type:{bool:!0}}}},dataPoint:{displayName:"Data colors",properties:{fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}}}},stopWords:{displayName:"Stop Words",properties:{show:{displayName:"Show",type:{bool:!0}},isDefaultStopWords:{displayName:"Default Stop Words",type:{bool:!0}},words:{displayName:"Words",type:{text:!0}}}},rotateText:{displayName:"Rotate Text",properties:{show:{displayName:"Show",type:{bool:!0}},minAngle:{displayName:"Min Angle",type:{numeric:!0}},maxAngle:{displayName:"Max Angle",type:{numeric:!0}},maxNumberOfOrientations:{displayName:"Max number of orientations",type:{numeric:!0}}}}}},i.Punctuation=["!",".",":","'",";",",","!","@","#","$","%","^","&","*","(",")","[","]",'"',"\\","/","-","_","+","="],i.StopWords=["a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"],i.DefaultSettings={minFontSize:20,maxFontSize:100,minAngle:-60,maxAngle:90,maxNumberOfOrientations:2,isRotateText:!1,isBrokenText:!0,isRemoveStopWords:!1,stopWordsArray:[],stopWords:void 0,isDefaultStopWords:!1,maxNumberOfWords:200},i.RenderDelay=50,i.MinDelay=10,i.DefaultMargin={top:10,right:10,bottom:10,left:10},i}();i.WordCloud=s;var l;!function(e){var t;!function(e){function t(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,i,a){return t+t+i+i+a+a});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?"rgb("+parseInt(i[1],16)+","+parseInt(i[2],16)+","+parseInt(i[3],16)+")":null}function i(){var e=Math.floor(255*Math.random()),t=Math.floor(255*Math.random()),i=Math.floor(255*Math.random());return"rgb("+e+","+t+","+i+")"}e.hexToRgb=t,e.getRandomColor=i}(t=e.util||(e.util={}))}(l||(l={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r,o=a.CssConstants.createClassAndSelector,n=a.PixelConverter,s=e.data.SQExprConverter,l=e.visuals.SelectionIdBuilder;!function(e){function t(e){return new c(e)}e.createTableView=t}(r=i.TableViewFactory||(i.TableViewFactory={}));var c=function(){function e(t){this.options=$.extend(!0,{},t),this.options.baseContainer.style("overflow-y","auto").attr("drag-resize-disabled",!0),this.scrollContainer=t.baseContainer.append("div").attr("class","scrollRegion"),this.visibleGroupContainer=this.scrollContainer.append("div").attr("class","visibleGroup"),e.SetDefaultOptions(t)}return e.SetDefaultOptions=function(t){t.rowHeight=t.rowHeight||e.defaultRowHeight},e.prototype.rowHeight=function(e){return this.options.rowHeight=Math.ceil(e),this},e.prototype.columnWidth=function(e){return this.options.columnWidth=Math.ceil(e),this},e.prototype.orientation=function(e){return this.options.orientation=e,this},e.prototype.rows=function(e){return this.options.rows=Math.ceil(e),this},e.prototype.columns=function(e){return this.options.columns=Math.ceil(e),this},e.prototype.data=function(e,t,i){return void 0===i&&(i=!1),this._data=e,this.getDatumIndex=t,this.setTotalRows(),i&&$(this.options.baseContainer.node()).scrollTop(0),this},e.prototype.viewport=function(e){return this.options.viewport=e,this},e.prototype.empty=function(){this._data=[],this.render()},e.prototype.setTotalRows=function(){var t=this._data.length,i=Math.min(this.options.rows,t),a=Math.min(this.options.columns,t);a>0&&i>0?(this._totalColumns=a,this._totalRows=i):i>0?(this._totalRows=i,this._totalColumns=Math.ceil(t/i)):a>0?(this._totalColumns=a,this._totalRows=Math.ceil(t/a)):(this._totalColumns=e.defaultColumns,this._totalRows=Math.ceil(t/e.defaultColumns))},e.prototype.render=function(){var t=this.options,i=this.visibleGroupContainer,a=t.rowHeight||e.defaultRowHeight,r=[],o=t.rows,n=t.columns,s=this._data.length,o=t.rows>s?s:t.rows,n=t.columns>s?s:t.columns;if(0===n&&0===o?t.orientation===p.HORIZONTAL?(n=s,o=1):(n=1,o=s):0===n&&o>0?n=Math.ceil(s/o):n>0&&0===o&&(o=Math.ceil(s/n)),this.options.orientation===p.VERTICAL){var l=o;o=n,n=l}else this.options.orientation===p.HORIZONTAL&&(0===o&&(o=this._totalRows),0===n&&(n=this._totalColumns));for(var c=0,h=0,u=0;o>u;u++)if(this.options.orientation===p.VERTICAL&&0===t.rows&&s%t.columns>0&&t.columns<=s)s%t.columns>u?(c=u*Math.ceil(s/t.columns),h=c+Math.ceil(s/t.columns),r.push(this._data.slice(c,h))):(r.push(this._data.slice(h,h+Math.floor(s/t.columns))),h+=Math.floor(s/t.columns));else if(this.options.orientation===p.HORIZONTAL&&0===t.columns&&s%t.rows>0&&t.rows<=s)s%t.rows>u?(c=u*Math.ceil(s/t.rows),h=c+Math.ceil(s/t.rows),r.push(this._data.slice(c,h))):(r.push(this._data.slice(h,h+Math.floor(s/t.rows))),h+=Math.floor(s/t.rows));else{var h=u*n;r.push(this._data.slice(h,h+n))}i.selectAll(".row").remove();var d=i.selectAll(".row").data(r).enter().append("div").classed("row",!0).selectAll(".cell").data(function(e){return e});d.enter().append("div").classed("cell",!0).call(function(e){return t.enter(e)}),d.order();var m=i.selectAll(".cell:not(.transitioning)");if(m.call(function(e){return t.update(e)}),m.style({height:a>0?a+"px":"auto"}),this.options.orientation===p.VERTICAL){for(var g=0,u=0;u<r.length;u++)0!==r[u].length&&(g=u+1);m.style({width:"100%"});var f=i.selectAll("div.row");f.style({width:t.columnWidth>0?t.columnWidth+"px":100/g+"%"})}else m.style({width:t.columnWidth>0?t.columnWidth+"px":100/n+"%"});d.exit().call(function(e){return t.exit(e)}).remove()},e.defaultRowHeight=0,e.defaultColumns=1,e}();i.chicletSlicerProps={general:{orientation:{objectName:"general",propertyName:"orientation"},columns:{objectName:"general",propertyName:"columns"},rows:{objectName:"general",propertyName:"rows"},showDisabled:{objectName:"general",propertyName:"showDisabled"},multiselect:{objectName:"general",propertyName:"multiselect"},selection:{objectName:"general",propertyName:"selection"},selfFilterEnabled:{objectName:"general",propertyName:"selfFilterEnabled"}},header:{show:{objectName:"header",propertyName:"show"},title:{objectName:"header",propertyName:"title"},fontColor:{objectName:"header",propertyName:"fontColor"},background:{objectName:"header",propertyName:"background"},outline:{objectName:"header",propertyName:"outline"},textSize:{objectName:"header",propertyName:"textSize"},outlineColor:{objectName:"header",propertyName:"outlineColor"},outlineWeight:{objectName:"header",propertyName:"outlineWeight"}},rows:{fontColor:{objectName:"rows",propertyName:"fontColor"},textSize:{objectName:"rows",propertyName:"textSize"},height:{objectName:"rows",propertyName:"height"},width:{objectName:"rows",propertyName:"width"},background:{objectName:"rows",propertyName:"background"},transparency:{objectName:"rows",propertyName:"transparency"},selectedColor:{objectName:"rows",propertyName:"selectedColor"},hoverColor:{objectName:"rows",propertyName:"hoverColor"},unselectedColor:{objectName:"rows",propertyName:"unselectedColor"},disabledColor:{objectName:"rows",propertyName:"disabledColor"},outline:{objectName:"rows",propertyName:"outline"},outlineColor:{objectName:"rows",propertyName:"outlineColor"},outlineWeight:{objectName:"rows",propertyName:"outlineWeight"},borderStyle:{objectName:"rows",propertyName:"borderStyle"}},images:{imageSplit:{objectName:"images",propertyName:"imageSplit"},stretchImage:{objectName:"images",propertyName:"stretchImage"},bottomImage:{objectName:"images",propertyName:"bottomImage"}},selectedPropertyIdentifier:{objectName:"general",propertyName:"selected"},filterPropertyIdentifier:{objectName:"general",propertyName:"filter"},formatString:{objectName:"general",propertyName:"formatString"},hasSavedSelection:!0};var h;!function(t){t.ROUNDED="Rounded",t.CUT="Cut",t.SQUARE="Square",t.type=e.createEnumType([{value:t.ROUNDED,displayName:t.ROUNDED},{value:t.CUT,displayName:t.CUT},{value:t.SQUARE,displayName:t.SQUARE}])}(h||(h={}));var u;!function(t){t.INPLACE="Inplace",t.BOTTOM="Bottom",t.HIDE="Hide",t.type=e.createEnumType([{value:t.INPLACE,displayName:t.INPLACE},{value:t.BOTTOM,displayName:t.BOTTOM},{value:t.HIDE,displayName:t.HIDE}])}(u||(u={}));var p;!function(t){t.HORIZONTAL="Horizontal",t.VERTICAL="Vertical",t.type=e.createEnumType([{value:t.HORIZONTAL,displayName:t.HORIZONTAL},{value:t.VERTICAL,displayName:t.VERTICAL}])}(p||(p={}));var d=function(){function a(e){e&&e.behavior&&(this.behavior=e.behavior),this.behavior||(this.behavior=new f)}return a.DefaultStyleProperties=function(){return{general:{orientation:p.VERTICAL,columns:3,rows:0,multiselect:!0,showDisabled:u.INPLACE,selection:null,selfFilterEnabled:!1},margin:{top:50,bottom:50,right:50,left:50},header:{borderBottomWidth:1,show:!0,outline:"BottomOnly",fontColor:"#a6a6a6",background:null,textSize:10,outlineColor:"#a6a6a6",outlineWeight:1,title:""},headerText:{marginLeft:8,marginTop:0},slicerText:{textSize:10,height:0,width:0,fontColor:"#666666",hoverColor:"#212121",selectedColor:"#BDD7EE",unselectedColor:"#ffffff",disabledColor:"grey",marginLeft:8,outline:"Frame",background:null,transparency:0,outlineColor:"#000000",outlineWeight:1,borderStyle:"Cut"},slicerItemContainer:{marginTop:5,marginLeft:0},images:{imageSplit:50,stretchImage:!1,bottomImage:!1}}},a.converter=function(a,r,o,n){if(a&&a.categorical&&a.categorical.categories&&a.categorical.categories[0]&&a.categorical.categories[0].values&&a.categorical.categories[0].values.length>0){var s=new m.ChicletSlicerConverter(a,n);s.convert();var l,c=this.DefaultStyleProperties(),h=a.metadata.objects;h&&(c.general.orientation=e.DataViewObjects.getValue(h,i.chicletSlicerProps.general.orientation,c.general.orientation),c.general.columns=e.DataViewObjects.getValue(h,i.chicletSlicerProps.general.columns,c.general.columns),c.general.rows=e.DataViewObjects.getValue(h,i.chicletSlicerProps.general.rows,c.general.rows),c.general.multiselect=e.DataViewObjects.getValue(h,i.chicletSlicerProps.general.multiselect,c.general.multiselect),c.general.showDisabled=e.DataViewObjects.getValue(h,i.chicletSlicerProps.general.showDisabled,c.general.showDisabled),c.general.selection=e.DataViewObjects.getValue(a.metadata.objects,i.chicletSlicerProps.general.selection,c.general.selection),c.general.selfFilterEnabled=e.DataViewObjects.getValue(h,i.chicletSlicerProps.general.selfFilterEnabled,c.general.selfFilterEnabled),c.header.show=e.DataViewObjects.getValue(h,i.chicletSlicerProps.header.show,c.header.show),c.header.title=e.DataViewObjects.getValue(h,i.chicletSlicerProps.header.title,c.header.title),c.header.fontColor=e.DataViewObjects.getFillColor(h,i.chicletSlicerProps.header.fontColor,c.header.fontColor),c.header.background=e.DataViewObjects.getFillColor(h,i.chicletSlicerProps.header.background,c.header.background),c.header.textSize=e.DataViewObjects.getValue(h,i.chicletSlicerProps.header.textSize,c.header.textSize),c.header.outline=e.DataViewObjects.getValue(h,i.chicletSlicerProps.header.outline,c.header.outline),c.header.outlineColor=e.DataViewObjects.getFillColor(h,i.chicletSlicerProps.header.outlineColor,c.header.outlineColor),c.header.outlineWeight=e.DataViewObjects.getValue(h,i.chicletSlicerProps.header.outlineWeight,c.header.outlineWeight),c.slicerText.textSize=e.DataViewObjects.getValue(h,i.chicletSlicerProps.rows.textSize,c.slicerText.textSize),c.slicerText.height=e.DataViewObjects.getValue(h,i.chicletSlicerProps.rows.height,c.slicerText.height),c.slicerText.width=e.DataViewObjects.getValue(h,i.chicletSlicerProps.rows.width,c.slicerText.width),c.slicerText.selectedColor=e.DataViewObjects.getFillColor(h,i.chicletSlicerProps.rows.selectedColor,c.slicerText.selectedColor),
c.slicerText.hoverColor=e.DataViewObjects.getFillColor(h,i.chicletSlicerProps.rows.hoverColor,c.slicerText.hoverColor),c.slicerText.unselectedColor=e.DataViewObjects.getFillColor(h,i.chicletSlicerProps.rows.unselectedColor,c.slicerText.unselectedColor),c.slicerText.disabledColor=e.DataViewObjects.getFillColor(h,i.chicletSlicerProps.rows.disabledColor,c.slicerText.disabledColor),c.slicerText.background=e.DataViewObjects.getFillColor(h,i.chicletSlicerProps.rows.background,c.slicerText.background),c.slicerText.transparency=e.DataViewObjects.getValue(h,i.chicletSlicerProps.rows.transparency,c.slicerText.transparency),c.slicerText.fontColor=e.DataViewObjects.getFillColor(h,i.chicletSlicerProps.rows.fontColor,c.slicerText.fontColor),c.slicerText.outline=e.DataViewObjects.getValue(h,i.chicletSlicerProps.rows.outline,c.slicerText.outline),c.slicerText.outlineColor=e.DataViewObjects.getFillColor(h,i.chicletSlicerProps.rows.outlineColor,c.slicerText.outlineColor),c.slicerText.outlineWeight=e.DataViewObjects.getValue(h,i.chicletSlicerProps.rows.outlineWeight,c.slicerText.outlineWeight),c.slicerText.borderStyle=e.DataViewObjects.getValue(h,i.chicletSlicerProps.rows.borderStyle,c.slicerText.borderStyle),c.images.imageSplit=e.DataViewObjects.getValue(h,i.chicletSlicerProps.images.imageSplit,c.images.imageSplit),c.images.stretchImage=e.DataViewObjects.getValue(h,i.chicletSlicerProps.images.stretchImage,c.images.stretchImage),c.images.bottomImage=e.DataViewObjects.getValue(h,i.chicletSlicerProps.images.bottomImage,c.images.bottomImage)),c.general.selfFilterEnabled&&o&&(o=o.toLowerCase(),s.dataPoints.forEach(function(e){return e.filtered=e.category.toLowerCase().indexOf(o)<0}));var u=a.categorical.categories[0];return l={categorySourceName:u.source.displayName,formatString:t.valueFormatter.getFormatString(u.source,i.chicletSlicerProps.formatString),slicerSettings:c,slicerDataPoints:s.dataPoints},l.hasSelectionOverride=s.hasSelectionOverride,l}},a.prototype.init=function(e){this.element=e.element,this.currentViewport=e.viewport,this.behavior&&(this.interactivityService=t.createInteractivityService(e.host)),this.hostServices=e.host,this.hostServices.canSelect=a.canSelect,this.settings=a.DefaultStyleProperties(),this.initContainer()},a.canSelect=function(e){var t=e.data;return!(t&&t.length>1&&t.some(function(e){return e&&e.data&&e.data.length>1}))},a.prototype.update=function(t){if(t&&t.dataViews&&t.dataViews[0]&&t.viewport){var i=this.dataView;this.dataView=t.dataViews[0];var a=!0;i&&(a=!e.DataViewAnalysis.hasSameCategoryIdentity(i,this.dataView)),t.viewport.height===this.currentViewport.height&&t.viewport.width===this.currentViewport.width?this.waitingForData=!1:this.currentViewport=t.viewport,this.updateInternal(a)}},a.prototype.onResizing=function(e){this.currentViewport=e,this.updateInternal(!1)},a.prototype.enumerateObjectInstances=function(e){var t=this.slicerData;if(t){var i=e.objectName;switch(i){case"rows":return this.enumerateRows(t);case"header":return this.enumerateHeader(t);case"general":return this.enumerateGeneral(t);case"images":return this.enumerateImages(t)}}},a.prototype.enumerateHeader=function(e){var t=this.settings;return[{selector:null,objectName:"header",properties:{show:t.header.show,title:t.header.title,fontColor:t.header.fontColor,background:t.header.background,textSize:t.header.textSize,outline:t.header.outline,outlineColor:t.header.outlineColor,outlineWeight:t.header.outlineWeight}}]},a.prototype.enumerateRows=function(e){var t=this.settings;return[{selector:null,objectName:"rows",properties:{textSize:t.slicerText.textSize,height:t.slicerText.height,width:t.slicerText.width,background:t.slicerText.background,transparency:t.slicerText.transparency,selectedColor:t.slicerText.selectedColor,hoverColor:t.slicerText.hoverColor,unselectedColor:t.slicerText.unselectedColor,disabledColor:t.slicerText.disabledColor,outline:t.slicerText.outline,outlineColor:t.slicerText.outlineColor,outlineWeight:t.slicerText.outlineWeight,fontColor:t.slicerText.fontColor,borderStyle:t.slicerText.borderStyle}}]},a.prototype.enumerateGeneral=function(e){var t=this.settings;return[{selector:null,objectName:"general",properties:{orientation:t.general.orientation,columns:t.general.columns,rows:t.general.rows,showDisabled:t.general.showDisabled,multiselect:t.general.multiselect,selfFilterEnabled:t.general.selfFilterEnabled}}]},a.prototype.enumerateImages=function(e){var t=this.settings;return[{selector:null,objectName:"images",properties:{imageSplit:t.images.imageSplit,stretchImage:t.images.stretchImage,bottomImage:t.images.bottomImage}}]},a.prototype.updateInternal=function(t){var i=this;this.updateSlicerBodyDimensions();var r="Select All",o=a.converter(this.dataView,r,this.searchInput.val(),this.interactivityService);if(!o)return void this.tableView.empty();this.interactivityService&&this.interactivityService.applySelectionStateToData(o.slicerDataPoints),o.slicerSettings.header.outlineWeight=o.slicerSettings.header.outlineWeight<0?0:o.slicerSettings.header.outlineWeight,o.slicerSettings.slicerText.outlineWeight=o.slicerSettings.slicerText.outlineWeight<0?0:o.slicerSettings.slicerText.outlineWeight,o.slicerSettings.slicerText.height=o.slicerSettings.slicerText.height<0?0:o.slicerSettings.slicerText.height,o.slicerSettings.slicerText.width=o.slicerSettings.slicerText.width<0?0:o.slicerSettings.slicerText.width,o.slicerSettings.images.imageSplit=o.slicerSettings.images.imageSplit<0?0:o.slicerSettings.images.imageSplit,o.slicerSettings.general.columns=o.slicerSettings.general.columns<0?0:o.slicerSettings.general.columns,o.slicerSettings.general.rows=o.slicerSettings.general.rows<0?0:o.slicerSettings.general.rows,o.slicerSettings.general.getSavedSelection=function(){try{return JSON.parse(i.slicerData.slicerSettings.general.selection)||[]}catch(e){return[]}},o.slicerSettings.general.setSavedSelection=function(e,t){i.isSelectionSaved=!0,i.hostServices.persistProperties({merge:[{objectName:"general",selector:null,properties:{filter:e,selection:t&&JSON.stringify(t)||""}}]})},this.slicerData?this.isSelectionSaved?this.isSelectionLoaded=!0:this.isSelectionLoaded=this.slicerData.slicerSettings.general.selection===o.slicerSettings.general.selection:this.isSelectionLoaded=!1,this.slicerData=o,this.settings=this.slicerData.slicerSettings,this.settings.general.showDisabled===u.BOTTOM?o.slicerDataPoints.sort(function(e,t){return e.selectable===t.selectable?0:e.selectable&&!t.selectable?-1:1}):this.settings.general.showDisabled===u.HIDE&&(o.slicerDataPoints=o.slicerDataPoints.filter(function(e){return e.selectable}));var n=this.settings.slicerText.height;if(0===n){var s=a.cellTotalInnerPaddings+a.cellTotalInnerBorders,l=a.getChicletTextProperties(this.settings.slicerText.textSize);n=e.TextMeasurementService.estimateSvgTextHeight(l)+e.TextMeasurementService.estimateSvgTextBaselineDelta(l)+s;var c=_.any(o.slicerDataPoints,function(e){return""!==e.imageURL&&"undefined"!=typeof e.imageURL});c&&(n+=100)}this.tableView.rowHeight(n).columnWidth(this.settings.slicerText.width).orientation(this.settings.general.orientation).rows(this.settings.general.rows).columns(this.settings.general.columns).data(o.slicerDataPoints.filter(function(e){return!e.filtered}),function(e){return $.inArray(e,o.slicerDataPoints)},t).viewport(this.getSlicerBodyViewport(this.currentViewport)).render(),this.updateSearchHeader()},a.prototype.initContainer=function(){var i=this,o=this.settings,s=this.getSlicerBodyViewport(this.currentViewport),l=d3.select(this.element.get(0)).append("div").classed(a.Container["class"],!0);this.slicerHeader=l.append("div").classed(a.Header["class"],!0),this.slicerHeader.append("span").classed(a.Clear["class"],!0).attr("title","Clear"),this.slicerHeader.append("div").classed(a.HeaderText["class"],!0).style({"margin-left":n.toString(o.headerText.marginLeft),"margin-top":n.toString(o.headerText.marginTop),"border-style":this.getBorderStyle(o.header.outline),"border-color":o.header.outlineColor,"border-width":this.getBorderWidth(o.header.outline,o.header.outlineWeight),"font-size":n.fromPoint(o.header.textSize)}),this.createSearchHeader($(l.node())),this.slicerBody=l.append("div").classed(a.Body["class"],!0).classed("slicerBody-horizontal",o.general.orientation===p.HORIZONTAL).classed("slicerBody-vertical",o.general.orientation===p.VERTICAL).style({height:n.toString(s.height),width:"100%"});var c=function(e){var t=i.settings,r=e.append("li").classed(a.ItemContainer["class"],!0).style({"margin-left":n.toString(t.slicerItemContainer.marginLeft)});r.append("div").classed("slicer-img-wrapper",!0),r.append("div").classed("slicer-text-wrapper",!0).append("span").classed(a.LabelText["class"],!0).style({"font-size":n.fromPoint(t.slicerText.textSize)})},h=function(r){var o=i.settings,s=i.slicerData;if(s&&o){i.slicerHeader.classed("hidden",!o.header.show),i.slicerHeader.select(a.HeaderText.selector).text(""!==o.header.title.trim()?o.header.title.trim():i.slicerData.categorySourceName).style({"border-style":i.getBorderStyle(o.header.outline),"border-color":o.header.outlineColor,"border-width":i.getBorderWidth(o.header.outline,o.header.outlineWeight),color:o.header.fontColor,"background-color":o.header.background,"font-size":n.fromPoint(o.header.textSize)}),i.slicerBody.classed("slicerBody-horizontal",o.general.orientation===p.HORIZONTAL).classed("slicerBody-vertical",o.general.orientation===p.VERTICAL);var l=r.selectAll(a.LabelText.selector),c=a.getChicletTextProperties(o.slicerText.textSize),h=s.formatString;l.text(function(r){var n=t.valueFormatter.format(r.category,h);return c.text=n,0===i.settings.slicerText.width?e.TextMeasurementService.getTailoredTextOrDefault(c,i.currentViewport.width/i.settings.general.columns-a.chicletTotalInnerRightLeftPaddings-a.cellTotalInnerBorders-o.slicerText.outlineWeight):e.TextMeasurementService.getTailoredTextOrDefault(c,i.settings.slicerText.width-a.chicletTotalInnerRightLeftPaddings-a.cellTotalInnerBorders-o.slicerText.outlineWeight)});var u=r.selectAll(".slicer-img-wrapper");if(u.style("height",o.images.imageSplit+"%").classed("hidden",function(e){return e.imageURL?o.images.imageSplit<10?!0:void 0:!0}).style("display",function(e){return e.imageURL?"flex":"none"}).classed("stretchImage",o.images.stretchImage).classed("bottomImage",o.images.bottomImage).style("background-image",function(e){return e.imageURL?"url("+e.imageURL+")":""}),r.selectAll(".slicer-text-wrapper").style("height",function(e){return e.imageURL?100-o.images.imageSplit+"%":"100%"}).classed("hidden",function(e){return o.images.imageSplit>90?!0:void 0}),r.selectAll(".slicerItemContainer").style({color:o.slicerText.fontColor,"border-style":i.getBorderStyle(o.slicerText.outline),"border-color":o.slicerText.outlineColor,"border-width":i.getBorderWidth(o.slicerText.outline,o.slicerText.outlineWeight),"font-size":n.fromPoint(o.slicerText.textSize),"border-radius":i.getBorderRadius(o.slicerText.borderStyle)}),o.slicerText.background?i.slicerBody.style("background-color",y.util.hexToRGBString(o.slicerText.background,(100-o.slicerText.transparency)/100)):i.slicerBody.style("background-color",null),i.interactivityService&&i.slicerBody){i.interactivityService.applySelectionStateToData(s.slicerDataPoints);var d=i.slicerBody.attr("width",i.currentViewport.width),m=d.selectAll(a.ItemContainer.selector),g=d.selectAll(a.LabelText.selector),f=d.selectAll(a.Input.selector),v=i.slicerHeader.select(a.Clear.selector),x={dataPoints:s.slicerDataPoints,slicerItemContainers:m,slicerItemLabels:g,slicerItemInputs:f,slicerClear:v,interactivityService:i.interactivityService,slicerSettings:s.slicerSettings,isSelectionLoaded:i.isSelectionLoaded};i.interactivityService.bind(s.slicerDataPoints,i.behavior,x,{overrideSelectionFromData:!0,hasSelectionOverride:s.hasSelectionOverride}),i.behavior.styleSlicerInputs(r.select(a.ItemContainer.selector),i.interactivityService.hasSelection())}else i.behavior.styleSlicerInputs(r.select(a.ItemContainer.selector),!1)}},u=function(e){e.remove()},d={rowHeight:this.getRowHeight(),columnWidth:this.settings.slicerText.width,orientation:this.settings.general.orientation,rows:this.settings.general.rows,columns:this.settings.general.columns,enter:c,exit:u,update:h,loadMoreData:function(){return i.onLoadMoreData()},scrollEnabled:!0,viewport:this.getSlicerBodyViewport(this.currentViewport),baseContainer:this.slicerBody};this.tableView=r.createTableView(d)},a.prototype.createSearchHeader=function(e){var t=this;this.searchHeader=$("<div>").appendTo(e).addClass("searchHeader").addClass("collapsed"),$("<div>").appendTo(this.searchHeader).attr("title","Search").addClass("search");var i=0;this.searchInput=$("<input>").appendTo(this.searchHeader).attr("type","text").attr("drag-resize-disabled","true").addClass("searchInput").on("input",function(){return t.hostServices.persistProperties({merge:[{objectName:"general",selector:null,properties:{counter:i++}}]})})},a.prototype.updateSearchHeader=function(){this.searchHeader.toggleClass("show",this.slicerData.slicerSettings.general.selfFilterEnabled),this.searchHeader.toggleClass("collapsed",!this.slicerData.slicerSettings.general.selfFilterEnabled)},a.prototype.onLoadMoreData=function(){!this.waitingForData&&this.dataView.metadata&&this.dataView.metadata.segment&&(this.hostServices.loadMoreData(),this.waitingForData=!0)},a.prototype.getSlicerBodyViewport=function(e){var t=this.settings,i=t.header.show?this.getHeaderHeight():0,a=e.height-(i+t.header.borderBottomWidth);return{height:a,width:e.width}},a.prototype.updateSlicerBodyDimensions=function(){var e=this.getSlicerBodyViewport(this.currentViewport);this.slicerBody.style({height:n.toString(e.height),width:"100%"})},a.getChicletTextProperties=function(e){return{fontFamily:a.DefaultFontFamily,fontSize:n.fromPoint(e||a.DefaultFontSizeInPt)}},a.prototype.getHeaderHeight=function(){return e.TextMeasurementService.estimateSvgTextHeight(a.getChicletTextProperties(this.settings.header.textSize))},a.prototype.getRowHeight=function(){var t=this.settings.slicerText;return 0!==t.height?t.height:e.TextMeasurementService.estimateSvgTextHeight(a.getChicletTextProperties(t.textSize))},a.prototype.getBorderStyle=function(e){return"0px"===e?"none":"solid"},a.prototype.getBorderWidth=function(e,t){switch(e){case"None":return"0px";case"BottomOnly":return"0px 0px "+t+"px 0px";case"TopOnly":return t+"px 0px 0px 0px";case"TopBottom":return t+"px 0px "+t+"px 0px";case"LeftRight":return"0px "+t+"px 0px "+t+"px";case"Frame":return t+"px";default:return e.replace("1",t.toString())}},a.prototype.getBorderRadius=function(e){switch(e){case h.ROUNDED:return"10px";case h.SQUARE:return"0px";default:return"5px"}},a.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:"Values"},{name:"Image",kind:e.VisualDataRoleKind.Grouping,displayName:"Image"}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{selection:{displayName:"Selection",type:{text:!0}},orientation:{displayName:"Orientation",type:{enumeration:p.type}},columns:{displayName:"Columns",type:{numeric:!0}},rows:{displayName:"Rows",type:{numeric:!0}},showDisabled:{displayName:"Show Disabled",type:{enumeration:u.type}},multiselect:{displayName:"Multiple selection",type:{bool:!0}},selected:{type:{bool:!0}},filter:{type:{filter:{}}},selfFilter:{type:{filter:{selfFilter:!0}}},selfFilterEnabled:{type:{operations:{searchEnabled:!0}}},formatString:{type:{formatting:{formatString:!0}}}}},header:{displayName:e.data.createDisplayNameGetter("Visual_Header"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},title:{displayName:"Title",type:{text:!0}},fontColor:{displayName:e.data.createDisplayNameGetter("Visual_FontColor"),type:{fill:{solid:{color:!0}}}},background:{displayName:e.data.createDisplayNameGetter("Visual_Background"),type:{fill:{solid:{color:!0}}}},outline:{displayName:e.data.createDisplayNameGetter("Visual_Outline"),type:{formatting:{outline:!0}}},textSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{numeric:!0}},outlineColor:{displayName:"Outline Color",type:{fill:{solid:{color:!0}}}},outlineWeight:{displayName:"Outline Weight",type:{numeric:!0}}}},rows:{displayName:"Chiclets",properties:{fontColor:{displayName:"Text color",type:{fill:{solid:{color:!0}}}},textSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{numeric:!0}},height:{displayName:"Height",type:{numeric:!0}},width:{displayName:"Width",type:{numeric:!0}},selectedColor:{displayName:"Selected Color",type:{fill:{solid:{color:!0}}}},hoverColor:{displayName:"Hover Color",type:{fill:{solid:{color:!0}}}},unselectedColor:{displayName:"Unselected Color",type:{fill:{solid:{color:!0}}}},disabledColor:{displayName:"Disabled Color",type:{fill:{solid:{color:!0}}}},background:{displayName:e.data.createDisplayNameGetter("Visual_Background"),type:{fill:{solid:{color:!0}}}},transparency:{displayName:"Transparency",description:"Set transparency for background color",type:{numeric:!0}},outline:{displayName:e.data.createDisplayNameGetter("Visual_Outline"),type:{formatting:{outline:!0}}},outlineColor:{displayName:"Outline Color",type:{fill:{solid:{color:!0}}}},outlineWeight:{displayName:"Outline Weight",type:{numeric:!0}},borderStyle:{displayName:"Outline Style",type:{enumeration:h.type}}}},images:{displayName:"Images",properties:{imageSplit:{displayName:"Image Split",type:{numeric:!0}},stretchImage:{displayName:"Stretch image",type:{bool:!0}},bottomImage:{displayName:"Bottom image",type:{bool:!0}}}}},dataViewMappings:[{conditions:[{Category:{max:1},Image:{min:0,max:1},Values:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{count:1e4}}},values:{group:{by:"Image",select:[{bind:{to:"Values"}}],dataReductionAlgorithm:{top:{count:1e4}}}},includeEmptyGroups:!0}}],supportsHighlight:!0,sorting:{"default":{}},suppressDefaultTitle:!0},a.DefaultFontFamily="Segoe UI, Tahoma, Verdana, Geneva, sans-serif",a.DefaultFontSizeInPt=11,a.cellTotalInnerPaddings=8,a.cellTotalInnerBorders=2,a.chicletTotalInnerRightLeftPaddings=14,a.ItemContainer=o("slicerItemContainer"),a.HeaderText=o("headerText"),a.Container=o("chicletSlicer"),a.LabelText=o("slicerText"),a.Header=o("slicerHeader"),a.Input=o("slicerCheckbox"),a.Clear=o("clear"),a.Body=o("slicerBody"),a}();i.ChicletSlicer=d;var m;!function(e){var a=function(){function e(e,a){var r=e.categorical;this.dataViewCategorical=r,this.dataViewMetadata=e.metadata,r.categories&&r.categories.length>0&&(this.category=r.categories[0],this.categoryIdentities=this.category.identity,this.categoryValues=this.category.values,this.categoryColumnRef=this.category.identityFields,this.categoryFormatString=t.valueFormatter.getFormatString(this.category.source,i.chicletSlicerProps.formatString)),this.dataPoints=[],this.interactivityService=a,this.hasSelectionOverride=!1}return e.prototype.convert=function(){if(this.dataPoints=[],this.numberOfCategoriesSelectedInData=0,this.categoryValues){var e,a=this.dataViewMetadata?this.dataViewMetadata.objects:void 0,r=void 0;if(a&&a.general&&a.general.filter){if(!this.categoryColumnRef)return;var o=a.general.filter,n=s.asScopeIdsContainer(o,this.categoryColumnRef);n?(r=n.isNot,e=n.scopeIds?n.scopeIds.length:0):r=!1}this.interactivityService&&(void 0===r?r=this.interactivityService.isSelectionModeInverted():this.interactivityService.setSelectionModeInverted(r));for(var c=void 0,h=0;h<this.categoryValues.length;h++){var u=t.isCategoryColumnSelected(i.chicletSlicerProps.selectedPropertyIdentifier,this.category,h);if(null!=u){c=u;break}}for(var p=this.dataViewCategorical,d=i.chicletSlicerProps.formatString,m=-(1/0),g="",f=0,y=this.categoryValues.length;y>f;f++){var v=t.isCategoryColumnSelected(i.chicletSlicerProps.selectedPropertyIdentifier,this.category,f),x=!0;null!=c&&(r?(null==this.category.objects&&(v=void 0),null!=v?v=c:null==v&&(v=!c)):null==v&&(v=!c)),v&&this.numberOfCategoriesSelectedInData++;var E=this.categoryValues[f],b=t.valueFormatter.format(E,this.categoryFormatString);if(this.dataViewCategorical.values)for(var T=0;T<this.dataViewCategorical.values.length;T++){var w=p.values[T];null!=w.values[f]&&(m=w.values[f],w.highlights&&(x=!(null===w.highlights[f])),w.source.groupName&&""!==w.source.groupName&&(g=t.converterHelper.getFormattedLegendLabel(w.source,p.values,d),/^(ftp|http|https):\/\/[^ "]+$/.test(g)||(g=void 0)))}var S=l.builder().withCategory(this.category,f).createSelectionId();this.dataPoints.push({identity:S,category:b,imageURL:g,value:m,selected:v,selectable:x})}null!=e&&e>this.numberOfCategoriesSelectedInData&&(this.hasSelectionOverride=!0)}},e}();e.ChicletSlicerConverter=a}(m||(m={}));var g;!function(e){function t(e){var t=r(e);return t.y+t.height}function i(){o||(o=$("<span/>"),$("body").append(o),n=d3.select($("body").get(0)).append("svg").style({height:"0px",width:"0px",position:"absolute"}).append("text"),s=$("<canvas/>").get(0).getContext("2d"))}function a(e){return i(),n.style(null),n.text(e.text).attr({visibility:"hidden","font-family":e.fontFamily,"font-size":e.fontSize,"font-weight":e.fontWeight,"font-style":e.fontStyle,"white-space":e.whiteSpace||"nowrap"}),n.node().getBBox()}function r(e){var t={fontFamily:e.fontFamily,fontSize:e.fontSize,text:"M"},i=a(t);return i}var o,n,s;e.estimateSvgTextBaselineDelta=t}(g=i.ChicletSlicerTextMeasurementHelper||(i.ChicletSlicerTextMeasurementHelper={}));var f=function(){function t(){}return t.prototype.bindEvents=function(e,t){var i=this,a=this.slicers=e.slicerItemContainers;this.slicerItemLabels=e.slicerItemLabels,this.slicerItemInputs=e.slicerItemInputs;var r=e.slicerClear;this.dataPoints=e.dataPoints,this.interactivityService=e.interactivityService,this.slicerSettings=e.slicerSettings,this.options=e,this.options.isSelectionLoaded||this.loadSelection(t),a.on("mouseover",function(e){e.selectable&&(e.mouseOver=!0,e.mouseOut=!1,i.renderMouseover())}),a.on("mouseout",function(e){e.selectable&&(e.mouseOver=!1,e.mouseOut=!0,i.renderMouseover())}),a.on("click",function(e,a){if(e.selectable){var r=i.slicerSettings;if(d3.event.preventDefault(),d3.event.altKey&&r.general.multiselect){var o=jQuery.map(i.dataPoints,function(e,t){return e.selected?t:void 0}),n=o.length>0?o[o.length-1]:0;if(n>a){var s=a;a=n,n=s}t.handleClearSelection();for(var l=n;a>=l;l++)t.handleSelection(i.dataPoints[l],!0)}else d3.event.ctrlKey&&r.general.multiselect?t.handleSelection(e,!0):t.handleSelection(e,!1);i.saveSelection(t)}}),r.on("click",function(e){t.handleClearSelection(),i.saveSelection(t)})},t.prototype.loadSelection=function(e){e.handleClearSelection();var t=this.slicerSettings.general.getSavedSelection();if(t.length){var a=this.dataPoints.filter(function(e){return t.some(function(t){return e.identity.getKey()===t})});a.forEach(function(t){return e.handleSelection(t,!0)}),e.persistSelectionFilter(i.chicletSlicerProps.filterPropertyIdentifier)}},t.getFilterFromSelectors=function(t,i){var a=[],r=t.selectedIds;r.length>0&&(a=_.chain(r).filter(function(e){return e.hasIdentity()}).map(function(e){return e.getSelector()}).value());var o=e.data.Selector.filterFromSelector(a,i);return o},t.prototype.saveSelection=function(e){var i=t.getFilterFromSelectors(e,this.interactivityService.isSelectionModeInverted()),a=e.selectedIds.map(function(e){return e.getKey()});this.slicerSettings.general.setSavedSelection(i,a)},t.prototype.renderSelection=function(e){e||this.interactivityService.isSelectionModeInverted()?this.styleSlicerInputs(this.slicers,e):this.slicers.style("background",this.slicerSettings.slicerText.unselectedColor)},t.prototype.renderMouseover=function(){var e=this;this.slicerItemLabels.style({color:function(t){return t.mouseOver?e.slicerSettings.slicerText.hoverColor:t.mouseOut?t.selected?e.slicerSettings.slicerText.fontColor:e.slicerSettings.slicerText.fontColor:void 0}})},t.prototype.styleSlicerInputs=function(e,t){var i=this.slicerSettings,a=[];e.each(function(e){e.selectable&&e.selected&&a.push(e),d3.select(this).style({background:e.selectable?e.selected?i.slicerText.selectedColor:i.slicerText.unselectedColor:i.slicerText.disabledColor}),d3.select(this).classed("slicerItem-disabled",!e.selectable)})},t}();i.ChicletSlicerWebBehavior=f;var y;!function(e){var t;!function(e){function t(e,t){var i=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(i,function(e,t,i,a){return t+t+i+i+a+a});var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),r=a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null;return null===r?"":t||0===t?"rgba("+r.r+","+r.g+","+r.b+","+t+")":"rgb("+r.r+","+r.g+","+r.b+")"}e.hexToRGBString=t}(t=e.util||(e.util={}))}(y||(y={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=a.PixelConverter,o=function(){function e(e,t){this.defaultViewport=e||{width:0,height:0},this.defaultMargin=t||{top:0,bottom:0,right:0,left:0}}return Object.defineProperty(e.prototype,"margin",{get:function(){return this.marginValue||(this.margin=this.defaultMargin)},set:function(t){this.marginValue=e.restrictToMinMax(t),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this.viewportValue||(this.viewportValue=this.defaultViewport)},set:function(t){this.viewportValue=e.restrictToMinMax(t,this.minViewport),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minViewport",{get:function(){return this.minViewportValue},set:function(e){this.minViewportValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportInIsZero",{get:function(){return 0===this.viewportIn.width||0===this.viewportIn.height},enumerable:!0,configurable:!0}),e.prototype.resetMargin=function(){this.margin=this.defaultMargin},e.prototype.update=function(){this.viewportInValue=e.restrictToMinMax({width:this.viewport.width-(this.margin.left+this.margin.right),height:this.viewport.height-(this.margin.top+this.margin.bottom)},this.minViewportValue)},e.restrictToMinMax=function(e,t){var i=$.extend({},e);return _.keys(e).forEach(function(a){return i[a]=Math.max(t&&t[a]||0,e[a])}),i},e}(),n=function(){function e(){}return e.interpolateArc=function(e){return function(t){if(!this.oldData)return this.oldData=t,function(){return e(t)};var i=d3.interpolate(this.oldData,t);return this.oldData=i(0),function(t){return e(i(t))}}},e.addContext=function(e,t){return function(){return t.apply(e,[this].concat(_.toArray(arguments)))}},e}(),s=function(){function i(){this.dataPoint={defaultColor:null,showAllDataPoints:!1},this.axis={show:!0},this.labels={show:!0,color:t.dataLabelUtils.defaultLabelColor,fontSize:t.dataLabelUtils.DefaultFontSizeInPt}}return Object.defineProperty(i,"Default",{get:function(){return new this},enumerable:!0,configurable:!0}),i.parse=function(e,t){var i=new this;if(!e||!e.metadata||!e.metadata.objects)return i;var a=this.getProperties(t);for(var r in t.objects)for(var o in t.objects[r].properties)if(i[r]&&_.has(i[r],o)){var n=t.objects[r].properties[o].type,s=this.getValueFnByType(n);i[r][o]=s(e.metadata.objects,a[r][o],i[r][o])}return i},i.getProperties=function(e){var t=_.merge({general:{properties:{formatString:{}}}},e.objects),i={};for(var a in t){i[a]={};for(var r in t[a].properties)i[a][r]={objectName:a,propertyName:r}}return i},i.createEnumTypeFromEnum=function(t){var i=!1;return e.createEnumType(Object.keys(t).filter(function(e,a){return!!(a%2)===i&&t[e]===e&&!void(i=!i)||!!(a%2)!==i}).map(function(e){return{value:e,displayName:e}}))},i.getValueFnByType=function(t){switch(_.keys(t)[0]){case"fill":return e.DataViewObjects.getFillColor;default:return e.DataViewObjects.getValue}},i.enumerateObjectInstances=function(e,i,a){var r=new t.ObjectEnumerationBuilder,o=e&&e[i.objectName];if(!o)return r;var n={objectName:i.objectName,selector:null,properties:{}};for(var s in o)_.has(o,s)&&(n.properties[s]=o[s]);return r.pushInstance(n),r},i}();i.ChordChartSettings=s;var l=function(){function e(){this.Category=null,this.Series=null,this.Y=null}return e.getColumnSources=function(e){return this.getColumnSourcesT(e)},e.getTableValues=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&_.mapValues(i,function(e,i){return e&&t.rows.map(function(t){return t[e.index]})})},e.getTableRows=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&t.rows.map(function(e){return _.mapValues(i,function(t,i){return t&&e[t.index]})})},e.getCategoricalValues=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[],r=t&&a.source&&this.getSeriesValues(e);return t&&_.mapValues(new this,function(e,t){return _.toArray(i).concat(_.toArray(a)).filter(function(e){return e.source.roles&&e.source.roles[t]}).map(function(e){return e.values})[0]||a.source&&a.source.roles&&a.source.roles[t]&&r})},e.getSeriesValues=function(e){return e&&e.categorical&&e.categorical.values&&e.categorical.values.map(function(e){return t.converterHelper.getSeriesName(e.source)})},e.getCategoricalColumns=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[];return t&&_.mapValues(new this,function(e,t){return i.filter(function(e){return e.source.roles&&e.source.roles[t]})[0]||a.source&&a.source.roles&&a.source.roles[t]||a.filter(function(e){return e.source.roles&&e.source.roles[t]})})},e.getColumnSourcesT=function(e){var t=e&&e.metadata&&e.metadata.columns;return t&&_.mapValues(new this,function(e,i){return t.filter(function(e){return e.roles&&e.roles[i]})[0]})},e.Roles=Object.freeze(_.mapValues(new e,function(e,t){return t})),e}();i.ChordChartColumns=l;var c=function(){function i(){}return Object.defineProperty(i.prototype,"settings",{get:function(){return this.data&&this.data.settings},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"innerRadius",{get:function(){return this.radius*i.InnerArcRadiusRatio},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"outerRadius",{get:function(){return this.radius*i.OuterArcRadiusRatio},enumerable:!0,configurable:!0}),i.converter=function(e,a,o){var n=s.getProperties(i.capabilities),c=i.parseSettings(e),h=l.getCategoricalColumns(e),u=l.getColumnSources(e),p=l.getCategoricalValues(e);if(!p||_.isEmpty(p.Category)||_.isEmpty(p.Y))return null;p.Series=p.Series||l.getSeriesValues(e);var d=[],m={dataPoints:[],title:u.Y.displayName||""},g=[],f=[],y=1e3,v=_.mapValues(_.invert(p.Series),parseFloat),x=_.mapValues(_.invert(p.Category),parseFloat),E=!1,b=[],T=new t.ColorHelper(a,n.dataPoint.fill,c.dataPoint.defaultColor),w=this.union_arrays(p.Category,p.Series).reverse();i.getValidArrayLength(w)===i.getValidArrayLength(p.Category)+i.getValidArrayLength(p.Series)&&(E=!0);for(var S=t.valueFormatter.create({format:t.valueFormatter.getFormatString(u.Category,n.general.formatString,!0)||u.Category.format}),R=t.valueFormatter.create({format:t.valueFormatter.getFormatString(u.Y,n.general.formatString,!0)||u.Y.format}),C=0,A=w.length;A>C;C++){var M=null,H="",P=!1;if(void 0!==x[w[C]]){var D=x[w[C]];M=t.SelectionIdBuilder.builder().withCategory(h.Category,x[w[C]]).createSelectionId(),P=!0;var L=h.Category.objects?h.Category.objects[D]:void 0;H=T.getColorForSeriesValue(L,void 0,p.Category[D])}else if(void 0!==v[w[C]]){var D=v[w[C]],N=h.Y[D],V=N&&N.objects&&N.objects[0],z=t.converterHelper.getSeriesName(N.source);M=t.SelectionId.createWithId(N.identity),P=!1,H=T.getColorForSeriesValue(V,void 0,z)}b.push({label:w[C],labelColor:c.labels.color,barColor:H,isCategory:P,identity:M,selected:!1,labelFontSize:r.fromPointToPixel(c.labels.fontSize)}),d.push([]),
g.push([]);for(var I=0,F=w.length;F>I;I++){var O=0,k=[];if(void 0!==x[w[C]]&&void 0!==v[w[I]]){var j=x[w[C]],B=v[w[I]];null!==h.Y[B].values[j]&&(O=h.Y[B].values[j],O>y&&(y=O),k=t.TooltipBuilder.createTooltipInfo(n.general.formatString,e.categorical,S.format(p.Category[C]),R.format(O),null,null,B,j))}else if(E&&void 0!==x[w[I]]&&void 0!==v[w[C]]){var j=x[w[I]],B=v[w[C]];null!==h.Y[B].values[j]&&(O=h.Y[B].values[j])}d[C].push(O||0),g[C].push({tooltipInfo:k})}var G=d3.sum(d[C]);f.push({tooltipInfo:[{displayName:w[C],value:R.format(G)}]})}var U=d3.layout.chord().padding(.1).matrix(d),W=Math.round(y/5).toString().length-1;return{dataMatrix:d,dataView:e,settings:c,labelDataPoints:i.getChordArcDescriptors(U.groups(),b),legendData:m,tooltipData:g,sliceTooltipData:f,tickUnit:Math.pow(10,W),differentFromTo:E,prevAxisVisible:void 0===o?c.axis.show:o}},i.parseSettings=function(e){return s.parse(e,i.capabilities)},i.getValidArrayLength=function(e){for(var t=0,i=0,a=e.length;a>i;i++)void 0!==e[i]&&t++;return t},i.getChordArcDescriptors=function(e,t){var i=e;return i.forEach(function(e,i){return e.data=t[i]}),i},i.prototype.init=function(e){var a=this.element=e.element;this.selectionManager=new t.utility.SelectionManager({hostServices:e.host}),this.layout=new o(e.viewport,i.DefaultMargin),this.layout.minViewport={width:150,height:150},this.svg=d3.select(a.get(0)).append("svg").style("position","absolute").classed(i.VisualClassName,!0),this.mainGraphicsContext=this.svg.append("g"),this.mainGraphicsContext.append("g").classed("chords",!0),this.slices=this.mainGraphicsContext.append("g").classed("slices",!0),this.mainGraphicsContext.append("g").classed("ticks",!0),this.labels=this.mainGraphicsContext.append("g").classed(i.labelGraphicsContextClass["class"],!0),this.lines=this.mainGraphicsContext.append("g").classed(i.linesGraphicsContextClass["class"],!0),this.colors=e.style.colorPalette.dataColors},i.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){if(this.layout.viewport=e.viewport,this.duration=e.suppressAnimations?0:t.AnimatorCommon.MinervaAnimationDuration,this.data=i.converter(e.dataViews[0],this.colors,this.settings&&this.settings.axis.show),!this.data)return void this.clear();this.layout.resetMargin(),this.layout.margin.top=this.layout.margin.bottom=r.fromPointToPixel(this.settings.labels.fontSize)/2,this.render()}},i.prototype.enumerateObjectInstances=function(e){var a=s.enumerateObjectInstances(this.settings,e,i.capabilities);if(this.settings&&"dataPoint"===e.objectName&&!_.isEmpty(this.data.labelDataPoints)&&this.settings.dataPoint.showAllDataPoints)for(var r=0,o=this.data.labelDataPoints.length;o>r;r++){var n=this.data.labelDataPoints[r].data;if(n.isCategory){var l={objectName:"dataPoint",displayName:n.label,selector:t.ColorHelper.normalizeSelector(n.identity.getSelector()),properties:{fill:{solid:{color:n.barColor}}}};a.pushInstance(l)}}return a.complete()},i.prototype.calculateRadius=function(){if(this.settings.labels.show){var e=this.layout.viewportIn.height/this.layout.viewportIn.width,t=2+1/(1+Math.exp(-5*(e-1)));return Math.min(this.layout.viewportIn.height,this.layout.viewportIn.width)/t}return Math.min(this.layout.viewportIn.height,this.layout.viewportIn.width)/2},i.prototype.drawCategoryLabels=function(){var e=d3.svg.arc().innerRadius(0).outerRadius(this.innerRadius),i=d3.svg.arc().innerRadius(this.outerRadius).outerRadius(this.outerRadius);if(this.settings.labels.show){var a=this.getChordChartLabelLayout(i),r=this.getDataLabelManager().hideCollidedLabels(this.layout.viewportIn,this.data.labelDataPoints,a,!0);this.renderLabels(r,a,!0),this.renderLines(r,e,i)}else t.dataLabelUtils.cleanDataLabels(this.labels),t.dataLabelUtils.cleanDataLabels(this.lines,!0)},i.prototype.getDataLabelManager=function(){function i(i,a,r,o){if(i.hasConflict(r))return!0;var n={left:0,top:r.height/2,width:o.width,height:o.height};return n=t.shapes.Rect.inflate(n,{left:e.DataLabelManager.InflateAmount,top:0,right:e.DataLabelManager.InflateAmount,bottom:0}),n=t.shapes.Rect.intersect(n,r),t.shapes.Rect.isEmpty(n)?!0:e.Double.lessWithPrecision(n.height,r.height/2)}var a=new e.DataLabelManager;return a.hasCollisions=i.bind(a),a},i.prototype.render=function(){var e=this;this.chordLayout=d3.layout.chord().padding(.1).matrix(this.data.dataMatrix),this.radius=this.calculateRadius();var a=d3.svg.arc().innerRadius(this.radius).outerRadius(this.innerRadius);this.svg.attr({width:this.layout.viewport.width,height:this.layout.viewport.height}),this.mainGraphicsContext.attr("transform",t.SVGUtil.translate(this.layout.viewport.width/2,this.layout.viewport.height/2));var r=this.slices.selectAll("path"+i.sliceClass.selector).data(this.getChordTicksArcDescriptors());r.enter().insert("path").classed(i.sliceClass["class"],!0),r.style("fill",function(t,i){return e.data.labelDataPoints[i].data.barColor}).style("stroke",function(t,i){return e.data.labelDataPoints[i].data.barColor}).on("click",n.addContext(this,function(t,i,a){e.selectionManager.select(e.data.labelDataPoints[a].data.identity).then(function(i){i.length>0?(e.mainGraphicsContext.selectAll(".chords path.chord").style("opacity",1),e.slices.selectAll("path.slice").style("opacity",.3),e.mainGraphicsContext.selectAll(".chords path.chord").filter(function(e){return e.source.index!==a&&e.target.index!==a}).style("opacity",.3),d3.select(t).style("opacity",1)):(r.style("opacity",1),e.mainGraphicsContext.selectAll(".chords path.chord").filter(function(e){return e.source.index!==a&&e.target.index!==a}).style("opacity",1))}),d3.event.stopPropagation()})).transition().duration(this.duration).attrTween("d",n.interpolateArc(a)),r.exit().remove(),t.TooltipManager.addTooltip(r,function(t){return e.data.sliceTooltipData[t.data.index].tooltipInfo});var o=this.svg.select(".chords").selectAll("path"+i.chordClass.selector).data(this.chordLayout.chords);o.enter().insert("path").classed(i.chordClass["class"],!0),o.style("fill",function(t,i){return e.data.labelDataPoints[t.target.index].data.barColor}).style("opacity",1).transition().duration(this.duration).attr("d",d3.svg.chord().radius(this.radius)),o.exit().remove(),this.svg.on("click",function(){return e.selectionManager.clear().then(function(){r.style("opacity",1),o.style("opacity",1)})}),this.drawTicks(),this.drawCategoryLabels(),t.TooltipManager.addTooltip(o,function(t){var i=[];return e.data.differentFromTo?i=e.data.tooltipData[t.data.source.index][t.data.source.subindex].tooltipInfo:(i.push({displayName:e.data.labelDataPoints[t.data.source.index].data.label+"->"+e.data.labelDataPoints[t.data.source.subindex].data.label,value:e.data.dataMatrix[t.data.source.index][t.data.source.subindex].toString()}),i.push({displayName:e.data.labelDataPoints[t.data.target.index].data.label+"->"+e.data.labelDataPoints[t.data.target.subindex].data.label,value:e.data.dataMatrix[t.data.target.index][t.data.target.subindex].toString()})),i})},i.prototype.clear=function(){this.mainGraphicsContext.selectAll(i.sliceClass.selector).remove(),this.mainGraphicsContext.selectAll(i.sliceTicksClass.selector).remove(),this.mainGraphicsContext.selectAll(i.chordClass.selector).remove(),this.mainGraphicsContext.selectAll(i.labelsClass.selector).remove(),this.mainGraphicsContext.selectAll(i.lineClass.selector).remove()},i.prototype.clearTicks=function(){var e=[],t=this.mainGraphicsContext.selectAll(i.tickLineClass.selector).data(e);t.exit().remove();var a=this.mainGraphicsContext.selectAll(i.tickTextClass.selector).data(e);a.exit().remove(),this.mainGraphicsContext.selectAll(i.tickPairClass.selector).remove(),this.mainGraphicsContext.selectAll(i.sliceTicksClass.selector).remove()},i.prototype.getChordTicksArcDescriptors=function(){var e=this.chordLayout.groups(),a=!_.isEmpty(e)&&_.max(e,function(e){return e.value}).value||0,r=!_.isEmpty(e)&&_.min(e,function(e){return e.value}).value||0,o=this.radius/Math.abs(a-r)*1.25,n=t.valueFormatter.create({format:"0.##",value:a});return e.forEach(function(e){var t=(e.endAngle-e.startAngle)/e.value,a=Math.abs(e.value),r=d3.range(0,a,.15>a-1?.15:a-1);e.value<0&&(r=r.map(function(e){return-1*e}).reverse());for(var s=1;s<r.length;s++){var l=Math.abs(r[s]-r[s-1])*o;l<i.TicksFontSize&&(r.length>2&&s===r.length-1?r.splice(--s,1):r.splice(s--,1))}e.angleLabels=r.map(function(i,a){return{angle:i*t+e.startAngle,label:n.format(i)}})}),e},i.prototype.drawTicks=function(){var e=this;if(this.settings.axis.show){var t=this.mainGraphicsContext.select(".ticks").selectAll("g"+i.sliceTicksClass.selector).data(this.chordLayout.groups),a=this.data.prevAxisVisible===this.settings.axis.show?this.duration:0;t.enter().insert("g").classed(i.sliceTicksClass["class"],!0);var r=t.selectAll("g"+i.tickPairClass.selector).data(function(e){return e.angleLabels});r.enter().insert("g").classed(i.tickPairClass["class"],!0),r.transition().duration(a).attr("transform",function(t){return"rotate("+(180*t.angle/Math.PI-90)+")translate("+e.innerRadius+",0)"}),r.selectAll("line"+i.tickLineClass.selector).data(function(e){return[e]}).enter().insert("line").classed(i.tickLineClass["class"],!0).style("stroke","#000").attr("x1",1).attr("y1",0).attr("x2",5).attr("y2",0),r.selectAll("text"+i.tickTextClass.selector).data(function(e){return[e]}).enter().insert("text").classed(i.tickTextClass["class"],!0).style("pointer-events","none").attr("x",8).attr("dy",".35em"),r.selectAll("text"+i.tickTextClass.selector).text(function(e){return e.label}).style("text-anchor",function(e){return e.angle>Math.PI?"end":null}).attr("transform",function(e){return e.angle>Math.PI?"rotate(180)translate(-16)":null}),r.exit().remove(),t.exit().remove()}else this.clearTicks()},i.prototype.renderLabels=function(e,a,r,o){if(void 0===r&&(r=!1),void 0===o&&(o=!1),0===e.length)return t.dataLabelUtils.cleanDataLabels(this.labels,!0),null;var n=null!==e[0].key,s=null!==e[0].identity,l=n?function(e){return e.key}:s?function(e){return e.identity.getKey()}:void 0,c=r?this.labels.selectAll(i.labelsClass.selector).data(e,function(e){return e.data.identity.getKey()}):null!==l?this.labels.selectAll(i.labelsClass.selector).data(e,l):this.labels.selectAll(i.labelsClass.selector).data(e),h=c.enter().append("text").classed(i.labelsClass["class"],!0);o&&h.style("opacity",0),c.attr({x:function(e){return e.labelX},y:function(e){return e.labelY},dy:".35em"}).text(function(e){return e.labeltext}).style(a.style),c.exit().remove()},i.prototype.renderLines=function(e,t,a){var r=this,o=this.lines.selectAll("polyline").data(e,function(e){return e.data.identity.getKey()}),n=2.05,s=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2};o.enter().append("polyline").classed(i.lineClass["class"],!0),o.attr("points",function(e){var o=a.centroid(e);o[0]=(r.radius+i.LabelMargin/2)*(s(e)<Math.PI?1:-1);var l=a.centroid(e),c=t.centroid(e);return c[0]*=n,c[1]*=n,[c,l,o]}).style({opacity:function(e){return i.PolylineOpacity},stroke:function(e){return e.data.labelColor},"pointer-events":"none"}),o.exit().remove()},i.prototype.getChordChartLabelLayout=function(e){var a=this,o=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2},n=(this.layout.viewportIn.width-2*this.radius-2*i.LabelMargin)/1.6;return{labelText:function(e){return t.dataLabelUtils.getLabelFormattedText({label:e.data.label,maxWidth:n,fontSize:r.fromPointToPixel(a.settings.labels.fontSize)})},labelLayout:{x:function(e){return(a.radius+i.LabelMargin)*(o(e)<Math.PI?1:-1)},y:function(t){var i=e.centroid(t);return i[1]}},filter:function(e){return null!==e&&null!==e.data&&null!==e.data.label},style:{fill:function(e){return e.data.labelColor},"text-anchor":function(e){return o(e)<Math.PI?"start":"end"},"font-size":function(e){return r.fromPoint(a.settings.labels.fontSize)}}}},i.union_arrays=function(e,t){for(var i={},a=0;a<e.length;a++)i[e[a]]=e[a];for(var a=0;a<t.length;a++)i[t[a]]=t[a];var r=[];for(var o in i)i.hasOwnProperty(o)&&r.push(i[o]);return r},i.capabilities={dataRoles:[{name:l.Roles.Category,kind:e.VisualDataRoleKind.Grouping,displayName:"From"},{name:l.Roles.Series,kind:e.VisualDataRoleKind.Grouping,displayName:"To"},{name:l.Roles.Y,kind:e.VisualDataRoleKind.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:0}},{Category:{max:1},Series:{min:1,max:1},Y:{max:1}},{Category:{max:1},Series:{max:0},Y:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{bind:{to:"Y"}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:2},supported:{min:1}}}}],objects:{dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),properties:{defaultColor:{displayName:e.data.createDisplayNameGetter("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint_Show_All"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}},axis:{displayName:"Axis",properties:{show:{type:{bool:!0}}}},labels:{displayName:"Labels",properties:{show:{type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_Reference_Line_Data_Label_Color"),description:e.data.createDisplayNameGetter("Visual_Reference_Line_Data_Label_Color_Description"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}}}},i.PolylineOpacity=.5,i.OuterArcRadiusRatio=.9,i.InnerArcRadiusRatio=.8,i.LabelMargin=10,i.DefaultMargin={left:10,right:10,top:10,bottom:10},i.VisualClassName="chordChart",i.TicksFontSize=12,i.sliceClass={"class":"slice",selector:".slice"},i.chordClass={"class":"chord",selector:".chord"},i.sliceTicksClass={"class":"slice-ticks",selector:".slice-ticks"},i.tickPairClass={"class":"tick-pair",selector:".tick-pair"},i.tickLineClass={"class":"tick-line",selector:".tick-line"},i.tickTextClass={"class":"tick-text",selector:".tick-text"},i.labelGraphicsContextClass={"class":"labels",selector:".labels"},i.labelsClass={"class":"data-labels",selector:".data-labels"},i.linesGraphicsContextClass={"class":"lines",selector:".lines"},i.lineClass={"class":"line-label",selector:".line-label"},i}();i.ChordChart=c}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=a.PixelConverter,o=a.CssConstants.createClassAndSelector,n=a.Lazy,s=e.data.DataRoleHelper.getCategoryIndexOfRole,l=e.data.DataRoleHelper.getMeasureIndexOfRole,c=function(){function i(){this.ScrollBarWidth=10,this.textProperties={fontFamily:"wf_segoe-ui_normal",fontSize:r.toString(i.AxisFontSize)}}return Object.defineProperty(i.prototype,"margin",{get:function(){return this._margin||{left:0,right:0,top:0,bottom:0}},set:function(e){this._margin=$.extend({},e),this._viewportIn=i.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewport",{get:function(){return this._viewport||{width:0,height:0}},set:function(e){this._viewport=$.extend({},e),this._viewportIn=i.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewportIn",{get:function(){return this._viewportIn||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"legendViewport",{get:function(){return this.legend.getMargins()},enumerable:!0,configurable:!0}),i.substractMargin=function(e,t){return{width:Math.max(e.width-(t.left+t.right),0),height:Math.max(e.height-(t.top+t.bottom),0)}},i.getCustomSymbolType=function(e){var t=d3.map({circle:function(e){var t=Math.sqrt(e/Math.PI);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"},cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*Math.tan(Math.PI/6))),i=t*Math.tan(Math.PI/6);return"M0,"+-t+"L"+i+",0 0,"+t+" "+-i+",0Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/Math.sqrt(3)),i=t*Math.sqrt(3)/2;return"M0,"+-i+"L"+t+","+i+" "+-t+","+i+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/Math.sqrt(3)),i=t*Math.sqrt(3)/2;return"M0,"+i+"L"+t+","+-i+" "+-t+","+-i+"Z"},star:function(e){for(var t=Math.sqrt(e/2),i=Math.sqrt(e/10),a="",r=Math.PI/5,o=0;10>o;o++){var n=0===(1&o)?t:i,s=Math.cos(o*r)*n,l=Math.sin(o*r)*n;0===o?a="M"+s+","+l+"L":a+=" "+s+","+l}return a+"Z"},hexagon:function(e){var t=Math.sqrt(e/(6*Math.sqrt(3))),i=Math.sqrt(e/(2*Math.sqrt(3)));return"M0,"+2*t+"L"+-i+","+t+" "+-i+","+-t+" 0,"+-2*t+" "+i+","+-t+" "+i+","+t+"Z"},x:function(e){var t=Math.sqrt(e/10);return"M0,"+t+"L"+-t+","+2*t+" "+-2*t+","+t+" "+-t+",0 "+-2*t+","+-t+" "+-t+","+-2*t+" 0,"+-t+" "+t+","+-2*t+" "+2*t+","+-t+" "+t+",0 "+2*t+","+t+" "+t+","+2*t+"Z"},uparrow:function(e){var t=Math.sqrt(e/12);return"M"+t+","+3*t+"L"+-t+","+3*t+" "+-t+","+-t+" "+-2*t+","+-t+" 0,"+-3*t+" "+2*t+","+-t+" "+t+","+-t+"Z"},downarrow:function(e){var t=Math.sqrt(e/12);return"M0,"+3*t+"L"+-2*t+","+t+" "+-t+","+t+" "+-t+","+-3*t+" "+t+","+-3*t+" "+t+","+t+" "+2*t+","+t+"Z"}}),i=t.entries()[0].value;if(e){if(isNaN(e))return t[e&&e.toString().toLowerCase()]||i;var a=t.entries()[Math.floor(e)];return a?a.value:i}return i},i.prototype.init=function(e){this.options=e,this.animator=new t.BaseAnimator,this.behavior=new t.CartesianChartBehavior([new t.ScatterChartWebBehavior]);var a=this.element=e.element;this.viewport=_.clone(e.viewport),this.style=e.style,this.hostServices=e.host,this.colors=this.style.colorPalette.dataColors,this.interactivity=e.interactivity,this.margin={top:1,right:1,bottom:1,left:1},this.yAxisOrientation=t.yAxisPosition.left,this.adjustMargins();var r=this.scrollY=!0,o=this.scrollX=!0,n=this.svg=d3.select(a.get(0)).append("svg").style("position","absolute").classed(i.ClassName,!0),s=this.axisGraphicsContext=n.append("g").classed(i.AxisGraphicsContextClassName,!0);this.svgScrollable=n.append("svg").classed("svgScrollable",!0).style("overflow","hidden");var l=this.axisGraphicsContextScrollable=this.svgScrollable.append("g").classed(i.AxisGraphicsContextClassName,!0);this.clearCatcher=t.appendClearCatcher(this.axisGraphicsContextScrollable);var c=r?l:s;this.backgroundGraphicsContext=s.append("svg:image"),this.xAxisGraphicsContext=r?s.append("g").attr("class","x axis"):l.append("g").attr("class","x axis"),this.y1AxisGraphicsContext=c.append("g").attr("class","y axis"),this.xAxisGraphicsContext.classed("showLinesOnAxis",r),this.y1AxisGraphicsContext.classed("showLinesOnAxis",o),this.xAxisGraphicsContext.classed("hideLinesOnAxis",!r),this.y1AxisGraphicsContext.classed("hideLinesOnAxis",!o),this.interactivityService=t.createInteractivityService(this.hostServices),this.legend=t.createLegend(a,this.interactivity&&this.interactivity.isInteractiveLegend,this.interactivityService,!0),this.mainGraphicsG=this.axisGraphicsContextScrollable.append("g").classed(i.MainGraphicsContextClassName,!0),this.mainGraphicsSVGSelection=this.mainGraphicsG.append("svg"),this.mainGraphicsContext=this.mainGraphicsSVGSelection.append("g"),this.svgDefaultImage="",this.keyArray=[]},i.prototype.adjustMargins=function(){var e=this.element.find(".x.axis");0===t.AxisHelper.getRecommendedNumberOfTicksForXAxis(this.viewportIn.width)&&0===t.AxisHelper.getRecommendedNumberOfTicksForYAxis(this.viewportIn.height)?(this.margin={top:0,right:0,bottom:0,left:0},e.hide()):e.show()},i.prototype.getValueAxisProperties=function(e,t){var i={};if(!e)return i;var a=e.objects;if(a){var r=a.valueAxis;r&&(i={show:r.show,position:r.position,axisScale:r.axisScale,start:r.start,end:r.end,showAxisTitle:null==r.showAxisTitle?t:r.showAxisTitle,axisStyle:r.axisStyle,axisColor:r.axisColor,secShow:r.secShow,secPosition:r.secPosition,secAxisScale:r.secAxisScale,secStart:r.secStart,secEnd:r.secEnd,secShowAxisTitle:r.secShowAxisTitle,secAxisStyle:r.secAxisStyle,labelDisplayUnits:r.labelDisplayUnits})}return i},i.prototype.getCategoryAxisProperties=function(e,t){var i={};if(!e)return i;var a=e.objects;if(a){var r=a.categoryAxis;r&&(i={show:r.show,axisType:r.axisType,axisScale:r.axisScale,axisColor:r.axisColor,start:r.start,end:r.end,showAxisTitle:null==r.showAxisTitle?t:r.showAxisTitle,axisStyle:r.axisStyle,labelDisplayUnits:r.labelDisplayUnits})}return i},i.converter=function(a,r,o,n,s){if(!a)return i.getDefaultData();var l,c,h,u,p,d=a.categorical,m=a.metadata,g=d.categories||[],f=d.values,y=!!f.source,v=f.grouped(),x=f.source,E=i.getMetadata(g,v,x),b=E.idx.category,T=E.idx.image>=0,w=E.idx.colorFill>=0;if(d.categories&&d.categories.length>0&&d.categories[b]){var S=d.categories[b];l=S.values,c=t.valueFormatter.create({format:t.valueFormatter.getFormatString(S.source,t.scatterChartProps.general.formatString),value:l[0],value2:l[l.length-1]}),u=S.identity,h=S.objects,p=S.source?S.source.queryName:null}else l=[null],c=t.valueFormatter.createDefaultFormatter(null);var R=t.dataLabelUtils.getDefaultPointLabelSettings(),C=!1,A={show:!1,url:""},M=!1,H=!1,P="",D=!0;if(m&&m.objects){var _=m.objects;P=e.DataViewObjects.getFillColor(_,t.columnChartProps.dataPoint.defaultColor),D=e.DataViewObjects.getValue(_,t.columnChartProps.dataPoint.showAllDataPoints);var L=_.categoryLabels;L&&(R.show=void 0!==L.show?L.show:R.show,R.fontSize=void 0!==L.fontSize?L.fontSize:R.fontSize,void 0!==L.color&&(R.labelColor=L.color.solid.color)),C=e.DataViewObjects.getValue(_,t.scatterChartProps.fillPoint.show,C);var N=_.backdrop;void 0!==N&&(A.show=N.show,A.show&&(A.url=N.url));var V=_.crosshair;void 0!==V&&(M=V.show);var z=_.outline;void 0!==z&&(H=z.show)}var I=i.createDataPoints(f,E,g,l,c,u,h,r,y,R,P,p);o&&o.applySelectionStateToData(I);var F=y?i.createSeriesLegend(f,r,f,t.valueFormatter.getFormatString(x,t.scatterChartProps.general.formatString),P):[],O=f&&x?x.displayName:"";O||(O=g&&g[b]&&g[b].source&&g[b].source.displayName?g[b].source.displayName:"");var k={title:O,dataPoints:F},j=i.getSizeRangeForGroups(v,E.idx.size);if(n&&null!==n.showAxisTitle&&n.showAxisTitle===!1&&(E.axesLabels.x=null),s&&null!==s.showAxisTitle&&s.showAxisTitle===!1&&(E.axesLabels.y=null),I&&I[0]){var B=I[0];null!=B.backdrop&&(A.show=!0,A.url=B.backdrop),null!=B.xStart&&(n.start=B.xStart),null!=B.xEnd&&(n.end=B.xEnd),null!=B.yStart&&(s.start=B.yStart),null!=B.yEnd&&(s.end=B.yEnd)}return{xCol:E.cols.x,yCol:E.cols.y,dataPoints:I,legendData:k,axesLabels:E.axesLabels,selectedIds:[],size:E.cols.size,sizeRange:j,dataLabelsSettings:R,defaultDataPointColor:P,hasDynamicSeries:y,showAllDataPoints:D,fillPoint:C,useShape:T,useCustomColor:w,backdrop:A,crosshair:M,outline:H}},i.createSeriesLegend=function(e,i,a,r,o){for(var n=e.grouped(),s=new t.ColorHelper(i,t.scatterChartProps.dataPoint.fill,o),l=[],c=0,h=n.length;h>c;c++){var u=n[c],p=s.getColorForSeriesValue(u.objects,e.identityFields,u.name);l.push({color:p,icon:t.LegendIcon.Circle,label:t.valueFormatter.format(u.name,r),identity:u.identity?t.SelectionId.createWithId(u.identity):t.SelectionId.createNull(),selected:!1})}return l},i.getSizeRangeForGroups=function(e,i){var a={};return e&&e.forEach(function(e){var r=t.ScatterChart.getMeasureValue(i,e.values),o=t.AxisHelper.getRangeForColumn(r);(null==a.min||a.min>o.min)&&(a.min=o.min),(null==a.max||a.max<o.max)&&(a.max=o.max)}),a},i.getMetadata=function(e,t,a){var r,o,n,c=s(e,i.ColumnCategory),h=s(e,i.ColumnColorFill),u=s(e,i.ColumnImage),p=s(e,i.ColumnBackdrop),d=l(t,i.ColumnX),m=l(t,i.ColumnY),g=l(t,i.ColumnSize),f=l(t,i.ColumnShape),y=l(t,i.ColumnRotation),v=l(t,i.ColumnXStart),x=l(t,i.ColumnXEnd),E=l(t,i.ColumnYStart),b=l(t,i.ColumnYEnd),T="",w="";if(t&&t.length){var S=t[0];d>=0&&(r=S.values[d].source,T=S.values[d].source.displayName),m>=0&&(o=S.values[m].source,w=S.values[m].source.displayName),g>=0&&(n=S.values[g].source)}return{idx:{category:c,x:d,y:m,size:g,colorFill:h,shape:f,image:u,rotation:y,backdrop:p,xStart:v,xEnd:x,yStart:E,yEnd:b},cols:{x:r,y:o,size:n},axesLabels:{x:T,y:w}}},i.createLazyFormattedCategory=function(e,t){return new n(function(){return e.format(t)})},i.createDataPoints=function(e,a,o,n,s,l,c,h,u,p,d,m){for(var g=[],f=a.idx,y=t.scatterChartProps.general.formatString,v=e.source,x=e.grouped(),E=r.fromPoint(p.fontSize),b=new t.ColorHelper(h,t.scatterChartProps.dataPoint.fill,d),T=0,w=n.length;w>T;T++)for(var S=n[T],R=0,C=x.length;C>R;R++){var A=o[f.colorFill],M=o[f.image],H=o[f.backdrop],P=x[R],D=P.values,_=t.ScatterChart.getMeasureValue(f.x,D),L=t.ScatterChart.getMeasureValue(f.y,D),N=t.ScatterChart.getMeasureValue(f.size,D),V=t.ScatterChart.getMeasureValue(f.shape,D),z=t.ScatterChart.getMeasureValue(f.rotation,D),I=t.ScatterChart.getMeasureValue(f.xStart,D),F=t.ScatterChart.getMeasureValue(f.xEnd,D),O=t.ScatterChart.getMeasureValue(f.yStart,D),k=t.ScatterChart.getMeasureValue(f.yEnd,D),j=_&&_.values&&!isNaN(_.values[T])?_.values[T]:null,B=L&&L.values&&!isNaN(L.values[T])?L.values[T]:0,G=null==j||null==B;if(!G){var U,W,X,Y,K,q,Z,Q,J,$,ee;if(U=i.getValueFromDataViewValueColumnById(N,T),W=i.getValueFromDataViewValueColumnById(A,T),X=i.getCustomSymbolType(i.getValueFromDataViewValueColumnById(V,T)),Y=i.getValueFromDataViewValueColumnById(M,T),K=i.getNumberFromDataViewValueColumnById(z,T),q=i.getValueFromDataViewValueColumnById(H,T),Z=i.getValueFromDataViewValueColumnById(I,T),Q=i.getValueFromDataViewValueColumnById(F,T),J=i.getValueFromDataViewValueColumnById(O,T),$=i.getValueFromDataViewValueColumnById(k,T),u)ee=b.getColorForSeriesValue(P.objects,e.identityFields,P.name);else{var te=null!=N?N.source.queryName:"";ee=b.getColorForMeasure(c&&c[T],te)}var ie=o&&o.length>0?o[f.category]:null,ae=t.SelectionIdBuilder.builder().withCategory(ie,T).withSeries(e,P).createSelectionId(),re=[];v&&re.push({value:P.name,metadata:{source:v,values:[]}}),_&&re.push({value:j,metadata:_}),L&&re.push({value:B,metadata:L}),N&&N.values&&N.values.length>0&&re.push({value:N.values[T],metadata:N}),A&&A.values&&A.values.length>0&&re.push({value:A.values[T],metadata:A}),V&&V.values&&V.values.length>0&&re.push({value:V.values[T],metadata:V}),M&&M.values&&M.values.length>0&&re.push({value:M.values[T],metadata:M}),z&&z.values&&z.values.length>0&&re.push({value:z.values[T],metadata:z}),H&&H.values&&H.values.length>0&&re.push({value:H.values[T],metadata:H}),I&&I.values&&I.values.length>0&&re.push({value:I.values[T],metadata:I}),F&&F.values&&F.values.length>0&&re.push({value:F.values[T],metadata:F}),O&&O.values&&O.values.length>0&&re.push({value:O.values[T],metadata:O}),k&&k.values&&k.values.length>0&&re.push({value:k.values[T],metadata:k});var oe=t.TooltipBuilder.createTooltipInfo(y,void 0,S,null,ie?[ie]:void 0,re,void 0),ne={x:j,y:B,size:U,radius:{sizeMeasure:N,index:T},fill:ee,formattedCategory:this.createLazyFormattedCategory(s,S),selected:!1,identity:ae,tooltipInfo:oe,labelFill:p.labelColor,labelFontSize:E,contentPosition:8,colorFill:W,shapeSymbolType:X,svgurl:Y,rotation:K,backdrop:q,xStart:Z,xEnd:Q,yStart:J,yEnd:$};g.push(ne)}}return g},i.getNumberFromDataViewValueColumnById=function(e,t){var a=i.getValueFromDataViewValueColumnById(e,t);return a&&!isNaN(a)?a:0},i.getValueFromDataViewValueColumnById=function(e,t){return e&&e.values?e.values[t]:null},i.getDefaultData=function(){return{xCol:void 0,yCol:void 0,dataPoints:[],legendData:{dataPoints:[]},axesLabels:{x:"",y:""},selectedIds:[],sizeRange:[],dataLabelsSettings:t.dataLabelUtils.getDefaultPointLabelSettings(),defaultDataPointColor:null,hasDynamicSeries:!1,useShape:!1,useCustomColor:!1}},i.prototype.setData=function(e){if(this.data=i.getDefaultData(),e&&e.length>0){var t=e[0];t&&(this.categoryAxisProperties=this.getCategoryAxisProperties(t.metadata,!0),this.valueAxisProperties=this.getValueAxisProperties(t.metadata,!0),this.dataView=t,t.categorical&&t.categorical.values&&(this.data=i.converter(t,this.colors,this.interactivityService,this.categoryAxisProperties,this.valueAxisProperties)))}},i.prototype.update=function(e){var i=this.dataViews=e.dataViews;if(this.viewport=_.clone(e.viewport),i){if(i&&i.length>0){var a=t.getInvalidValueWarnings(i,!1,!1,!1);a&&a.length>0&&this.hostServices.setWarnings(a),this.populateObjectProperties(i)}this.setData(i),this.options.interactivity&&this.options.interactivity.isInteractiveLegend||this.renderLegend(),this.render(e.suppressAnimations)}},i.prototype.populateObjectProperties=function(i){if(i&&i.length>0){var a=i[0].metadata;a?this.legendObjectProperties=e.DataViewObjects.getObject(a.objects,"legend",{}):this.legendObjectProperties={},this.categoryAxisProperties=this.getCategoryAxisProperties(a),this.valueAxisProperties=this.getValueAxisProperties(a);var r=this.valueAxisProperties.position;this.yAxisOrientation=r?r.toString():t.yAxisPosition.left}},i.prototype.renderLegend=function(){var e={title:"",dataPoints:[]},a=this.legend;this.layerLegendData=this.data.legendData,this.layerLegendData&&(e.title=this.layerLegendData.title||"",e.dataPoints=e.dataPoints.concat(this.layerLegendData.dataPoints||[]),e.fontSize=this.legendLabelFontSize?this.legendLabelFontSize:i.LegendLabelFontSizeDefault,this.layerLegendData.grouped&&(e.grouped=!0));var r=this.legendObjectProperties;if(r){t.LegendData.update(e,r);var o=r[t.legendProps.position];o&&a.changeOrientation(t.LegendPosition[o])}else a.changeOrientation(t.LegendPosition.Top);(1===e.dataPoints.length&&!e.grouped||this.hideLegends())&&(e.dataPoints=[]);var n=this.viewport;a.drawLegend(e,{height:n.height,width:n.width}),t.Legend.positionChartArea(this.svg,a)},i.prototype.hideLegends=function(){return!!(this.cartesianSmallViewPortProperties&&this.cartesianSmallViewPortProperties.hideLegendOnSmallViewPort&&this.viewport.height<this.cartesianSmallViewPortProperties.MinHeightLegendVisible)},i.prototype.shouldRenderAxis=function(e,t){return void 0===t&&(t="show"),e?(!e.isCategoryAxis||this.categoryAxisProperties&&null!=this.categoryAxisProperties[t]&&!this.categoryAxisProperties[t])&&(e.isCategoryAxis||this.valueAxisProperties&&null!=this.valueAxisProperties[t]&&!this.valueAxisProperties[t])?!1:e.values&&e.values.length>0:!1},i.prototype.getMaxMarginFactor=function(){return this.options.style.maxMarginFactor||.25},i.prototype.adjustViewportbyBackdrop=function(){var e=new Image,t=this;if(e.src=this.data.backdrop.url,e.onload=function(){t.oldBackdrop!==this.src&&(t.render(!0),t.oldBackdrop=this.src)},e.width>0&&e.height>0)if(e.width*this.viewportIn.height<this.viewportIn.width*e.height){var i=this.viewportIn.width-this.viewportIn.height*e.width/e.height;this.viewport={width:this.viewport.width-i,height:this.viewport.height}}else{var a=this.viewportIn.height-this.viewportIn.width*e.height/e.width;this.viewport={width:this.viewport.width,height:this.viewport.height-a}}},i.prototype.render=function(a){if(this.viewport.height-=this.legendViewport.height,this.viewport.width-=this.legendViewport.width,0!==this.viewportIn.width&&0!==this.viewportIn.height){var r=this.getMaxMarginFactor();this.leftRightMarginLimit=this.viewport.width*r;var o=this.bottomMarginLimit=Math.max(25,Math.ceil(this.viewport.height*r));this.margin.top=8,this.margin.bottom=o,this.margin.right=0,this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,this.textProperties,!0),this.yAxisIsCategorical=this.yAxisProperties.isCategoryAxis,this.hasCategoryAxis=this.yAxisIsCategorical?this.yAxisProperties&&this.yAxisProperties.values.length>0:this.xAxisProperties&&this.xAxisProperties.values.length>0;var n,s=this.shouldRenderAxis(this.xAxisProperties),l=this.shouldRenderAxis(this.yAxisProperties);this.isXScrollBarVisible=!1,this.isYScrollBarVisible=!1;var c,h,u,p=this.yAxisOrientation,d=p===t.yAxisPosition.right;this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,this.textProperties,!0);for(var m=!1,g=2,f=0;!m&&g>f;){f++,c=t.AxisHelper.getTickLabelMargins({width:this.viewportIn.width,
height:this.viewport.height},this.leftRightMarginLimit,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.measureSvgTextHeight,{x:this.xAxisProperties,y1:this.yAxisProperties},this.bottomMarginLimit,this.textProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,d,s,l,!1);var y=d?c.yRight:c.yLeft,v=d?c.yLeft:c.yRight,x=c.xMax;y+=10,v+=10,x+=12,d&&l&&(v+=20),!d&&l&&(y+=20),this.hideAxisLabels()&&(this.xAxisProperties.axisLabel=null,this.yAxisProperties.axisLabel=null),this.addUnitTypeToAxisLabel(this.xAxisProperties,this.yAxisProperties),h={x:this.xAxisProperties.axisLabel,y:this.yAxisProperties.axisLabel,y2:null},u=null!=h.x||null!=h.y||null!=h.y2,null!=h.x&&(x+=18),null!=h.y&&(y+=20),null!=h.y2&&(v+=20),this.margin.left=d?v:y,this.margin.right=d?y:v,this.margin.bottom=x;var E=this.yAxisProperties.values.length;this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,this.textProperties,!0),this.yAxisProperties.values.length===E&&(m=!0)}if(this.data.backdrop&&this.data.backdrop.show&&void 0!==this.data.backdrop.url)for(this.adjustViewportbyBackdrop(),m=!1,g=2,f=0;!m&&g>f;){f++,c=t.AxisHelper.getTickLabelMargins({width:this.viewportIn.width,height:this.viewport.height},this.leftRightMarginLimit,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.measureSvgTextHeight,{x:this.xAxisProperties,y1:this.yAxisProperties},this.bottomMarginLimit,this.textProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,d,s,l,!1);var y=d?c.yRight:c.yLeft,v=d?c.yLeft:c.yRight,x=c.xMax;y+=10,d&&l&&(v+=15),x+=12,this.hideAxisLabels()&&(this.xAxisProperties.axisLabel=null,this.yAxisProperties.axisLabel=null),this.addUnitTypeToAxisLabel(this.xAxisProperties,this.yAxisProperties),h={x:this.xAxisProperties.axisLabel,y:this.yAxisProperties.axisLabel,y2:null},u=null!=h.x||null!=h.y||null!=h.y2,null!=h.x&&(x+=18),null!=h.y&&(y+=20),null!=h.y2&&(v+=20),this.margin.left=d?v:y,this.margin.right=d?y:v,this.margin.bottom=x;var E=this.yAxisProperties.values.length;this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,this.textProperties,!0),this.yAxisProperties.values.length===E&&(m=!0)}if(this.renderChart(n,this.xAxisProperties,this.yAxisProperties,c,u,h,a),this.updateAxis(),this.data){var b=this.data,T=this.data.dataPoints,w=this.interactivityService&&this.interactivityService.hasSelection();this.mainGraphicsSVGSelection.attr("width",this.viewportIn.width).attr("height",this.viewportIn.height);var S=T.sort(function(e,t){return t.radius.sizeMeasure?t.radius.sizeMeasure.values[t.radius.index]-e.radius.sizeMeasure.values[e.radius.index]:0}),R=t.AnimatorCommon.GetAnimationDuration(this.animator,a),C=this.drawScatterMarkers(S,w,b.sizeRange,R),A=this.data.dataLabelsSettings;if(A.show){var M,H,P;M=this.getEnhanchedScatterChartLabelLayout(A,this.viewportIn,b.sizeRange),H=this.cloneDataPoints(T),P=t.dataLabelUtils.drawDefaultLabelsForDataPointChart(H,this.mainGraphicsG,M,this.viewportIn),P&&P.attr("transform",function(e){var a,r,o=e.size;return a=o.width/i.DataLabelXOffset,r=o.height/i.DataLabelYOffset,t.SVGUtil.translate(a,r)})}else t.dataLabelUtils.cleanDataLabels(this.mainGraphicsG);this.renderCrosshair();var D;if(this.interactivityService&&(D={dataPointsSelection:C,data:this.data,plotContext:this.mainGraphicsSVGSelection}),t.TooltipManager.addTooltip(C,function(e){return e.data.tooltipInfo}),t.SVGUtil.flushAllD3TransitionsIfNeeded(this.options),this.behavior){var _=[];if(_.push(D),this.interactivityService){var L={layerOptions:_,clearCatcher:this.clearCatcher};this.interactivityService.bind(T,this.behavior,L)}}}}},i.prototype.cloneDataPoints=function(e){return e.map(function(e){return _.clone(e)})},i.prototype.darkenZeroLine=function(e){var t=e.selectAll("g.tick").filter(function(e){return 0===e}).node();t&&d3.select(t).select("line").classed("zero-line",!0)},i.prototype.getCategoryAxisFill=function(){if(this.dataView&&this.dataView.metadata.objects){var e=this.dataView.metadata.objects.categoryAxis;if(e)return e.axisColor}return{solid:{color:"#333"}}},i.prototype.getEnhanchedScatterChartLabelLayout=function(e,i,a){var o=this.xAxisProperties.scale,n=this.yAxisProperties.scale,s=r.fromPoint(e.fontSize),l=t.dataLabelUtils.LabelTextProperties.fontFamily;return{labelText:function(a){return t.dataLabelUtils.getLabelFormattedText({label:a.formattedCategory.getValue(),fontSize:e.fontSize,maxWidth:i.width})},labelLayout:{x:function(e){return o(e.x)},y:function(r){var o=t.ScatterChart.getBubbleRadius(r.radius,a,i)+t.dataLabelUtils.labelMargin;return 0===e.position?n(r.y)-o:n(r.y)+o}},filter:function(e){return null!=e&&null!=e.formattedCategory.getValue()},style:{fill:function(e){return e.labelFill},"font-size":s,"font-family":l}}},i.prototype.getValueAxisFill=function(){if(this.dataView&&this.dataView.metadata.objects){var e=this.dataView.metadata.objects.valueAxis;if(e)return e.axisColor}return{solid:{color:"#333"}}},i.prototype.renderCrosshair=function(){return this.mainGraphicsSVGSelection?(this.crosshairCanvasSelection=this.addCrosshairCanvasToDOM(this.mainGraphicsSVGSelection),this.data&&this.data.crosshair&&(this.crosshairVerticalLineSelection=this.addCrosshairLineToDOM(this.crosshairCanvasSelection,i.CrosshairVerticalLineSelector),this.crosshairHorizontalLineSelection=this.addCrosshairLineToDOM(this.crosshairCanvasSelection,i.CrosshairHorizontalLineSelector),this.crosshairTextSelection=this.addCrosshairTextToDOM(this.crosshairCanvasSelection),this.bindCrosshairEvents()),this.crosshairCanvasSelection):void 0},i.prototype.addCrosshairCanvasToDOM=function(e){var t=i.CrosshairCanvasSelector;return this.addElementToDOM(e,{name:"g",selector:t.selector,className:t["class"],styles:{display:"none"}})},i.prototype.addCrosshairLineToDOM=function(e,t){var a=i.CrosshairLineSelector;return this.addElementToDOM(e,{name:"line",selector:t.selector,className:a["class"]+" "+t["class"],attributes:{x1:0,y1:0,x2:0,y2:0}})},i.prototype.addCrosshairTextToDOM=function(e){var t=i.CrosshairTextSelector;return this.addElementToDOM(e,{name:"text",selector:t.selector,className:t["class"]})},i.prototype.bindCrosshairEvents=function(){var t=this;this.axisGraphicsContextScrollable&&this.axisGraphicsContextScrollable.on("mousemove",function(){var i=d3.event.currentTarget,a=d3.mouse(i),r=i.viewportElement,o=r.getBoundingClientRect(),n=r.getBBox(),s=o.width/n.width,l=o.height/n.height,c=a[0],h=a[1];n.width>0&&!e.Double.equalWithPrecision(s,1,1e-5)&&(c/=s),n.height>0&&!e.Double.equalWithPrecision(l,1,1e-5)&&(h/=l),t.updateCrosshair(c,h)}).on("mouseover",function(){t.crosshairCanvasSelection.style("display","block")}).on("mouseout",function(){t.crosshairCanvasSelection.style("display","none")})},i.prototype.updateCrosshair=function(e,t){if(this.viewportIn&&this.crosshairHorizontalLineSelection&&this.crosshairVerticalLineSelection&&this.crosshairTextSelection&&this.xAxisProperties){var a,r,o=i.CrosshairTextMargin,n=this.xAxisProperties.scale,s=this.yAxisProperties.scale;this.crosshairHorizontalLineSelection.attr({x1:0,y1:t,x2:this.viewportIn.width,y2:t}),this.crosshairVerticalLineSelection.attr({x1:e,y1:0,x2:e,y2:this.viewportIn.height}),a=Math.round(100*n.invert(e))/100,r=Math.round(100*s.invert(t))/100,this.crosshairTextSelection.attr({x:e+o,y:t-o}).text("("+a+", "+r+")")}},i.prototype.addElementToDOM=function(e,t){if(!e||!t)return null;var i,a;return i=e.selectAll(t.selector),a=i.data(t.data||[[]]),a.enter().append(t.name).attr(t.attributes).style(t.styles).classed(t.className,!0),a.exit().remove(),a},i.prototype.renderBackground=function(){this.data.backdrop&&this.data.backdrop.show&&void 0!==this.data.backdrop.url?this.backgroundGraphicsContext.attr("xlink:href",this.data.backdrop.url).attr("x",0).attr("y",0).attr("width",this.viewportIn.width).attr("height",this.viewportIn.height):this.backgroundGraphicsContext.attr("width",0).attr("height",0)},i.prototype.renderChart=function(i,a,r,o,n,s,l,c,h){var u=this.bottomMarginLimit,p=this.leftRightMarginLimit,d=t.AnimatorCommon.GetAnimationDuration(this.animator,l);if(this.renderBackground(),this.shouldRenderAxis(a)){a.axis.orient("bottom"),a.willLabelsFit||a.axis.tickPadding(5);var m=this.xAxisGraphicsContext;d?m.transition().duration(d).call(a.axis).call(this.darkenZeroLine):m.call(a.axis).call(this.darkenZeroLine);var g=m.selectAll("g.tick").filter(function(e){return 0===e});if(g){var f=this.getValueAxisFill();f&&g.selectAll("line").style({stroke:f.solid.color})}var y=m.selectAll("text");a.willLabelsWordBreak?y.call(t.AxisHelper.LabelLayoutStrategy.wordBreak,a,u):y.call(t.AxisHelper.LabelLayoutStrategy.rotate,u,e.TextMeasurementService.getTailoredTextOrDefault,t.CartesianChart.AxisTextProperties,!a.willLabelsFit,u===o.xMax,a,this.margin,this.isXScrollBarVisible||this.isYScrollBarVisible)}else this.xAxisGraphicsContext.selectAll("*").remove();if(this.shouldRenderAxis(r)){var v=this.yAxisOrientation;r.axis.tickSize(-this.viewportIn.width).tickPadding(10).orient(v.toLowerCase());var x=this.y1AxisGraphicsContext;d?x.transition().duration(d).call(r.axis).call(this.darkenZeroLine):x.call(r.axis).call(this.darkenZeroLine);var E=x.selectAll("g.tick").filter(function(e){return 0===e});if(E){var b=this.getCategoryAxisFill();b&&E.selectAll("line").style({stroke:b.solid.color})}o.yLeft>=p&&x.selectAll("text").call(t.AxisHelper.LabelLayoutStrategy.clip,p-10,e.TextMeasurementService.svgEllipsis)}else this.y1AxisGraphicsContext.selectAll("*").remove();if(n){var T=!this.shouldRenderAxis(a,"showAxisTitle"),w=!this.shouldRenderAxis(r,"showAxisTitle"),S=this.valueAxisProperties&&null!=this.valueAxisProperties.secShowAxisTitle&&this.valueAxisProperties.secShowAxisTitle===!1;this.renderAxesLabels(s,this.legendViewport.height,T,w,S)}else this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove()},i.prototype.renderAxesLabels=function(a,r,o,n,s){this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove();var l=this.margin,c=this.viewportIn.width,h=this.viewport.height,u=i.AxisFontSize,p=this.yAxisOrientation,d=p===t.yAxisPosition.right;if(!o){var m=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(a.x).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"xAxisLabel",transform:t.SVGUtil.translate(c/2,h-u-2)})})});m.call(t.AxisHelper.LabelLayoutStrategy.clip,c,e.TextMeasurementService.svgEllipsis)}if(!n){var g=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(a.y).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"yAxisLabel",transform:"rotate(-90)",y:d?c+l.right-u:-l.left,x:-((h-l.top-r)/2),dy:"1em"})})});g.call(t.AxisHelper.LabelLayoutStrategy.clip,h-(l.bottom+l.top),e.TextMeasurementService.svgEllipsis)}if(!s&&a.y2){var f=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(a.y2).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"yAxisLabel",transform:"rotate(-90)",y:d?-l.left:c+l.right-u,x:-((h-l.top-r)/2),dy:"1em"})})});f.call(t.AxisHelper.LabelLayoutStrategy.clip,h-(l.bottom+l.top),e.TextMeasurementService.svgEllipsis)}},i.prototype.updateAxis=function(){this.adjustMargins();var e=this.yAxisOrientation,i=e===t.yAxisPosition.right;this.xAxisGraphicsContext.attr("transform",t.SVGUtil.translate(0,this.viewportIn.height)),this.y1AxisGraphicsContext.attr("transform",t.SVGUtil.translate(i?this.viewportIn.width:0,0)),this.svg.attr({width:this.viewport.width,height:this.viewport.height}),this.svgScrollable.attr({width:this.viewport.width,height:this.viewport.height}),this.svgScrollable.attr({x:0});var a=this.margin.left,r=this.margin.top;this.axisGraphicsContext.attr("transform",t.SVGUtil.translate(a,r)),this.axisGraphicsContextScrollable.attr("transform",t.SVGUtil.translate(a,r)),this.clearCatcher.attr("transform",t.SVGUtil.translate(-a,-r)),this.isXScrollBarVisible?(this.svgScrollable.attr({x:a}),this.axisGraphicsContextScrollable.attr("transform",t.SVGUtil.translate(0,r)),this.svgScrollable.attr("width",this.viewportIn.width),this.svg.attr("width",this.viewport.width).attr("height",this.viewport.height+this.ScrollBarWidth)):this.isYScrollBarVisible&&(this.svgScrollable.attr("height",this.viewportIn.height+r),this.svg.attr("width",this.viewport.width+this.ScrollBarWidth).attr("height",this.viewport.height))},i.prototype.getUnitType=function(e){return e.formatter&&e.formatter.displayUnit&&e.formatter.displayUnit.value>1?e.formatter.displayUnit.title:null},i.prototype.addUnitTypeToAxisLabel=function(e,i){var a=this.getUnitType(e);e.isCategoryAxis?this.categoryAxisHasUnitType=null!==a:this.valueAxisHasUnitType=null!==a,e.axisLabel&&a&&(e.isCategoryAxis?e.axisLabel=t.AxisHelper.createAxisLabel(this.categoryAxisProperties,e.axisLabel,a):e.axisLabel=t.AxisHelper.createAxisLabel(this.valueAxisProperties,e.axisLabel,a)),a=this.getUnitType(i),i.isCategoryAxis?this.categoryAxisHasUnitType=null!==a:this.valueAxisHasUnitType=null!==a,i.axisLabel&&a&&(i.isCategoryAxis?i.axisLabel=t.AxisHelper.createAxisLabel(this.categoryAxisProperties,i.axisLabel,a):i.axisLabel=t.AxisHelper.createAxisLabel(this.valueAxisProperties,i.axisLabel,a))},i.prototype.hideAxisLabels=function(){return!(!(this.cartesianSmallViewPortProperties&&this.cartesianSmallViewPortProperties.hideAxesOnSmallViewPort&&this.viewport.height+this.legendViewport.height<this.cartesianSmallViewPortProperties.MinHeightAxesVisible)||this.options.interactivity.isInteractiveLegend)},i.prototype.drawScatterMarkers=function(e,a,r,o){var n,s=this,l=this.xAxisProperties.scale,c=this.yAxisProperties.scale,h=(!r||!r.min)&&this.data.fillPoint,u=this.data.useCustomColor;this.data.useShape?(this.mainGraphicsContext.selectAll(i.DotClasses.selector).remove(),n=this.mainGraphicsContext.classed("ScatterMarkers",!0).selectAll(i.ImageClasses.selector).data(e,function(e){return e.identity.getKey()}),n.enter().append("svg:image").classed(i.ImageClasses["class"],!0).attr("id","markerimage"),n.attr("xlink:href",function(e){return void 0!==e.svgurl&&null!=e.svgurl&&""!==e.svgurl?e.svgurl:s.svgDefaultImage}).attr("width",function(e){return 2*t.ScatterChart.getBubbleRadius(e.radius,r,s.viewport)}).attr("height",function(e){return 2*t.ScatterChart.getBubbleRadius(e.radius,r,s.viewport)}).transition().duration(function(e){return s.keyArray.indexOf(e.identity.getKey())>=0?o:0}).attr("transform",function(e){var i=t.ScatterChart.getBubbleRadius(e.radius,r,s.viewport);return"translate("+(l(e.x)-i)+","+(c(e.y)-i)+") rotate("+e.rotation+","+i+","+i+")"})):(this.mainGraphicsContext.selectAll(i.ImageClasses.selector).remove(),n=this.mainGraphicsContext.classed("ScatterMarkers",!0).selectAll(i.DotClasses.selector).data(e,function(e){return e.identity.getKey()}),n.enter().append("path").classed(i.DotClasses["class"],!0).attr("id","markershape"),n.style({"stroke-opacity":function(e){return t.ScatterChart.getBubbleOpacity(e,a)},"stroke-width":"1px",stroke:function(e){var t=u?e.colorFill:e.fill;return s.data.outline?d3.rgb(t).darker():d3.rgb(t)},fill:function(e){return d3.rgb(u?e.colorFill:e.fill)},"fill-opacity":function(e){return null!=e.size||h?t.ScatterChart.getBubbleOpacity(e,a):0}}).attr("d",function(e){var i=t.ScatterChart.getBubbleRadius(e.radius,r,s.viewport),a=4*i*i;return e.shapeSymbolType(a)}).transition().duration(function(e){return s.keyArray.indexOf(e.identity.getKey())>=0?o:0}).attr("transform",function(e){return"translate("+l(e.x)+","+c(e.y)+") rotate("+e.rotation+")"})),n.exit().remove(),this.keyArray=[];for(var p=0;p<e.length;p++)this.keyArray.push(e[p].identity.getKey());return n},i.prototype.calculateAxes=function(a,r,o,n){var s={viewport:this.viewport,margin:this.margin,forcedXDomain:[a?a.start:null,a?a.end:null],forceMerge:r&&r.secShow===!1,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:a&&null!=a.axisScale?a.axisScale:null,valueAxisScaleType:r&&null!=r.axisScale?r.axisScale:null,valueAxisDisplayUnits:r&&null!=r.labelDisplayUnits?r.labelDisplayUnits:i.LabelDisplayUnitsDefault,categoryAxisDisplayUnits:a&&null!=a.labelDisplayUnits?a.labelDisplayUnits:i.LabelDisplayUnitsDefault,trimOrdinalDataOnOverflow:!1};r&&(s.forcedYDomain=t.AxisHelper.applyCustomizedDomain([r.start,r.end],s.forcedYDomain)),s.showCategoryAxisLabel=!!a&&!!a.showAxisTitle,s.showValueAxisLabel=!0;var l=this.viewport.width-(this.margin.left+this.margin.right),c=this.calculateAxesProperties(s);return c[0].willLabelsFit=t.AxisHelper.LabelLayoutStrategy.willLabelsFit(c[0],l,e.TextMeasurementService.measureSvgTextWidth,o),c[0].willLabelsWordBreak=!c[0].willLabelsFit&&!n&&t.AxisHelper.LabelLayoutStrategy.willLabelsWordBreak(c[0],this.margin,l,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.estimateSvgTextHeight,e.TextMeasurementService.getTailoredTextOrDefault,o),c},i.prototype.calculateAxesProperties=function(e){var i=this.data,a=i.dataPoints;this.margin=e.margin,this.viewport=e.viewport;var r=0,o=10,n=0,s=10;a.length>0&&(r=d3.min(a,function(e){return e.y}),o=d3.max(a,function(e){return e.y}),n=d3.min(a,function(e){return e.x}),s=d3.max(a,function(e){return e.x}));var l,c,h=[n,s];return l=t.AxisHelper.combineDomain(this.optimizeTranslateValues(e.forcedXDomain),h),this.xAxisProperties=t.AxisHelper.createAxis({pixelSpan:this.viewportIn.width,dataDomain:l,metaDataColumn:i.xCol,formatString:t.valueFormatter.getFormatString(i.xCol,t.scatterChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!1,forcedTickCount:e.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,scaleType:e.categoryAxisScaleType,axisDisplayUnits:e.categoryAxisDisplayUnits}),this.xAxisProperties.axis.tickSize(-this.viewportIn.height,0),this.xAxisProperties.axisLabel=this.data.axesLabels.x,c=t.AxisHelper.combineDomain(this.optimizeTranslateValues(e.forcedYDomain),[r,o]),this.yAxisProperties=t.AxisHelper.createAxis({pixelSpan:this.viewportIn.height,dataDomain:c,metaDataColumn:i.yCol,formatString:t.valueFormatter.getFormatString(i.yCol,t.scatterChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:e.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:e.valueAxisScaleType,axisDisplayUnits:e.valueAxisDisplayUnits}),this.yAxisProperties.axisLabel=this.data.axesLabels.y,[this.xAxisProperties,this.yAxisProperties]},i.prototype.optimizeTranslateValues=function(e){var t=this;return e&&e.map?e.map(function(e){return t.optimizeTranslateValue(e)}):e},i.prototype.optimizeTranslateValue=function(e){if(e){var t=e>=0?1:-1,a=Math.abs(e);if(a>i.MaxTranslateValue)return i.MaxTranslateValue*t;if(a<i.MinTranslateValue)return i.MinTranslateValue*t}return e},i.prototype.enumerateDataPoints=function(e){var i=this.data;if(i){var a=i.dataPoints.length;if(i.hasDynamicSeries)for(var r=i.legendData.dataPoints.length,o=0;r>o;o++){var n=i.legendData.dataPoints[o];e.pushInstance({objectName:"dataPoint",displayName:n.label,selector:t.ColorHelper.normalizeSelector(n.identity.getSelector()),properties:{fill:{solid:{color:n.color}}}})}else{var s=i.showAllDataPoints;if(e.pushInstance({objectName:"dataPoint",selector:null,properties:{defaultColor:{solid:{color:i.defaultDataPointColor||this.colors.getColorByIndex(0).value}}}}).pushInstance({objectName:"dataPoint",selector:null,properties:{showAllDataPoints:s}}),s)for(var o=0;a>o;o++){var l=i.dataPoints[o];e.pushInstance({objectName:"dataPoint",displayName:l.formattedCategory.getValue(),selector:t.ColorHelper.normalizeSelector(l.identity.getSelector(),!0),properties:{fill:{solid:{color:l.fill}}}})}}}},i.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;switch(e.objectName){case"dataPoint":var a=this.dataView&&this.dataView.categorical?this.dataView.categorical:null;t.GradientUtils.hasGradientRole(a)||this.enumerateDataPoints(i);break;case"categoryAxis":this.getCategoryAxisValues(i);break;case"valueAxis":this.getValueAxisValues(i);break;case"categoryLabels":this.data?t.dataLabelUtils.enumerateCategoryLabels(i,this.data.dataLabelsSettings,!0):t.dataLabelUtils.enumerateCategoryLabels(i,null,!0);break;case"fillPoint":var r=this.data.sizeRange;if(r&&r.min)break;i.pushInstance({objectName:"fillPoint",selector:null,properties:{show:this.data.fillPoint}});break;case"backdrop":i.pushInstance({objectName:"backdrop",displayName:"Backdrop",selector:null,properties:{show:this.data.backdrop?this.data.backdrop.show:!1,url:this.data.backdrop?this.data.backdrop.url:null}});break;case"crosshair":i.pushInstance({objectName:"crosshair",selector:null,properties:{show:this.data.crosshair}});break;case"outline":i.pushInstance({objectName:"outline",selector:null,properties:{show:this.data.outline}});break;case"legend":this.getLegendValue(i)}return i.complete()},i.prototype.hasLegend=function(){return this.data&&this.data.hasDynamicSeries},i.prototype.getLegendValue=function(a){if(this.hasLegend()){var r=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.show,this.legend.isVisible()),o=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.showTitle,!0),n=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.titleText,this.layerLegendData?this.layerLegendData.title:""),s=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.labelColor,t.LegendData.DefaultLegendLabelFillColor);this.legendLabelFontSize=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.fontSize,i.LegendLabelFontSizeDefault),a.pushInstance({selector:null,properties:{show:r,position:t.LegendPosition[this.legend.getOrientation()],showTitle:o,titleText:n,labelColor:s,fontSize:this.legendLabelFontSize},objectName:"legend"})}},i.prototype.getCategoryAxisValues=function(e){var a=t.axisType.both,r=!0,o=!1,n=[t.axisScale.log,t.axisScale.linear];r||this.categoryAxisProperties&&(this.categoryAxisProperties.start=null,this.categoryAxisProperties.end=null);var s={selector:null,properties:{},objectName:"categoryAxis",validValues:{axisScale:n}};s.properties.show=this.categoryAxisProperties&&null!=this.categoryAxisProperties.show?this.categoryAxisProperties.show:!0,this.yAxisIsCategorical&&(s.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:t.yAxisPosition.left),a===t.axisType.both&&(s.properties.axisType=r?t.axisType.scalar:t.axisType.categorical),r&&(s.properties.axisScale=this.categoryAxisProperties&&null!=this.categoryAxisProperties.axisScale&&o?this.categoryAxisProperties.axisScale:t.axisScale.linear,s.properties.start=this.categoryAxisProperties?this.categoryAxisProperties.start:null,s.properties.end=this.categoryAxisProperties?this.categoryAxisProperties.end:null,s.properties.labelDisplayUnits=this.categoryAxisProperties&&null!=this.categoryAxisProperties.labelDisplayUnits?this.categoryAxisProperties.labelDisplayUnits:i.LabelDisplayUnitsDefault),s.properties.showAxisTitle=this.categoryAxisProperties&&null!=this.categoryAxisProperties.showAxisTitle?this.categoryAxisProperties.showAxisTitle:!0,e.pushInstance(s).pushInstance({selector:null,properties:{axisStyle:this.categoryAxisProperties&&this.categoryAxisProperties.axisStyle?this.categoryAxisProperties.axisStyle:t.axisStyle.showTitleOnly,labelColor:this.categoryAxisProperties?this.categoryAxisProperties.labelColor:null},objectName:"categoryAxis",validValues:{axisStyle:this.categoryAxisHasUnitType?[t.axisStyle.showTitleOnly,t.axisStyle.showUnitOnly,t.axisStyle.showBoth]:[t.axisStyle.showTitleOnly]}})},i.prototype.getValueAxisValues=function(e){var a=[t.axisScale.log,t.axisScale.linear],r=!1,o={selector:null,properties:{},objectName:"valueAxis",validValues:{axisScale:a,secAxisScale:a}};o.properties.show=this.valueAxisProperties&&null!=this.valueAxisProperties.show?this.valueAxisProperties.show:!0,this.yAxisIsCategorical||(o.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:t.yAxisPosition.left),o.properties.axisScale=this.valueAxisProperties&&null!=this.valueAxisProperties.axisScale&&r?this.valueAxisProperties.axisScale:t.axisScale.linear,o.properties.start=this.valueAxisProperties?this.valueAxisProperties.start:null,o.properties.end=this.valueAxisProperties?this.valueAxisProperties.end:null,o.properties.showAxisTitle=this.valueAxisProperties&&null!=this.valueAxisProperties.showAxisTitle?this.valueAxisProperties.showAxisTitle:!0,o.properties.labelDisplayUnits=this.valueAxisProperties&&null!=this.valueAxisProperties.labelDisplayUnits?this.valueAxisProperties.labelDisplayUnits:i.LabelDisplayUnitsDefault,e.pushInstance(o).pushInstance({selector:null,properties:{axisStyle:this.valueAxisProperties&&null!=this.valueAxisProperties.axisStyle?this.valueAxisProperties.axisStyle:t.axisStyle.showTitleOnly,labelColor:this.valueAxisProperties?this.valueAxisProperties.labelColor:null},objectName:"valueAxis",validValues:{axisStyle:this.valueAxisHasUnitType?[t.axisStyle.showTitleOnly,t.axisStyle.showUnitOnly,t.axisStyle.showBoth]:[t.axisStyle.showTitleOnly]}})},i.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},i.AxisGraphicsContextClassName="axisGraphicsContext",i.ClassName="enhancedScatterChart",i.MainGraphicsContextClassName="mainGraphicsContext",i.LegendLabelFontSizeDefault=9,i.LabelDisplayUnitsDefault=0,i.AxisFontSize=11,i.CrosshairTextMargin=5,i.DataLabelXOffset=2,i.DataLabelYOffset=1.8,i.DotClasses=o("dot"),i.ImageClasses=o("img"),i.CrosshairCanvasSelector=o("crosshairCanvas"),i.CrosshairLineSelector=o("crosshairLine"),i.CrosshairVerticalLineSelector=o("crosshairVerticalLine"),i.CrosshairHorizontalLineSelector=o("crosshairHorizontalLine"),i.CrosshairTextSelector=o("crosshairText"),i.MaxTranslateValue=1e25,i.MinTranslateValue=1e-25,i.DefaultBubbleOpacity=.85,i.DimmedBubbleOpacity=.4,i.ColumnCategory="Category",i.ColumnSeries="Series",i.ColumnX="X",i.ColumnY="Y",i.ColumnSize="Size",i.ColumnGradient="Gradient",i.ColumnColorFill="ColorFill",i.ColumnShape="Shape",i.ColumnImage="Image",i.ColumnRotation="Rotation",i.ColumnBackdrop="Backdrop",i.ColumnXStart="X Start",i.ColumnXEnd="X End",i.ColumnYStart="Y Start",i.ColumnYEnd="Y End",i.capabilities={dataRoles:[{name:i.ColumnCategory,kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Details")},{name:i.ColumnSeries,kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Legend")},{name:i.ColumnX,kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_X")},{name:i.ColumnY,kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Y")},{name:i.ColumnSize,kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Size")},{name:i.ColumnGradient,kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Gradient")},{name:i.ColumnColorFill,kind:e.VisualDataRoleKind.Grouping,displayName:"Customized Color"},{name:i.ColumnShape,kind:e.VisualDataRoleKind.Measure,displayName:"Shape"},{name:i.ColumnImage,kind:e.VisualDataRoleKind.Grouping,displayName:"Image"},{name:i.ColumnRotation,kind:e.VisualDataRoleKind.Measure,displayName:"Rotation"},{name:i.ColumnBackdrop,kind:e.VisualDataRoleKind.Grouping,displayName:"Backdrop"},{name:i.ColumnXStart,kind:e.VisualDataRoleKind.Measure,displayName:"X Start"},{name:i.ColumnXEnd,kind:e.VisualDataRoleKind.Measure,displayName:"X End"},{name:i.ColumnYStart,kind:e.VisualDataRoleKind.Measure,displayName:"Y Start"},{name:i.ColumnYEnd,kind:e.VisualDataRoleKind.Measure,displayName:"Y End"}],dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:1},X:{max:1},Y:{max:1},Size:{max:1},Gradient:{max:0},ColorFill:{max:1},Shape:{max:1},Image:{max:0},Rotation:{max:1},Backdrop:{max:1},"X Start":{max:1},"X End":{max:1},"Y Start":{max:1},"Y End":{max:1}},{Category:{max:1},Series:{max:0},X:{max:1},Y:{max:1},Size:{max:1},Gradient:{max:1},ColorFill:{max:1},Shape:{max:1},Image:{max:0},Rotation:{max:1},Backdrop:{max:1},"X Start":{max:1},"X End":{max:1},"Y Start":{max:1},"Y End":{max:1}},{Category:{max:1},Series:{max:1},X:{max:1},Y:{max:1},Size:{max:1},Gradient:{max:0},ColorFill:{max:0},Shape:{max:0},Image:{max:1},Rotation:{max:1},Backdrop:{max:1},"X Start":{max:1},"X End":{max:1},"Y Start":{max:1},"Y End":{max:1}},{Category:{max:1},Series:{max:0},X:{max:1},Y:{max:1},Size:{max:1},Gradient:{max:1},ColorFill:{max:0},Shape:{max:0},Image:{max:1},Rotation:{max:1},Backdrop:{max:1},"X Start":{max:1},"X End":{max:1},"Y Start":{max:1},"Y End":{max:1}}],categorical:{categories:{"for":{"in":i.ColumnCategory},dataReductionAlgorithm:{sample:{}}},values:{group:{by:i.ColumnSeries,select:[{bind:{to:i.ColumnX}},{bind:{to:i.ColumnY}},{bind:{to:i.ColumnSize}},{bind:{to:i.ColumnGradient}},{bind:{to:i.ColumnColorFill}},{bind:{to:i.ColumnShape}},{bind:{to:i.ColumnImage}},{bind:{to:i.ColumnRotation}},{bind:{to:i.ColumnBackdrop}},{bind:{to:i.ColumnXStart}},{bind:{to:i.ColumnXEnd}},{bind:{to:i.ColumnYStart}},{bind:{to:i.ColumnYEnd}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:2}}}}],objects:{dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),properties:{defaultColor:{displayName:e.data.createDisplayNameGetter("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint_Show_All"),type:{bool:!0}},useShape:{displayName:e.data.createDisplayNameGetter("Visual_UseImage"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fillRule:{displayName:e.data.createDisplayNameGetter("Visual_Gradient"),type:{fillRule:{}},rule:{inputRole:i.ColumnGradient,output:{property:"fill",selector:[i.ColumnCategory]}}}}},general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},categoryAxis:{displayName:e.data.createDisplayNameGetter("Visual_XAxis"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},axisScale:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Scale"),type:{formatting:{axisScale:!0}}},start:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Start"),type:{numeric:!0}},end:{displayName:e.data.createDisplayNameGetter("Visual_Axis_End"),type:{numeric:!0}},showAxisTitle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Title"),type:{bool:!0}},axisStyle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Style"),type:{formatting:{axisStyle:!0}}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}}}},valueAxis:{displayName:e.data.createDisplayNameGetter("Visual_YAxis"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_YAxis_Position"),type:{formatting:{yAxisPosition:!0}}},axisScale:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Scale"),type:{formatting:{axisScale:!0}}},start:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Start"),type:{numeric:!0}},end:{displayName:e.data.createDisplayNameGetter("Visual_Axis_End"),type:{numeric:!0}},showAxisTitle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Title"),type:{bool:!0}},axisStyle:{displayName:e.data.createDisplayNameGetter("Visual_Axis_Style"),type:{formatting:{axisStyle:!0}}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}}}},legend:{displayName:e.data.createDisplayNameGetter("Visual_Legend"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_LegendPosition"),
description:e.data.createDisplayNameGetter("Visual_LegendPositionDescription"),type:{enumeration:t.legendPosition.type}},showTitle:{displayName:e.data.createDisplayNameGetter("Visual_LegendShowTitle"),description:e.data.createDisplayNameGetter("Visual_LegendShowTitleDescription"),type:{bool:!0}},titleText:{displayName:"Legend Name",description:e.data.createDisplayNameGetter("Visual_LegendNameDescription"),type:{text:!0}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},categoryLabels:{displayName:e.data.createDisplayNameGetter("Visual_CategoryLabels"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},fillPoint:{displayName:e.data.createDisplayNameGetter("Visual_FillPoint"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{bool:!0}}}},backdrop:{displayName:"Backdrop",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},url:{displayName:"Image URL",type:{text:!0}}}},crosshair:{displayName:"Crosshair",properties:{show:{displayName:"Crosshair",type:{bool:!0}}}},outline:{displayName:"Outline",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Outline"),type:{bool:!0}}}}}},i}();i.EnhancedScatterChart=c}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){function i(){window.eval('THREE=THREE||{REVISION:"59"},self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\\s+|\\s+$/g,"")},THREE.extend=function(e,t){if(Object.keys)for(var r=Object.keys(t),i=0,o=r.length;o>i;i++){var n=r[i];Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}else{var a={}.hasOwnProperty;for(var n in t)a.call(t,n)&&(e[n]=t[n])}return e},function(){for(var e=0,t=["ms","moz","webkit","o"],r=0;r<t.length&&!self.requestAnimationFrame;++r)self.requestAnimationFrame=self[t[r]+"RequestAnimationFrame"],self.cancelAnimationFrame=self[t[r]+"CancelAnimationFrame"]||self[t[r]+"CancelRequestAnimationFrame"];void 0===self.requestAnimationFrame&&void 0!==self.setTimeout&&(self.requestAnimationFrame=function(t){var r=Date.now(),i=Math.max(0,16-(r-e)),o=self.setTimeout(function(){t(r+i)},i);return e=r+i,o}),void 0===self.cancelAnimationFrame&&void 0!==self.clearTimeout&&(self.cancelAnimationFrame=function(e){self.clearTimeout(e)})}(),THREE.CullFaceNone=0,THREE.CullFaceBack=1,THREE.CullFaceFront=2,THREE.CullFaceFrontBack=3,THREE.FrontFaceDirectionCW=0,THREE.FrontFaceDirectionCCW=1,THREE.BasicShadowMap=0,THREE.PCFShadowMap=1,THREE.PCFSoftShadowMap=2,THREE.FrontSide=0,THREE.BackSide=1,THREE.DoubleSide=2,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.CustomBlending=5,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.AddOperation=2,THREE.UVMapping=function(){},THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.RepeatWrapping=1e3,THREE.ClampToEdgeWrapping=1001,THREE.MirroredRepeatWrapping=1002,THREE.NearestFilter=1003,THREE.NearestMipMapNearestFilter=1004,THREE.NearestMipMapLinearFilter=1005,THREE.LinearFilter=1006,THREE.LinearMipMapNearestFilter=1007,THREE.LinearMipMapLinearFilter=1008,THREE.UnsignedByteType=1009,THREE.ByteType=1010,THREE.ShortType=1011,THREE.UnsignedShortType=1012,THREE.IntType=1013,THREE.UnsignedIntType=1014,THREE.FloatType=1015,THREE.UnsignedShort4444Type=1016,THREE.UnsignedShort5551Type=1017,THREE.UnsignedShort565Type=1018,THREE.AlphaFormat=1019,THREE.RGBFormat=1020,THREE.RGBAFormat=1021,THREE.LuminanceFormat=1022,THREE.LuminanceAlphaFormat=1023,THREE.RGB_S3TC_DXT1_Format=2001,THREE.RGBA_S3TC_DXT1_Format=2002,THREE.RGBA_S3TC_DXT3_Format=2003,THREE.RGBA_S3TC_DXT5_Format=2004,THREE.Color=function(e){return void 0!==e&&this.set(e),this},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(e){return e instanceof THREE.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(e,t,r){if(0===t)this.r=this.g=this.b=r;else{var i=function(e,t,r){return 0>r&&(r+=1),r>1&&(r-=1),1/6>r?e+6*(t-e)*r:.5>r?t:2/3>r?e+6*(t-e)*(2/3-r):e},o=.5>=r?r*(1+t):r+t-r*t,n=2*r-o;this.r=i(n,o,e+1/3),this.g=i(n,o,e),this.b=i(n,o,e-1/3)}return this},setStyle:function(e){if(/^rgb\\((\\d+),(\\d+),(\\d+)\\)$/i.test(e)){var t=/^rgb\\((\\d+),(\\d+),(\\d+)\\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\\((\\d+)\\%,(\\d+)\\%,(\\d+)\\%\\)$/i.test(e)){var t=/^rgb\\((\\d+)\\%,(\\d+)\\%,(\\d+)\\%\\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\\#([0-9a-f]{6})$/i.test(e)){var t=/^\\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}return/^(\\w+)$/i.test(e)?(this.setHex(THREE.ColorKeywords[e]),this):void 0},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(){var e={h:0,s:0,l:0};return function(){var t,r,i=this.r,o=this.g,n=this.b,a=Math.max(i,o,n),s=Math.min(i,o,n),h=(s+a)/2;if(s===a)t=0,r=0;else{var l=a-s;switch(r=.5>=h?l/(a+s):l/(2-a-s),a){case i:t=(o-n)/l+(n>o?6:0);break;case o:t=(n-i)/l+2;break;case n:t=(i-o)/l+4}t/=6}return e.h=t,e.s=r,e.l=h,e}}(),getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,r){var i=this.getHSL();return i.h+=e,i.s+=t,i.l+=r,this.setHSL(i.h,i.s,i.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},THREE.Quaternion=function(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==i?i:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,_euler:void 0,_updateEuler:function(e){void 0!==this._euler&&this._euler.setFromQuaternion(this,void 0,!1)},get x(){return this._x},set x(e){this._x=e,this._updateEuler()},get y(){return this._y},set y(e){this._y=e,this._updateEuler()},get z(){return this._z},set z(e){this._z=e,this._updateEuler()},get w(){return this._w},set w(e){this._w=e,this._updateEuler()},set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._updateEuler(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._w=e._w,this._updateEuler(),this},setFromEuler:function(e,t){void 0===typeof e.order&&console.error("ERROR: Quaternion\'s .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var r=Math.cos(e._x/2),i=Math.cos(e._y/2),o=Math.cos(e._z/2),n=Math.sin(e._x/2),a=Math.sin(e._y/2),s=Math.sin(e._z/2);return void 0===e.order||"XYZ"===e.order?(this._x=n*i*o+r*a*s,this._y=r*a*o-n*i*s,this._z=r*i*s+n*a*o,this._w=r*i*o-n*a*s):"YXZ"===e.order?(this._x=n*i*o+r*a*s,this._y=r*a*o-n*i*s,this._z=r*i*s-n*a*o,this._w=r*i*o+n*a*s):"ZXY"===e.order?(this._x=n*i*o-r*a*s,this._y=r*a*o+n*i*s,this._z=r*i*s+n*a*o,this._w=r*i*o-n*a*s):"ZYX"===e.order?(this._x=n*i*o-r*a*s,this._y=r*a*o+n*i*s,this._z=r*i*s-n*a*o,this._w=r*i*o+n*a*s):"YZX"===e.order?(this._x=n*i*o+r*a*s,this._y=r*a*o+n*i*s,this._z=r*i*s-n*a*o,this._w=r*i*o-n*a*s):"XZY"===e.order&&(this._x=n*i*o-r*a*s,this._y=r*a*o-n*i*s,this._z=r*i*s+n*a*o,this._w=r*i*o+n*a*s),t!==!1&&this._updateEuler(),this},setFromAxisAngle:function(e,t){var r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._updateEuler(),this},setFromRotationMatrix:function(e){var t,r=e.elements,i=r[0],o=r[4],n=r[8],a=r[1],s=r[5],h=r[9],l=r[2],c=r[6],u=r[10],p=i+s+u;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(c-h)*t,this._y=(n-l)*t,this._z=(a-o)*t):i>s&&i>u?(t=2*Math.sqrt(1+i-s-u),this._w=(c-h)/t,this._x=.25*t,this._y=(o+a)/t,this._z=(n+l)/t):s>u?(t=2*Math.sqrt(1+s-i-u),this._w=(n-l)/t,this._x=(o+a)/t,this._y=.25*t,this._z=(h+c)/t):(t=2*Math.sqrt(1+u-i-s),this._w=(a-o)/t,this._x=(n+l)/t,this._y=(h+c)/t,this._z=.25*t),this._updateEuler(),this},setFromUnitVectors:function(){var e,t,r=1e-6;return function(i,o){return void 0===e&&(e=new THREE.Vector3),t=i.dot(o)+1,r>t?(t=0,Math.abs(i.x)>Math.abs(i.z)?e.set(-i.y,i.x,0):e.set(0,-i.z,i.y)):e.crossVectors(i,o),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._updateEuler(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Quaternion\'s .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e._x,i=e._y,o=e._z,n=e._w,a=t._x,s=t._y,h=t._z,l=t._w;return this._x=r*l+n*a+i*h-o*s,this._y=i*l+n*s+o*a-r*h,this._z=o*l+n*h+r*s-i*a,this._w=n*l-r*a-i*s-o*h,this._updateEuler(),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quaternion\'s .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var r=this._x,i=this._y,o=this._z,n=this._w,a=n*e._w+r*e._x+i*e._y+o*e._z;if(0>a?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=n,this._x=r,this._y=i,this._z=o,this;var s=Math.acos(a),h=Math.sqrt(1-a*a);if(Math.abs(h)<.001)return this._w=.5*(n+this._w),this._x=.5*(r+this._x),this._y=.5*(i+this._y),this._z=.5*(o+this._z),this;var l=Math.sin((1-t)*s)/h,c=Math.sin(t*s)/h;return this._w=n*l+this._w*c,this._x=r*l+this._x*c,this._y=i*l+this._y*c,this._z=o*l+this._z*c,this._updateEuler(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],this._w=e[3],this._updateEuler(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}},THREE.Quaternion.slerp=function(e,t,r,i){return r.copy(e).slerp(t,i)},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2\'s .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2\'s .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){return this.x=e[0],this.y=e[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new THREE.Vector2(this.x,this.y)}},THREE.Vector3=function(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function(t){return t instanceof THREE.Euler==!1&&console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===e&&(e=new THREE.Quaternion),this.applyQuaternion(e.setFromEuler(t)),this}}(),applyAxisAngle:function(){var e;return function(t,r){return void 0===e&&(e=new THREE.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,r)),this}}(),applyMatrix3:function(e){var t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[3]*r+o[6]*i,this.y=o[1]*t+o[4]*r+o[7]*i,this.z=o[2]*t+o[5]*r+o[8]*i,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i+o[12],this.y=o[1]*t+o[5]*r+o[9]*i+o[13],this.z=o[2]*t+o[6]*r+o[10]*i+o[14],this},applyProjection:function(e){var t=this.x,r=this.y,i=this.z,o=e.elements,n=1/(o[3]*t+o[7]*r+o[11]*i+o[15]);return this.x=(o[0]*t+o[4]*r+o[8]*i+o[12])*n,this.y=(o[1]*t+o[5]*r+o[9]*i+o[13])*n,this.z=(o[2]*t+o[6]*r+o[10]*i+o[14])*n,this},applyQuaternion:function(e){var t=this.x,r=this.y,i=this.z,o=e.x,n=e.y,a=e.z,s=e.w,h=s*t+n*i-a*r,l=s*r+a*t-o*i,c=s*i+o*r-n*t,u=-o*t-n*r-a*i;return this.x=h*s+u*-o+l*-a-c*-n,this.y=l*s+u*-n+c*-o-h*-a,this.z=c*s+u*-a+h*-n-l*-o,this},project:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyProjection(e)}}(),unproject:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i,this.y=o[1]*t+o[5]*r+o[9]*i,this.z=o[2]*t+o[6]*r+o[10]*i,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e,t;return function(r,i){return void 0===e&&(e=new THREE.Vector3,t=new THREE.Vector3),e.set(r,r,r),t.set(i,i,i),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,r))/r),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},cross:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var r=this.x,i=this.y,o=this.z;return this.x=i*e.z-o*e.y,this.y=o*e.x-r*e.z,this.z=r*e.y-i*e.x,this},crossVectors:function(e,t){var r=e.x,i=e.y,o=e.z,n=t.x,a=t.y,s=t.z;return this.x=i*s-o*a,this.y=o*n-r*s,this.z=r*a-i*n,this},projectOnVector:function(){var e,t;return function(r){return void 0===e&&(e=new THREE.Vector3),e.copy(r).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new THREE.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new THREE.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(THREE.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i},setEulerFromRotationMatrix:function(e,t){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),r=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),i=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=r,this.z=i,this},setFromMatrixColumn:function(e,t){var r=4*e,i=t.elements;return this.x=i[r],this.y=i[r+1],this.z=i[r+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this}},THREE.Vector4=function(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4\'s .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4\'s .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,o=this.w,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i+n[12]*o,this.y=n[1]*t+n[5]*r+n[9]*i+n[13]*o,this.z=n[2]*t+n[6]*r+n[10]*i+n[14]*o,this.w=n[3]*t+n[7]*r+n[11]*i+n[15]*o,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,i,o,n=.01,a=.1,s=e.elements,h=s[0],l=s[4],c=s[8],u=s[1],p=s[5],f=s[9],E=s[2],d=s[6],m=s[10];if(Math.abs(l-u)<n&&Math.abs(c-E)<n&&Math.abs(f-d)<n){if(Math.abs(l+u)<a&&Math.abs(c+E)<a&&Math.abs(f+d)<a&&Math.abs(h+p+m-3)<a)return this.set(1,0,0,0),this;t=Math.PI;var g=(h+1)/2,v=(p+1)/2,T=(m+1)/2,y=(l+u)/4,R=(c+E)/4,x=(f+d)/4;return g>v&&g>T?n>g?(r=0,i=.707106781,o=.707106781):(r=Math.sqrt(g),i=y/r,o=R/r):v>T?n>v?(r=.707106781,i=0,o=.707106781):(i=Math.sqrt(v),r=y/i,o=x/i):n>T?(r=.707106781,i=.707106781,o=0):(o=Math.sqrt(T),r=R/o,i=x/o),this.set(r,i,o,t),this}var H=Math.sqrt((d-f)*(d-f)+(c-E)*(c-E)+(u-l)*(u-l));return Math.abs(H)<.001&&(H=1),this.x=(d-f)/H,this.y=(c-E)/H,this.z=(u-l)/H,this.w=Math.acos((h+p+m-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}},THREE.Euler=function(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._order=i||THREE.Euler.DefaultOrder},THREE.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],THREE.Euler.DefaultOrder="XYZ",THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,_quaternion:void 0,_updateQuaternion:function(){void 0!==this._quaternion&&this._quaternion.setFromEuler(this,!1)},get x(){return this._x},set x(e){this._x=e,this._updateQuaternion()},get y(){return this._y},set y(e){this._y=e,this._updateQuaternion()},get z(){return this._z},set z(e){this._z=e,this._updateQuaternion()},get order(){return this._order},set order(e){this._order=e,this._updateQuaternion()},set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._order=i||this._order,this._updateQuaternion(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._updateQuaternion(),this},setFromRotationMatrix:function(e,t){function r(e){return Math.min(Math.max(e,-1),1)}var i=e.elements,o=i[0],n=i[4],a=i[8],s=i[1],h=i[5],l=i[9],c=i[2],u=i[6],p=i[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(r(a)),Math.abs(a)<.99999?(this._x=Math.atan2(-l,p),this._z=Math.atan2(-n,o)):(this._x=Math.atan2(u,h),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(l)),Math.abs(l)<.99999?(this._y=Math.atan2(a,p),this._z=Math.atan2(s,h)):(this._y=Math.atan2(-c,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(u)),Math.abs(u)<.99999?(this._y=Math.atan2(-c,p),this._z=Math.atan2(-n,h)):(this._y=0,this._z=Math.atan2(s,o))):"ZYX"===t?(this._y=Math.asin(-r(c)),Math.abs(c)<.99999?(this._x=Math.atan2(u,p),this._z=Math.atan2(s,o)):(this._x=0,this._z=Math.atan2(-n,h))):"YZX"===t?(this._z=Math.asin(r(s)),Math.abs(s)<.99999?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-c,o)):(this._x=0,this._y=Math.atan2(a,p))):"XZY"===t?(this._z=Math.asin(-r(n)),Math.abs(n)<.99999?(this._x=Math.atan2(u,h),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-l,p),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+t),this._order=t,this._updateQuaternion(),this},setFromQuaternion:function(e,t,r){function i(e){return Math.min(Math.max(e,-1),1)}var o=e.x*e.x,n=e.y*e.y,a=e.z*e.z,s=e.w*e.w;return t=t||this._order,"XYZ"===t?(this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),s-o-n+a),this._y=Math.asin(i(2*(e.x*e.z+e.y*e.w))),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),s+o-n-a)):"YXZ"===t?(this._x=Math.asin(i(2*(e.x*e.w-e.y*e.z))),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),s-o-n+a),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),s-o+n-a)):"ZXY"===t?(this._x=Math.asin(i(2*(e.x*e.w+e.y*e.z))),this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),s-o-n+a),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),s-o+n-a)):"ZYX"===t?(this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),s-o-n+a),this._y=Math.asin(i(2*(e.y*e.w-e.x*e.z))),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),s+o-n-a)):"YZX"===t?(this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),s-o+n-a),\r\nthis._y=Math.atan2(2*(e.y*e.w-e.x*e.z),s+o-n-a),this._z=Math.asin(i(2*(e.x*e.y+e.z*e.w)))):"XZY"===t?(this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),s-o+n-a),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),s+o-n-a),this._z=Math.asin(i(2*(e.z*e.w-e.x*e.y)))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+t),this._order=t,r!==!1&&this._updateQuaternion(),this},reorder:function(){var e=new THREE.Quaternion;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._updateQuaternion(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}},THREE.Line3=function(e,t){this.start=void 0!==e?e:new THREE.Vector3,this.end=void 0!==t?t:new THREE.Vector3},THREE.Line3.prototype={constructor:THREE.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new THREE.Vector3;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r,i){e.subVectors(r,this.start),t.subVectors(this.end,this.start);var o=t.dot(t),n=t.dot(e),a=n/o;return i&&(a=THREE.Math.clamp(a,0,1)),a}}(),closestPointToPoint:function(e,t,r){var i=this.closestPointToPointParameter(e,t),o=r||new THREE.Vector3;return this.delta(o).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}},THREE.Box2=function(e,t){this.min=void 0!==e?e:new THREE.Vector2(1/0,1/0),this.max=void 0!==t?t:new THREE.Vector2(-(1/0),-(1/0))},THREE.Box2.prototype={constructor:THREE.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var r=1,i=e.length;i>r;r++)t=e[r],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new THREE.Vector2;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new THREE.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(e){return new THREE.Vector2((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){var r=t||new THREE.Vector2;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector2;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}},THREE.Box3=function(e,t){this.min=void 0!==e?e:new THREE.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new THREE.Vector3(-(1/0),-(1/0),-(1/0))},THREE.Box3.prototype={constructor:THREE.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var r=1,i=e.length;i>r;r++)t=e[r],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y),t.z<this.min.z?this.min.z=t.z:t.z>this.max.z&&(this.max.z=t.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new THREE.Vector3;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),setFromObject:function(){var e=new THREE.Vector3;return function(t){var r=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){if(void 0!==t.geometry&&void 0!==t.geometry.vertices)for(var i=t.geometry.vertices,o=0,n=i.length;n>o;o++)e.copy(i[o]),e.applyMatrix4(t.matrixWorld),r.expandByPoint(e)}),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(e){return new THREE.Vector3((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(e,t){var r=t||new THREE.Vector3;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),getBoundingSphere:function(){var e=new THREE.Vector3;return function(t){var r=t||new THREE.Sphere;return r.center=this.center(),r.radius=.5*this.size(e).length(),r}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}},THREE.Matrix3=function(e,t,r,i,o,n,a,s,h){this.elements=new Float32Array(9),this.set(void 0!==e?e:1,t||0,r||0,i||0,void 0!==o?o:1,n||0,a||0,s||0,void 0!==h?h:1)},THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(e,t,r,i,o,n,a,s,h){var l=this.elements;return l[0]=e,l[3]=t,l[6]=r,l[1]=i,l[4]=o,l[7]=n,l[2]=a,l[5]=s,l[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix3\'s .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var e=new THREE.Vector3;return function(t){for(var r=0,i=t.length;i>r;r+=3)e.x=t[r],e.y=t[r+1],e.z=t[r+2],e.applyMatrix3(this),t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],n=e[4],a=e[5],s=e[6],h=e[7],l=e[8];return t*n*l-t*a*h-r*o*l+r*a*s+i*o*h-i*n*s},getInverse:function(e,t){var r=e.elements,i=this.elements;i[0]=r[10]*r[5]-r[6]*r[9],i[1]=-r[10]*r[1]+r[2]*r[9],i[2]=r[6]*r[1]-r[2]*r[5],i[3]=-r[10]*r[4]+r[6]*r[8],i[4]=r[10]*r[0]-r[2]*r[8],i[5]=-r[6]*r[0]+r[2]*r[4],i[6]=r[9]*r[4]-r[5]*r[8],i[7]=-r[9]*r[0]+r[1]*r[8],i[8]=r[5]*r[0]-r[1]*r[4];var o=r[0]*i[0]+r[1]*i[3]+r[2]*i[6];if(0===o){var n="Matrix3.getInverse(): can\'t invert matrix, determinant is 0";if(t)throw new Error(n);return console.warn(n),this.identity(),this}return this.multiplyScalar(1/o),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},clone:function(){var e=this.elements;return new THREE.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},THREE.Matrix4=function(e,t,r,i,o,n,a,s,h,l,c,u,p,f,E,d){this.elements=new Float32Array(16);var m=this.elements;m[0]=void 0!==e?e:1,m[4]=t||0,m[8]=r||0,m[12]=i||0,m[1]=o||0,m[5]=void 0!==n?n:1,m[9]=a||0,m[13]=s||0,m[2]=h||0,m[6]=l||0,m[10]=void 0!==c?c:1,m[14]=u||0,m[3]=p||0,m[7]=f||0,m[11]=E||0,m[15]=void 0!==d?d:1},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,r,i,o,n,a,s,h,l,c,u,p,f,E,d){var m=this.elements;return m[0]=e,m[4]=t,m[8]=r,m[12]=i,m[1]=o,m[5]=n,m[9]=a,m[13]=s,m[2]=h,m[6]=l,m[10]=c,m[14]=u,m[3]=p,m[7]=f,m[11]=E,m[15]=d,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("DEPRECATED: Matrix4\'s .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractRotation:function(){var e=new THREE.Vector3;return function(t){var r=this.elements,i=t.elements,o=1/e.set(i[0],i[1],i[2]).length(),n=1/e.set(i[4],i[5],i[6]).length(),a=1/e.set(i[8],i[9],i[10]).length();return r[0]=i[0]*o,r[1]=i[1]*o,r[2]=i[2]*o,r[4]=i[4]*n,r[5]=i[5]*n,r[6]=i[6]*n,r[8]=i[8]*a,r[9]=i[9]*a,r[10]=i[10]*a,this}}(),makeRotationFromEuler:function(e){void 0===typeof e.order&&console.error("ERROR: Matrix\'s .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var t=this.elements,r=e.x,i=e.y,o=e.z,n=Math.cos(r),a=Math.sin(r),s=Math.cos(i),h=Math.sin(i),l=Math.cos(o),c=Math.sin(o);if(void 0===e.order||"XYZ"===e.order){var u=n*l,p=n*c,f=a*l,E=a*c;t[0]=s*l,t[4]=-s*c,t[8]=h,t[1]=p+f*h,t[5]=u-E*h,t[9]=-a*s,t[2]=E-u*h,t[6]=f+p*h,t[10]=n*s}else if("YXZ"===e.order){var d=s*l,m=s*c,g=h*l,v=h*c;t[0]=d+v*a,t[4]=g*a-m,t[8]=n*h,t[1]=n*c,t[5]=n*l,t[9]=-a,t[2]=m*a-g,t[6]=v+d*a,t[10]=n*s}else if("ZXY"===e.order){var d=s*l,m=s*c,g=h*l,v=h*c;t[0]=d-v*a,t[4]=-n*c,t[8]=g+m*a,t[1]=m+g*a,t[5]=n*l,t[9]=v-d*a,t[2]=-n*h,t[6]=a,t[10]=n*s}else if("ZYX"===e.order){var u=n*l,p=n*c,f=a*l,E=a*c;t[0]=s*l,t[4]=f*h-p,t[8]=u*h+E,t[1]=s*c,t[5]=E*h+u,t[9]=p*h-f,t[2]=-h,t[6]=a*s,t[10]=n*s}else if("YZX"===e.order){var T=n*s,y=n*h,R=a*s,x=a*h;t[0]=s*l,t[4]=x-T*c,t[8]=R*c+y,t[1]=c,t[5]=n*l,t[9]=-a*l,t[2]=-h*l,t[6]=y*c+R,t[10]=T-x*c}else if("XZY"===e.order){var T=n*s,y=n*h,R=a*s,x=a*h;t[0]=s*l,t[4]=-c,t[8]=h*l,t[1]=T*c+x,t[5]=n*l,t[9]=y*c-R,t[2]=R*c-y,t[6]=a*l,t[10]=x*c+T}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("DEPRECATED: Matrix4\'s .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,r=e.x,i=e.y,o=e.z,n=e.w,a=r+r,s=i+i,h=o+o,l=r*a,c=r*s,u=r*h,p=i*s,f=i*h,E=o*h,d=n*a,m=n*s,g=n*h;return t[0]=1-(p+E),t[4]=c-g,t[8]=u+m,t[1]=c+g,t[5]=1-(l+E),t[9]=f-d,t[2]=u-m,t[6]=f+d,t[10]=1-(l+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3;return function(i,o,n){var a=this.elements;return r.subVectors(i,o).normalize(),0===r.length()&&(r.z=1),e.crossVectors(n,r).normalize(),0===e.length()&&(r.x+=1e-4,e.crossVectors(n,r).normalize()),t.crossVectors(r,e),a[0]=e.x,a[4]=t.x,a[8]=r.x,a[1]=e.y,a[5]=t.y,a[9]=r.y,a[2]=e.z,a[6]=t.z,a[10]=r.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4\'s .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,o=this.elements,n=r[0],a=r[4],s=r[8],h=r[12],l=r[1],c=r[5],u=r[9],p=r[13],f=r[2],E=r[6],d=r[10],m=r[14],g=r[3],v=r[7],T=r[11],y=r[15],R=i[0],x=i[4],H=i[8],_=i[12],b=i[1],w=i[5],M=i[9],S=i[13],A=i[2],C=i[6],L=i[10],P=i[14],F=i[3],D=i[7],U=i[11],V=i[15];return o[0]=n*R+a*b+s*A+h*F,o[4]=n*x+a*w+s*C+h*D,o[8]=n*H+a*M+s*L+h*U,o[12]=n*_+a*S+s*P+h*V,o[1]=l*R+c*b+u*A+p*F,o[5]=l*x+c*w+u*C+p*D,o[9]=l*H+c*M+u*L+p*U,o[13]=l*_+c*S+u*P+p*V,o[2]=f*R+E*b+d*A+m*F,o[6]=f*x+E*w+d*C+m*D,o[10]=f*H+E*M+d*L+m*U,o[14]=f*_+E*S+d*P+m*V,o[3]=g*R+v*b+T*A+y*F,o[7]=g*x+v*w+T*C+y*D,o[11]=g*H+v*M+T*L+y*U,o[15]=g*_+v*S+T*P+y*V,this},multiplyToArray:function(e,t,r){var i=this.elements;return this.multiplyMatrices(e,t),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix4\'s .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("DEPRECATED: Matrix4\'s .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){var e=new THREE.Vector3;return function(t){for(var r=0,i=t.length;i>r;r+=3)e.x=t[r],e.y=t[r+1],e.z=t[r+2],e.applyProjection(this),t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z;return t}}(),rotateAxis:function(e){console.warn("DEPRECATED: Matrix4\'s .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("DEPRECATED: Matrix4\'s .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],r=e[4],i=e[8],o=e[12],n=e[1],a=e[5],s=e[9],h=e[13],l=e[2],c=e[6],u=e[10],p=e[14],f=e[3],E=e[7],d=e[11],m=e[15];return f*(+o*s*c-i*h*c-o*a*u+r*h*u+i*a*p-r*s*p)+E*(+t*s*p-t*h*u+o*n*u-i*n*p+i*h*l-o*s*l)+d*(+t*h*c-t*a*p-o*n*c+r*n*p+o*a*l-r*h*l)+m*(-i*a*l-t*s*c+t*a*u+i*n*c-r*n*u+r*s*l)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e},getPosition:function(){var e=new THREE.Vector3;return function(){console.warn("DEPRECATED: Matrix4\'s .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,i=e.elements,o=i[0],n=i[4],a=i[8],s=i[12],h=i[1],l=i[5],c=i[9],u=i[13],p=i[2],f=i[6],E=i[10],d=i[14],m=i[3],g=i[7],v=i[11],T=i[15];r[0]=c*d*g-u*E*g+u*f*v-l*d*v-c*f*T+l*E*T,r[4]=s*E*g-a*d*g-s*f*v+n*d*v+a*f*T-n*E*T,r[8]=a*u*g-s*c*g+s*l*v-n*u*v-a*l*T+n*c*T,r[12]=s*c*f-a*u*f-s*l*E+n*u*E+a*l*d-n*c*d,r[1]=u*E*m-c*d*m-u*p*v+h*d*v+c*p*T-h*E*T,r[5]=a*d*m-s*E*m+s*p*v-o*d*v-a*p*T+o*E*T,r[9]=s*c*m-a*u*m-s*h*v+o*u*v+a*h*T-o*c*T,r[13]=a*u*p-s*c*p+s*h*E-o*u*E-a*h*d+o*c*d,r[2]=l*d*m-u*f*m+u*p*g-h*d*g-l*p*T+h*f*T,r[6]=s*f*m-n*d*m-s*p*g+o*d*g+n*p*T-o*f*T,r[10]=n*u*m-s*l*m+s*h*g-o*u*g-n*h*T+o*l*T,r[14]=s*l*p-n*u*p-s*h*f+o*u*f+n*h*d-o*l*d,r[3]=c*f*m-l*E*m-c*p*g+h*E*g+l*p*v-h*f*v,r[7]=n*E*m-a*f*m+a*p*g-o*E*g-n*p*v+o*f*v,r[11]=a*l*m-n*c*m-a*h*g+o*c*g+n*h*v-o*l*v,r[15]=n*c*p-a*l*p+a*h*f-o*c*f-n*h*E+o*l*E;var y=o*r[0]+h*r[4]+p*r[8]+m*r[12];if(0==y){var R="Matrix4.getInverse(): can\'t invert matrix, determinant is 0";if(t)throw new Error(R);return console.warn(R),this.identity(),this}return this.multiplyScalar(1/y),this},translate:function(e){console.warn("DEPRECATED: Matrix4\'s .translate() has been removed.")},rotateX:function(e){console.warn("DEPRECATED: Matrix4\'s .rotateX() has been removed.")},rotateY:function(e){console.warn("DEPRECATED: Matrix4\'s .rotateY() has been removed.")},rotateZ:function(e){console.warn("DEPRECATED: Matrix4\'s .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.warn("DEPRECATED: Matrix4\'s .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,r=e.x,i=e.y,o=e.z;return t[0]*=r,t[4]*=i,t[8]*=o,t[1]*=r,t[5]*=i,t[9]*=o,t[2]*=r,t[6]*=i,t[10]*=o,t[3]*=r,t[7]*=i,t[11]*=o,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(r,i)))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),i=Math.sin(t),o=1-r,n=e.x,a=e.y,s=e.z,h=o*n,l=o*a;return this.set(h*n+r,h*a-i*s,h*s+i*a,0,h*a+i*s,l*a+r,l*s-i*n,0,h*s-i*a,l*s+i*n,o*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},compose:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},decompose:function(){var e=new THREE.Vector3,t=new THREE.Matrix4;return function(r,i,o){var n=this.elements,a=e.set(n[0],n[1],n[2]).length(),s=e.set(n[4],n[5],n[6]).length(),h=e.set(n[8],n[9],n[10]).length();r.x=n[12],r.y=n[13],r.z=n[14],t.elements.set(this.elements);var l=1/a,c=1/s,u=1/h;return t.elements[0]*=l,t.elements[1]*=l,t.elements[2]*=l,t.elements[4]*=c,t.elements[5]*=c,t.elements[6]*=c,t.elements[8]*=u,t.elements[9]*=u,t.elements[10]*=u,i.setFromRotationMatrix(t),o.x=a,o.y=s,o.z=h,this}}(),makeFrustum:function(e,t,r,i,o,n){var a=this.elements,s=2*o/(t-e),h=2*o/(i-r),l=(t+e)/(t-e),c=(i+r)/(i-r),u=-(n+o)/(n-o),p=-2*n*o/(n-o);return a[0]=s,a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=h,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(e,t,r,i){var o=r*Math.tan(THREE.Math.degToRad(.5*e)),n=-o,a=n*t,s=o*t;return this.makeFrustum(a,s,n,o,r,i)},makeOrthographic:function(e,t,r,i,o,n){var a=this.elements,s=t-e,h=r-i,l=n-o,c=(t+e)/s,u=(r+i)/h,p=(n+o)/l;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2/h,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2/l,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){var e=this.elements;return new THREE.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},THREE.Ray=function(e,t){this.origin=void 0!==e?e:new THREE.Vector3,this.direction=void 0!==t?t:new THREE.Vector3},THREE.Ray.prototype={constructor:THREE.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var r=t||new THREE.Vector3;return r.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new THREE.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var r=t||new THREE.Vector3;r.subVectors(e,this.origin);var i=r.dot(this.direction);return 0>i?r.copy(this.origin):r.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new THREE.Vector3;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return 0>r?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3;return function(i,o,n,a){e.copy(i).add(o).multiplyScalar(.5),t.copy(o).sub(i).normalize(),r.copy(this.origin).sub(e);var s,h,l,c,u=.5*i.distanceTo(o),p=-this.direction.dot(t),f=r.dot(this.direction),E=-r.dot(t),d=r.lengthSq(),m=Math.abs(1-p*p);if(m>0)if(s=p*E-f,h=p*f-E,c=u*m,s>=0)if(h>=-c)if(c>=h){var g=1/m;s*=g,h*=g,l=s*(s+p*h+2*f)+h*(p*s+h+2*E)+d}else h=u,s=Math.max(0,-(p*h+f)),l=-s*s+h*(h+2*E)+d;else h=-u,s=Math.max(0,-(p*h+f)),l=-s*s+h*(h+2*E)+d;else-c>=h?(s=Math.max(0,-(-p*u+f)),h=s>0?-u:Math.min(Math.max(-u,-E),u),l=-s*s+h*(h+2*E)+d):c>=h?(s=0,h=Math.min(Math.max(-u,-E),u),l=h*(h+2*E)+d):(s=Math.max(0,-(p*u+f)),h=s>0?u:Math.min(Math.max(-u,-E),u),l=-s*s+h*(h+2*E)+d);else h=p>0?-u:u,s=Math.max(0,-(p*h+f)),l=-s*s+h*(h+2*E)+d;return n&&n.copy(this.direction).multiplyScalar(s).add(this.origin),a&&a.copy(t).multiplyScalar(h).add(e),l}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new THREE.Vector3;return function(t,r){e.subVectors(t.center,this.origin);var i=e.dot(this.direction),o=e.dot(e)-i*i,n=t.radius*t.radius;if(o>n)return null;var a=Math.sqrt(n-o),s=i-a,h=i+a;return 0>s&&0>h?null:0>s?this.at(h,r):this.at(s,r)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var r=e.normal.dot(this.direction);return 0>r*t?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},isIntersectionBox:function(){var e=new THREE.Vector3;return function(t){return null!==this.intersectBox(t,e)}}(),intersectBox:function(e,t){var r,i,o,n,a,s,h=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,u=this.origin;return h>=0?(r=(e.min.x-u.x)*h,i=(e.max.x-u.x)*h):(r=(e.max.x-u.x)*h,i=(e.min.x-u.x)*h),l>=0?(o=(e.min.y-u.y)*l,n=(e.max.y-u.y)*l):(o=(e.max.y-u.y)*l,n=(e.min.y-u.y)*l),r>n||o>i?null:((o>r||r!==r)&&(r=o),(i>n||i!==i)&&(i=n),c>=0?(a=(e.min.z-u.z)*c,s=(e.max.z-u.z)*c):(a=(e.max.z-u.z)*c,s=(e.min.z-u.z)*c),r>s||a>i?null:((a>r||r!==r)&&(r=a),(i>s||i!==i)&&(i=s),0>i?null:this.at(r>=0?r:i,t)))},intersectTriangle:function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3;return function(o,n,a,s,h){t.subVectors(n,o),r.subVectors(a,o),i.crossVectors(t,r);var l,c=this.direction.dot(i);if(c>0){if(s)return null;l=1}else{if(!(0>c))return null;l=-1,c=-c}e.subVectors(this.origin,o);var u=l*this.direction.dot(r.crossVectors(e,r));if(0>u)return null;var p=l*this.direction.dot(t.cross(e));if(0>p)return null;if(u+p>c)return null;var f=-l*e.dot(i);return 0>f?null:this.at(f/c,h)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},THREE.Sphere=function(e,t){this.center=void 0!==e?e:new THREE.Vector3,this.radius=void 0!==t?t:0},THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e){for(var t,r=0,i=0,o=e.length;o>i;i++)t=e[i].lengthSq(),r=Math.max(r,t);return this.center.set(0,0,0),this.radius=Math.sqrt(r),this},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var r=this.center.distanceToSquared(e),i=t||new THREE.Vector3;return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(e){var t=e||new THREE.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}},THREE.Frustum=function(e,t,r,i,o,n){this.planes=[void 0!==e?e:new THREE.Plane,void 0!==t?t:new THREE.Plane,void 0!==r?r:new THREE.Plane,void 0!==i?i:new THREE.Plane,void 0!==o?o:new THREE.Plane,void 0!==n?n:new THREE.Plane]},THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(e,t,r,i,o,n){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(o),a[5].copy(n),this},copy:function(e){for(var t=this.planes,r=0;6>r;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,i=r[0],o=r[1],n=r[2],a=r[3],s=r[4],h=r[5],l=r[6],c=r[7],u=r[8],p=r[9],f=r[10],E=r[11],d=r[12],m=r[13],g=r[14],v=r[15];return t[0].setComponents(a-i,c-s,E-u,v-d).normalize(),t[1].setComponents(a+i,c+s,E+u,v+d).normalize(),t[2].setComponents(a+o,c+h,E+p,v+m).normalize(),t[3].setComponents(a-o,c-h,E-p,v-m).normalize(),t[4].setComponents(a-n,c-l,E-f,v-g).normalize(),t[5].setComponents(a+n,c+l,E+f,v+g).normalize(),this},intersectsObject:function(){var e=new THREE.Vector3;return function(t){var r=t.geometry,i=t.matrixWorld;null===r.boundingSphere&&r.computeBoundingSphere();var o=-r.boundingSphere.radius*i.getMaxScaleOnAxis();e.getPositionFromMatrix(i);for(var n=this.planes,a=0;6>a;a++){var s=n[a].distanceToPoint(e);if(o>s)return!1}return!0}}(),intersectsSphere:function(e){for(var t=this.planes,r=e.center,i=-e.radius,o=0;6>o;o++){var n=t[o].distanceToPoint(r);if(i>n)return!1}return!0},intersectsBox:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r){for(var i=this.planes,o=0;6>o;o++){var n=i[o];e.x=n.normal.x>0?r.min.x:r.max.x,t.x=n.normal.x>0?r.max.x:r.min.x,e.y=n.normal.y>0?r.min.y:r.max.y,t.y=n.normal.y>0?r.max.y:r.min.y,e.z=n.normal.z>0?r.min.z:r.max.z,t.z=n.normal.z>0?r.max.z:r.min.z;var a=n.distanceToPoint(e),s=n.distanceToPoint(t);if(0>a&&0>s)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,r=0;6>r;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new THREE.Frustum).copy(this)}},THREE.Plane=function(e,t){this.normal=void 0!==e?e:new THREE.Vector3(1,0,0),this.constant=void 0!==t?t:0},THREE.Plane.prototype={constructor:THREE.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r,i,o){var n=e.subVectors(o,i).cross(t.subVectors(r,i)).normalize();return this.setFromNormalAndCoplanarPoint(n,r),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e),i=t||new THREE.Vector3;return i.copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return 0>t&&r>0||0>r&&t>0},intersectLine:function(){var e=new THREE.Vector3;return function(t,r){var i=r||new THREE.Vector3,o=t.delta(e),n=this.normal.dot(o);if(0!=n){var a=-(t.start.dot(this.normal)+this.constant)/n;if(!(0>a||a>1))return i.copy(o).multiplyScalar(a).add(t.start)}else if(0==this.distanceToPoint(t.start))return i.copy(t.start)}}(),coplanarPoint:function(e){var t=e||new THREE.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r,i){i=i||(new THREE.Matrix3).getNormalMatrix(r);var o=e.copy(this.normal).applyMatrix3(i),n=this.coplanarPoint(t);return n.applyMatrix4(r),this.setFromNormalAndCoplanarPoint(o,n),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}},THREE.Math={PI2:2*Math.PI,generateUUID:function(){\r\nvar e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),i=0;return function(){for(var o=0;36>o;o++)8==o||13==o||18==o||23==o?r[o]="-":14==o?r[o]="4":(2>=i&&(i=33554432+16777216*Math.random()|0),e=15&i,i>>=4,r[o]=t[19==o?3&e|8:e]);return r.join("")}}(),clamp:function(e,t,r){return t>e?t:e>r?r:e},clampBottom:function(e,t){return t>e?t:e},mapLinear:function(e,t,r,i,o){return i+(e-t)*(o-i)/(r-t)},smoothstep:function(e,t,r){return t>=e?0:e>=r?1:(e=(e-t)/(r-t),e*e*(3-2*e))},smootherstep:function(e,t,r){return t>=e?0:e>=r?1:(e=(e-t)/(r-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return 0>e?-1:e>0?1:0},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}()},THREE.Spline=function(e){function t(e,t,r,i,o,n,a){var s=.5*(r-e),h=.5*(i-t);return(2*(t-r)+s+h)*a+(-3*(t-r)-2*s-h)*n+s*o+t}this.points=e;var r,i,o,n,a,s,h,l,c,u=[],p={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return r=(this.points.length-1)*e,i=Math.floor(r),o=r-i,u[0]=0===i?i:i-1,u[1]=i,u[2]=i>this.points.length-2?this.points.length-1:i+1,u[3]=i>this.points.length-3?this.points.length-1:i+2,s=this.points[u[0]],h=this.points[u[1]],l=this.points[u[2]],c=this.points[u[3]],n=o*o,a=o*n,p.x=t(s.x,h.x,l.x,c.x,o,n,a),p.y=t(s.y,h.y,l.y,c.y,o,n,a),p.z=t(s.z,h.z,l.z,c.z,o,n,a),p},this.getControlPointsArray=function(){var e,t,r=this.points.length,i=[];for(e=0;r>e;e++)t=this.points[e],i[e]=[t.x,t.y,t.z];return i},this.getLength=function(e){var t,r,i,o,n=0,a=0,s=0,h=new THREE.Vector3,l=new THREE.Vector3,c=[],u=0;for(c[0]=0,e||(e=100),i=this.points.length*e,h.copy(this.points[0]),t=1;i>t;t++)r=t/i,o=this.getPoint(r),l.copy(o),u+=l.distanceTo(h),h.copy(o),n=(this.points.length-1)*r,a=Math.floor(n),a!=s&&(c[a]=u,s=a);return c[c.length]=u,{chunks:c,total:u}},this.reparametrizeByArcLength=function(e){var t,r,i,o,n,a,s,h,l=[],c=new THREE.Vector3,u=this.getLength();for(l.push(c.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(a=u.chunks[t]-u.chunks[t-1],s=Math.ceil(e*a/u.total),o=(t-1)/(this.points.length-1),n=t/(this.points.length-1),r=1;s-1>r;r++)i=o+r*(1/s)*(n-o),h=this.getPoint(i),l.push(c.copy(h).clone());l.push(c.copy(this.points[t]).clone())}this.points=l}},THREE.Triangle=function(e,t,r){this.a=void 0!==e?e:new THREE.Vector3,this.b=void 0!==t?t:new THREE.Vector3,this.c=void 0!==r?r:new THREE.Vector3},THREE.Triangle.normal=function(){var e=new THREE.Vector3;return function(t,r,i,o){var n=o||new THREE.Vector3;n.subVectors(i,r),e.subVectors(t,r),n.cross(e);var a=n.lengthSq();return a>0?n.multiplyScalar(1/Math.sqrt(a)):n.set(0,0,0)}}(),THREE.Triangle.barycoordFromPoint=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3;return function(i,o,n,a,s){e.subVectors(a,o),t.subVectors(n,o),r.subVectors(i,o);var h=e.dot(e),l=e.dot(t),c=e.dot(r),u=t.dot(t),p=t.dot(r),f=h*u-l*l,E=s||new THREE.Vector3;if(0==f)return E.set(-2,-1,-1);var d=1/f,m=(u*c-l*p)*d,g=(h*p-l*c)*d;return E.set(1-m-g,g,m)}}(),THREE.Triangle.containsPoint=function(){var e=new THREE.Vector3;return function(t,r,i,o){var n=THREE.Triangle.barycoordFromPoint(t,r,i,o,e);return n.x>=0&&n.y>=0&&n.x+n.y<=1}}(),THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return THREE.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new THREE.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return THREE.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return THREE.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}},THREE.Vertex=function(e){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),e},THREE.UV=function(e,t){return console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),new THREE.Vector2(e,t)},THREE.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},THREE.EventDispatcher=function(){},THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(e){e.addEventListener=THREE.EventDispatcher.prototype.addEventListener,e.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener,e.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners,i=r[e].indexOf(t);-1!==i&&r[e].splice(i,1)}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,r=t[e.type];if(void 0!==r){e.target=this;for(var i=0,o=r.length;o>i;i++)r[i].call(this,e)}}}},function(e){function t(e,t){return e.distance-t.distance}function r(e,t,i,o){if(e.visible!==!1&&(e.raycast(t,i),o===!0))for(var n=e.children,a=0,s=n.length;s>a;a++)r(n[a],t,i,!0)}e.Raycaster=function(t,r,i,o){this.ray=new e.Ray(t,r),this.near=i||0,this.far=o||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})},e.Raycaster.prototype={constructor:e.Raycaster,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,r){r instanceof e.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(r.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(r).sub(this.ray.origin).normalize()):r instanceof e.OrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(r),this.ray.direction.set(0,0,-1).transformDirection(r.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,i){var o=[];return r(e,this,o,i),o.sort(t),o},intersectObjects:function(e,i){var o=[];if(Array.isArray(e)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),o;for(var n=0,a=e.length;a>n;n++)r(e[n],this,o,i);return o.sort(t),o}}}(THREE),THREE.Object3D=function(){this.id=THREE.Object3DIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this.rotation=new THREE.Euler,this.quaternion=new THREE.Quaternion,this.scale=new THREE.Vector3(1,1,1),this.rotation._quaternion=this.quaternion,this.quaternion._euler=this.rotation,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.userData={}},THREE.Object3D.prototype={constructor:THREE.Object3D,get eulerOrder(){return console.warn("DEPRECATED: Object3D\'s .eulerOrder has been moved to Object3D\'s .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("DEPRECATED: Object3D\'s .eulerOrder has been moved to Object3D\'s .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("DEPRECATED: Object3D\'s .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("DEPRECATED: Object3D\'s .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(){var e=new THREE.Matrix4;return function(t){this.matrix.multiplyMatrices(t,this.matrix),this.position.getPositionFromMatrix(this.matrix),this.scale.getScaleFromMatrix(this.matrix),e.extractRotation(this.matrix),this.quaternion.setFromRotationMatrix(e)}}(),setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new THREE.Quaternion;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new THREE.Vector3;return function(t,r){return e.copy(t),e.applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translate:function(e,t){return console.warn("DEPRECATED: Object3D\'s .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),this.translateOnAxis(t,e)},translateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new THREE.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new THREE.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(e===this)return void console.warn("THREE.Object3D.add: An object can\'t be added as a child of itself.");if(e instanceof THREE.Object3D){void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.__addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(-1!==t){e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(t,1);for(var r=this;void 0!==r.parent;)r=r.parent;void 0!==r&&r instanceof THREE.Scene&&r.__removeObject(e)}},traverse:function(e){e(this);for(var t=0,r=this.children.length;r>t;t++)this.children[t].traverse(e)},getObjectById:function(e,t){for(var r=0,i=this.children.length;i>r;r++){var o=this.children[r];if(o.id===e)return o;if(t===!0&&(o=o.getObjectById(e,t),void 0!==o))return o}},getObjectByName:function(e,t){for(var r=0,i=this.children.length;i>r;r++){var o=this.children[r];if(o.name===e)return o;if(t===!0&&(o=o.getObjectByName(e,t),void 0!==o))return o}},getChildByName:function(e,t){return console.warn("DEPRECATED: Object3D\'s .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,r=this.children.length;r>t;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||e===!0)&&(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;r>t;t++)this.children[t].updateMatrixWorld(e)},clone:function(e,t){if(void 0===e&&(e=new THREE.Object3D),void 0===t&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData)),t===!0)for(var r=0;r<this.children.length;r++){var i=this.children[r];e.add(i.clone())}return e}},THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype),THREE.Object3DIdCount=0,THREE.Projector=function(){function e(){if(l===R){var e=new THREE.RenderableObject;return y.push(e),R++,l++,e}return y[l++]}function t(){if(u===H){var e=new THREE.RenderableVertex;return x.push(e),H++,u++,e}return x[u++]}function r(){if(f===b){var e=new THREE.RenderableFace3;return _.push(e),b++,f++,e}return _[f++]}function i(){if(E===M){var e=new THREE.RenderableFace4;return w.push(e),M++,E++,e}return w[E++]}function o(){if(m===A){var e=new THREE.RenderableLine;return S.push(e),A++,m++,e}return S[m++]}function n(){if(v===L){var e=new THREE.RenderableParticle;return C.push(e),L++,v++,e}return C[v++]}function a(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function s(e,t){var r=0,i=1,o=e.z+e.w,n=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return o>=0&&n>=0&&a>=0&&s>=0?!0:0>o&&0>n||0>a&&0>s?!1:(0>o?r=Math.max(r,o/(o-n)):0>n&&(i=Math.min(i,o/(o-n))),0>a?r=Math.max(r,a/(a-s)):0>s&&(i=Math.min(i,a/(a-s))),r>i?!1:(e.lerp(t,r),t.lerp(e,1-i),!0))}var h,l,c,u,p,f,E,d,m,g,v,T,y=[],R=0,x=[],H=0,_=[],b=0,w=[],M=0,S=[],A=0,C=[],L=0,P={objects:[],sprites:[],lights:[],elements:[]},F=new THREE.Vector3,D=new THREE.Vector4,U=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),V=new THREE.Box3,O=new Array(3),z=new Array(4),N=new THREE.Matrix4,B=new THREE.Matrix4,I=new THREE.Matrix4,k=new THREE.Matrix3,G=new THREE.Matrix3,j=new THREE.Vector3,W=new THREE.Frustum,X=new THREE.Vector4,Y=new THREE.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),B.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(B)},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),B.multiplyMatrices(t.matrixWorld,t.projectionMatrixInverse),e.applyProjection(B)},this.pickingRay=function(e,t){e.z=-1;var r=new THREE.Vector3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(r,t),r.sub(e).normalize(),new THREE.Raycaster(e,r)};var q=function(t){return h=e(),h.id=t.id,h.object=t,null!==t.renderDepth?h.z=t.renderDepth:(F.getPositionFromMatrix(t.matrixWorld),F.applyProjection(B),h.z=F.z),h},K=function(e){if(e.visible!==!1){e instanceof THREE.Light?P.lights.push(e):e instanceof THREE.Mesh||e instanceof THREE.Line?(e.frustumCulled===!1||W.intersectsObject(e)===!0)&&P.objects.push(q(e)):(e instanceof THREE.Sprite||e instanceof THREE.Particle)&&P.sprites.push(q(e));for(var t=0,r=e.children.length;r>t;t++)K(e.children[t])}},Z=function(e,t){l=0,P.objects.length=0,P.sprites.length=0,P.lights.length=0,K(e),t===!0&&P.objects.sort(a)};this.projectScene=function(e,h,l,y){var R,H,_,b,w,M,S,A,C,L,F,q,K,Q,J,$,ee,te,re,ie,oe,ne,ae,se,he,le,ce=!1;for(f=0,E=0,m=0,v=0,P.elements.length=0,e.autoUpdate===!0&&e.updateMatrixWorld(),void 0===h.parent&&h.updateMatrixWorld(),N.copy(h.matrixWorldInverse.getInverse(h.matrixWorld)),B.multiplyMatrices(h.projectionMatrix,N),G.getNormalMatrix(N),W.setFromMatrix(B),Z(e,l),R=0,H=P.objects.length;H>R;R++)if(K=P.objects[R].object,T=K.matrixWorld,u=0,K instanceof THREE.Mesh){for(Q=K.geometry,J=Q.vertices,$=Q.faces,re=Q.faceVertexUvs,k.getNormalMatrix(T),he=K.material instanceof THREE.MeshFaceMaterial,le=he===!0?K.material:null,_=0,b=J.length;b>_;_++){c=t(),c.positionWorld.copy(J[_]).applyMatrix4(T),c.positionScreen.copy(c.positionWorld).applyMatrix4(B);var ue=1/c.positionScreen.w;c.positionScreen.x*=ue,c.positionScreen.y*=ue,c.positionScreen.z*=ue,c.visible=!(c.positionScreen.x<-1||c.positionScreen.x>1||c.positionScreen.y<-1||c.positionScreen.y>1||c.positionScreen.z<-1||c.positionScreen.z>1)}for(w=0,M=$.length;M>w;w++){ee=$[w];var pe=he===!0?le.materials[ee.materialIndex]:K.material;if(void 0!==pe){var fe=pe.side;if(ee instanceof THREE.Face3){if(oe=x[ee.a],ne=x[ee.b],ae=x[ee.c],O[0]=oe.positionScreen,O[1]=ne.positionScreen,O[2]=ae.positionScreen,oe.visible!==!0&&ne.visible!==!0&&ae.visible!==!0&&!U.isIntersectionBox(V.setFromPoints(O)))continue;if(ce=(ae.positionScreen.x-oe.positionScreen.x)*(ne.positionScreen.y-oe.positionScreen.y)-(ae.positionScreen.y-oe.positionScreen.y)*(ne.positionScreen.x-oe.positionScreen.x)<0,fe!==THREE.DoubleSide&&ce!==(fe===THREE.FrontSide))continue;p=r(),p.id=K.id,p.v1.copy(oe),p.v2.copy(ne),p.v3.copy(ae)}else if(ee instanceof THREE.Face4){if(oe=x[ee.a],ne=x[ee.b],ae=x[ee.c],se=x[ee.d],z[0]=oe.positionScreen,z[1]=ne.positionScreen,z[2]=ae.positionScreen,z[3]=se.positionScreen,oe.visible!==!0&&ne.visible!==!0&&ae.visible!==!0&&se.visible!==!0&&!U.isIntersectionBox(V.setFromPoints(z)))continue;if(ce=(se.positionScreen.x-oe.positionScreen.x)*(ne.positionScreen.y-oe.positionScreen.y)-(se.positionScreen.y-oe.positionScreen.y)*(ne.positionScreen.x-oe.positionScreen.x)<0||(ne.positionScreen.x-ae.positionScreen.x)*(se.positionScreen.y-ae.positionScreen.y)-(ne.positionScreen.y-ae.positionScreen.y)*(se.positionScreen.x-ae.positionScreen.x)<0,fe!==THREE.DoubleSide&&ce!==(fe===THREE.FrontSide))continue;p=i(),p.id=K.id,p.v1.copy(oe),p.v2.copy(ne),p.v3.copy(ae),p.v4.copy(se)}for(p.normalModel.copy(ee.normal),ce!==!1||fe!==THREE.BackSide&&fe!==THREE.DoubleSide||p.normalModel.negate(),p.normalModel.applyMatrix3(k).normalize(),p.normalModelView.copy(p.normalModel).applyMatrix3(G),p.centroidModel.copy(ee.centroid).applyMatrix4(T),te=ee.vertexNormals,S=0,A=te.length;A>S;S++){var Ee=p.vertexNormalsModel[S];Ee.copy(te[S]),ce!==!1||fe!==THREE.BackSide&&fe!==THREE.DoubleSide||Ee.negate(),Ee.applyMatrix3(k).normalize();var de=p.vertexNormalsModelView[S];de.copy(Ee).applyMatrix3(G)}for(p.vertexNormalsLength=te.length,C=0,L=re.length;L>C;C++)if(ie=re[C][w],void 0!==ie)for(F=0,q=ie.length;q>F;F++)p.uvs[C][F]=ie[F];p.color=ee.color,p.material=pe,j.copy(p.centroidModel).applyProjection(B),p.z=j.z,P.elements.push(p)}}}else if(K instanceof THREE.Line){I.multiplyMatrices(B,T),J=K.geometry.vertices,oe=t(),oe.positionScreen.copy(J[0]).applyMatrix4(I);var me=K.type===THREE.LinePieces?2:1;for(_=1,b=J.length;b>_;_++)oe=t(),oe.positionScreen.copy(J[_]).applyMatrix4(I),(_+1)%me>0||(ne=x[u-2],X.copy(oe.positionScreen),Y.copy(ne.positionScreen),s(X,Y)===!0&&(X.multiplyScalar(1/X.w),Y.multiplyScalar(1/Y.w),d=o(),d.id=K.id,d.v1.positionScreen.copy(X),d.v2.positionScreen.copy(Y),d.z=Math.max(X.z,Y.z),d.material=K.material,K.material.vertexColors===THREE.VertexColors&&(d.vertexColors[0].copy(K.geometry.colors[_]),d.vertexColors[1].copy(K.geometry.colors[_-1])),P.elements.push(d)))}for(R=0,H=P.sprites.length;H>R;R++)if(K=P.sprites[R].object,T=K.matrixWorld,K instanceof THREE.Particle){D.set(T.elements[12],T.elements[13],T.elements[14],1),D.applyMatrix4(B);var ue=1/D.w;D.z*=ue,D.z>0&&D.z<1&&(g=n(),g.id=K.id,g.x=D.x*ue,g.y=D.y*ue,g.z=D.z,g.object=K,g.rotation=K.rotation.z,g.scale.x=K.scale.x*Math.abs(g.x-(D.x+h.projectionMatrix.elements[0])/(D.w+h.projectionMatrix.elements[12])),g.scale.y=K.scale.y*Math.abs(g.y-(D.y+h.projectionMatrix.elements[5])/(D.w+h.projectionMatrix.elements[13])),g.material=K.material,P.elements.push(g))}return y===!0&&P.elements.sort(a),P}},THREE.Face3=function(e,t,r,i,o,n){this.a=e,this.b=t,this.c=r,this.normal=i instanceof THREE.Vector3?i:new THREE.Vector3,this.vertexNormals=i instanceof Array?i:[],this.color=o instanceof THREE.Color?o:new THREE.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=void 0!==n?n:0,this.centroid=new THREE.Vector3},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e=new THREE.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,r;for(t=0,r=this.vertexNormals.length;r>t;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,r=this.vertexColors.length;r>t;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,r=this.vertexTangents.length;r>t;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.Face4=function(e,t,r,i,o,n,a){this.a=e,this.b=t,this.c=r,this.d=i,this.normal=o instanceof THREE.Vector3?o:new THREE.Vector3,this.vertexNormals=o instanceof Array?o:[],this.color=n instanceof THREE.Color?n:new THREE.Color,this.vertexColors=n instanceof Array?n:[],this.vertexTangents=[],this.materialIndex=void 0!==a?a:0,this.centroid=new THREE.Vector3},THREE.Face4.prototype={constructor:THREE.Face4,clone:function(){var e=new THREE.Face4(this.a,this.b,this.c,this.d);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,r;for(t=0,r=this.vertexNormals.length;r>t;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,r=this.vertexColors.length;r>t;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,r=this.vertexTangents.length;r>t;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.Geometry=function(){this.id=THREE.GeometryIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.vertices=[],this.colors=[],this.normals=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){for(var t=(new THREE.Matrix3).getNormalMatrix(e),r=0,i=this.vertices.length;i>r;r++){var o=this.vertices[r];o.applyMatrix4(e)}for(var r=0,i=this.faces.length;i>r;r++){var n=this.faces[r];n.normal.applyMatrix3(t).normalize();for(var a=0,s=n.vertexNormals.length;s>a;a++)n.vertexNormals[a].applyMatrix3(t).normalize();n.centroid.applyMatrix4(e)}this.boundingBox instanceof THREE.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof THREE.Sphere&&this.computeBoundingSphere()},computeCentroids:function(){var e,t,r;for(e=0,t=this.faces.length;t>e;e++)r=this.faces[e],r.centroid.set(0,0,0),r instanceof THREE.Face3?(r.centroid.add(this.vertices[r.a]),r.centroid.add(this.vertices[r.b]),r.centroid.add(this.vertices[r.c]),r.centroid.divideScalar(3)):r instanceof THREE.Face4&&(r.centroid.add(this.vertices[r.a]),r.centroid.add(this.vertices[r.b]),r.centroid.add(this.vertices[r.c]),r.centroid.add(this.vertices[r.d]),r.centroid.divideScalar(4))},computeFaceNormals:function(){for(var e=new THREE.Vector3,t=new THREE.Vector3,r=0,i=this.faces.length;i>r;r++){var o=this.faces[r],n=this.vertices[o.a],a=this.vertices[o.b],s=this.vertices[o.c];e.subVectors(s,a),t.subVectors(n,a),e.cross(t),e.normalize(),o.normal.copy(e)}},computeVertexNormals:function(e){var t,r,i,o,n,a;if(void 0===this.__tmpVertices){for(this.__tmpVertices=new Array(this.vertices.length),a=this.__tmpVertices,t=0,r=this.vertices.length;r>t;t++)a[t]=new THREE.Vector3;for(i=0,o=this.faces.length;o>i;i++)n=this.faces[i],n instanceof THREE.Face3?n.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]:n instanceof THREE.Face4&&(n.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3])}else for(a=this.__tmpVertices,t=0,r=this.vertices.length;r>t;t++)a[t].set(0,0,0);if(e){var s,h,l,c,u=new THREE.Vector3,p=new THREE.Vector3,f=new THREE.Vector3,E=new THREE.Vector3,d=new THREE.Vector3;for(i=0,o=this.faces.length;o>i;i++)n=this.faces[i],n instanceof THREE.Face3?(s=this.vertices[n.a],h=this.vertices[n.b],l=this.vertices[n.c],u.subVectors(l,h),p.subVectors(s,h),u.cross(p),a[n.a].add(u),a[n.b].add(u),a[n.c].add(u)):n instanceof THREE.Face4&&(s=this.vertices[n.a],h=this.vertices[n.b],l=this.vertices[n.c],c=this.vertices[n.d],f.subVectors(c,h),p.subVectors(s,h),f.cross(p),a[n.a].add(f),a[n.b].add(f),a[n.d].add(f),E.subVectors(c,l),d.subVectors(h,l),E.cross(d),a[n.b].add(E),a[n.c].add(E),a[n.d].add(E))}else for(i=0,o=this.faces.length;o>i;i++)n=this.faces[i],n instanceof THREE.Face3?(a[n.a].add(n.normal),a[n.b].add(n.normal),a[n.c].add(n.normal)):n instanceof THREE.Face4&&(a[n.a].add(n.normal),a[n.b].add(n.normal),a[n.c].add(n.normal),a[n.d].add(n.normal));for(t=0,r=this.vertices.length;r>t;t++)a[t].normalize();for(i=0,o=this.faces.length;o>i;i++)n=this.faces[i],n instanceof THREE.Face3?(n.vertexNormals[0].copy(a[n.a]),n.vertexNormals[1].copy(a[n.b]),n.vertexNormals[2].copy(a[n.c])):n instanceof THREE.Face4&&(n.vertexNormals[0].copy(a[n.a]),n.vertexNormals[1].copy(a[n.b]),n.vertexNormals[2].copy(a[n.c]),n.vertexNormals[3].copy(a[n.d]))},computeMorphNormals:function(){var e,t,r,i,o;for(r=0,i=this.faces.length;i>r;r++)for(o=this.faces[r],o.__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),e=0,t=o.vertexNormals.length;t>e;e++)o.__originalVertexNormals[e]?o.__originalVertexNormals[e].copy(o.vertexNormals[e]):o.__originalVertexNormals[e]=o.vertexNormals[e].clone();var n=new THREE.Geometry;for(n.faces=this.faces,e=0,t=this.morphTargets.length;t>e;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a,s,h=this.morphNormals[e].faceNormals,l=this.morphNormals[e].vertexNormals;for(r=0,i=this.faces.length;i>r;r++)o=this.faces[r],a=new THREE.Vector3,s=o instanceof THREE.Face3?{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3}:{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3,d:new THREE.Vector3},h.push(a),l.push(s)}var c=this.morphNormals[e];n.vertices=this.morphTargets[e].vertices,n.computeFaceNormals(),n.computeVertexNormals();var a,s;for(r=0,i=this.faces.length;i>r;r++)o=this.faces[r],a=c.faceNormals[r],s=c.vertexNormals[r],a.copy(o.normal),o instanceof THREE.Face3?(s.a.copy(o.vertexNormals[0]),s.b.copy(o.vertexNormals[1]),s.c.copy(o.vertexNormals[2])):(s.a.copy(o.vertexNormals[0]),s.b.copy(o.vertexNormals[1]),s.c.copy(o.vertexNormals[2]),s.d.copy(o.vertexNormals[3]))}for(r=0,i=this.faces.length;i>r;r++)o=this.faces[r],o.normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals},computeTangents:function(){function e(e,t,r,i,o,n,a){l=e.vertices[t],c=e.vertices[r],u=e.vertices[i],p=h[o],f=h[n],E=h[a],d=c.x-l.x,m=u.x-l.x,g=c.y-l.y,v=u.y-l.y,T=c.z-l.z,y=u.z-l.z,R=f.x-p.x,x=E.x-p.x,H=f.y-p.y,_=E.y-p.y,b=1/(R*_-x*H),L.set((_*d-H*m)*b,(_*g-H*v)*b,(_*T-H*y)*b),P.set((R*m-x*d)*b,(R*v-x*g)*b,(R*y-x*T)*b),A[t].add(L),A[r].add(L),A[i].add(L),C[t].add(P),C[r].add(P),C[i].add(P)}var t,r,i,o,n,a,s,h,l,c,u,p,f,E,d,m,g,v,T,y,R,x,H,_,b,w,M,S,A=[],C=[],L=new THREE.Vector3,P=new THREE.Vector3,F=new THREE.Vector3,D=new THREE.Vector3,U=new THREE.Vector3;for(i=0,o=this.vertices.length;o>i;i++)A[i]=new THREE.Vector3,C[i]=new THREE.Vector3;for(t=0,r=this.faces.length;r>t;t++)s=this.faces[t],h=this.faceVertexUvs[0][t],s instanceof THREE.Face3?e(this,s.a,s.b,s.c,0,1,2):s instanceof THREE.Face4&&(e(this,s.a,s.b,s.d,0,1,3),e(this,s.b,s.c,s.d,1,2,3));var V=["a","b","c","d"];for(t=0,r=this.faces.length;r>t;t++)for(s=this.faces[t],n=0;n<s.vertexNormals.length;n++)U.copy(s.vertexNormals[n]),a=s[V[n]],w=A[a],F.copy(w),F.sub(U.multiplyScalar(U.dot(w))).normalize(),D.crossVectors(s.vertexNormals[n],w),M=D.dot(C[a]),S=0>M?-1:1,s.vertexTangents[n]=new THREE.Vector4(F.x,F.y,F.z,S);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,r=0,i=t.length;i>r;r++)r>0&&(e+=t[r].distanceTo(t[r-1])),this.lineDistances[r]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),this.boundingSphere.setFromPoints(this.vertices)},mergeVertices:function(){var e,t,r,i,o,n,a,s,h,l={},c=[],u=[],p=4,f=Math.pow(10,p);for(this.__tmpVertices=void 0,r=0,i=this.vertices.length;i>r;r++)e=this.vertices[r],t=Math.round(e.x*f)+"_"+Math.round(e.y*f)+"_"+Math.round(e.z*f),void 0===l[t]?(l[t]=r,c.push(this.vertices[r]),u[r]=c.length-1):u[r]=u[l[t]];var E=[];for(r=0,i=this.faces.length;i>r;r++)if(o=this.faces[r],o instanceof THREE.Face3){o.a=u[o.a],o.b=u[o.b],o.c=u[o.c],n=[o.a,o.b,o.c];for(var d=-1,m=0;3>m;m++)if(n[m]==n[(m+1)%3]){d=m,E.push(r);break}}else if(o instanceof THREE.Face4){o.a=u[o.a],o.b=u[o.b],o.c=u[o.c],o.d=u[o.d],n=[o.a,o.b,o.c,o.d];for(var d=-1,m=0;4>m;m++)n[m]==n[(m+1)%4]&&(d>=0&&E.push(r),d=m);if(d>=0){n.splice(d,1);var g=new THREE.Face3(n[0],n[1],n[2],o.normal,o.color,o.materialIndex);for(a=0,s=this.faceVertexUvs.length;s>a;a++)h=this.faceVertexUvs[a][r],h&&h.splice(d,1);o.vertexNormals&&o.vertexNormals.length>0&&(g.vertexNormals=o.vertexNormals,g.vertexNormals.splice(d,1)),o.vertexColors&&o.vertexColors.length>0&&(g.vertexColors=o.vertexColors,g.vertexColors.splice(d,1)),this.faces[r]=g}}for(r=E.length-1;r>=0;r--)for(this.faces.splice(r,1),a=0,s=this.faceVertexUvs.length;s>a;a++)this.faceVertexUvs[a].splice(r,1);var v=this.vertices.length-c.length;return this.vertices=c,v},clone:function(){for(var e=new THREE.Geometry,t=this.vertices,r=0,i=t.length;i>r;r++)e.vertices.push(t[r].clone());for(var o=this.faces,r=0,i=o.length;i>r;r++)e.faces.push(o[r].clone());for(var n=this.faceVertexUvs[0],r=0,i=n.length;i>r;r++){for(var a=n[r],s=[],h=0,l=a.length;l>h;h++)s.push(new THREE.Vector2(a[h].x,a[h].y));e.faceVertexUvs[0].push(s)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype),THREE.GeometryIdCount=0,THREE.BufferGeometry=function(){this.id=THREE.GeometryIdCount++,this.uuid=THREE.Math.generateUUID(),this.attributes={},this.dynamic=!1,this.offsets=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.morphTargets=[]},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,applyMatrix:function(e){var t,r;if(this.attributes.position&&(t=this.attributes.position.array),this.attributes.normal&&(r=this.attributes.normal.array),void 0!==t&&(e.multiplyVector3Array(t),this.verticesNeedUpdate=!0),void 0!==r){var i=(new THREE.Matrix3).getNormalMatrix(e);\r\ni.multiplyVector3Array(r),this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.attributes.position.array;if(e){var t,r,i,o=this.boundingBox;e.length>=3&&(o.min.x=o.max.x=e[0],o.min.y=o.max.y=e[1],o.min.z=o.max.z=e[2]);for(var n=3,a=e.length;a>n;n+=3)t=e[n],r=e[n+1],i=e[n+2],t<o.min.x?o.min.x=t:t>o.max.x&&(o.max.x=t),r<o.min.y?o.min.y=r:r>o.max.y&&(o.max.y=r),i<o.min.z?o.min.z=i:i>o.max.z&&(o.max.z=i)}(void 0===e||0===e.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var e=this.attributes.position.array;if(e){for(var t,r,i,o,n=0,a=0,s=e.length;s>a;a+=3)r=e[a],i=e[a+1],o=e[a+2],t=r*r+i*i+o*o,t>n&&(n=t);this.boundingSphere.radius=Math.sqrt(n)}},computeVertexNormals:function(){if(this.attributes.position){var e,t,r,i,o=this.attributes.position.array.length;if(void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(o)};else for(e=0,t=this.attributes.normal.array.length;t>e;e++)this.attributes.normal.array[e]=0;var n,a,s,h,l,c,u=this.attributes.position.array,p=this.attributes.normal.array,f=new THREE.Vector3,E=new THREE.Vector3,d=new THREE.Vector3,m=new THREE.Vector3,g=new THREE.Vector3;if(this.attributes.index){var v=this.attributes.index.array,T=this.offsets;for(r=0,i=T.length;i>r;++r){var y=T[r].start,R=T[r].count,x=T[r].index;for(e=y,t=y+R;t>e;e+=3)n=x+v[e],a=x+v[e+1],s=x+v[e+2],h=u[3*n],l=u[3*n+1],c=u[3*n+2],f.set(h,l,c),h=u[3*a],l=u[3*a+1],c=u[3*a+2],E.set(h,l,c),h=u[3*s],l=u[3*s+1],c=u[3*s+2],d.set(h,l,c),m.subVectors(d,E),g.subVectors(f,E),m.cross(g),p[3*n]+=m.x,p[3*n+1]+=m.y,p[3*n+2]+=m.z,p[3*a]+=m.x,p[3*a+1]+=m.y,p[3*a+2]+=m.z,p[3*s]+=m.x,p[3*s+1]+=m.y,p[3*s+2]+=m.z}}else for(e=0,t=u.length;t>e;e+=9)h=u[e],l=u[e+1],c=u[e+2],f.set(h,l,c),h=u[e+3],l=u[e+4],c=u[e+5],E.set(h,l,c),h=u[e+6],l=u[e+7],c=u[e+8],d.set(h,l,c),m.subVectors(d,E),g.subVectors(f,E),m.cross(g),p[e]=m.x,p[e+1]=m.y,p[e+2]=m.z,p[e+3]=m.x,p[e+4]=m.y,p[e+5]=m.z,p[e+6]=m.x,p[e+7]=m.y,p[e+8]=m.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e,t,r,i,o=this.attributes.normal.array,n=0,a=o.length;a>n;n+=3)e=o[n],t=o[n+1],r=o[n+2],i=1/Math.sqrt(e*e+t*t+r*r),o[n]*=i,o[n+1]*=i,o[n+2]*=i},computeTangents:function(){function e(e,t,r){p=i[3*e],f=i[3*e+1],E=i[3*e+2],d=i[3*t],m=i[3*t+1],g=i[3*t+2],v=i[3*r],T=i[3*r+1],y=i[3*r+2],R=n[2*e],x=n[2*e+1],H=n[2*t],_=n[2*t+1],b=n[2*r],w=n[2*r+1],M=d-p,S=v-p,A=m-f,C=T-f,L=g-E,P=y-E,F=H-R,D=b-R,U=_-x,V=w-x,O=1/(F*V-D*U),W.set((V*M-U*S)*O,(V*A-U*C)*O,(V*L-U*P)*O),X.set((F*S-D*M)*O,(F*C-D*A)*O,(F*P-D*L)*O),l[e].add(W),l[t].add(W),l[r].add(W),c[e].add(X),c[t].add(X),c[r].add(X)}function t(e){re.x=o[3*e],re.y=o[3*e+1],re.z=o[3*e+2],ie.copy(re),J=l[e],ee.copy(J),ee.sub(re.multiplyScalar(re.dot(J))).normalize(),te.crossVectors(ie,J),$=te.dot(c[e]),Q=0>$?-1:1,h[4*e]=ee.x,h[4*e+1]=ee.y,h[4*e+2]=ee.z,h[4*e+3]=Q}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)return void console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");var r=this.attributes.index.array,i=this.attributes.position.array,o=this.attributes.normal.array,n=this.attributes.uv.array,a=i.length/3;if(void 0===this.attributes.tangent){var s=4*a;this.attributes.tangent={itemSize:4,array:new Float32Array(s)}}for(var h=this.attributes.tangent.array,l=[],c=[],u=0;a>u;u++)l[u]=new THREE.Vector3,c[u]=new THREE.Vector3;var p,f,E,d,m,g,v,T,y,R,x,H,_,b,w,M,S,A,C,L,P,F,D,U,V,O,z,N,B,I,k,G,j,W=new THREE.Vector3,X=new THREE.Vector3,Y=this.offsets;for(B=0,I=Y.length;I>B;++B){var q=Y[B].start,K=Y[B].count,Z=Y[B].index;for(z=q,N=q+K;N>z;z+=3)k=Z+r[z],G=Z+r[z+1],j=Z+r[z+2],e(k,G,j)}var Q,J,$,ee=new THREE.Vector3,te=new THREE.Vector3,re=new THREE.Vector3,ie=new THREE.Vector3;for(B=0,I=Y.length;I>B;++B){var q=Y[B].start,K=Y[B].count,Z=Y[B].index;for(z=q,N=q+K;N>z;z+=3)k=Z+r[z],G=Z+r[z+1],j=Z+r[z+2],t(k),t(G),t(j)}this.hasTangents=!0,this.tangentsNeedUpdate=!0},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype),THREE.Camera=function(){THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4,this.projectionMatrixInverse=new THREE.Matrix4},THREE.Camera.prototype=Object.create(THREE.Object3D.prototype),THREE.Camera.prototype.lookAt=function(){var e=new THREE.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),THREE.OrthographicCamera=function(e,t,r,i,o,n){THREE.Camera.call(this),this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=void 0!==o?o:.1,this.far=void 0!==n?n:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype),THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.PerspectiveCamera=function(e,t,r,i){THREE.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype),THREE.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*THREE.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,r,i,o,n){this.fullWidth=e,this.fullHeight=t,this.x=r,this.y=i,this.width=o,this.height=n,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(THREE.Math.degToRad(.5*this.fov))*this.near,r=-t,i=e*r,o=e*t,n=Math.abs(o-i),a=Math.abs(t-r);this.projectionMatrix.makeFrustum(i+this.x*n/this.fullWidth,i+(this.x+this.width)*n/this.fullWidth,t-(this.y+this.height)*a/this.fullHeight,t-this.y*a/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.Light=function(e){THREE.Object3D.call(this),this.color=new THREE.Color(e)},THREE.Light.prototype=Object.create(THREE.Object3D.prototype),THREE.Light.prototype.clone=function(e){return void 0===e&&(e=new THREE.Light),THREE.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},THREE.AmbientLight=function(e){THREE.Light.call(this,e)},THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype),THREE.AmbientLight.prototype.clone=function(){var e=new THREE.AmbientLight;return THREE.Light.prototype.clone.call(this,e),e},THREE.AreaLight=function(e,t){THREE.Light.call(this,e),this.normal=new THREE.Vector3(0,-1,0),this.right=new THREE.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},THREE.AreaLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight=function(e,t){THREE.Light.call(this,e),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight.prototype.clone=function(){var e=new THREE.DirectionalLight;return THREE.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},THREE.HemisphereLight=function(e,t,r){THREE.Light.call(this,e),this.position.set(0,100,0),this.groundColor=new THREE.Color(t),this.intensity=void 0!==r?r:1},THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype),THREE.HemisphereLight.prototype.clone=function(){var e=new THREE.PointLight;return THREE.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},THREE.PointLight=function(e,t,r){THREE.Light.call(this,e),this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0},THREE.PointLight.prototype=Object.create(THREE.Light.prototype),THREE.PointLight.prototype.clone=function(){var e=new THREE.PointLight;return THREE.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e},THREE.SpotLight=function(e,t,r,i,o){THREE.Light.call(this,e),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/3,this.exponent=void 0!==o?o:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},THREE.SpotLight.prototype=Object.create(THREE.Light.prototype),THREE.SpotLight.prototype.clone=function(){var e=new THREE.SpotLight;return THREE.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},THREE.Loader=function(e){this.showStatus=e,this.statusDomElement=e?THREE.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";t+=e.total?(100*e.loaded/e.total).toFixed(0)+"%":(e.loaded/1e3).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return t.pop(),(t.length<1?".":t.join("/"))+"/"},initMaterials:function(e,t){for(var r=[],i=0;i<e.length;++i)r[i]=THREE.Loader.prototype.createMaterial(e[i],t);return r},needsTangents:function(e){for(var t=0,r=e.length;r>t;t++){var i=e[t];if(i instanceof THREE.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){function r(e){var t=Math.log(e)/Math.LN2;return Math.floor(t)==t}function i(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function o(e,t){var o=new Image;o.onload=function(){if(r(this.width)&&r(this.height))e.image=this;else{var t=i(this.width),o=i(this.height);e.image.width=t,e.image.height=o,e.image.getContext("2d").drawImage(this,0,0,t,o)}e.needsUpdate=!0},o.crossOrigin=s.crossOrigin,o.src=t}function n(e,r,i,n,a,s,h){var l=/\\.dds$/i.test(i),c=t+"/"+i;if(l){var u=THREE.ImageUtils.loadCompressedTexture(c);e[r]=u}else{var u=document.createElement("canvas");e[r]=new THREE.Texture(u)}if(e[r].sourceFile=i,n&&(e[r].repeat.set(n[0],n[1]),1!==n[0]&&(e[r].wrapS=THREE.RepeatWrapping),1!==n[1]&&(e[r].wrapT=THREE.RepeatWrapping)),a&&e[r].offset.set(a[0],a[1]),s){var p={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};void 0!==p[s[0]]&&(e[r].wrapS=p[s[0]]),void 0!==p[s[1]]&&(e[r].wrapT=p[s[1]])}h&&(e[r].anisotropy=h),l||o(e[r],c)}function a(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var s=this,h="MeshLambertMaterial",l={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var c=e.shading.toLowerCase();"phong"===c?h="MeshPhongMaterial":"basic"===c&&(h="MeshBasicMaterial")}if(void 0!==e.blending&&void 0!==THREE[e.blending]&&(l.blending=THREE[e.blending]),(void 0!==e.transparent||e.opacity<1)&&(l.transparent=e.transparent),void 0!==e.depthTest&&(l.depthTest=e.depthTest),void 0!==e.depthWrite&&(l.depthWrite=e.depthWrite),void 0!==e.visible&&(l.visible=e.visible),void 0!==e.flipSided&&(l.side=THREE.BackSide),void 0!==e.doubleSided&&(l.side=THREE.DoubleSide),void 0!==e.wireframe&&(l.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?l.vertexColors=THREE.FaceColors:e.vertexColors&&(l.vertexColors=THREE.VertexColors)),e.colorDiffuse?l.color=a(e.colorDiffuse):e.DbgColor&&(l.color=e.DbgColor),e.colorSpecular&&(l.specular=a(e.colorSpecular)),e.colorAmbient&&(l.ambient=a(e.colorAmbient)),e.transparency&&(l.opacity=e.transparency),e.specularCoef&&(l.shininess=e.specularCoef),e.mapDiffuse&&t&&n(l,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&n(l,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&n(l,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&n(l,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&n(l,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapBumpScale&&(l.bumpScale=e.mapBumpScale),e.mapNormal){var u=THREE.ShaderLib.normalmap,p=THREE.UniformsUtils.clone(u.uniforms);p.tNormal.value=l.normalMap,e.mapNormalFactor&&p.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),l.map&&(p.tDiffuse.value=l.map,p.enableDiffuse.value=!0),l.specularMap&&(p.tSpecular.value=l.specularMap,p.enableSpecular.value=!0),l.lightMap&&(p.tAO.value=l.lightMap,p.enableAO.value=!0),p.uDiffuseColor.value.setHex(l.color),p.uSpecularColor.value.setHex(l.specular),p.uAmbientColor.value.setHex(l.ambient),p.uShininess.value=l.shininess,void 0!==l.opacity&&(p.uOpacity.value=l.opacity);var f={fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:p,lights:!0,fog:!0},E=new THREE.ShaderMaterial(f);l.transparent&&(E.transparent=!0)}else var E=new THREE[h](l);return void 0!==e.DbgName&&(E.name=e.DbgName),E}},THREE.XHRLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(e,t,r,i){var o=this,n=new XMLHttpRequest;void 0!==t&&n.addEventListener("load",function(r){o.manager.itemEnd(e),t(r.target.responseText)},!1),void 0!==r&&n.addEventListener("progress",function(e){r(e)},!1),void 0!==i&&n.addEventListener("error",function(e){i(e)},!1),void 0!==this.crossOrigin&&(n.crossOrigin=this.crossOrigin),n.open("GET",e,!0),n.send(null),o.manager.itemStart(e)},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.ImageLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(e,t,r,i){var o=this,n=document.createElement("img");void 0!==t&&n.addEventListener("load",function(r){o.manager.itemEnd(e),t(this)},!1),void 0!==r&&n.addEventListener("progress",function(e){r(e)},!1),void 0!==i&&n.addEventListener("error",function(e){i(e)},!1),void 0!==this.crossOrigin&&(n.crossOrigin=this.crossOrigin),n.src=e,o.manager.itemStart(e)},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.JSONLoader=function(e){THREE.Loader.call(this,e),this.withCredentials=!1},THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype),THREE.JSONLoader.prototype.load=function(e,t,r){r=r&&"string"==typeof r?r:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,r)},THREE.JSONLoader.prototype.loadAjaxJSON=function(e,t,r,i,o){var n=new XMLHttpRequest,a=0;n.onreadystatechange=function(){if(n.readyState===n.DONE)if(200===n.status||0===n.status){if(n.responseText){var s=JSON.parse(n.responseText),h=e.parse(s,i);r(h.geometry,h.materials)}else console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn\'t load ["+t+"] ["+n.status+"]");else n.readyState===n.LOADING?o&&(0===a&&(a=n.getResponseHeader("Content-Length")),o({total:a,loaded:n.responseText.length})):n.readyState===n.HEADERS_RECEIVED&&void 0!==o&&(a=n.getResponseHeader("Content-Length"))},n.open("GET",t,!0),n.withCredentials=this.withCredentials,n.send(null)},THREE.JSONLoader.prototype.parse=function(e,t){function r(t){function r(e,t){return e&1<<t}var i,o,a,s,h,l,c,u,p,f,E,d,m,g,v,T,y,R,x,H,_,b,w,M,S,A,C,L=e.faces,P=e.vertices,F=e.normals,D=e.colors,U=0;if(void 0!==e.uvs){for(i=0;i<e.uvs.length;i++)e.uvs[i].length&&U++;for(i=0;U>i;i++)n.faceUvs[i]=[],n.faceVertexUvs[i]=[]}for(s=0,h=P.length;h>s;)H=new THREE.Vector3,H.x=P[s++]*t,H.y=P[s++]*t,H.z=P[s++]*t,n.vertices.push(H);for(s=0,h=L.length;h>s;){if(E=L[s++],d=r(E,0),m=r(E,1),g=r(E,2),v=r(E,3),T=r(E,4),y=r(E,5),R=r(E,6),x=r(E,7),d?(_=new THREE.Face4,_.a=L[s++],_.b=L[s++],_.c=L[s++],_.d=L[s++],l=4):(_=new THREE.Face3,_.a=L[s++],_.b=L[s++],_.c=L[s++],l=3),m&&(f=L[s++],_.materialIndex=f),a=n.faces.length,g)for(i=0;U>i;i++)M=e.uvs[i],p=L[s++],A=M[2*p],C=M[2*p+1],n.faceUvs[i][a]=new THREE.Vector2(A,C);if(v)for(i=0;U>i;i++){for(M=e.uvs[i],S=[],o=0;l>o;o++)p=L[s++],A=M[2*p],C=M[2*p+1],S[o]=new THREE.Vector2(A,C);n.faceVertexUvs[i][a]=S}if(T&&(u=3*L[s++],w=new THREE.Vector3,w.x=F[u++],w.y=F[u++],w.z=F[u],_.normal=w),y)for(i=0;l>i;i++)u=3*L[s++],w=new THREE.Vector3,w.x=F[u++],w.y=F[u++],w.z=F[u],_.vertexNormals.push(w);if(R&&(c=L[s++],b=new THREE.Color(D[c]),_.color=b),x)for(i=0;l>i;i++)c=L[s++],b=new THREE.Color(D[c]),_.vertexColors.push(b);n.faces.push(_)}}function i(){var t,r,i,o,a,s,h,l,c,u;if(e.skinWeights)for(t=0,r=e.skinWeights.length;r>t;t+=2)i=e.skinWeights[t],o=e.skinWeights[t+1],a=0,s=0,n.skinWeights.push(new THREE.Vector4(i,o,a,s));if(e.skinIndices)for(t=0,r=e.skinIndices.length;r>t;t+=2)h=e.skinIndices[t],l=e.skinIndices[t+1],c=0,u=0,n.skinIndices.push(new THREE.Vector4(h,l,c,u));n.bones=e.bones,n.animation=e.animation}function o(t){if(void 0!==e.morphTargets){var r,i,o,a,s,h;for(r=0,i=e.morphTargets.length;i>r;r++)for(n.morphTargets[r]={},n.morphTargets[r].name=e.morphTargets[r].name,n.morphTargets[r].vertices=[],s=n.morphTargets[r].vertices,h=e.morphTargets[r].vertices,o=0,a=h.length;a>o;o+=3){var l=new THREE.Vector3;l.x=h[o]*t,l.y=h[o+1]*t,l.z=h[o+2]*t,s.push(l)}}if(void 0!==e.morphColors){var r,i,c,u,p,f,E;for(r=0,i=e.morphColors.length;i>r;r++)for(n.morphColors[r]={},n.morphColors[r].name=e.morphColors[r].name,n.morphColors[r].colors=[],p=n.morphColors[r].colors,f=e.morphColors[r].colors,c=0,u=f.length;u>c;c+=3)E=new THREE.Color(16755200),E.setRGB(f[c],f[c+1],f[c+2]),p.push(E)}}var n=new THREE.Geometry,a=void 0!==e.scale?1/e.scale:1;if(r(a),i(),o(a),n.computeCentroids(),n.computeFaceNormals(),n.computeBoundingSphere(),void 0===e.materials)return{geometry:n};var s=this.initMaterials(e.materials,t);return this.needsTangents(s)&&n.computeTangents(),{geometry:n,materials:s}},THREE.LoadingManager=function(e,t,r){var i=this,o=0,n=0;this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){n++},this.itemEnd=function(e){o++,void 0!==i.onProgress&&i.onProgress(e,o,n),o===n&&void 0!==i.onLoad&&i.onLoad()}},THREE.DefaultLoadingManager=new THREE.LoadingManager,THREE.GeometryLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.GeometryLoader.prototype={constructor:THREE.GeometryLoader,load:function(e,t,r,i){var o=this,n=new THREE.XHRLoader;n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(o.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){}},THREE.MaterialLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(e,t,r,i){var o=this,n=new THREE.XHRLoader;n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(o.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t;switch(e.type){case"MeshBasicMaterial":t=new THREE.MeshBasicMaterial({color:e.color,opacity:e.opacity,transparent:e.transparent,wireframe:e.wireframe});break;case"MeshLambertMaterial":t=new THREE.MeshLambertMaterial({color:e.color,ambient:e.ambient,emissive:e.emissive,opacity:e.opacity,transparent:e.transparent,wireframe:e.wireframe});break;case"MeshPhongMaterial":t=new THREE.MeshPhongMaterial({color:e.color,ambient:e.ambient,emissive:e.emissive,specular:e.specular,shininess:e.shininess,opacity:e.opacity,transparent:e.transparent,wireframe:e.wireframe});break;case"MeshNormalMaterial":t=new THREE.MeshNormalMaterial({opacity:e.opacity,transparent:e.transparent,wireframe:e.wireframe});break;case"MeshDepthMaterial":t=new THREE.MeshDepthMaterial({opacity:e.opacity,transparent:e.transparent,wireframe:e.wireframe})}return void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),t}},THREE.ObjectLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(e,t,r,i){var o=this,n=new THREE.XHRLoader(o.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(o.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.parseGeometries(e.geometries),r=this.parseMaterials(e.materials),i=this.parseObject(e.object,t,r);return i},parseGeometries:function(e){var t={};if(void 0!==e)for(var r=new THREE.JSONLoader,i=0,o=e.length;o>i;i++){var n,a=e[i];switch(a.type){case"PlaneGeometry":n=new THREE.PlaneGeometry(a.width,a.height,a.widthSegments,a.heightSegments);break;case"CubeGeometry":n=new THREE.CubeGeometry(a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CylinderGeometry":n=new THREE.CylinderGeometry(a.radiusTop,a.radiusBottom,a.height,a.radiusSegments,a.heightSegments,a.openEnded);break;case"SphereGeometry":n=new THREE.SphereGeometry(a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"IcosahedronGeometry":n=new THREE.IcosahedronGeometry(a.radius,a.detail);break;case"TorusGeometry":n=new THREE.TorusGeometry(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":n=new THREE.TorusKnotGeometry(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.p,a.q,a.heightScale);break;case"Geometry":n=r.parse(a.data).geometry}n.uuid=a.uuid,void 0!==a.name&&(n.name=a.name),t[a.uuid]=n}return t},parseMaterials:function(e){var t={};if(void 0!==e)for(var r=new THREE.MaterialLoader,i=0,o=e.length;o>i;i++){var n=e[i],a=r.parse(n);a.uuid=n.uuid,void 0!==n.name&&(a.name=n.name),t[n.uuid]=a}return t},parseObject:function(){var e=new THREE.Matrix4;return function(t,r,i){var o;switch(t.type){case"Scene":o=new THREE.Scene;break;case"PerspectiveCamera":o=new THREE.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":o=new THREE.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":o=new THREE.AmbientLight(t.color);break;case"DirectionalLight":o=new THREE.DirectionalLight(t.color,t.intensity);break;case"PointLight":o=new THREE.PointLight(t.color,t.intensity,t.distance);break;case"SpotLight":o=new THREE.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent);break;case"HemisphereLight":o=new THREE.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":var n=r[t.geometry],a=i[t.material];void 0===n&&console.error("THREE.ObjectLoader: Undefined geometry "+t.geometry),void 0===a&&console.error("THREE.ObjectLoader: Undefined material "+t.material),o=new THREE.Mesh(n,a);break;default:o=new THREE.Object3D}if(o.uuid=t.uuid,void 0!==t.name&&(o.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(o.position,o.quaternion,o.scale)):(void 0!==t.position&&o.position.fromArray(t.position),void 0!==t.rotation&&o.rotation.fromArray(t.rotation),void 0!==t.scale&&o.scale.fromArray(t.scale)),void 0!==t.visible&&(o.visible=t.visible),void 0!==t.userData&&(o.userData=t.userData),void 0!==t.children)for(var s in t.children)o.add(this.parseObject(t.children[s],r,i));return o}}()},THREE.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlers={},this.hierarchyHandlers={},this.addGeometryHandler("ascii",THREE.JSONLoader)},THREE.SceneLoader.prototype={constructor:THREE.SceneLoader,load:function(e,t,r,i){var o=this,n=new THREE.XHRLoader(o.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,function(r){o.parse(JSON.parse(r),t,e)})},setCrossOrigin:function(e){this.crossOrigin=e},addGeometryHandler:function(e,t){this.geometryHandlers[e]={loaderClass:t}},addHierarchyHandler:function(e,t){this.hierarchyHandlers[e]={loaderClass:t}},parse:function(e,t,r){function i(e,t){return"relativeToHTML"==t?e:A+"/"+e}function o(){n(M.scene,L.objects)}function n(e,t){var r,o,a,s,h,c;for(var u in t){var p=M.objects[u],f=t[u];if(void 0===p){if(f.type&&f.type in S.hierarchyHandlers){if(void 0===f.loading){var g={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1},v={};for(var T in f)T in g||(v[T]=f[T]);d=M.materials[f.material],f.loading=!0;var H=S.hierarchyHandlers[f.type].loaderObject;H.options?H.load(i(f.url,L.urlBaseType),l(u,e,d,f)):H.load(i(f.url,L.urlBaseType),l(u,e,d,f),v)}}else if(void 0!==f.geometry){if(E=M.geometries[f.geometry]){var _=!1;if(d=M.materials[f.material],_=d instanceof THREE.ShaderMaterial,a=f.position,s=f.rotation,h=f.scale,r=f.matrix,c=f.quaternion,f.material||(d=new THREE.MeshFaceMaterial(M.face_materials[f.geometry])),d instanceof THREE.MeshFaceMaterial&&0===d.materials.length&&(d=new THREE.MeshFaceMaterial(M.face_materials[f.geometry])),d instanceof THREE.MeshFaceMaterial)for(var b=0;b<d.materials.length;b++)_=_||d.materials[b]instanceof THREE.ShaderMaterial;_&&E.computeTangents(),f.skin?p=new THREE.SkinnedMesh(E,d):f.morph?(p=new THREE.MorphAnimMesh(E,d),void 0!==f.duration&&(p.duration=f.duration),void 0!==f.time&&(p.time=f.time),void 0!==f.mirroredLoop&&(p.mirroredLoop=f.mirroredLoop),d.morphNormals&&E.computeMorphNormals()):p=new THREE.Mesh(E,d),p.name=u,r?(p.matrixAutoUpdate=!1,p.matrix.set(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])):(p.position.fromArray(a),c?p.quaternion.fromArray(c):p.rotation.fromArray(s),p.scale.fromArray(h)),p.visible=f.visible,p.castShadow=f.castShadow,p.receiveShadow=f.receiveShadow,e.add(p),M.objects[u]=p}}else"DirectionalLight"===f.type||"PointLight"===f.type||"AmbientLight"===f.type?(R=void 0!==f.color?f.color:16777215,x=void 0!==f.intensity?f.intensity:1,"DirectionalLight"===f.type?(a=f.direction,y=new THREE.DirectionalLight(R,x),y.position.fromArray(a),f.target&&(C.push({object:y,targetName:f.target}),y.target=null)):"PointLight"===f.type?(a=f.position,o=f.distance,y=new THREE.PointLight(R,x,o),y.position.fromArray(a)):"AmbientLight"===f.type&&(y=new THREE.AmbientLight(R)),e.add(y),y.name=u,M.lights[u]=y,M.objects[u]=y):"PerspectiveCamera"===f.type||"OrthographicCamera"===f.type?(a=f.position,s=f.rotation,c=f.quaternion,"PerspectiveCamera"===f.type?m=new THREE.PerspectiveCamera(f.fov,f.aspect,f.near,f.far):"OrthographicCamera"===f.type&&(m=new THREE.OrthographicCamera(f.left,f.right,f.top,f.bottom,f.near,f.far)),m.name=u,m.position.fromArray(a),void 0!==c?m.quaternion.fromArray(c):void 0!==s&&m.rotation.fromArray(s),e.add(m),M.cameras[u]=m,M.objects[u]=m):(a=f.position,s=f.rotation,h=f.scale,c=f.quaternion,p=new THREE.Object3D,p.name=u,p.position.fromArray(a),c?p.quaternion.fromArray(c):p.rotation.fromArray(s),p.scale.fromArray(h),p.visible=void 0!==f.visible?f.visible:!1,e.add(p),M.objects[u]=p,M.empties[u]=p);if(p){if(void 0!==f.userData)for(var w in f.userData){var A=f.userData[w];p.userData[w]=A}if(void 0!==f.groups)for(var b=0;b<f.groups.length;b++){var P=f.groups[b];void 0===M.groups[P]&&(M.groups[P]=[]),M.groups[P].push(u)}}}void 0!==p&&void 0!==f.children&&n(p,f.children)}}function a(e,t,r){M.geometries[r]=e,M.face_materials[r]=t,o()}function s(e,t,r,i,n){var a=n.position,s=n.rotation,h=n.quaternion,l=n.scale;e.position.fromArray(a),h?e.quaternion.fromArray(h):e.rotation.fromArray(s),e.scale.fromArray(l),i&&e.traverse(function(e){e.material=i});var c=void 0!==n.visible?n.visible:!0;e.traverse(function(e){e.visible=c}),r.add(e),e.name=t,M.objects[t]=e,o()}function h(e){return function(t,r){t.name=e,a(t,r,e),H-=1,S.onLoadComplete(),u()}}function l(e,t,r,i){return function(o){var n;n=o.content?o.content:o.dae?o.scene:o,s(n,e,t,r,i),H-=1,S.onLoadComplete(),u()}}function c(e){return function(t,r){t.name=e,M.geometries[e]=t,M.face_materials[e]=r}}function u(){var e={totalModels:b,totalTextures:w,loadedModels:b-H,loadedTextures:w-_};S.callbackProgress(e,M),S.onLoadProgress(),0===H&&0===_&&(p(),t(M))}function p(){for(var e=0;e<C.length;e++){var t=C[e],r=M.objects[t.targetName];r?t.object.target=r:(t.object.target=new THREE.Object3D,M.scene.add(t.object.target)),t.object.target.userData.targetInverse=t.object}}function f(e,t){if(t(e),void 0!==e.children)for(var r in e.children)f(e.children[r],t)}var E,d,m,g,v,T,y,R,x,H,_,b,w,M,S=this,A=THREE.Loader.prototype.extractUrlBase(r),C=[],L=e;for(var P in this.geometryHandlers){var F=this.geometryHandlers[P].loaderClass;this.geometryHandlers[P].loaderObject=new F}for(var P in this.hierarchyHandlers){var F=this.hierarchyHandlers[P].loaderClass;this.hierarchyHandlers[P].loaderObject=new F}if(H=0,_=0,M={scene:new THREE.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},L.transform){var D=L.transform.position,U=L.transform.rotation,V=L.transform.scale;D&&M.scene.position.fromArray(D),U&&M.scene.rotation.fromArray(U),V&&M.scene.scale.fromArray(V),(D||U||V)&&(M.scene.updateMatrix(),M.scene.updateMatrixWorld())}var O,z,N=function(e){_-=e,u(),S.onLoadComplete()},B=function(e){return function(){N(e)}};for(O in L.fogs)z=L.fogs[O],"linear"===z.type?g=new THREE.Fog(0,z.near,z.far):"exp2"===z.type&&(g=new THREE.FogExp2(0,z.density)),T=z.color,g.color.setRGB(T[0],T[1],T[2]),M.fogs[O]=g;var I,k;for(I in L.geometries)k=L.geometries[I],k.type in this.geometryHandlers&&(H+=1,S.onLoadStart());for(var G in L.objects)f(L.objects[G],function(e){e.type&&e.type in S.hierarchyHandlers&&(H+=1,S.onLoadStart())});b=H;for(I in L.geometries)if(k=L.geometries[I],"cube"===k.type)E=new THREE.CubeGeometry(k.width,k.height,k.depth,k.widthSegments,k.heightSegments,k.depthSegments),E.name=I,M.geometries[I]=E;else if("plane"===k.type)E=new THREE.PlaneGeometry(k.width,k.height,k.widthSegments,k.heightSegments),E.name=I,M.geometries[I]=E;else if("sphere"===k.type)E=new THREE.SphereGeometry(k.radius,k.widthSegments,k.heightSegments),E.name=I,M.geometries[I]=E;else if("cylinder"===k.type)E=new THREE.CylinderGeometry(k.topRad,k.botRad,k.height,k.radSegs,k.heightSegs),E.name=I,M.geometries[I]=E;else if("torus"===k.type)E=new THREE.TorusGeometry(k.radius,k.tube,k.segmentsR,k.segmentsT),E.name=I,M.geometries[I]=E;else if("icosahedron"===k.type)E=new THREE.IcosahedronGeometry(k.radius,k.subdivisions),E.name=I,M.geometries[I]=E;else if(k.type in this.geometryHandlers){var j={};for(var W in k)"type"!==W&&"url"!==W&&(j[W]=k[W]);var X=this.geometryHandlers[k.type].loaderObject;\r\nX.load(i(k.url,L.urlBaseType),h(I),j)}else if("embedded"===k.type){var Y=L.embeds[k.id],q="";if(Y.metadata=L.metadata,Y){var K=this.geometryHandlers.ascii.loaderObject,Z=K.parse(Y,q);c(I)(Z.geometry,Z.materials)}}var Q,J;for(Q in L.textures)if(J=L.textures[Q],J.url instanceof Array){_+=J.url.length;for(var $=0;$<J.url.length;$++)S.onLoadStart()}else _+=1,S.onLoadStart();w=_;for(Q in L.textures){if(J=L.textures[Q],void 0!==J.mapping&&void 0!==THREE[J.mapping]&&(J.mapping=new THREE[J.mapping]),J.url instanceof Array){for(var ee=J.url.length,te=[],re=0;ee>re;re++)te[re]=i(J.url[re],L.urlBaseType);var ie=/\\.dds$/i.test(te[0]);v=ie?THREE.ImageUtils.loadCompressedTextureCube(te,J.mapping,B(ee)):THREE.ImageUtils.loadTextureCube(te,J.mapping,B(ee))}else{var ie=/\\.dds$/i.test(J.url),oe=i(J.url,L.urlBaseType),ne=B(1);if(v=ie?THREE.ImageUtils.loadCompressedTexture(oe,J.mapping,ne):THREE.ImageUtils.loadTexture(oe,J.mapping,ne),void 0!==THREE[J.minFilter]&&(v.minFilter=THREE[J.minFilter]),void 0!==THREE[J.magFilter]&&(v.magFilter=THREE[J.magFilter]),J.anisotropy&&(v.anisotropy=J.anisotropy),J.repeat&&(v.repeat.set(J.repeat[0],J.repeat[1]),1!==J.repeat[0]&&(v.wrapS=THREE.RepeatWrapping),1!==J.repeat[1]&&(v.wrapT=THREE.RepeatWrapping)),J.offset&&v.offset.set(J.offset[0],J.offset[1]),J.wrap){var ae={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};void 0!==ae[J.wrap[0]]&&(v.wrapS=ae[J.wrap[0]]),void 0!==ae[J.wrap[1]]&&(v.wrapT=ae[J.wrap[1]])}}M.textures[Q]=v}var se,he,le;for(se in L.materials){he=L.materials[se];for(le in he.parameters)if("envMap"===le||"map"===le||"lightMap"===le||"bumpMap"===le)he.parameters[le]=M.textures[he.parameters[le]];else if("shading"===le)he.parameters[le]="flat"===he.parameters[le]?THREE.FlatShading:THREE.SmoothShading;else if("side"===le)"double"==he.parameters[le]?he.parameters[le]=THREE.DoubleSide:"back"==he.parameters[le]?he.parameters[le]=THREE.BackSide:he.parameters[le]=THREE.FrontSide;else if("blending"===le)he.parameters[le]=he.parameters[le]in THREE?THREE[he.parameters[le]]:THREE.NormalBlending;else if("combine"===le)he.parameters[le]=he.parameters[le]in THREE?THREE[he.parameters[le]]:THREE.MultiplyOperation;else if("vertexColors"===le)"face"==he.parameters[le]?he.parameters[le]=THREE.FaceColors:he.parameters[le]&&(he.parameters[le]=THREE.VertexColors);else if("wrapRGB"===le){var ce=he.parameters[le];he.parameters[le]=new THREE.Vector3(ce[0],ce[1],ce[2])}if(void 0!==he.parameters.opacity&&he.parameters.opacity<1&&(he.parameters.transparent=!0),he.parameters.normalMap){var ue=THREE.ShaderLib.normalmap,pe=THREE.UniformsUtils.clone(ue.uniforms),fe=he.parameters.color,Ee=he.parameters.specular,de=he.parameters.ambient,me=he.parameters.shininess;pe.tNormal.value=M.textures[he.parameters.normalMap],he.parameters.normalScale&&pe.uNormalScale.value.set(he.parameters.normalScale[0],he.parameters.normalScale[1]),he.parameters.map&&(pe.tDiffuse.value=he.parameters.map,pe.enableDiffuse.value=!0),he.parameters.envMap&&(pe.tCube.value=he.parameters.envMap,pe.enableReflection.value=!0,pe.uReflectivity.value=he.parameters.reflectivity),he.parameters.lightMap&&(pe.tAO.value=he.parameters.lightMap,pe.enableAO.value=!0),he.parameters.specularMap&&(pe.tSpecular.value=M.textures[he.parameters.specularMap],pe.enableSpecular.value=!0),he.parameters.displacementMap&&(pe.tDisplacement.value=M.textures[he.parameters.displacementMap],pe.enableDisplacement.value=!0,pe.uDisplacementBias.value=he.parameters.displacementBias,pe.uDisplacementScale.value=he.parameters.displacementScale),pe.uDiffuseColor.value.setHex(fe),pe.uSpecularColor.value.setHex(Ee),pe.uAmbientColor.value.setHex(de),pe.uShininess.value=me,he.parameters.opacity&&(pe.uOpacity.value=he.parameters.opacity);var ge={fragmentShader:ue.fragmentShader,vertexShader:ue.vertexShader,uniforms:pe,lights:!0,fog:!0};d=new THREE.ShaderMaterial(ge)}else d=new THREE[he.type](he.parameters);d.name=se,M.materials[se]=d}for(se in L.materials)if(he=L.materials[se],he.parameters.materials){for(var ve=[],re=0;re<he.parameters.materials.length;re++){var Te=he.parameters.materials[re];ve.push(M.materials[Te])}M.materials[se].materials=ve}o(),M.cameras&&L.defaults.camera&&(M.currentCamera=M.cameras[L.defaults.camera]),M.fogs&&L.defaults.fog&&(M.scene.fog=M.fogs[L.defaults.fog]),S.callbackSync(M),u()}},THREE.TextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(e,t,r,i){var o=this,n=new THREE.ImageLoader(o.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){var r=new THREE.Texture(e);r.needsUpdate=!0,void 0!==t&&t(r)})},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.Material=function(){this.id=THREE.MaterialIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.side=THREE.FrontSide,this.opacity=1,this.transparent=!1,this.blending=THREE.NormalBlending,this.blendSrc=THREE.SrcAlphaFactor,this.blendDst=THREE.OneMinusSrcAlphaFactor,this.blendEquation=THREE.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this.needsUpdate=!0},THREE.Material.prototype={constructor:THREE.Material,setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r){if(t in this){var i=this[t];i instanceof THREE.Color?i.set(r):i instanceof THREE.Vector3&&r instanceof THREE.Vector3?i.copy(r):"overdraw"==t?this[t]=Number(r):this[t]=r}}else console.warn("THREE.Material: \'"+t+"\' parameter is undefined.")}},clone:function(e){return void 0===e&&(e=new THREE.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Material.prototype),THREE.MaterialIdCount=0,THREE.LineBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineBasicMaterial.prototype.clone=function(){var e=new THREE.LineBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.LineDashedMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineDashedMaterial.prototype.clone=function(){var e=new THREE.LineDashedMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.MeshBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshBasicMaterial.prototype.clone=function(){var e=new THREE.MeshBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},THREE.MeshLambertMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLambertMaterial.prototype.clone=function(){var e=new THREE.MeshLambertMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshPhongMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.specular=new THREE.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.specularMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshPhongMaterial.prototype.clone=function(){var e=new THREE.MeshPhongMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshDepthMaterial=function(e){THREE.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshDepthMaterial.prototype.clone=function(){var e=new THREE.MeshDepthMaterial;return THREE.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),this.shading=THREE.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshNormalMaterial.prototype.clone=function(){var e=new THREE.MeshNormalMaterial;return THREE.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},THREE.MeshFaceMaterial.prototype.clone=function(){return new THREE.MeshFaceMaterial(this.materials.slice(0))},THREE.ParticleBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.ParticleBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ParticleBasicMaterial.prototype.clone=function(){var e=new THREE.ParticleBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.ParticleCanvasMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.program=function(e,t){},this.setValues(e)},THREE.ParticleCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ParticleCanvasMaterial.prototype.clone=function(){var e=new THREE.ParticleCanvasMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},THREE.ShaderMaterial=function(e){THREE.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=THREE.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial.prototype.clone=function(){var e=new THREE.ShaderMaterial;return THREE.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=THREE.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.SpriteMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=new THREE.Texture,this.useScreenCoordinates=!0,this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.scaleByViewport=!this.sizeAttenuation,this.alignment=THREE.SpriteAlignment.center.clone(),this.fog=!1,this.uvOffset=new THREE.Vector2(0,0),this.uvScale=new THREE.Vector2(1,1),this.setValues(e),e=e||{},void 0===e.depthTest&&(this.depthTest=!this.useScreenCoordinates),void 0===e.sizeAttenuation&&(this.sizeAttenuation=!this.useScreenCoordinates),void 0===e.scaleByViewport&&(this.scaleByViewport=!this.sizeAttenuation)},THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteMaterial.prototype.clone=function(){var e=new THREE.SpriteMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.useScreenCoordinates=this.useScreenCoordinates,e.sizeAttenuation=this.sizeAttenuation,e.scaleByViewport=this.scaleByViewport,e.alignment.copy(this.alignment),e.uvOffset.copy(this.uvOffset),e.uvScale.copy(this.uvScale),e.fog=this.fog,e},THREE.SpriteAlignment={},THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1),THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1),THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1),THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0),THREE.SpriteAlignment.center=new THREE.Vector2(0,0),THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0),THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1),THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1),THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1),THREE.Texture=function(e,t,r,i,o,n,a,s,h){this.id=THREE.TextureIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=void 0!==t?t:new THREE.UVMapping,this.wrapS=void 0!==r?r:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==i?i:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==o?o:THREE.LinearFilter,this.minFilter=void 0!==n?n:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==h?h:1,this.format=void 0!==a?a:THREE.RGBAFormat,this.type=void 0!==s?s:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},THREE.Texture.prototype={constructor:THREE.Texture,clone:function(e){return void 0===e&&(e=new THREE.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype),THREE.TextureIdCount=0,THREE.CompressedTexture=function(e,t,r,i,o,n,a,s,h,l,c){THREE.Texture.call(this,null,n,a,s,h,l,i,o,c),this.image={width:t,height:r},this.mipmaps=e,this.generateMipmaps=!1},THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CompressedTexture.prototype.clone=function(){var e=new THREE.CompressedTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.DataTexture=function(e,t,r,i,o,n,a,s,h,l,c){THREE.Texture.call(this,null,n,a,s,h,l,i,o,c),this.image={data:e,width:t,height:r}},THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.Particle=function(e){THREE.Object3D.call(this),this.material=e},THREE.Particle.prototype=Object.create(THREE.Object3D.prototype),THREE.Particle.prototype.clone=function(e){return void 0===e&&(e=new THREE.Particle(this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.ParticleSystem=function(e,t){THREE.Object3D.call(this),this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.ParticleBasicMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.frustumCulled=!1},THREE.ParticleSystem.prototype=Object.create(THREE.Object3D.prototype),THREE.ParticleSystem.prototype.clone=function(e){return void 0===e&&(e=new THREE.ParticleSystem(this.geometry,this.material)),e.sortParticles=this.sortParticles,THREE.Object3D.prototype.clone.call(this,e),e},THREE.Line=function(e,t,r){THREE.Object3D.call(this),this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==r?r:THREE.LineStrip},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=Object.create(THREE.Object3D.prototype),THREE.Line.prototype.clone=function(e){return void 0===e&&(e=new THREE.Line(this.geometry,this.material,this.type)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Mesh=function(e,t){THREE.Object3D.call(this),this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype),THREE.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;t>e;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Mesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.Mesh(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Mesh.prototype.raycast=function(){function e(e,t,r,i,o,n,a){return THREE.Triangle.barycoordFromPoint(e,t,r,i,d),o.multiplyScalar(d.x),n.multiplyScalar(d.y),a.multiplyScalar(d.z),o.add(n).add(a),o.clone()}function t(e,t,r,i,o,n,a){var s,h=e.material;if(s=h.side===THREE.BackSide?r.intersectTriangle(n,o,i,!0,a):r.intersectTriangle(i,o,n,h.side!==THREE.DoubleSide,a),null===s)return null;g.copy(a),g.applyMatrix4(e.matrixWorld);var l=t.ray.origin.distanceTo(g);return l<t.near||l>t.far?null:{distance:l,point:g.clone(),object:e}}function r(r,i,o,n,l,c,u,d){a.fromArray(n,3*c),s.fromArray(n,3*u),h.fromArray(n,3*d);var g=t(r,i,o,a,s,h,m);return g&&(l&&(p.fromArray(l,2*c),f.fromArray(l,2*u),E.fromArray(l,2*d),g.uv=e(m,a,s,h,p,f,E)),g.face=new THREE.Face3(c,u,d,THREE.Triangle.normal(a,s,h)),g.faceIndex=c),g}var i=new THREE.Matrix4,o=new THREE.Ray,n=new THREE.Sphere,a=new THREE.Vector3,s=new THREE.Vector3,h=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3,u=new THREE.Vector3,p=new THREE.Vector2,f=new THREE.Vector2,E=new THREE.Vector2,d=new THREE.Vector3,m=new THREE.Vector3,g=new THREE.Vector3;return function(d,g){var v=this.geometry,T=this.material;if(void 0!==T){null===v.boundingSphere&&v.computeBoundingSphere();var y=this.matrixWorld;if(n.copy(v.boundingSphere),n.applyMatrix4(y),d.ray.isIntersectionSphere(n)!==!1&&(i.getInverse(y),o.copy(d.ray).applyMatrix4(i),null===v.boundingBox||o.isIntersectionBox(v.boundingBox)!==!1)){var R,x;if(v instanceof THREE.BufferGeometry){var H,_,b,w=v.index,M=v.attributes,S=M.position.array;if(void 0!==M.uv&&(R=M.uv.array),null!==w)for(var A=w.array,C=0,L=A.length;L>C;C+=3)H=A[C],_=A[C+1],b=A[C+2],x=r(this,d,o,S,R,H,_,b),x&&(x.faceIndex=Math.floor(C/3),g.push(x));else for(var C=0,L=S.length;L>C;C+=9)H=C/3,_=H+1,b=H+2,x=r(this,d,o,S,R,H,_,b),x&&(x.index=H,g.push(x))}else if(v instanceof THREE.Geometry){var P,F,D,U=T instanceof THREE.MeshFaceMaterial,V=U===!0?T.materials:null,O=v.vertices,z=v.faces,N=v.faceVertexUvs[0];N.length>0&&(R=N);for(var B=0,I=z.length;I>B;B++){var k=z[B],G=U===!0?V[k.materialIndex]:T;if(void 0!==G){if(P=O[k.a],F=O[k.b],D=O[k.c],G.morphTargets===!0){var j=v.morphTargets,W=this.morphTargetInfluences;a.set(0,0,0),s.set(0,0,0),h.set(0,0,0);for(var X=0,Y=j.length;Y>X;X++){var q=W[X];if(0!==q){var K=j[X].vertices;a.addScaledVector(l.subVectors(K[k.a],P),q),s.addScaledVector(c.subVectors(K[k.b],F),q),h.addScaledVector(u.subVectors(K[k.c],D),q)}}a.add(P),s.add(F),h.add(D),P=a,F=s,D=h}if(x=t(this,d,o,P,F,D,m)){if(R){var Z=R[B];p.copy(Z[0]),f.copy(Z[1]),E.copy(Z[2]),x.uv=e(m,P,F,D,p,f,E)}x.face=k,x.faceIndex=B,g.push(x)}}}}}}}}(),THREE.Bone=function(e){THREE.Object3D.call(this),this.skin=e,this.skinMatrix=new THREE.Matrix4},THREE.Bone.prototype=Object.create(THREE.Object3D.prototype),THREE.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var r,i=this.children.length;for(r=0;i>r;r++)this.children[r].update(this.skinMatrix,t)},THREE.SkinnedMesh=function(e,t,r){THREE.Mesh.call(this,e,t),this.useVertexTexture=void 0!==r?r:!0,this.identityMatrix=new THREE.Matrix4,this.bones=[],this.boneMatrices=[];var i,o,n,a,s,h;if(this.geometry&&void 0!==this.geometry.bones){for(i=0;i<this.geometry.bones.length;i++)n=this.geometry.bones[i],a=n.pos,s=n.rotq,h=n.scl,o=this.addBone(),o.name=n.name,o.position.set(a[0],a[1],a[2]),o.quaternion.set(s[0],s[1],s[2],s[3]),void 0!==h?o.scale.set(h[0],h[1],h[2]):o.scale.set(1,1,1);for(i=0;i<this.bones.length;i++)n=this.geometry.bones[i],o=this.bones[i],-1===n.parent?this.add(o):this.bones[n.parent].add(o);var l=this.bones.length;if(this.useVertexTexture){var c;c=l>256?64:l>64?32:l>16?16:8,this.boneTextureWidth=c,this.boneTextureHeight=c,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),this.boneTexture.minFilter=THREE.NearestFilter,this.boneTexture.magFilter=THREE.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1}else this.boneMatrices=new Float32Array(16*l);this.pose()}},THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new THREE.Bone(this)),this.bones.push(e),e},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(){var e=new THREE.Matrix4;return function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var r=0,i=this.children.length;i>r;r++){var o=this.children[r];o instanceof THREE.Bone?o.update(this.identityMatrix,!1):o.updateMatrixWorld(!0)}if(void 0==this.boneInverses){this.boneInverses=[];for(var n=0,a=this.bones.length;a>n;n++){var s=new THREE.Matrix4;s.getInverse(this.bones[n].skinMatrix),this.boneInverses.push(s)}}for(var n=0,a=this.bones.length;a>n;n++)e.multiplyMatrices(this.bones[n].skinMatrix,this.boneInverses[n]),e.flattenToArrayOffset(this.boneMatrices,16*n);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0),this.normalizeSkinWeights()},THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],r=1/t.lengthManhattan();r!==1/0?t.multiplyScalar(r):t.set(1)}},THREE.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),THREE.Mesh.prototype.clone.call(this,e),e},THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},THREE.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,r=e.animations,i=/([a-z]+)(\\d+)/,o=0,n=e.morphTargets.length;n>o;o++){var a=e.morphTargets[o],s=a.name.match(i);if(s&&s.length>1){var h=s[1];s[2];r[h]||(r[h]={start:1/0,end:-(1/0)});var l=r[h];o<l.start&&(l.start=o),o>l.end&&(l.end=o),t||(t=h)}}e.firstAnimation=t},THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,r){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:r}},THREE.MorphAnimMesh.prototype.playAnimation=function(e,t){var r=this.geometry.animations[e];r?(this.setFrameRange(r.start,r.end),this.duration=1e3*((r.end-r.start)/t),this.time=0):console.warn("animation["+e+"] undefined")},THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var r=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/t),0,this.length-1);r!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[r]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=r);var i=this.time%t/t;this.directionBackwards&&(i=1-i),this.morphTargetInfluences[this.currentKeyframe]=i,this.morphTargetInfluences[this.lastKeyframe]=1-i},THREE.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,THREE.Mesh.prototype.clone.call(this,e),e},THREE.Ribbon=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=t},THREE.Ribbon.prototype=Object.create(THREE.Object3D.prototype),THREE.Ribbon.prototype.clone=function(e){return void 0===e&&(e=new THREE.Ribbon(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.LOD=function(){THREE.Object3D.call(this),this.objects=[]},THREE.LOD.prototype=Object.create(THREE.Object3D.prototype),THREE.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=0;r<this.objects.length&&!(t<this.objects[r].distance);r++);this.objects.splice(r,0,{distance:t,object:e}),this.add(e)},THREE.LOD.prototype.getObjectForDistance=function(e){for(var t=1,r=this.objects.length;r>t&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},THREE.LOD.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r){if(this.objects.length>1){e.getPositionFromMatrix(r.matrixWorld),t.getPositionFromMatrix(this.matrixWorld);var i=e.distanceTo(t);this.objects[0].object.visible=!0;for(var o=1,n=this.objects.length;n>o&&i>=this.objects[o].distance;o++)this.objects[o-1].object.visible=!1,this.objects[o].object.visible=!0;for(;n>o;o++)this.objects[o].object.visible=!1}}}(),THREE.LOD.prototype.clone=function(){},THREE.Sprite=function(e){THREE.Object3D.call(this),this.material=void 0!==e?e:new THREE.SpriteMaterial,this.rotation3d=this.rotation,this.rotation=0},THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype),THREE.Sprite.prototype.updateMatrix=function(){this.rotation3d.set(0,0,this.rotation,this.rotation3d.order),this.quaternion.setFromEuler(this.rotation3d),this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},THREE.Sprite.prototype.clone=function(e){return void 0===e&&(e=new THREE.Sprite(this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Scene=function(){THREE.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=Object.create(THREE.Object3D.prototype),\r\nTHREE.Scene.prototype.__addObject=function(e){if(e instanceof THREE.Light)-1===this.__lights.indexOf(e)&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target);else if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)&&-1===this.__objects.indexOf(e)){this.__objects.push(e),this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}for(var r=0;r<e.children.length;r++)this.__addObject(e.children[r])},THREE.Scene.prototype.__removeObject=function(e){if(e instanceof THREE.Light){var t=this.__lights.indexOf(e);-1!==t&&this.__lights.splice(t,1)}else if(!(e instanceof THREE.Camera)){var t=this.__objects.indexOf(e);if(-1!==t){this.__objects.splice(t,1),this.__objectsRemoved.push(e);var r=this.__objectsAdded.indexOf(e);-1!==r&&this.__objectsAdded.splice(r,1)}}for(var i=0;i<e.children.length;i++)this.__removeObject(e.children[i])},THREE.Scene.prototype.clone=function(e){return void 0===e&&(e=new THREE.Scene),THREE.Object3D.prototype.clone.call(this,e),null!==this.fog&&(e.fog=this.fog.clone()),null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},THREE.Fog=function(e,t,r){this.name="",this.color=new THREE.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3},THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)},THREE.FogExp2=function(e,t){this.name="",this.color=new THREE.Color(e),this.density=void 0!==t?t:25e-5},THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)},THREE.CanvasRenderer=function(e){function t(){Be.setRGB(0,0,0),Ie.setRGB(0,0,0),ke.setRGB(0,0,0);for(var e=0,t=w.length;t>e;e++){var r=w[e],i=r.color;r instanceof THREE.AmbientLight?Be.add(i):r instanceof THREE.DirectionalLight?Ie.add(i):r instanceof THREE.PointLight&&ke.add(i)}}function r(e,t,r){for(var i=0,o=w.length;o>i;i++){var n=w[i];if(De.copy(n.color),n instanceof THREE.DirectionalLight){var a=Ge.getPositionFromMatrix(n.matrixWorld).normalize(),s=t.dot(a);if(0>=s)continue;s*=n.intensity,r.add(De.multiplyScalar(s))}else if(n instanceof THREE.PointLight){var a=Ge.getPositionFromMatrix(n.matrixWorld),s=t.dot(Ge.subVectors(a,e).normalize());if(0>=s)continue;if(s*=0==n.distance?1:1-Math.min(e.distanceTo(a)/n.distance,1),0==s)continue;s*=n.intensity,r.add(De.multiplyScalar(s))}}}function i(e,t,r){d(r.opacity),m(r.blending);var i,o,n,a,s,h,l;if(r instanceof THREE.ParticleBasicMaterial)if(null===r.map){if(n=t.object.scale.x,a=t.object.scale.y,n*=t.scale.x*A,a*=t.scale.y*C,Ne.min.set(e.x-n,e.y-a),Ne.max.set(e.x+n,e.y+a),Oe.isIntersectionBox(Ne)===!1)return void Ne.makeEmpty();R(r.color.getStyle()),fe.save(),fe.translate(e.x,e.y),fe.rotate(-t.rotation),fe.scale(n,a),fe.fillRect(-1,-1,2,2),fe.restore()}else{if(s=r.map.image,h=s.width>>1,l=s.height>>1,n=t.scale.x*A,a=t.scale.y*C,i=n*h,o=a*l,Ne.min.set(e.x-i,e.y-o),Ne.max.set(e.x+i,e.y+o),Oe.isIntersectionBox(Ne)===!1)return void Ne.makeEmpty();fe.save(),fe.translate(e.x,e.y),fe.rotate(-t.rotation),fe.scale(n,-a),fe.translate(-h,-l),fe.drawImage(s,0,0),fe.restore()}else if(r instanceof THREE.ParticleCanvasMaterial){if(i=t.scale.x*A,o=t.scale.y*C,Ne.min.set(e.x-i,e.y-o),Ne.max.set(e.x+i,e.y+o),Oe.isIntersectionBox(Ne)===!1)return void Ne.makeEmpty();y(r.color.getStyle()),R(r.color.getStyle()),fe.save(),fe.translate(e.x,e.y),fe.rotate(-t.rotation),fe.scale(i,o),r.program(fe),fe.restore()}}function o(e,t,r,i){if(d(i.opacity),m(i.blending),fe.beginPath(),fe.moveTo(e.positionScreen.x,e.positionScreen.y),fe.lineTo(t.positionScreen.x,t.positionScreen.y),i instanceof THREE.LineBasicMaterial){if(g(i.linewidth),v(i.linecap),T(i.linejoin),i.vertexColors!==THREE.VertexColors)y(i.color.getStyle());else{var o=r.vertexColors[0].getStyle(),n=r.vertexColors[1].getStyle();if(o===n)y(o);else{try{var a=fe.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);a.addColorStop(0,o),a.addColorStop(1,n)}catch(s){a=o}y(a)}}fe.stroke(),Ne.expandByScalar(2*i.linewidth)}else i instanceof THREE.LineDashedMaterial&&(g(i.linewidth),v(i.linecap),T(i.linejoin),y(i.color.getStyle()),x(i.dashSize,i.gapSize),fe.stroke(),Ne.expandByScalar(2*i.linewidth),x(null,null))}function n(e,t,i,o,n,a,h,E){if(ce.info.render.vertices+=3,ce.info.render.faces++,d(E.opacity),m(E.blending),V=e.positionScreen.x,O=e.positionScreen.y,z=t.positionScreen.x,N=t.positionScreen.y,B=i.positionScreen.x,I=i.positionScreen.y,s(V,O,z,N,B,I),(E instanceof THREE.MeshLambertMaterial||E instanceof THREE.MeshPhongMaterial)&&null===E.map)Pe.copy(E.color),Fe.copy(E.emissive),E.vertexColors===THREE.FaceColors&&Pe.multiply(h.color),E.wireframe===!1&&E.shading==THREE.SmoothShading&&3==h.vertexNormalsLength?(Se.copy(Be),Ae.copy(Be),Ce.copy(Be),r(h.v1.positionWorld,h.vertexNormalsModel[0],Se),r(h.v2.positionWorld,h.vertexNormalsModel[1],Ae),r(h.v3.positionWorld,h.vertexNormalsModel[2],Ce),Se.multiply(Pe).add(Fe),Ae.multiply(Pe).add(Fe),Ce.multiply(Pe).add(Fe),Le.addColors(Ae,Ce).multiplyScalar(.5),Z=f(Se,Ae,Ce,Le),p(V,O,z,N,B,I,0,0,1,0,0,1,Z)):(Me.copy(Be),r(h.centroidModel,h.normalModel,Me),Me.multiply(Pe).add(Fe),E.wireframe===!0?l(Me,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):c(Me));else if(E instanceof THREE.MeshBasicMaterial||E instanceof THREE.MeshLambertMaterial||E instanceof THREE.MeshPhongMaterial)null!==E.map?E.map.mapping instanceof THREE.UVMapping&&(Q=h.uvs[0],u(V,O,z,N,B,I,Q[o].x,Q[o].y,Q[n].x,Q[n].y,Q[a].x,Q[a].y,E.map)):null!==E.envMap?E.envMap.mapping instanceof THREE.SphericalReflectionMapping&&(Ge.copy(h.vertexNormalsModelView[o]),J=.5*Ge.x+.5,$=.5*Ge.y+.5,Ge.copy(h.vertexNormalsModelView[n]),ee=.5*Ge.x+.5,te=.5*Ge.y+.5,Ge.copy(h.vertexNormalsModelView[a]),re=.5*Ge.x+.5,ie=.5*Ge.y+.5,u(V,O,z,N,B,I,J,$,ee,te,re,ie,E.envMap)):(Me.copy(E.color),E.vertexColors===THREE.FaceColors&&Me.multiply(h.color),E.wireframe===!0?l(Me,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):c(Me));else if(E instanceof THREE.MeshDepthMaterial)q=L.near,K=L.far,Se.r=Se.g=Se.b=1-H(e.positionScreen.z*e.positionScreen.w,q,K),Ae.r=Ae.g=Ae.b=1-H(t.positionScreen.z*t.positionScreen.w,q,K),Ce.r=Ce.g=Ce.b=1-H(i.positionScreen.z*i.positionScreen.w,q,K),Le.addColors(Ae,Ce).multiplyScalar(.5),Z=f(Se,Ae,Ce,Le),p(V,O,z,N,B,I,0,0,1,0,0,1,Z);else if(E instanceof THREE.MeshNormalMaterial){var g;E.shading==THREE.FlatShading?(g=h.normalModelView,Me.setRGB(g.x,g.y,g.z).multiplyScalar(.5).addScalar(.5),E.wireframe===!0?l(Me,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):c(Me)):E.shading==THREE.SmoothShading&&(g=h.vertexNormalsModelView[o],Se.setRGB(g.x,g.y,g.z).multiplyScalar(.5).addScalar(.5),g=h.vertexNormalsModelView[n],Ae.setRGB(g.x,g.y,g.z).multiplyScalar(.5).addScalar(.5),g=h.vertexNormalsModelView[a],Ce.setRGB(g.x,g.y,g.z).multiplyScalar(.5).addScalar(.5),Le.addColors(Ae,Ce).multiplyScalar(.5),Z=f(Se,Ae,Ce,Le),p(V,O,z,N,B,I,0,0,1,0,0,1,Z))}}function a(e,t,i,o,a,u,E,g){if(ce.info.render.vertices+=4,ce.info.render.faces++,d(g.opacity),m(g.blending),void 0!==g.map&&null!==g.map||void 0!==g.envMap&&null!==g.envMap)return n(e,t,o,0,1,3,E,g),void n(a,i,u,1,2,3,E,g);if(V=e.positionScreen.x,O=e.positionScreen.y,z=t.positionScreen.x,N=t.positionScreen.y,B=i.positionScreen.x,I=i.positionScreen.y,k=o.positionScreen.x,G=o.positionScreen.y,j=a.positionScreen.x,W=a.positionScreen.y,X=u.positionScreen.x,Y=u.positionScreen.y,g instanceof THREE.MeshLambertMaterial||g instanceof THREE.MeshPhongMaterial)Pe.copy(g.color),Fe.copy(g.emissive),g.vertexColors===THREE.FaceColors&&Pe.multiply(E.color),g.wireframe===!1&&g.shading==THREE.SmoothShading&&4==E.vertexNormalsLength?(Se.copy(Be),Ae.copy(Be),Ce.copy(Be),Le.copy(Be),r(E.v1.positionWorld,E.vertexNormalsModel[0],Se),r(E.v2.positionWorld,E.vertexNormalsModel[1],Ae),r(E.v4.positionWorld,E.vertexNormalsModel[3],Ce),r(E.v3.positionWorld,E.vertexNormalsModel[2],Le),Se.multiply(Pe).add(Fe),Ae.multiply(Pe).add(Fe),Ce.multiply(Pe).add(Fe),Le.multiply(Pe).add(Fe),Z=f(Se,Ae,Ce,Le),s(V,O,z,N,k,G),p(V,O,z,N,k,G,0,0,1,0,0,1,Z),s(j,W,B,I,X,Y),p(j,W,B,I,X,Y,1,0,1,1,0,1,Z)):(Me.copy(Be),r(E.centroidModel,E.normalModel,Me),Me.multiply(Pe).add(Fe),h(V,O,z,N,B,I,k,G),g.wireframe===!0?l(Me,g.wireframeLinewidth,g.wireframeLinecap,g.wireframeLinejoin):c(Me));else if(g instanceof THREE.MeshBasicMaterial)Me.copy(g.color),g.vertexColors===THREE.FaceColors&&Me.multiply(E.color),h(V,O,z,N,B,I,k,G),g.wireframe===!0?l(Me,g.wireframeLinewidth,g.wireframeLinecap,g.wireframeLinejoin):c(Me);else if(g instanceof THREE.MeshNormalMaterial){var v;g.shading==THREE.FlatShading?(v=E.normalModelView,Me.setRGB(v.x,v.y,v.z).multiplyScalar(.5).addScalar(.5),h(V,O,z,N,B,I,k,G),g.wireframe===!0?l(Me,g.wireframeLinewidth,g.wireframeLinecap,g.wireframeLinejoin):c(Me)):g.shading==THREE.SmoothShading&&(v=E.vertexNormalsModelView[0],Se.setRGB(v.x,v.y,v.z).multiplyScalar(.5).addScalar(.5),v=E.vertexNormalsModelView[1],Ae.setRGB(v.x,v.y,v.z).multiplyScalar(.5).addScalar(.5),v=E.vertexNormalsModelView[3],Ce.setRGB(v.x,v.y,v.z).multiplyScalar(.5).addScalar(.5),v=E.vertexNormalsModelView[2],Le.setRGB(v.x,v.y,v.z).multiplyScalar(.5).addScalar(.5),Z=f(Se,Ae,Ce,Le),s(V,O,z,N,k,G),p(V,O,z,N,k,G,0,0,1,0,0,1,Z),s(j,W,B,I,X,Y),p(j,W,B,I,X,Y,1,0,1,1,0,1,Z))}else g instanceof THREE.MeshDepthMaterial&&(q=L.near,K=L.far,Se.r=Se.g=Se.b=1-H(e.positionScreen.z*e.positionScreen.w,q,K),Ae.r=Ae.g=Ae.b=1-H(t.positionScreen.z*t.positionScreen.w,q,K),Ce.r=Ce.g=Ce.b=1-H(o.positionScreen.z*o.positionScreen.w,q,K),Le.r=Le.g=Le.b=1-H(i.positionScreen.z*i.positionScreen.w,q,K),Z=f(Se,Ae,Ce,Le),s(V,O,z,N,k,G),p(V,O,z,N,k,G,0,0,1,0,0,1,Z),s(j,W,B,I,X,Y),p(j,W,B,I,X,Y,1,0,1,1,0,1,Z))}function s(e,t,r,i,o,n){fe.beginPath(),fe.moveTo(e,t),fe.lineTo(r,i),fe.lineTo(o,n),fe.closePath()}function h(e,t,r,i,o,n,a,s){fe.beginPath(),fe.moveTo(e,t),fe.lineTo(r,i),fe.lineTo(o,n),fe.lineTo(a,s),fe.closePath()}function l(e,t,r,i){g(t),v(r),T(i),y(e.getStyle()),fe.stroke(),Ne.expandByScalar(2*t)}function c(e){R(e.getStyle()),fe.fill()}function u(e,t,r,i,o,n,a,s,h,l,u,p,f){if(!(f instanceof THREE.DataTexture||void 0===f.image||0==f.image.width)){if(f.needsUpdate===!0){var E=f.wrapS==THREE.RepeatWrapping,d=f.wrapT==THREE.RepeatWrapping;Ue[f.id]=fe.createPattern(f.image,E===!0&&d===!0?"repeat":E===!0&&d===!1?"repeat-x":E===!1&&d===!0?"repeat-y":"no-repeat"),f.needsUpdate=!1}R(void 0===Ue[f.id]?"rgba(0,0,0,1)":Ue[f.id]);var m,g,v,T,y,x,H,_,b=f.offset.x/f.repeat.x,w=f.offset.y/f.repeat.y,M=f.image.width*f.repeat.x,S=f.image.height*f.repeat.y;if(a=(a+b)*M,s=(1-s+w)*S,h=(h+b)*M,l=(1-l+w)*S,u=(u+b)*M,p=(1-p+w)*S,r-=e,i-=t,o-=e,n-=t,h-=a,l-=s,u-=a,p-=s,H=h*p-u*l,0===H){if(void 0===Ve[f.id]){var A=document.createElement("canvas");A.width=f.image.width,A.height=f.image.height;var C=A.getContext("2d");C.drawImage(f.image,0,0),Ve[f.id]=C.getImageData(0,0,f.image.width,f.image.height).data}var L=Ve[f.id],P=4*(Math.floor(a)+Math.floor(s)*f.image.width);return Me.setRGB(L[P]/255,L[P+1]/255,L[P+2]/255),void c(Me)}_=1/H,m=(p*r-l*o)*_,g=(p*i-l*n)*_,v=(h*o-u*r)*_,T=(h*n-u*i)*_,y=e-m*a-v*s,x=t-g*a-T*s,fe.save(),fe.transform(m,g,v,T,y,x),fe.fill(),fe.restore()}}function p(e,t,r,i,o,n,a,s,h,l,c,u,p){var f,E,d,m,g,v,T,y,R=p.width-1,x=p.height-1;a*=R,s*=x,h*=R,l*=x,c*=R,u*=x,r-=e,i-=t,o-=e,n-=t,h-=a,l-=s,c-=a,u-=s,T=h*u-c*l,y=1/T,f=(u*r-l*o)*y,E=(u*i-l*n)*y,d=(h*o-c*r)*y,m=(h*n-c*i)*y,g=e-f*a-d*s,v=t-E*a-m*s,fe.save(),fe.transform(f,E,d,m,g,v),fe.clip(),fe.drawImage(p,0,0),fe.restore()}function f(e,t,r,i){return se[0]=255*e.r|0,se[1]=255*e.g|0,se[2]=255*e.b|0,se[4]=255*t.r|0,se[5]=255*t.g|0,se[6]=255*t.b|0,se[8]=255*r.r|0,se[9]=255*r.g|0,se[10]=255*r.b|0,se[12]=255*i.r|0,se[13]=255*i.g|0,se[14]=255*i.b|0,ne.putImageData(ae,0,0),le.drawImage(oe,0,0),he}function E(e,t,r){var i,o=t.x-e.x,n=t.y-e.y,a=o*o+n*n;0!==a&&(i=r/Math.sqrt(a),o*=i,n*=i,t.x+=o,t.y+=n,e.x-=o,e.y-=n)}function d(e){me!==e&&(fe.globalAlpha=e,me=e)}function m(e){ge!==e&&(e===THREE.NormalBlending?fe.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?fe.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending&&(fe.globalCompositeOperation="darker"),ge=e)}function g(e){ye!==e&&(fe.lineWidth=e,ye=e)}function v(e){Re!==e&&(fe.lineCap=e,Re=e)}function T(e){xe!==e&&(fe.lineJoin=e,xe=e)}function y(e){ve!==e&&(fe.strokeStyle=e,ve=e)}function R(e){Te!==e&&(fe.fillStyle=e,Te=e)}function x(e,t){(He!==e||_e!==t)&&(fe.setLineDash([e,t]),He=e,_e=t)}console.log("THREE.CanvasRenderer",THREE.REVISION);var H=THREE.Math.smoothstep;e=e||{};var _,b,w,M,S,A,C,L,P,F,D,U,V,O,z,N,B,I,k,G,j,W,X,Y,q,K,Z,Q,J,$,ee,te,re,ie,oe,ne,ae,se,he,le,ce=this,ue=new THREE.Projector,pe=void 0!==e.canvas?e.canvas:document.createElement("canvas"),fe=pe.getContext("2d"),Ee=new THREE.Color(0),de=0,me=1,ge=0,ve=null,Te=null,ye=null,Re=null,xe=null,He=null,_e=0,be=new THREE.RenderableVertex,we=new THREE.RenderableVertex,Me=new THREE.Color,Se=new THREE.Color,Ae=new THREE.Color,Ce=new THREE.Color,Le=new THREE.Color,Pe=new THREE.Color,Fe=new THREE.Color,De=new THREE.Color,Ue={},Ve={},Oe=new THREE.Box2,ze=new THREE.Box2,Ne=new THREE.Box2,Be=new THREE.Color,Ie=new THREE.Color,ke=new THREE.Color,Ge=new THREE.Vector3,je=16;oe=document.createElement("canvas"),oe.width=oe.height=2,ne=oe.getContext("2d"),ne.fillStyle="rgba(0,0,0,1)",ne.fillRect(0,0,2,2),ae=ne.getImageData(0,0,2,2),se=ae.data,he=document.createElement("canvas"),he.width=he.height=je,le=he.getContext("2d"),le.translate(-je/2,-je/2),le.scale(je,je),je--,void 0===fe.setLineDash&&(void 0!==fe.mozDash?fe.setLineDash=function(e){fe.mozDash=null!==e[0]?e:null}:fe.setLineDash=function(){}),this.domElement=pe,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t,r){M=e*this.devicePixelRatio,S=t*this.devicePixelRatio,A=Math.floor(M/2),C=Math.floor(S/2),pe.width=M,pe.height=S,1!==this.devicePixelRatio&&r!==!1&&(pe.style.width=e+"px",pe.style.height=t+"px"),Oe.set(new THREE.Vector2(-A,-C),new THREE.Vector2(A,C)),ze.set(new THREE.Vector2(-A,-C),new THREE.Vector2(A,C)),me=1,ge=0,ve=null,Te=null,ye=null,Re=null,xe=null},this.setClearColor=function(e,t){Ee.set(e),de=void 0!==t?t:1,ze.set(new THREE.Vector2(-A,-C),new THREE.Vector2(A,C))},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){fe.setTransform(1,0,0,-1,A,C),ze.empty()===!1&&(ze.intersect(Oe),ze.expandByScalar(2),1>de&&fe.clearRect(0|ze.min.x,0|ze.min.y,ze.max.x-ze.min.x|0,ze.max.y-ze.min.y|0),de>0&&(m(THREE.NormalBlending),d(1),R("rgba("+Math.floor(255*Ee.r)+","+Math.floor(255*Ee.g)+","+Math.floor(255*Ee.b)+","+de+")"),fe.fillRect(0|ze.min.x,0|ze.min.y,ze.max.x-ze.min.x|0,ze.max.y-ze.min.y|0)),ze.makeEmpty())},this.render=function(e,r){if(r instanceof THREE.Camera==!1)return void console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");this.autoClear===!0&&this.clear(),fe.setTransform(1,0,0,-1,A,C),ce.info.render.vertices=0,ce.info.render.faces=0,_=ue.projectScene(e,r,this.sortObjects,this.sortElements),b=_.elements,w=_.lights,L=r,t();for(var s=0,h=b.length;h>s;s++){var l=b[s],c=l.material;if(void 0!==c&&c.visible!==!1){if(Ne.makeEmpty(),l instanceof THREE.RenderableParticle)P=l,P.x*=A,P.y*=C,i(P,l,c);else if(l instanceof THREE.RenderableLine)P=l.v1,F=l.v2,P.positionScreen.x*=A,P.positionScreen.y*=C,F.positionScreen.x*=A,F.positionScreen.y*=C,Ne.setFromPoints([P.positionScreen,F.positionScreen]),Oe.isIntersectionBox(Ne)===!0&&o(P,F,l,c);else if(l instanceof THREE.RenderableFace3){if(P=l.v1,F=l.v2,D=l.v3,P.positionScreen.z<-1||P.positionScreen.z>1)continue;if(F.positionScreen.z<-1||F.positionScreen.z>1)continue;if(D.positionScreen.z<-1||D.positionScreen.z>1)continue;P.positionScreen.x*=A,P.positionScreen.y*=C,F.positionScreen.x*=A,F.positionScreen.y*=C,D.positionScreen.x*=A,D.positionScreen.y*=C,c.overdraw>0&&(E(P.positionScreen,F.positionScreen,c.overdraw),E(F.positionScreen,D.positionScreen,c.overdraw),E(D.positionScreen,P.positionScreen,c.overdraw)),Ne.setFromPoints([P.positionScreen,F.positionScreen,D.positionScreen]),Oe.isIntersectionBox(Ne)===!0&&n(P,F,D,0,1,2,l,c)}else if(l instanceof THREE.RenderableFace4){if(P=l.v1,F=l.v2,D=l.v3,U=l.v4,P.positionScreen.z<-1||P.positionScreen.z>1)continue;if(F.positionScreen.z<-1||F.positionScreen.z>1)continue;if(D.positionScreen.z<-1||D.positionScreen.z>1)continue;if(U.positionScreen.z<-1||U.positionScreen.z>1)continue;P.positionScreen.x*=A,P.positionScreen.y*=C,F.positionScreen.x*=A,F.positionScreen.y*=C,D.positionScreen.x*=A,D.positionScreen.y*=C,U.positionScreen.x*=A,U.positionScreen.y*=C,be.positionScreen.copy(F.positionScreen),we.positionScreen.copy(U.positionScreen),c.overdraw>0&&(E(P.positionScreen,F.positionScreen,c.overdraw),E(F.positionScreen,U.positionScreen,c.overdraw),E(U.positionScreen,P.positionScreen,c.overdraw),E(D.positionScreen,be.positionScreen,c.overdraw),E(D.positionScreen,we.positionScreen,c.overdraw)),Ne.setFromPoints([P.positionScreen,F.positionScreen,D.positionScreen,U.positionScreen]),Oe.isIntersectionBox(Ne)===!0&&a(P,F,D,U,be,we,l,c)}ze.union(Ne)}}fe.setTransform(1,0,0,1,0,0)}},THREE.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\\n"),map_fragment:["#ifdef USE_MAP","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = gl_FragColor * texelColor;","#endif"].join("\\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\\n"),\r\nlights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -vViewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix 	+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","vec3 shadowZ = vec3( shadowCoord.z );","shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));","shadowKernel[0] *= vec3(0.25);","shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));","shadowKernel[1] *= vec3(0.25);","shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));","shadowKernel[2] *= vec3(0.25);","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\\n")},THREE.UniformsUtils={merge:function(e){var t,r,i,o={};for(t=0;t<e.length;t++){i=this.clone(e[t]);for(r in i)o[r]=i[r]}return o},clone:function(e){var t,r,i,o={};for(t in e){o[t]={};for(r in e[t])i=e[t][r],i instanceof THREE.Color||i instanceof THREE.Vector2||i instanceof THREE.Vector3||i instanceof THREE.Vector4||i instanceof THREE.Matrix4||i instanceof THREE.Texture?o[t][r]=i.clone():i instanceof Array?o[t][r]=i.slice():o[t][r]=i}return o}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\\n")},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(16777215)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\\n"),\r\nvertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\\n")}},THREE.WebGLRenderer=function(e){function t(e){e.__webglVertexBuffer=ze.createBuffer(),e.__webglColorBuffer=ze.createBuffer(),je.info.memory.geometries++}function r(e){e.__webglVertexBuffer=ze.createBuffer(),e.__webglColorBuffer=ze.createBuffer(),e.__webglLineDistanceBuffer=ze.createBuffer(),je.info.memory.geometries++}function i(e){e.__webglVertexBuffer=ze.createBuffer(),e.__webglColorBuffer=ze.createBuffer(),e.__webglNormalBuffer=ze.createBuffer(),je.info.memory.geometries++}function o(e){e.__webglVertexBuffer=ze.createBuffer(),e.__webglNormalBuffer=ze.createBuffer(),e.__webglTangentBuffer=ze.createBuffer(),e.__webglColorBuffer=ze.createBuffer(),e.__webglUVBuffer=ze.createBuffer(),e.__webglUV2Buffer=ze.createBuffer(),e.__webglSkinIndicesBuffer=ze.createBuffer(),e.__webglSkinWeightsBuffer=ze.createBuffer(),e.__webglFaceBuffer=ze.createBuffer(),e.__webglLineBuffer=ze.createBuffer();var t,r;if(e.numMorphTargets)for(e.__webglMorphTargetsBuffers=[],t=0,r=e.numMorphTargets;r>t;t++)e.__webglMorphTargetsBuffers.push(ze.createBuffer());if(e.numMorphNormals)for(e.__webglMorphNormalsBuffers=[],t=0,r=e.numMorphNormals;r>t;t++)e.__webglMorphNormalsBuffers.push(ze.createBuffer());je.info.memory.geometries++}function n(e){if(e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)ze.deleteBuffer(e.__webglCustomAttributesList[t].buffer)}function a(e,t){var r=e.vertices.length,i=t.material;if(i.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var o in i.attributes){var n=i.attributes[o];if(!n.__webglInitialized||n.createUniqueBuffers){n.__webglInitialized=!0;var a=1;"v2"===n.type?a=2:"v3"===n.type?a=3:"v4"===n.type?a=4:"c"===n.type&&(a=3),n.size=a,n.array=new Float32Array(r*a),n.buffer=ze.createBuffer(),n.buffer.belongsToAttribute=o,n.needsUpdate=!0}e.__webglCustomAttributesList.push(n)}}}function s(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__sortArray=[],e.__webglParticleCount=r,a(e,t)}function h(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__lineDistanceArray=new Float32Array(1*r),e.__webglLineCount=r,a(e,t)}function l(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__normalArray=new Float32Array(3*r),e.__webglVertexCount=r,a(e,t)}function c(e,t){var r=t.geometry,i=e.faces3,o=e.faces4,n=3*i.length+4*o.length,a=1*i.length+2*o.length,s=3*i.length+4*o.length,h=u(t,e),l=d(h),c=f(h),p=E(h);e.__vertexArray=new Float32Array(3*n),c&&(e.__normalArray=new Float32Array(3*n)),r.hasTangents&&(e.__tangentArray=new Float32Array(4*n)),p&&(e.__colorArray=new Float32Array(3*n)),l&&((r.faceUvs.length>0||r.faceVertexUvs.length>0)&&(e.__uvArray=new Float32Array(2*n)),(r.faceUvs.length>1||r.faceVertexUvs.length>1)&&(e.__uv2Array=new Float32Array(2*n))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*n),e.__skinWeightArray=new Float32Array(4*n)),e.__faceArray=new Uint16Array(3*a),e.__lineArray=new Uint16Array(2*s);var m,g;if(e.numMorphTargets)for(e.__morphTargetsArrays=[],m=0,g=e.numMorphTargets;g>m;m++)e.__morphTargetsArrays.push(new Float32Array(3*n));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],m=0,g=e.numMorphNormals;g>m;m++)e.__morphNormalsArrays.push(new Float32Array(3*n));if(e.__webglFaceCount=3*a,e.__webglLineCount=2*s,h.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var v in h.attributes){var T=h.attributes[v],y={};for(var R in T)y[R]=T[R];if(!y.__webglInitialized||y.createUniqueBuffers){y.__webglInitialized=!0;var x=1;"v2"===y.type?x=2:"v3"===y.type?x=3:"v4"===y.type?x=4:"c"===y.type&&(x=3),y.size=x,y.array=new Float32Array(n*x),y.buffer=ze.createBuffer(),y.buffer.belongsToAttribute=v,T.needsUpdate=!0,y.__original=T}e.__webglCustomAttributesList.push(y)}}e.__inittedArrays=!0}function u(e,t){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function p(e){return e&&void 0!==e.shading&&e.shading===THREE.SmoothShading}function f(e){return e instanceof THREE.MeshBasicMaterial&&!e.envMap||e instanceof THREE.MeshDepthMaterial?!1:p(e)?THREE.SmoothShading:THREE.FlatShading}function E(e){return e.vertexColors?e.vertexColors:!1}function d(e){return e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof THREE.ShaderMaterial?!0:!1}function m(e){var t,r,i;for(t in e.attributes)i="index"===t?ze.ELEMENT_ARRAY_BUFFER:ze.ARRAY_BUFFER,r=e.attributes[t],void 0===r.numItems&&(r.numItems=r.array.length),r.buffer=ze.createBuffer(),ze.bindBuffer(i,r.buffer),ze.bufferData(i,r.array,ze.STATIC_DRAW)}function g(e,t,r){var i,o,n,a,s,h,l,c,u,p,f,E,d=e.vertices,m=d.length,g=e.colors,v=g.length,T=e.__vertexArray,y=e.__colorArray,R=e.__sortArray,x=e.verticesNeedUpdate,H=(e.elementsNeedUpdate,e.colorsNeedUpdate),_=e.__webglCustomAttributesList;if(r.sortParticles){for(Rt.copy(yt),Rt.multiply(r.matrixWorld),i=0;m>i;i++)n=d[i],xt.copy(n),xt.applyProjection(Rt),R[i]=[xt.z,i];for(R.sort(w),i=0;m>i;i++)n=d[R[i][1]],a=3*i,T[a]=n.x,T[a+1]=n.y,T[a+2]=n.z;for(o=0;v>o;o++)a=3*o,h=g[R[o][1]],y[a]=h.r,y[a+1]=h.g,y[a+2]=h.b;if(_)for(l=0,c=_.length;c>l;l++)if(E=_[l],void 0===E.boundTo||"vertices"===E.boundTo)if(a=0,p=E.value.length,1===E.size)for(u=0;p>u;u++)s=R[u][1],E.array[u]=E.value[s];else if(2===E.size)for(u=0;p>u;u++)s=R[u][1],f=E.value[s],E.array[a]=f.x,E.array[a+1]=f.y,a+=2;else if(3===E.size)if("c"===E.type)for(u=0;p>u;u++)s=R[u][1],f=E.value[s],E.array[a]=f.r,E.array[a+1]=f.g,E.array[a+2]=f.b,a+=3;else for(u=0;p>u;u++)s=R[u][1],f=E.value[s],E.array[a]=f.x,E.array[a+1]=f.y,E.array[a+2]=f.z,a+=3;else if(4===E.size)for(u=0;p>u;u++)s=R[u][1],f=E.value[s],E.array[a]=f.x,E.array[a+1]=f.y,E.array[a+2]=f.z,E.array[a+3]=f.w,a+=4}else{if(x)for(i=0;m>i;i++)n=d[i],a=3*i,T[a]=n.x,T[a+1]=n.y,T[a+2]=n.z;if(H)for(o=0;v>o;o++)h=g[o],a=3*o,y[a]=h.r,y[a+1]=h.g,y[a+2]=h.b;if(_)for(l=0,c=_.length;c>l;l++)if(E=_[l],E.needsUpdate&&(void 0===E.boundTo||"vertices"===E.boundTo))if(p=E.value.length,a=0,1===E.size)for(u=0;p>u;u++)E.array[u]=E.value[u];else if(2===E.size)for(u=0;p>u;u++)f=E.value[u],E.array[a]=f.x,E.array[a+1]=f.y,a+=2;else if(3===E.size)if("c"===E.type)for(u=0;p>u;u++)f=E.value[u],E.array[a]=f.r,E.array[a+1]=f.g,E.array[a+2]=f.b,a+=3;else for(u=0;p>u;u++)f=E.value[u],E.array[a]=f.x,E.array[a+1]=f.y,E.array[a+2]=f.z,a+=3;else if(4===E.size)for(u=0;p>u;u++)f=E.value[u],E.array[a]=f.x,E.array[a+1]=f.y,E.array[a+2]=f.z,E.array[a+3]=f.w,a+=4}if((x||r.sortParticles)&&(ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglVertexBuffer),ze.bufferData(ze.ARRAY_BUFFER,T,t)),(H||r.sortParticles)&&(ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglColorBuffer),ze.bufferData(ze.ARRAY_BUFFER,y,t)),_)for(l=0,c=_.length;c>l;l++)E=_[l],(E.needsUpdate||r.sortParticles)&&(ze.bindBuffer(ze.ARRAY_BUFFER,E.buffer),ze.bufferData(ze.ARRAY_BUFFER,E.array,t))}function v(e,t){var r,i,o,n,a,s,h,l,c,u,p,f,E=e.vertices,d=e.colors,m=e.lineDistances,g=E.length,v=d.length,T=m.length,y=e.__vertexArray,R=e.__colorArray,x=e.__lineDistanceArray,H=e.verticesNeedUpdate,_=e.colorsNeedUpdate,b=e.lineDistancesNeedUpdate,w=e.__webglCustomAttributesList;if(H){for(r=0;g>r;r++)n=E[r],a=3*r,y[a]=n.x,y[a+1]=n.y,y[a+2]=n.z;ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglVertexBuffer),ze.bufferData(ze.ARRAY_BUFFER,y,t)}if(_){for(i=0;v>i;i++)s=d[i],a=3*i,R[a]=s.r,R[a+1]=s.g,R[a+2]=s.b;ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglColorBuffer),ze.bufferData(ze.ARRAY_BUFFER,R,t)}if(b){for(o=0;T>o;o++)x[o]=m[o];ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglLineDistanceBuffer),ze.bufferData(ze.ARRAY_BUFFER,x,t)}if(w)for(h=0,l=w.length;l>h;h++)if(f=w[h],f.needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo)){if(a=0,u=f.value.length,1===f.size)for(c=0;u>c;c++)f.array[c]=f.value[c];else if(2===f.size)for(c=0;u>c;c++)p=f.value[c],f.array[a]=p.x,f.array[a+1]=p.y,a+=2;else if(3===f.size)if("c"===f.type)for(c=0;u>c;c++)p=f.value[c],f.array[a]=p.r,f.array[a+1]=p.g,f.array[a+2]=p.b,a+=3;else for(c=0;u>c;c++)p=f.value[c],f.array[a]=p.x,f.array[a+1]=p.y,f.array[a+2]=p.z,a+=3;else if(4===f.size)for(c=0;u>c;c++)p=f.value[c],f.array[a]=p.x,f.array[a+1]=p.y,f.array[a+2]=p.z,f.array[a+3]=p.w,a+=4;ze.bindBuffer(ze.ARRAY_BUFFER,f.buffer),ze.bufferData(ze.ARRAY_BUFFER,f.array,t)}}function T(e,t){var r,i,o,n,a,s,h,l,c,u,p,f,E,d=e.vertices,m=e.colors,g=e.normals,v=d.length,T=m.length,y=g.length,R=e.__vertexArray,x=e.__colorArray,H=e.__normalArray,_=e.verticesNeedUpdate,b=e.colorsNeedUpdate,w=e.normalsNeedUpdate,M=e.__webglCustomAttributesList;if(_){for(r=0;v>r;r++)n=d[r],a=3*r,R[a]=n.x,R[a+1]=n.y,R[a+2]=n.z;ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglVertexBuffer),ze.bufferData(ze.ARRAY_BUFFER,R,t)}if(b){for(i=0;T>i;i++)s=m[i],a=3*i,x[a]=s.r,x[a+1]=s.g,x[a+2]=s.b;ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglColorBuffer),ze.bufferData(ze.ARRAY_BUFFER,x,t)}if(w){for(o=0;y>o;o++)h=g[o],a=3*o,H[a]=h.x,H[a+1]=h.y,H[a+2]=h.z;ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglNormalBuffer),ze.bufferData(ze.ARRAY_BUFFER,H,t)}if(M)for(l=0,c=M.length;c>l;l++)if(f=M[l],f.needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo)){if(a=0,p=f.value.length,1===f.size)for(u=0;p>u;u++)f.array[u]=f.value[u];else if(2===f.size)for(u=0;p>u;u++)E=f.value[u],f.array[a]=E.x,f.array[a+1]=E.y,a+=2;else if(3===f.size)if("c"===f.type)for(u=0;p>u;u++)E=f.value[u],f.array[a]=E.r,f.array[a+1]=E.g,f.array[a+2]=E.b,a+=3;else for(u=0;p>u;u++)E=f.value[u],f.array[a]=E.x,f.array[a+1]=E.y,f.array[a+2]=E.z,a+=3;else if(4===f.size)for(u=0;p>u;u++)E=f.value[u],f.array[a]=E.x,f.array[a+1]=E.y,f.array[a+2]=E.z,f.array[a+3]=E.w,a+=4;ze.bindBuffer(ze.ARRAY_BUFFER,f.buffer),ze.bufferData(ze.ARRAY_BUFFER,f.array,t)}}function y(e,t,r,i,o){if(e.__inittedArrays){var n,a,s,h,l,c,u,p,m,g,v,T,y,R,x,H,_,b,w,M,S,A,C,L,P,F,D,U,V,O,z,N,B,I,k,G,j,W,X,Y,q,K,Z,Q,J,$,ee,te,re=f(o),ie=E(o),oe=d(o),ne=re===THREE.SmoothShading,ae=0,se=0,he=0,le=0,ce=0,ue=0,pe=0,fe=0,Ee=0,de=0,me=0,ge=0,ve=0,Te=e.__vertexArray,ye=e.__uvArray,Re=e.__uv2Array,xe=e.__normalArray,He=e.__tangentArray,_e=e.__colorArray,be=e.__skinIndexArray,we=e.__skinWeightArray,Me=e.__morphTargetsArrays,Se=e.__morphNormalsArrays,Ae=e.__webglCustomAttributesList,Ce=e.__faceArray,Le=e.__lineArray,Pe=t.geometry,Fe=Pe.verticesNeedUpdate,De=Pe.elementsNeedUpdate,Ue=Pe.uvsNeedUpdate,Ve=Pe.normalsNeedUpdate,Oe=Pe.tangentsNeedUpdate,Ne=Pe.colorsNeedUpdate,Be=Pe.morphTargetsNeedUpdate,Ie=Pe.vertices,ke=e.faces3,Ge=e.faces4,je=Pe.faces,We=Pe.faceVertexUvs[0],Xe=Pe.faceVertexUvs[1],Ye=(Pe.colors,Pe.skinIndices),qe=Pe.skinWeights,Ke=Pe.morphTargets,Ze=Pe.morphNormals;if(Fe){for(n=0,a=ke.length;a>n;n++)h=je[ke[n]],T=Ie[h.a],y=Ie[h.b],R=Ie[h.c],Te[se]=T.x,Te[se+1]=T.y,Te[se+2]=T.z,Te[se+3]=y.x,Te[se+4]=y.y,Te[se+5]=y.z,Te[se+6]=R.x,Te[se+7]=R.y,Te[se+8]=R.z,se+=9;for(n=0,a=Ge.length;a>n;n++)h=je[Ge[n]],T=Ie[h.a],y=Ie[h.b],R=Ie[h.c],x=Ie[h.d],Te[se]=T.x,Te[se+1]=T.y,Te[se+2]=T.z,Te[se+3]=y.x,Te[se+4]=y.y,Te[se+5]=y.z,Te[se+6]=R.x,Te[se+7]=R.y,Te[se+8]=R.z,Te[se+9]=x.x,Te[se+10]=x.y,Te[se+11]=x.z,se+=12;ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglVertexBuffer),ze.bufferData(ze.ARRAY_BUFFER,Te,r)}if(Be)for(q=0,K=Ke.length;K>q;q++){for(me=0,n=0,a=ke.length;a>n;n++)J=ke[n],h=je[J],T=Ke[q].vertices[h.a],y=Ke[q].vertices[h.b],R=Ke[q].vertices[h.c],Z=Me[q],Z[me]=T.x,Z[me+1]=T.y,Z[me+2]=T.z,Z[me+3]=y.x,Z[me+4]=y.y,Z[me+5]=y.z,Z[me+6]=R.x,Z[me+7]=R.y,Z[me+8]=R.z,o.morphNormals&&(ne?($=Ze[q].vertexNormals[J],M=$.a,S=$.b,A=$.c):(M=Ze[q].faceNormals[J],S=M,A=M),Q=Se[q],Q[me]=M.x,Q[me+1]=M.y,Q[me+2]=M.z,Q[me+3]=S.x,Q[me+4]=S.y,Q[me+5]=S.z,Q[me+6]=A.x,Q[me+7]=A.y,Q[me+8]=A.z),me+=9;for(n=0,a=Ge.length;a>n;n++)J=Ge[n],h=je[J],T=Ke[q].vertices[h.a],y=Ke[q].vertices[h.b],R=Ke[q].vertices[h.c],x=Ke[q].vertices[h.d],Z=Me[q],Z[me]=T.x,Z[me+1]=T.y,Z[me+2]=T.z,Z[me+3]=y.x,Z[me+4]=y.y,Z[me+5]=y.z,Z[me+6]=R.x,Z[me+7]=R.y,Z[me+8]=R.z,Z[me+9]=x.x,Z[me+10]=x.y,Z[me+11]=x.z,o.morphNormals&&(ne?($=Ze[q].vertexNormals[J],M=$.a,S=$.b,A=$.c,C=$.d):(M=Ze[q].faceNormals[J],S=M,A=M,C=M),Q=Se[q],Q[me]=M.x,Q[me+1]=M.y,Q[me+2]=M.z,Q[me+3]=S.x,Q[me+4]=S.y,Q[me+5]=S.z,Q[me+6]=A.x,Q[me+7]=A.y,Q[me+8]=A.z,Q[me+9]=C.x,Q[me+10]=C.y,Q[me+11]=C.z),me+=12;ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[q]),ze.bufferData(ze.ARRAY_BUFFER,Me[q],r),o.morphNormals&&(ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[q]),ze.bufferData(ze.ARRAY_BUFFER,Se[q],r))}if(qe.length){for(n=0,a=ke.length;a>n;n++)h=je[ke[n]],U=qe[h.a],V=qe[h.b],O=qe[h.c],we[de]=U.x,we[de+1]=U.y,we[de+2]=U.z,we[de+3]=U.w,we[de+4]=V.x,we[de+5]=V.y,we[de+6]=V.z,we[de+7]=V.w,we[de+8]=O.x,we[de+9]=O.y,we[de+10]=O.z,we[de+11]=O.w,N=Ye[h.a],B=Ye[h.b],I=Ye[h.c],be[de]=N.x,be[de+1]=N.y,be[de+2]=N.z,be[de+3]=N.w,be[de+4]=B.x,be[de+5]=B.y,be[de+6]=B.z,be[de+7]=B.w,be[de+8]=I.x,be[de+9]=I.y,be[de+10]=I.z,be[de+11]=I.w,de+=12;for(n=0,a=Ge.length;a>n;n++)h=je[Ge[n]],U=qe[h.a],V=qe[h.b],O=qe[h.c],z=qe[h.d],we[de]=U.x,we[de+1]=U.y,we[de+2]=U.z,we[de+3]=U.w,we[de+4]=V.x,we[de+5]=V.y,we[de+6]=V.z,we[de+7]=V.w,we[de+8]=O.x,we[de+9]=O.y,we[de+10]=O.z,we[de+11]=O.w,we[de+12]=z.x,we[de+13]=z.y,we[de+14]=z.z,we[de+15]=z.w,N=Ye[h.a],B=Ye[h.b],I=Ye[h.c],k=Ye[h.d],be[de]=N.x,be[de+1]=N.y,be[de+2]=N.z,be[de+3]=N.w,be[de+4]=B.x,be[de+5]=B.y,be[de+6]=B.z,be[de+7]=B.w,be[de+8]=I.x,be[de+9]=I.y,be[de+10]=I.z,be[de+11]=I.w,be[de+12]=k.x,be[de+13]=k.y,be[de+14]=k.z,be[de+15]=k.w,de+=16;de>0&&(ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),ze.bufferData(ze.ARRAY_BUFFER,be,r),ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),ze.bufferData(ze.ARRAY_BUFFER,we,r))}if(Ne&&ie){for(n=0,a=ke.length;a>n;n++)h=je[ke[n]],u=h.vertexColors,p=h.color,3===u.length&&ie===THREE.VertexColors?(L=u[0],P=u[1],F=u[2]):(L=p,P=p,F=p),_e[Ee]=L.r,_e[Ee+1]=L.g,_e[Ee+2]=L.b,_e[Ee+3]=P.r,_e[Ee+4]=P.g,_e[Ee+5]=P.b,_e[Ee+6]=F.r,_e[Ee+7]=F.g,_e[Ee+8]=F.b,Ee+=9;for(n=0,a=Ge.length;a>n;n++)h=je[Ge[n]],u=h.vertexColors,p=h.color,4===u.length&&ie===THREE.VertexColors?(L=u[0],P=u[1],F=u[2],D=u[3]):(L=p,P=p,F=p,D=p),_e[Ee]=L.r,_e[Ee+1]=L.g,_e[Ee+2]=L.b,_e[Ee+3]=P.r,_e[Ee+4]=P.g,_e[Ee+5]=P.b,_e[Ee+6]=F.r,_e[Ee+7]=F.g,_e[Ee+8]=F.b,_e[Ee+9]=D.r,_e[Ee+10]=D.g,_e[Ee+11]=D.b,Ee+=12;Ee>0&&(ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglColorBuffer),ze.bufferData(ze.ARRAY_BUFFER,_e,r))}if(Oe&&Pe.hasTangents){for(n=0,a=ke.length;a>n;n++)h=je[ke[n]],m=h.vertexTangents,H=m[0],_=m[1],b=m[2],He[pe]=H.x,He[pe+1]=H.y,He[pe+2]=H.z,He[pe+3]=H.w,He[pe+4]=_.x,He[pe+5]=_.y,He[pe+6]=_.z,He[pe+7]=_.w,He[pe+8]=b.x,He[pe+9]=b.y,He[pe+10]=b.z,He[pe+11]=b.w,pe+=12;for(n=0,a=Ge.length;a>n;n++)h=je[Ge[n]],m=h.vertexTangents,H=m[0],_=m[1],b=m[2],w=m[3],He[pe]=H.x,He[pe+1]=H.y,He[pe+2]=H.z,He[pe+3]=H.w,He[pe+4]=_.x,He[pe+5]=_.y,He[pe+6]=_.z,He[pe+7]=_.w,He[pe+8]=b.x,He[pe+9]=b.y,He[pe+10]=b.z,He[pe+11]=b.w,He[pe+12]=w.x,He[pe+13]=w.y,He[pe+14]=w.z,He[pe+15]=w.w,pe+=16;ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglTangentBuffer),ze.bufferData(ze.ARRAY_BUFFER,He,r)}if(Ve&&re){for(n=0,a=ke.length;a>n;n++)if(h=je[ke[n]],l=h.vertexNormals,c=h.normal,3===l.length&&ne)for(G=0;3>G;G++)W=l[G],xe[ue]=W.x,xe[ue+1]=W.y,xe[ue+2]=W.z,ue+=3;else for(G=0;3>G;G++)xe[ue]=c.x,xe[ue+1]=c.y,xe[ue+2]=c.z,ue+=3;for(n=0,a=Ge.length;a>n;n++)if(h=je[Ge[n]],l=h.vertexNormals,c=h.normal,4===l.length&&ne)for(G=0;4>G;G++)W=l[G],xe[ue]=W.x,xe[ue+1]=W.y,xe[ue+2]=W.z,ue+=3;else for(G=0;4>G;G++)xe[ue]=c.x,xe[ue+1]=c.y,xe[ue+2]=c.z,ue+=3;ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglNormalBuffer),ze.bufferData(ze.ARRAY_BUFFER,xe,r)}if(Ue&&We&&oe){for(n=0,a=ke.length;a>n;n++)if(s=ke[n],g=We[s],void 0!==g)for(G=0;3>G;G++)X=g[G],ye[he]=X.x,ye[he+1]=X.y,he+=2;for(n=0,a=Ge.length;a>n;n++)if(s=Ge[n],g=We[s],void 0!==g)for(G=0;4>G;G++)X=g[G],ye[he]=X.x,ye[he+1]=X.y,he+=2;he>0&&(ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglUVBuffer),ze.bufferData(ze.ARRAY_BUFFER,ye,r))}if(Ue&&Xe&&oe){for(n=0,a=ke.length;a>n;n++)if(s=ke[n],v=Xe[s],void 0!==v)for(G=0;3>G;G++)Y=v[G],Re[le]=Y.x,Re[le+1]=Y.y,le+=2;for(n=0,a=Ge.length;a>n;n++)if(s=Ge[n],v=Xe[s],void 0!==v)for(G=0;4>G;G++)Y=v[G],Re[le]=Y.x,Re[le+1]=Y.y,le+=2;le>0&&(ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglUV2Buffer),ze.bufferData(ze.ARRAY_BUFFER,Re,r))}if(De){for(n=0,a=ke.length;a>n;n++)Ce[ce]=ae,Ce[ce+1]=ae+1,Ce[ce+2]=ae+2,ce+=3,Le[fe]=ae,Le[fe+1]=ae+1,Le[fe+2]=ae,Le[fe+3]=ae+2,Le[fe+4]=ae+1,Le[fe+5]=ae+2,fe+=6,ae+=3;for(n=0,a=Ge.length;a>n;n++)Ce[ce]=ae,Ce[ce+1]=ae+1,Ce[ce+2]=ae+3,Ce[ce+3]=ae+1,Ce[ce+4]=ae+2,Ce[ce+5]=ae+3,ce+=6,Le[fe]=ae,Le[fe+1]=ae+1,Le[fe+2]=ae,Le[fe+3]=ae+3,Le[fe+4]=ae+1,Le[fe+5]=ae+2,Le[fe+6]=ae+2,Le[fe+7]=ae+3,fe+=8,ae+=4;ze.bindBuffer(ze.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),ze.bufferData(ze.ELEMENT_ARRAY_BUFFER,Ce,r),ze.bindBuffer(ze.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),ze.bufferData(ze.ELEMENT_ARRAY_BUFFER,Le,r)}if(Ae)for(G=0,j=Ae.length;j>G;G++)if(te=Ae[G],te.__original.needsUpdate){if(ge=0,ve=0,1===te.size){if(void 0===te.boundTo||"vertices"===te.boundTo){for(n=0,a=ke.length;a>n;n++)h=je[ke[n]],te.array[ge]=te.value[h.a],te.array[ge+1]=te.value[h.b],te.array[ge+2]=te.value[h.c],ge+=3;for(n=0,a=Ge.length;a>n;n++)h=je[Ge[n]],te.array[ge]=te.value[h.a],te.array[ge+1]=te.value[h.b],te.array[ge+2]=te.value[h.c],te.array[ge+3]=te.value[h.d],ge+=4}else if("faces"===te.boundTo){for(n=0,a=ke.length;a>n;n++)ee=te.value[ke[n]],te.array[ge]=ee,te.array[ge+1]=ee,te.array[ge+2]=ee,ge+=3;for(n=0,a=Ge.length;a>n;n++)ee=te.value[Ge[n]],te.array[ge]=ee,te.array[ge+1]=ee,te.array[ge+2]=ee,te.array[ge+3]=ee,ge+=4}}else if(2===te.size){if(void 0===te.boundTo||"vertices"===te.boundTo){for(n=0,a=ke.length;a>n;n++)h=je[ke[n]],T=te.value[h.a],y=te.value[h.b],R=te.value[h.c],te.array[ge]=T.x,te.array[ge+1]=T.y,te.array[ge+2]=y.x,te.array[ge+3]=y.y,te.array[ge+4]=R.x,te.array[ge+5]=R.y,ge+=6;for(n=0,a=Ge.length;a>n;n++)h=je[Ge[n]],T=te.value[h.a],y=te.value[h.b],R=te.value[h.c],x=te.value[h.d],te.array[ge]=T.x,te.array[ge+1]=T.y,te.array[ge+2]=y.x,te.array[ge+3]=y.y,te.array[ge+4]=R.x,te.array[ge+5]=R.y,te.array[ge+6]=x.x,te.array[ge+7]=x.y,ge+=8}else if("faces"===te.boundTo){for(n=0,a=ke.length;a>n;n++)ee=te.value[ke[n]],T=ee,y=ee,R=ee,te.array[ge]=T.x,te.array[ge+1]=T.y,te.array[ge+2]=y.x,te.array[ge+3]=y.y,te.array[ge+4]=R.x,te.array[ge+5]=R.y,ge+=6;for(n=0,a=Ge.length;a>n;n++)ee=te.value[Ge[n]],T=ee,y=ee,R=ee,x=ee,te.array[ge]=T.x,te.array[ge+1]=T.y,te.array[ge+2]=y.x,te.array[ge+3]=y.y,te.array[ge+4]=R.x,te.array[ge+5]=R.y,te.array[ge+6]=x.x,te.array[ge+7]=x.y,ge+=8}}else if(3===te.size){var Qe;if(Qe="c"===te.type?["r","g","b"]:["x","y","z"],void 0===te.boundTo||"vertices"===te.boundTo){for(n=0,a=ke.length;a>n;n++)h=je[ke[n]],T=te.value[h.a],y=te.value[h.b],R=te.value[h.c],te.array[ge]=T[Qe[0]],te.array[ge+1]=T[Qe[1]],te.array[ge+2]=T[Qe[2]],te.array[ge+3]=y[Qe[0]],te.array[ge+4]=y[Qe[1]],te.array[ge+5]=y[Qe[2]],te.array[ge+6]=R[Qe[0]],te.array[ge+7]=R[Qe[1]],te.array[ge+8]=R[Qe[2]],ge+=9;for(n=0,a=Ge.length;a>n;n++)h=je[Ge[n]],T=te.value[h.a],y=te.value[h.b],R=te.value[h.c],x=te.value[h.d],te.array[ge]=T[Qe[0]],te.array[ge+1]=T[Qe[1]],te.array[ge+2]=T[Qe[2]],te.array[ge+3]=y[Qe[0]],te.array[ge+4]=y[Qe[1]],te.array[ge+5]=y[Qe[2]],te.array[ge+6]=R[Qe[0]],te.array[ge+7]=R[Qe[1]],te.array[ge+8]=R[Qe[2]],te.array[ge+9]=x[Qe[0]],te.array[ge+10]=x[Qe[1]],te.array[ge+11]=x[Qe[2]],ge+=12}else if("faces"===te.boundTo){for(n=0,a=ke.length;a>n;n++)ee=te.value[ke[n]],T=ee,y=ee,R=ee,te.array[ge]=T[Qe[0]],te.array[ge+1]=T[Qe[1]],te.array[ge+2]=T[Qe[2]],te.array[ge+3]=y[Qe[0]],te.array[ge+4]=y[Qe[1]],te.array[ge+5]=y[Qe[2]],te.array[ge+6]=R[Qe[0]],te.array[ge+7]=R[Qe[1]],te.array[ge+8]=R[Qe[2]],ge+=9;for(n=0,a=Ge.length;a>n;n++)ee=te.value[Ge[n]],T=ee,y=ee,R=ee,x=ee,te.array[ge]=T[Qe[0]],te.array[ge+1]=T[Qe[1]],te.array[ge+2]=T[Qe[2]],te.array[ge+3]=y[Qe[0]],te.array[ge+4]=y[Qe[1]],te.array[ge+5]=y[Qe[2]],te.array[ge+6]=R[Qe[0]],te.array[ge+7]=R[Qe[1]],te.array[ge+8]=R[Qe[2]],te.array[ge+9]=x[Qe[0]],te.array[ge+10]=x[Qe[1]],te.array[ge+11]=x[Qe[2]],ge+=12}else if("faceVertices"===te.boundTo){for(n=0,a=ke.length;a>n;n++)ee=te.value[ke[n]],T=ee[0],y=ee[1],R=ee[2],te.array[ge]=T[Qe[0]],te.array[ge+1]=T[Qe[1]],te.array[ge+2]=T[Qe[2]],te.array[ge+3]=y[Qe[0]],te.array[ge+4]=y[Qe[1]],te.array[ge+5]=y[Qe[2]],te.array[ge+6]=R[Qe[0]],te.array[ge+7]=R[Qe[1]],te.array[ge+8]=R[Qe[2]],ge+=9;for(n=0,a=Ge.length;a>n;n++)ee=te.value[Ge[n]],T=ee[0],y=ee[1],R=ee[2],x=ee[3],te.array[ge]=T[Qe[0]],te.array[ge+1]=T[Qe[1]],te.array[ge+2]=T[Qe[2]],te.array[ge+3]=y[Qe[0]],te.array[ge+4]=y[Qe[1]],te.array[ge+5]=y[Qe[2]],te.array[ge+6]=R[Qe[0]],te.array[ge+7]=R[Qe[1]],te.array[ge+8]=R[Qe[2]],te.array[ge+9]=x[Qe[0]],te.array[ge+10]=x[Qe[1]],te.array[ge+11]=x[Qe[2]],ge+=12}}else if(4===te.size)if(void 0===te.boundTo||"vertices"===te.boundTo){for(n=0,a=ke.length;a>n;n++)h=je[ke[n]],T=te.value[h.a],y=te.value[h.b],R=te.value[h.c],te.array[ge]=T.x,te.array[ge+1]=T.y,te.array[ge+2]=T.z,te.array[ge+3]=T.w,te.array[ge+4]=y.x,te.array[ge+5]=y.y,te.array[ge+6]=y.z,te.array[ge+7]=y.w,te.array[ge+8]=R.x,te.array[ge+9]=R.y,te.array[ge+10]=R.z,te.array[ge+11]=R.w,ge+=12;for(n=0,a=Ge.length;a>n;n++)h=je[Ge[n]],T=te.value[h.a],y=te.value[h.b],R=te.value[h.c],x=te.value[h.d],te.array[ge]=T.x,te.array[ge+1]=T.y,te.array[ge+2]=T.z,te.array[ge+3]=T.w,te.array[ge+4]=y.x,te.array[ge+5]=y.y,te.array[ge+6]=y.z,te.array[ge+7]=y.w,te.array[ge+8]=R.x,te.array[ge+9]=R.y,te.array[ge+10]=R.z,te.array[ge+11]=R.w,te.array[ge+12]=x.x,te.array[ge+13]=x.y,te.array[ge+14]=x.z,te.array[ge+15]=x.w,ge+=16}else if("faces"===te.boundTo){for(n=0,a=ke.length;a>n;n++)ee=te.value[ke[n]],T=ee,y=ee,R=ee,te.array[ge]=T.x,te.array[ge+1]=T.y,te.array[ge+2]=T.z,te.array[ge+3]=T.w,te.array[ge+4]=y.x,te.array[ge+5]=y.y,te.array[ge+6]=y.z,te.array[ge+7]=y.w,te.array[ge+8]=R.x,te.array[ge+9]=R.y,te.array[ge+10]=R.z,te.array[ge+11]=R.w,ge+=12;for(n=0,a=Ge.length;a>n;n++)ee=te.value[Ge[n]],T=ee,y=ee,R=ee,x=ee,te.array[ge]=T.x,te.array[ge+1]=T.y,te.array[ge+2]=T.z,te.array[ge+3]=T.w,te.array[ge+4]=y.x,te.array[ge+5]=y.y,te.array[ge+6]=y.z,te.array[ge+7]=y.w,te.array[ge+8]=R.x,te.array[ge+9]=R.y,te.array[ge+10]=R.z,te.array[ge+11]=R.w,te.array[ge+12]=x.x,te.array[ge+13]=x.y,te.array[ge+14]=x.z,te.array[ge+15]=x.w,ge+=16}else if("faceVertices"===te.boundTo){for(n=0,a=ke.length;a>n;n++)ee=te.value[ke[n]],T=ee[0],y=ee[1],R=ee[2],te.array[ge]=T.x,te.array[ge+1]=T.y,te.array[ge+2]=T.z,te.array[ge+3]=T.w,te.array[ge+4]=y.x,te.array[ge+5]=y.y,te.array[ge+6]=y.z,te.array[ge+7]=y.w,te.array[ge+8]=R.x,te.array[ge+9]=R.y,te.array[ge+10]=R.z,te.array[ge+11]=R.w,ge+=12;for(n=0,a=Ge.length;a>n;n++)ee=te.value[Ge[n]],T=ee[0],y=ee[1],R=ee[2],x=ee[3],te.array[ge]=T.x,te.array[ge+1]=T.y,te.array[ge+2]=T.z,te.array[ge+3]=T.w,te.array[ge+4]=y.x,te.array[ge+5]=y.y,te.array[ge+6]=y.z,te.array[ge+7]=y.w,te.array[ge+8]=R.x,te.array[ge+9]=R.y,te.array[ge+10]=R.z,te.array[ge+11]=R.w,te.array[ge+12]=x.x,te.array[ge+13]=x.y,te.array[ge+14]=x.z,te.array[ge+15]=x.w,ge+=16}ze.bindBuffer(ze.ARRAY_BUFFER,te.buffer),ze.bufferData(ze.ARRAY_BUFFER,te.array,r)}i&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function R(e,t,r){var i,o,n=e.attributes;for(i in n)o=n[i],o.needsUpdate&&("index"===i?(ze.bindBuffer(ze.ELEMENT_ARRAY_BUFFER,o.buffer),ze.bufferData(ze.ELEMENT_ARRAY_BUFFER,o.array,t)):(ze.bindBuffer(ze.ARRAY_BUFFER,o.buffer),ze.bufferData(ze.ARRAY_BUFFER,o.array,t)),o.needsUpdate=!1),r&&!o.dynamic&&(o.array=null)}function x(e){vt[e]||(ze.enableVertexAttribArray(e),vt[e]=!0)}function H(){for(var e in vt)vt[e]&&(ze.disableVertexAttribArray(e),vt[e]=!1)}function _(e,t,r){var i=e.program.attributes;if(-1!==r.morphTargetBase&&i.position>=0?(ze.bindBuffer(ze.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[r.morphTargetBase]),x(i.position),ze.vertexAttribPointer(i.position,3,ze.FLOAT,!1,0,0)):i.position>=0&&(ze.bindBuffer(ze.ARRAY_BUFFER,t.__webglVertexBuffer),x(i.position),ze.vertexAttribPointer(i.position,3,ze.FLOAT,!1,0,0)),r.morphTargetForcedOrder.length)for(var o=0,n=r.morphTargetForcedOrder,a=r.morphTargetInfluences;o<e.numSupportedMorphTargets&&o<n.length;)i["morphTarget"+o]>=0&&(ze.bindBuffer(ze.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[n[o]]),x(i["morphTarget"+o]),ze.vertexAttribPointer(i["morphTarget"+o],3,ze.FLOAT,!1,0,0)),i["morphNormal"+o]>=0&&e.morphNormals&&(ze.bindBuffer(ze.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[n[o]]),x(i["morphNormal"+o]),ze.vertexAttribPointer(i["morphNormal"+o],3,ze.FLOAT,!1,0,0)),r.__webglMorphTargetInfluences[o]=a[n[o]],o++;else{var s,h,l=[],a=r.morphTargetInfluences,c=a.length;for(h=0;c>h;h++)s=a[h],s>0&&l.push([s,h]);l.length>e.numSupportedMorphTargets?(l.sort(w),l.length=e.numSupportedMorphTargets):l.length>e.numSupportedMorphNormals?l.sort(w):0===l.length&&l.push([0,0]);for(var u,o=0;o<e.numSupportedMorphTargets;)l[o]?(u=l[o][1],i["morphTarget"+o]>=0&&(ze.bindBuffer(ze.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[u]),x(i["morphTarget"+o]),ze.vertexAttribPointer(i["morphTarget"+o],3,ze.FLOAT,!1,0,0)),i["morphNormal"+o]>=0&&e.morphNormals&&(ze.bindBuffer(ze.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[u]),x(i["morphNormal"+o]),ze.vertexAttribPointer(i["morphNormal"+o],3,ze.FLOAT,!1,0,0)),r.__webglMorphTargetInfluences[o]=a[u]):r.__webglMorphTargetInfluences[o]=0,o++}null!==e.program.uniforms.morphTargetInfluences&&ze.uniform1fv(e.program.uniforms.morphTargetInfluences,r.__webglMorphTargetInfluences)}function b(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function w(e,t){return t[0]-e[0]}function M(e,t,r){if(e.length)for(var i=0,o=e.length;o>i;i++)Ye=null,Qe=null,rt=-1,at=-1,st=-1,et=-1,tt=-1,Ze=-1,Ke=-1,_t=!0,e[i].render(t,r,mt,gt),Ye=null,Qe=null,rt=-1,at=-1,st=-1,et=-1,tt=-1,Ze=-1,Ke=-1,_t=!0}function S(e,t,r,i,o,n,a,s){var h,l,c,u,p,f,E;t?(p=e.length-1,f=-1,E=-1):(p=0,f=e.length,E=1);for(var d=p;d!==f;d+=E)if(h=e[d],h.render){if(l=h.object,c=h.buffer,s)u=s;else{if(u=h[r],!u)continue;a&&je.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),je.setDepthTest(u.depthTest),je.setDepthWrite(u.depthWrite),se(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}je.setMaterialFaces(u),c instanceof THREE.BufferGeometry?je.renderBufferDirect(i,o,n,u,c,l):je.renderBuffer(i,o,n,u,c,l)}}function A(e,t,r,i,o,n,a){for(var s,h,l,c=0,u=e.length;u>c;c++)if(s=e[c],h=s.object,h.visible){if(a)l=a;else{if(l=s[t],!l)continue;n&&je.setBlending(l.blending,l.blendEquation,l.blendSrc,l.blendDst),je.setDepthTest(l.depthTest),je.setDepthWrite(l.depthWrite),se(l.polygonOffset,l.polygonOffsetFactor,l.polygonOffsetUnits)}je.renderImmediateObject(r,i,o,l,h)}}function C(e){var t=e.object,r=t.material;r.transparent?(e.transparent=r,e.opaque=null):(e.opaque=r,e.transparent=null)}function L(e){var t,r,i,o=e.object,n=e.buffer;i=o.material,i instanceof THREE.MeshFaceMaterial?(r=n.materialIndex,t=i.materials[r],t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)):(t=i,t&&(t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)))}function P(e,t){var r,i,o,n,a,s,h={},l=e.morphTargets.length,c=e.morphNormals.length,u=t instanceof THREE.MeshFaceMaterial;for(e.geometryGroups={},r=0,i=e.faces.length;i>r;r++)o=e.faces[r],n=u?o.materialIndex:0,void 0===h[n]&&(h[n]={hash:n,counter:0}),s=h[n].hash+"_"+h[n].counter,void 0===e.geometryGroups[s]&&(e.geometryGroups[s]={faces3:[],faces4:[],materialIndex:n,vertices:0,numMorphTargets:l,numMorphNormals:c}),a=o instanceof THREE.Face3?3:4,e.geometryGroups[s].vertices+a>65535&&(h[n].counter+=1,s=h[n].hash+"_"+h[n].counter,void 0===e.geometryGroups[s]&&(e.geometryGroups[s]={faces3:[],faces4:[],materialIndex:n,vertices:0,numMorphTargets:l,numMorphNormals:c})),o instanceof THREE.Face3?e.geometryGroups[s].faces3.push(r):e.geometryGroups[s].faces4.push(r),e.geometryGroups[s].vertices+=a;e.geometryGroupsList=[];for(var p in e.geometryGroups)e.geometryGroups[p].id=Je++,e.geometryGroupsList.push(e.geometryGroups[p])}function F(e,n){var a,u,p,f;if(void 0===e.__webglInit)if(e.__webglInit=!0,e._modelViewMatrix=new THREE.Matrix4,e._normalMatrix=new THREE.Matrix3,void 0!==e.geometry&&void 0===e.geometry.__webglInit&&(e.geometry.__webglInit=!0,e.geometry.addEventListener("dispose",zt)),u=e.geometry,void 0===u);else if(u instanceof THREE.BufferGeometry)m(u);else if(e instanceof THREE.Mesh){p=e.material,void 0===u.geometryGroups&&P(u,p);for(a in u.geometryGroups)f=u.geometryGroups[a],f.__webglVertexBuffer||(o(f),c(f,e),u.verticesNeedUpdate=!0,u.morphTargetsNeedUpdate=!0,\r\nu.elementsNeedUpdate=!0,u.uvsNeedUpdate=!0,u.normalsNeedUpdate=!0,u.tangentsNeedUpdate=!0,u.colorsNeedUpdate=!0)}else e instanceof THREE.Ribbon?u.__webglVertexBuffer||(i(u),l(u,e),u.verticesNeedUpdate=!0,u.colorsNeedUpdate=!0,u.normalsNeedUpdate=!0):e instanceof THREE.Line?u.__webglVertexBuffer||(r(u),h(u,e),u.verticesNeedUpdate=!0,u.colorsNeedUpdate=!0,u.lineDistancesNeedUpdate=!0):e instanceof THREE.ParticleSystem&&(u.__webglVertexBuffer||(t(u),s(u,e),u.verticesNeedUpdate=!0,u.colorsNeedUpdate=!0));if(void 0===e.__webglActive){if(e instanceof THREE.Mesh){if(u=e.geometry,u instanceof THREE.BufferGeometry)D(n.__webglObjects,u,e);else if(u instanceof THREE.Geometry)for(a in u.geometryGroups)f=u.geometryGroups[a],D(n.__webglObjects,f,e)}else e instanceof THREE.Ribbon||e instanceof THREE.Line||e instanceof THREE.ParticleSystem?(u=e.geometry,D(n.__webglObjects,u,e)):e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback?U(n.__webglObjectsImmediate,e):e instanceof THREE.Sprite?n.__webglSprites.push(e):e instanceof THREE.LensFlare&&n.__webglFlares.push(e);e.__webglActive=!0}}function D(e,t,r){e.push({id:null,buffer:t,object:r,opaque:null,transparent:null,z:0})}function U(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function V(e){var t,r,i,o=e.geometry;if(o instanceof THREE.BufferGeometry)R(o,ze.DYNAMIC_DRAW,!o.dynamic);else if(e instanceof THREE.Mesh){for(var n=0,a=o.geometryGroupsList.length;a>n;n++)t=o.geometryGroupsList[n],i=u(e,t),o.buffersNeedUpdate&&c(t,e),r=i.attributes&&O(i),(o.verticesNeedUpdate||o.morphTargetsNeedUpdate||o.elementsNeedUpdate||o.uvsNeedUpdate||o.normalsNeedUpdate||o.colorsNeedUpdate||o.tangentsNeedUpdate||r)&&y(t,e,ze.DYNAMIC_DRAW,!o.dynamic,i);o.verticesNeedUpdate=!1,o.morphTargetsNeedUpdate=!1,o.elementsNeedUpdate=!1,o.uvsNeedUpdate=!1,o.normalsNeedUpdate=!1,o.colorsNeedUpdate=!1,o.tangentsNeedUpdate=!1,o.buffersNeedUpdate=!1,i.attributes&&z(i)}else e instanceof THREE.Ribbon?(i=u(e,o),r=i.attributes&&O(i),(o.verticesNeedUpdate||o.colorsNeedUpdate||o.normalsNeedUpdate||r)&&T(o,ze.DYNAMIC_DRAW),o.verticesNeedUpdate=!1,o.colorsNeedUpdate=!1,o.normalsNeedUpdate=!1,i.attributes&&z(i)):e instanceof THREE.Line?(i=u(e,o),r=i.attributes&&O(i),(o.verticesNeedUpdate||o.colorsNeedUpdate||o.lineDistancesNeedUpdate||r)&&v(o,ze.DYNAMIC_DRAW),o.verticesNeedUpdate=!1,o.colorsNeedUpdate=!1,o.lineDistancesNeedUpdate=!1,i.attributes&&z(i)):e instanceof THREE.ParticleSystem&&(i=u(e,o),r=i.attributes&&O(i),(o.verticesNeedUpdate||o.colorsNeedUpdate||e.sortParticles||r)&&g(o,ze.DYNAMIC_DRAW,e),o.verticesNeedUpdate=!1,o.colorsNeedUpdate=!1,i.attributes&&z(i))}function O(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function z(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function N(e,t){e instanceof THREE.Mesh||e instanceof THREE.ParticleSystem||e instanceof THREE.Ribbon||e instanceof THREE.Line?B(t.__webglObjects,e):e instanceof THREE.Sprite?I(t.__webglSprites,e):e instanceof THREE.LensFlare?I(t.__webglFlares,e):(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback)&&B(t.__webglObjectsImmediate,e),delete e.__webglActive}function B(e,t){for(var r=e.length-1;r>=0;r--)e[r].object===t&&e.splice(r,1)}function I(e,t){for(var r=e.length-1;r>=0;r--)e[r]===t&&e.splice(r,1)}function k(e,t){e.uniforms=THREE.UniformsUtils.clone(t.uniforms),e.vertexShader=t.vertexShader,e.fragmentShader=t.fragmentShader}function G(e,t,r,i,o){$e=0,i.needsUpdate&&(i.program&&Wt(i),je.initMaterial(i,t,r,o),i.needsUpdate=!1),i.morphTargets&&(o.__webglMorphTargetInfluences||(o.__webglMorphTargetInfluences=new Float32Array(je.maxMorphTargets)));var n=!1,a=i.program,s=a.uniforms,h=i.uniforms;if(a!==Ye&&(ze.useProgram(a),Ye=a,n=!0),i.id!==Ke&&(Ke=i.id,n=!0),(n||e!==Qe)&&(ze.uniformMatrix4fv(s.projectionMatrix,!1,e.projectionMatrix.elements),e!==Qe&&(Qe=e)),i.skinning)if(Lt&&o.useVertexTexture){if(null!==s.boneTexture){var l=ee();ze.uniform1i(s.boneTexture,l),je.setTexture(o.boneTexture,l)}}else null!==s.boneGlobalMatrices&&ze.uniformMatrix4fv(s.boneGlobalMatrices,!1,o.boneMatrices);return n&&(r&&i.fog&&q(h,r),(i instanceof THREE.MeshPhongMaterial||i instanceof THREE.MeshLambertMaterial||i.lights)&&(_t&&(ne(a,t),_t=!1),Q(h,bt)),(i instanceof THREE.MeshBasicMaterial||i instanceof THREE.MeshLambertMaterial||i instanceof THREE.MeshPhongMaterial)&&j(h,i),i instanceof THREE.LineBasicMaterial?W(h,i):i instanceof THREE.LineDashedMaterial?(W(h,i),X(h,i)):i instanceof THREE.ParticleBasicMaterial?Y(h,i):i instanceof THREE.MeshPhongMaterial?K(h,i):i instanceof THREE.MeshLambertMaterial?Z(h,i):i instanceof THREE.MeshDepthMaterial?(h.mNear.value=e.near,h.mFar.value=e.far,h.opacity.value=i.opacity):i instanceof THREE.MeshNormalMaterial&&(h.opacity.value=i.opacity),o.receiveShadow&&!i._shadowPass&&J(h,t),te(a,i.uniformsList),(i instanceof THREE.ShaderMaterial||i instanceof THREE.MeshPhongMaterial||i.envMap)&&null!==s.cameraPosition&&(xt.getPositionFromMatrix(e.matrixWorld),ze.uniform3f(s.cameraPosition,xt.x,xt.y,xt.z)),(i instanceof THREE.MeshPhongMaterial||i instanceof THREE.MeshLambertMaterial||i instanceof THREE.ShaderMaterial||i.skinning)&&null!==s.viewMatrix&&ze.uniformMatrix4fv(s.viewMatrix,!1,e.matrixWorldInverse.elements)),$(s,o),null!==s.modelMatrix&&ze.uniformMatrix4fv(s.modelMatrix,!1,o.matrixWorld.elements),a}function j(e,t){e.opacity.value=t.opacity,je.gammaInput?e.diffuse.value.copyGammaToLinear(t.color):e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var r;if(t.map?r=t.map:t.specularMap?r=t.specularMap:t.normalMap?r=t.normalMap:t.bumpMap&&(r=t.bumpMap),void 0!==r){var i=r.offset,o=r.repeat;e.offsetRepeat.value.set(i.x,i.y,o.x,o.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,je.gammaInput?e.reflectivity.value=t.reflectivity:e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.combine.value=t.combine,e.useRefract.value=t.envMap&&t.envMap.mapping instanceof THREE.CubeRefractionMapping}function W(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function X(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function Y(e,t){e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=Ae.height/2,e.map.value=t.map}function q(e,t){e.fogColor.value=t.color,t instanceof THREE.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof THREE.FogExp2&&(e.fogDensity.value=t.density)}function K(e,t){e.shininess.value=t.shininess,je.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive),e.specular.value.copyGammaToLinear(t.specular)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.specular.value=t.specular),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function Z(e,t){je.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function Q(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function J(e,t){if(e.shadowMatrix)for(var r=0,i=0,o=t.length;o>i;i++){var n=t[i];n.castShadow&&(n instanceof THREE.SpotLight||n instanceof THREE.DirectionalLight&&!n.shadowCascade)&&(e.shadowMap.value[r]=n.shadowMap,e.shadowMapSize.value[r]=n.shadowMapSize,e.shadowMatrix.value[r]=n.shadowMatrix,e.shadowDarkness.value[r]=n.shadowDarkness,e.shadowBias.value[r]=n.shadowBias,r++)}}function $(e,t){ze.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&ze.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}function ee(){var e=$e;return e>=wt&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+wt),$e+=1,e}function te(e,t){var r,i,o,n,a,s,h,l,c,u,p;for(c=0,u=t.length;u>c;c++)if(n=e.uniforms[t[c][1]])if(r=t[c][0],o=r.type,i=r.value,"i"===o)ze.uniform1i(n,i);else if("f"===o)ze.uniform1f(n,i);else if("v2"===o)ze.uniform2f(n,i.x,i.y);else if("v3"===o)ze.uniform3f(n,i.x,i.y,i.z);else if("v4"===o)ze.uniform4f(n,i.x,i.y,i.z,i.w);else if("c"===o)ze.uniform3f(n,i.r,i.g,i.b);else if("iv1"===o)ze.uniform1iv(n,i);else if("iv"===o)ze.uniform3iv(n,i);else if("fv1"===o)ze.uniform1fv(n,i);else if("fv"===o)ze.uniform3fv(n,i);else if("v2v"===o){for(void 0===r._array&&(r._array=new Float32Array(2*i.length)),h=0,l=i.length;l>h;h++)p=2*h,r._array[p]=i[h].x,r._array[p+1]=i[h].y;ze.uniform2fv(n,r._array)}else if("v3v"===o){for(void 0===r._array&&(r._array=new Float32Array(3*i.length)),h=0,l=i.length;l>h;h++)p=3*h,r._array[p]=i[h].x,r._array[p+1]=i[h].y,r._array[p+2]=i[h].z;ze.uniform3fv(n,r._array)}else if("v4v"===o){for(void 0===r._array&&(r._array=new Float32Array(4*i.length)),h=0,l=i.length;l>h;h++)p=4*h,r._array[p]=i[h].x,r._array[p+1]=i[h].y,r._array[p+2]=i[h].z,r._array[p+3]=i[h].w;ze.uniform4fv(n,r._array)}else if("m4"===o)void 0===r._array&&(r._array=new Float32Array(16)),i.flattenToArray(r._array),ze.uniformMatrix4fv(n,!1,r._array);else if("m4v"===o){for(void 0===r._array&&(r._array=new Float32Array(16*i.length)),h=0,l=i.length;l>h;h++)i[h].flattenToArrayOffset(r._array,16*h);ze.uniformMatrix4fv(n,!1,r._array)}else if("t"===o){if(a=i,s=ee(),ze.uniform1i(n,s),!a)continue;a.image instanceof Array&&6===a.image.length?ge(a,s):a instanceof THREE.WebGLRenderTargetCube?ve(a,s):je.setTexture(a,s)}else if("tv"===o){for(void 0===r._array&&(r._array=[]),h=0,l=r.value.length;l>h;h++)r._array[h]=ee();for(ze.uniform1iv(n,r._array),h=0,l=r.value.length;l>h;h++)a=r.value[h],s=r._array[h],a&&je.setTexture(a,s)}else console.warn("THREE.WebGLRenderer: Unknown uniform type: "+o)}function re(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function ie(e,t,r,i){e[t]=r.r*r.r*i,e[t+1]=r.g*r.g*i,e[t+2]=r.b*r.b*i}function oe(e,t,r,i){e[t]=r.r*i,e[t+1]=r.g*i,e[t+2]=r.b*i}function ne(e,t){var r,i,o,n,a,s,h,l,c,u=0,p=0,f=0,E=bt,d=E.directional.colors,m=E.directional.positions,g=E.point.colors,v=E.point.positions,T=E.point.distances,y=E.spot.colors,R=E.spot.positions,x=E.spot.distances,H=E.spot.directions,_=E.spot.anglesCos,b=E.spot.exponents,w=E.hemi.skyColors,M=E.hemi.groundColors,S=E.hemi.positions,A=0,C=0,L=0,P=0,F=0,D=0,U=0,V=0,O=0,z=0,N=0,B=0;for(r=0,i=t.length;i>r;r++)if(o=t[r],!o.onlyShadow)if(n=o.color,h=o.intensity,c=o.distance,o instanceof THREE.AmbientLight){if(!o.visible)continue;je.gammaInput?(u+=n.r*n.r,p+=n.g*n.g,f+=n.b*n.b):(u+=n.r,p+=n.g,f+=n.b)}else if(o instanceof THREE.DirectionalLight){if(F+=1,!o.visible)continue;if(Ht.getPositionFromMatrix(o.matrixWorld),xt.getPositionFromMatrix(o.target.matrixWorld),Ht.sub(xt),Ht.normalize(),0===Ht.x&&0===Ht.y&&0===Ht.z)continue;O=3*A,m[O]=Ht.x,m[O+1]=Ht.y,m[O+2]=Ht.z,je.gammaInput?ie(d,O,n,h*h):oe(d,O,n,h),A+=1}else if(o instanceof THREE.PointLight){if(D+=1,!o.visible)continue;z=3*C,je.gammaInput?ie(g,z,n,h*h):oe(g,z,n,h),xt.getPositionFromMatrix(o.matrixWorld),v[z]=xt.x,v[z+1]=xt.y,v[z+2]=xt.z,T[C]=c,C+=1}else if(o instanceof THREE.SpotLight){if(U+=1,!o.visible)continue;N=3*L,je.gammaInput?ie(y,N,n,h*h):oe(y,N,n,h),xt.getPositionFromMatrix(o.matrixWorld),R[N]=xt.x,R[N+1]=xt.y,R[N+2]=xt.z,x[L]=c,Ht.copy(xt),xt.getPositionFromMatrix(o.target.matrixWorld),Ht.sub(xt),Ht.normalize(),H[N]=Ht.x,H[N+1]=Ht.y,H[N+2]=Ht.z,_[L]=Math.cos(o.angle),b[L]=o.exponent,L+=1}else if(o instanceof THREE.HemisphereLight){if(V+=1,!o.visible)continue;if(Ht.getPositionFromMatrix(o.matrixWorld),Ht.normalize(),0===Ht.x&&0===Ht.y&&0===Ht.z)continue;B=3*P,S[B]=Ht.x,S[B+1]=Ht.y,S[B+2]=Ht.z,a=o.color,s=o.groundColor,je.gammaInput?(l=h*h,ie(w,B,a,l),ie(M,B,s,l)):(oe(w,B,a,h),oe(M,B,s,h)),P+=1}for(r=3*A,i=Math.max(d.length,3*F);i>r;r++)d[r]=0;for(r=3*C,i=Math.max(g.length,3*D);i>r;r++)g[r]=0;for(r=3*L,i=Math.max(y.length,3*U);i>r;r++)y[r]=0;for(r=3*P,i=Math.max(w.length,3*V);i>r;r++)w[r]=0;for(r=3*P,i=Math.max(M.length,3*V);i>r;r++)M[r]=0;E.directional.length=A,E.point.length=C,E.spot.length=L,E.hemi.length=P,E.ambient[0]=u,E.ambient[1]=p,E.ambient[2]=f}function ae(e){e!==ut&&(ze.lineWidth(e),ut=e)}function se(e,t,r){ht!==e&&(e?ze.enable(ze.POLYGON_OFFSET_FILL):ze.disable(ze.POLYGON_OFFSET_FILL),ht=e),!e||lt===t&&ct===r||(ze.polygonOffset(t,r),lt=t,ct=r)}function he(e){var t,r,i=[];for(var o in e)t=e[o],t!==!1&&(r="#define "+o+" "+t,i.push(r));return i.join("\\n")}function le(e,t,r,i,o,n,a){var s,h,l,c,u,p=[];e?p.push(e):(p.push(t),p.push(r));for(l in n)p.push(l),p.push(n[l]);for(s in a)p.push(s),p.push(a[s]);for(u=p.join(),s=0,h=We.length;h>s;s++){var f=We[s];if(f.code===u)return f.usedTimes++,f.program}var E="SHADOWMAP_TYPE_BASIC";a.shadowMapType===THREE.PCFShadowMap?E="SHADOWMAP_TYPE_PCF":a.shadowMapType===THREE.PCFSoftShadowMap&&(E="SHADOWMAP_TYPE_PCF_SOFT");var d=he(n);c=ze.createProgram();var m=["precision "+Ce+" float;",d,Ct?"#define VERTEX_TEXTURES":"",je.gammaInput?"#define GAMMA_INPUT":"",je.gammaOutput?"#define GAMMA_OUTPUT":"",je.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+a.maxDirLights,"#define MAX_POINT_LIGHTS "+a.maxPointLights,"#define MAX_SPOT_LIGHTS "+a.maxSpotLights,"#define MAX_HEMI_LIGHTS "+a.maxHemiLights,"#define MAX_SHADOWS "+a.maxShadows,"#define MAX_BONES "+a.maxBones,a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.lightMap?"#define USE_LIGHTMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.vertexColors?"#define USE_COLOR":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.boneTextureWidth?"#define N_BONE_PIXEL_X "+a.boneTextureWidth.toFixed(1):"",a.boneTextureHeight?"#define N_BONE_PIXEL_Y "+a.boneTextureHeight.toFixed(1):"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals?"#define USE_MORPHNORMALS":"",a.perPixel?"#define PHONG_PER_PIXEL":"",a.wrapAround?"#define WRAP_AROUND":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+E:"",a.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",a.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\\n"),g=["precision "+Ce+" float;",a.bumpMap||a.normalMap?"#extension GL_OES_standard_derivatives : enable":"",d,"#define MAX_DIR_LIGHTS "+a.maxDirLights,"#define MAX_POINT_LIGHTS "+a.maxPointLights,"#define MAX_SPOT_LIGHTS "+a.maxSpotLights,"#define MAX_HEMI_LIGHTS "+a.maxHemiLights,"#define MAX_SHADOWS "+a.maxShadows,a.alphaTest?"#define ALPHATEST "+a.alphaTest:"",je.gammaInput?"#define GAMMA_INPUT":"",je.gammaOutput?"#define GAMMA_OUTPUT":"",je.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.lightMap?"#define USE_LIGHTMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.vertexColors?"#define USE_COLOR":"",a.metal?"#define METAL":"",a.perPixel?"#define PHONG_PER_PIXEL":"",a.wrapAround?"#define WRAP_AROUND":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+E:"",a.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",a.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\\n"),v=fe("vertex",m+r),T=fe("fragment",g+t);ze.attachShader(c,v),ze.attachShader(c,T),ze.linkProgram(c),ze.getProgramParameter(c,ze.LINK_STATUS)||console.error("Could not initialise shader\\nVALIDATE_STATUS: "+ze.getProgramParameter(c,ze.VALIDATE_STATUS)+", gl error ["+ze.getError()+"]"),ze.deleteShader(T),ze.deleteShader(v),c.uniforms={},c.attributes={};var y,R,x,H;y=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"],a.useVertexTexture?y.push("boneTexture"):y.push("boneGlobalMatrices");for(R in i)y.push(R);for(ce(c,y),y=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"],H=0;H<a.maxMorphTargets;H++)y.push("morphTarget"+H);for(H=0;H<a.maxMorphNormals;H++)y.push("morphNormal"+H);for(x in o)y.push(x);return ue(c,y),c.id=Xe++,We.push({program:c,code:u,usedTimes:1}),je.info.memory.programs=We.length,c}function ce(e,t){var r,i,o;for(r=0,i=t.length;i>r;r++)o=t[r],e.uniforms[o]=ze.getUniformLocation(e,o)}function ue(e,t){var r,i,o;for(r=0,i=t.length;i>r;r++)o=t[r],e.attributes[o]=ze.getAttribLocation(e,o)}function pe(e){for(var t=e.split("\\n"),r=0,i=t.length;i>r;r++)t[r]=r+1+": "+t[r];return t.join("\\n")}function fe(e,t){var r;return"fragment"===e?r=ze.createShader(ze.FRAGMENT_SHADER):"vertex"===e&&(r=ze.createShader(ze.VERTEX_SHADER)),ze.shaderSource(r,t),ze.compileShader(r),ze.getShaderParameter(r,ze.COMPILE_STATUS)?r:(console.error(ze.getShaderInfoLog(r)),console.error(pe(t)),null)}function Ee(e){return 0===(e&e-1)}function de(e,t,r){r?(ze.texParameteri(e,ze.TEXTURE_WRAP_S,He(t.wrapS)),ze.texParameteri(e,ze.TEXTURE_WRAP_T,He(t.wrapT)),ze.texParameteri(e,ze.TEXTURE_MAG_FILTER,He(t.magFilter)),ze.texParameteri(e,ze.TEXTURE_MIN_FILTER,He(t.minFilter))):(ze.texParameteri(e,ze.TEXTURE_WRAP_S,ze.CLAMP_TO_EDGE),ze.texParameteri(e,ze.TEXTURE_WRAP_T,ze.CLAMP_TO_EDGE),ze.texParameteri(e,ze.TEXTURE_MAG_FILTER,xe(t.magFilter)),ze.texParameteri(e,ze.TEXTURE_MIN_FILTER,xe(t.minFilter))),ke&&t.type!==THREE.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(ze.texParameterf(e,ke.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,At)),t.__oldAnisotropy=t.anisotropy)}function me(e,t){if(e.width<=t&&e.height<=t)return e;var r=Math.max(e.width,e.height),i=Math.floor(e.width*t/r),o=Math.floor(e.height*t/r),n=document.createElement("canvas");n.width=i,n.height=o;var a=n.getContext("2d");return a.drawImage(e,0,0,e.width,e.height,0,0,i,o),n}function ge(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.addEventListener("dispose",Nt),e.image.__webglTextureCube=ze.createTexture(),je.info.memory.textures++),ze.activeTexture(ze.TEXTURE0+t),ze.bindTexture(ze.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),ze.pixelStorei(ze.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var r=e instanceof THREE.CompressedTexture,i=[],o=0;6>o;o++)je.autoScaleCubemaps&&!r?i[o]=me(e.image[o],St):i[o]=e.image[o];var n=i[0],a=Ee(n.width)&&Ee(n.height),s=He(e.format),h=He(e.type);de(ze.TEXTURE_CUBE_MAP,e,a);for(var o=0;6>o;o++)if(r)for(var l,c=i[o].mipmaps,u=0,p=c.length;p>u;u++)l=c[u],ze.compressedTexImage2D(ze.TEXTURE_CUBE_MAP_POSITIVE_X+o,u,s,l.width,l.height,0,l.data);else ze.texImage2D(ze.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,s,s,h,i[o]);e.generateMipmaps&&a&&ze.generateMipmap(ze.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else ze.activeTexture(ze.TEXTURE0+t),ze.bindTexture(ze.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function ve(e,t){ze.activeTexture(ze.TEXTURE0+t),ze.bindTexture(ze.TEXTURE_CUBE_MAP,e.__webglTexture)}function Te(e,t,r){ze.bindFramebuffer(ze.FRAMEBUFFER,e),ze.framebufferTexture2D(ze.FRAMEBUFFER,ze.COLOR_ATTACHMENT0,r,t.__webglTexture,0)}function ye(e,t){ze.bindRenderbuffer(ze.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(ze.renderbufferStorage(ze.RENDERBUFFER,ze.DEPTH_COMPONENT16,t.width,t.height),ze.framebufferRenderbuffer(ze.FRAMEBUFFER,ze.DEPTH_ATTACHMENT,ze.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(ze.renderbufferStorage(ze.RENDERBUFFER,ze.DEPTH_STENCIL,t.width,t.height),ze.framebufferRenderbuffer(ze.FRAMEBUFFER,ze.DEPTH_STENCIL_ATTACHMENT,ze.RENDERBUFFER,e)):ze.renderbufferStorage(ze.RENDERBUFFER,ze.RGBA4,t.width,t.height)}function Re(e){e instanceof THREE.WebGLRenderTargetCube?(ze.bindTexture(ze.TEXTURE_CUBE_MAP,e.__webglTexture),ze.generateMipmap(ze.TEXTURE_CUBE_MAP),ze.bindTexture(ze.TEXTURE_CUBE_MAP,null)):(ze.bindTexture(ze.TEXTURE_2D,e.__webglTexture),ze.generateMipmap(ze.TEXTURE_2D),ze.bindTexture(ze.TEXTURE_2D,null))}function xe(e){return e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter?ze.NEAREST:ze.LINEAR}function He(e){if(e===THREE.RepeatWrapping)return ze.REPEAT;if(e===THREE.ClampToEdgeWrapping)return ze.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return ze.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return ze.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return ze.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return ze.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return ze.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return ze.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return ze.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return ze.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return ze.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return ze.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return ze.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return ze.BYTE;if(e===THREE.ShortType)return ze.SHORT;if(e===THREE.UnsignedShortType)return ze.UNSIGNED_SHORT;if(e===THREE.IntType)return ze.INT;if(e===THREE.UnsignedIntType)return ze.UNSIGNED_INT;if(e===THREE.FloatType)return ze.FLOAT;if(e===THREE.AlphaFormat)return ze.ALPHA;if(e===THREE.RGBFormat)return ze.RGB;if(e===THREE.RGBAFormat)return ze.RGBA;if(e===THREE.LuminanceFormat)return ze.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return ze.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return ze.FUNC_ADD;if(e===THREE.SubtractEquation)return ze.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return ze.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return ze.ZERO;if(e===THREE.OneFactor)return ze.ONE;if(e===THREE.SrcColorFactor)return ze.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return ze.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return ze.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return ze.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return ze.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return ze.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return ze.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return ze.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return ze.SRC_ALPHA_SATURATE;if(void 0!==Ge){if(e===THREE.RGB_S3TC_DXT1_Format)return Ge.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return Ge.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return Ge.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return Ge.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function _e(e){if(Lt&&e&&e.useVertexTexture)return 1024;var t=ze.getParameter(ze.MAX_VERTEX_UNIFORM_VECTORS),r=Math.floor((t-20)/4),i=r;return void 0!==e&&e instanceof THREE.SkinnedMesh&&(i=Math.min(e.bones.length,i),i<e.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.bones.length+", this GPU supports just "+i+" (try OpenGL instead of ANGLE)")),i}function be(e){for(var t=0,r=0,i=0,o=0,n=0,a=e.length;a>n;n++){var s=e[n];s.onlyShadow||(s instanceof THREE.DirectionalLight&&t++,s instanceof THREE.PointLight&&r++,s instanceof THREE.SpotLight&&i++,s instanceof THREE.HemisphereLight&&o++)}return{directional:t,point:r,spot:i,hemi:o}}function we(e){for(var t=0,r=0,i=e.length;i>r;r++){var o=e[r];o.castShadow&&(o instanceof THREE.SpotLight&&t++,o instanceof THREE.DirectionalLight&&!o.shadowCascade&&t++)}return t}function Me(){try{if(!(ze=Ae.getContext("experimental-webgl",{alpha:Le,premultipliedAlpha:Pe,antialias:Fe,stencil:De,preserveDrawingBuffer:Ue})))throw"Error creating WebGL context."}catch(e){console.error(e)}Ne=ze.getExtension("OES_texture_float"),Be=ze.getExtension("OES_texture_float_linear"),Ie=ze.getExtension("OES_standard_derivatives"),ke=ze.getExtension("EXT_texture_filter_anisotropic")||ze.getExtension("MOZ_EXT_texture_filter_anisotropic")||ze.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),Ge=ze.getExtension("WEBGL_compressed_texture_s3tc")||ze.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||ze.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),Ne||console.log("THREE.WebGLRenderer: Float textures not supported."),Ie||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),ke||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),Ge||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),void 0===ze.getShaderPrecisionFormat&&(ze.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}function Se(){ze.clearColor(0,0,0,1),ze.clearDepth(1),ze.clearStencil(0),ze.enable(ze.DEPTH_TEST),ze.depthFunc(ze.LEQUAL),ze.frontFace(ze.CCW),ze.cullFace(ze.BACK),ze.enable(ze.CULL_FACE),ze.enable(ze.BLEND),ze.blendEquation(ze.FUNC_ADD),ze.blendFunc(ze.SRC_ALPHA,ze.ONE_MINUS_SRC_ALPHA),ze.clearColor(Ve.r,Ve.g,Ve.b,Oe)}console.log("THREE.WebGLRenderer",THREE.REVISION),e=e||{};var Ae=void 0!==e.canvas?e.canvas:document.createElement("canvas"),Ce=void 0!==e.precision?e.precision:"highp",Le=void 0!==e.alpha?e.alpha:!0,Pe=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,Fe=void 0!==e.antialias?e.antialias:!1,De=void 0!==e.stencil?e.stencil:!0,Ue=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,Ve=new THREE.Color(0),Oe=0;void 0!==e.clearColor&&(console.warn("DEPRECATED: clearColor in WebGLRenderer constructor parameters is being removed. Use .setClearColor() instead."),Ve.setHex(e.clearColor)),void 0!==e.clearAlpha&&(console.warn("DEPRECATED: clearAlpha in WebGLRenderer constructor parameters is being removed. Use .setClearColor() instead."),Oe=e.clearAlpha),this.domElement=Ae,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyBasedShading=!1,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=THREE.PCFShadowMap,this.shadowMapCullFace=THREE.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var ze,Ne,Be,Ie,ke,Ge,je=this,We=[],Xe=0,Ye=null,qe=null,Ke=-1,Ze=null,Qe=null,Je=0,$e=0,et=-1,tt=-1,rt=-1,it=-1,ot=-1,nt=-1,at=-1,st=-1,ht=null,lt=null,ct=null,ut=null,pt=0,ft=0,Et=0,dt=0,mt=0,gt=0,vt={},Tt=new THREE.Frustum,yt=new THREE.Matrix4,Rt=new THREE.Matrix4,xt=new THREE.Vector3,Ht=new THREE.Vector3,_t=!0,bt={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}};Me(),Se(),this.context=ze;var wt=ze.getParameter(ze.MAX_TEXTURE_IMAGE_UNITS),Mt=ze.getParameter(ze.MAX_VERTEX_TEXTURE_IMAGE_UNITS),St=(ze.getParameter(ze.MAX_TEXTURE_SIZE),ze.getParameter(ze.MAX_CUBE_MAP_TEXTURE_SIZE)),At=ke?ze.getParameter(ke.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Ct=Mt>0,Lt=Ct&&Ne,Pt=(Ge?ze.getParameter(ze.COMPRESSED_TEXTURE_FORMATS):[],ze.getShaderPrecisionFormat(ze.VERTEX_SHADER,ze.HIGH_FLOAT)),Ft=ze.getShaderPrecisionFormat(ze.VERTEX_SHADER,ze.MEDIUM_FLOAT),Dt=(ze.getShaderPrecisionFormat(ze.VERTEX_SHADER,ze.LOW_FLOAT),ze.getShaderPrecisionFormat(ze.FRAGMENT_SHADER,ze.HIGH_FLOAT)),Ut=ze.getShaderPrecisionFormat(ze.FRAGMENT_SHADER,ze.MEDIUM_FLOAT),Vt=(ze.getShaderPrecisionFormat(ze.FRAGMENT_SHADER,ze.LOW_FLOAT),ze.getShaderPrecisionFormat(ze.VERTEX_SHADER,ze.HIGH_INT),ze.getShaderPrecisionFormat(ze.VERTEX_SHADER,ze.MEDIUM_INT),ze.getShaderPrecisionFormat(ze.VERTEX_SHADER,ze.LOW_INT),ze.getShaderPrecisionFormat(ze.FRAGMENT_SHADER,ze.HIGH_INT),ze.getShaderPrecisionFormat(ze.FRAGMENT_SHADER,ze.MEDIUM_INT),ze.getShaderPrecisionFormat(ze.FRAGMENT_SHADER,ze.LOW_INT),Pt.precision>0&&Dt.precision>0),Ot=Ft.precision>0&&Ut.precision>0;"highp"!==Ce||Vt||(Ot?(Ce="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(Ce="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==Ce||Ot||(Ce="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return ze},this.supportsVertexTextures=function(){return Ct},this.supportsFloatTextures=function(){return Ne},this.supportsStandardDerivatives=function(){return Ie},this.supportsCompressedTextureS3TC=function(){return Ge},this.getMaxAnisotropy=function(){return At},this.getPrecision=function(){return Ce},this.setSize=function(e,t,r){Ae.width=e*this.devicePixelRatio,Ae.height=t*this.devicePixelRatio,1!==this.devicePixelRatio&&r!==!1&&(Ae.style.width=e+"px",Ae.style.height=t+"px"),this.setViewport(0,0,Ae.width,Ae.height)},this.setViewport=function(e,t,r,i){pt=void 0!==e?e:0,ft=void 0!==t?t:0,Et=void 0!==r?r:Ae.width,dt=void 0!==i?i:Ae.height,ze.viewport(pt,ft,Et,dt)},this.setScissor=function(e,t,r,i){ze.scissor(e,t,r,i)},this.enableScissorTest=function(e){e?ze.enable(ze.SCISSOR_TEST):ze.disable(ze.SCISSOR_TEST)},this.setClearColor=function(e,t){Ve.set(e),Oe=void 0!==t?t:1,ze.clearColor(Ve.r,Ve.g,Ve.b,Oe)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return Ve},this.getClearAlpha=function(){return Oe},this.clear=function(e,t,r){var i=0;(void 0===e||e)&&(i|=ze.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=ze.DEPTH_BUFFER_BIT),(void 0===r||r)&&(i|=ze.STENCIL_BUFFER_BIT),ze.clear(i)},this.clearTarget=function(e,t,r,i){this.setRenderTarget(e),this.clear(t,r,i)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){Ye=null,rt=-1,at=-1,st=-1,Ze=-1,Ke=-1,_t=!0,et=-1,tt=-1,this.shadowMapPlugin.update(e,t)};var zt=function(e){var t=e.target;t.removeEventListener("dispose",zt),kt(t),je.info.memory.geometries--;\r\n},Nt=function(e){var t=e.target;t.removeEventListener("dispose",Nt),Gt(t),je.info.memory.textures--},Bt=function(e){var t=e.target;t.removeEventListener("dispose",Bt),jt(t),je.info.memory.textures--},It=function(e){var t=e.target;t.removeEventListener("dispose",It),Wt(t)},kt=function(e){if(e.__webglInit=void 0,void 0!==e.__webglVertexBuffer&&ze.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&ze.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&ze.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&ze.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&ze.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&ze.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&ze.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&ze.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&ze.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&ze.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&ze.deleteBuffer(e.__webglLineDistanceBuffer),void 0!==e.geometryGroups)for(var t in e.geometryGroups){var r=e.geometryGroups[t];if(void 0!==r.numMorphTargets)for(var i=0,o=r.numMorphTargets;o>i;i++)ze.deleteBuffer(r.__webglMorphTargetsBuffers[i]);if(void 0!==r.numMorphNormals)for(var i=0,o=r.numMorphNormals;o>i;i++)ze.deleteBuffer(r.__webglMorphNormalsBuffers[i]);n(r)}n(e)},Gt=function(e){if(e.image&&e.image.__webglTextureCube)ze.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,ze.deleteTexture(e.__webglTexture)}},jt=function(e){if(e&&e.__webglTexture)if(ze.deleteTexture(e.__webglTexture),e instanceof THREE.WebGLRenderTargetCube)for(var t=0;6>t;t++)ze.deleteFramebuffer(e.__webglFramebuffer[t]),ze.deleteRenderbuffer(e.__webglRenderbuffer[t]);else ze.deleteFramebuffer(e.__webglFramebuffer),ze.deleteRenderbuffer(e.__webglRenderbuffer)},Wt=function(e){var t=e.program;if(void 0!==t){e.program=void 0;var r,i,o,n=!1;for(r=0,i=We.length;i>r;r++)if(o=We[r],o.program===t){o.usedTimes--,0===o.usedTimes&&(n=!0);break}if(n===!0){var a=[];for(r=0,i=We.length;i>r;r++)o=We[r],o.program!==t&&a.push(o);We=a,ze.deleteProgram(t),je.info.memory.programs--}}};this.renderBufferImmediate=function(e,t,r){if(e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=ze.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=ze.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=ze.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=ze.createBuffer()),e.hasPositions&&(ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglVertexBuffer),ze.bufferData(ze.ARRAY_BUFFER,e.positionArray,ze.DYNAMIC_DRAW),ze.enableVertexAttribArray(t.attributes.position),ze.vertexAttribPointer(t.attributes.position,3,ze.FLOAT,!1,0,0)),e.hasNormals){if(ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglNormalBuffer),r.shading===THREE.FlatShading){var i,o,n,a,s,h,l,c,u,p,f,E,d,m,g=3*e.count;for(m=0;g>m;m+=9)d=e.normalArray,a=d[m],l=d[m+1],p=d[m+2],s=d[m+3],c=d[m+4],f=d[m+5],h=d[m+6],u=d[m+7],E=d[m+8],i=(a+s+h)/3,o=(l+c+u)/3,n=(p+f+E)/3,d[m]=i,d[m+1]=o,d[m+2]=n,d[m+3]=i,d[m+4]=o,d[m+5]=n,d[m+6]=i,d[m+7]=o,d[m+8]=n}ze.bufferData(ze.ARRAY_BUFFER,e.normalArray,ze.DYNAMIC_DRAW),ze.enableVertexAttribArray(t.attributes.normal),ze.vertexAttribPointer(t.attributes.normal,3,ze.FLOAT,!1,0,0)}e.hasUvs&&r.map&&(ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglUvBuffer),ze.bufferData(ze.ARRAY_BUFFER,e.uvArray,ze.DYNAMIC_DRAW),ze.enableVertexAttribArray(t.attributes.uv),ze.vertexAttribPointer(t.attributes.uv,2,ze.FLOAT,!1,0,0)),e.hasColors&&r.vertexColors!==THREE.NoColors&&(ze.bindBuffer(ze.ARRAY_BUFFER,e.__webglColorBuffer),ze.bufferData(ze.ARRAY_BUFFER,e.colorArray,ze.DYNAMIC_DRAW),ze.enableVertexAttribArray(t.attributes.color),ze.vertexAttribPointer(t.attributes.color,3,ze.FLOAT,!1,0,0)),ze.drawArrays(ze.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,i,o,n){if(i.visible!==!1){var a,s,h,l,c=G(e,t,r,i,n),u=c.attributes,p=o.attributes,f=!1,E=i.wireframe?1:0,d=16777215*o.id+2*c.id+E;if(d!==Ze&&(Ze=d,f=!0),f&&H(),n instanceof THREE.Mesh){var m=p.index;if(m){var g=o.offsets;g.length>1&&(f=!0);for(var v=0,T=g.length;T>v;v++){var y=g[v].index;if(f){for(s in p)"index"!==s&&(h=u[s],a=p[s],l=a.itemSize,h>=0&&(ze.bindBuffer(ze.ARRAY_BUFFER,a.buffer),x(h),ze.vertexAttribPointer(h,l,ze.FLOAT,!1,0,y*l*4)));ze.bindBuffer(ze.ELEMENT_ARRAY_BUFFER,m.buffer)}ze.drawElements(ze.TRIANGLES,g[v].count,ze.UNSIGNED_SHORT,2*g[v].start),je.info.render.calls++,je.info.render.vertices+=g[v].count,je.info.render.faces+=g[v].count/3}}else{if(f)for(s in p)"index"!==s&&(h=u[s],a=p[s],l=a.itemSize,h>=0&&(ze.bindBuffer(ze.ARRAY_BUFFER,a.buffer),x(h),ze.vertexAttribPointer(h,l,ze.FLOAT,!1,0,0)));var R=o.attributes.position;ze.drawArrays(ze.TRIANGLES,0,R.numItems/3),je.info.render.calls++,je.info.render.vertices+=R.numItems/3,je.info.render.faces+=R.numItems/3/3}}else if(n instanceof THREE.ParticleSystem){if(f){for(s in p)h=u[s],a=p[s],l=a.itemSize,h>=0&&(ze.bindBuffer(ze.ARRAY_BUFFER,a.buffer),x(h),ze.vertexAttribPointer(h,l,ze.FLOAT,!1,0,0));var R=p.position;ze.drawArrays(ze.POINTS,0,R.numItems/3),je.info.render.calls++,je.info.render.points+=R.numItems/3}}else if(n instanceof THREE.Line&&f){for(s in p)h=u[s],a=p[s],l=a.itemSize,h>=0&&(ze.bindBuffer(ze.ARRAY_BUFFER,a.buffer),x(h),ze.vertexAttribPointer(h,l,ze.FLOAT,!1,0,0));var _=n.type===THREE.LineStrip?ze.LINE_STRIP:ze.LINES;ae(i.linewidth);var R=p.position;ze.drawArrays(_,0,R.numItems/3),je.info.render.calls++,je.info.render.points+=R.numItems}}},this.renderBuffer=function(e,t,r,i,o,n){if(i.visible!==!1){var a,s,h,l=G(e,t,r,i,n),c=l.attributes,u=!1,p=i.wireframe?1:0,f=16777215*o.id+2*l.id+p;if(f!==Ze&&(Ze=f,u=!0),u&&H(),!i.morphTargets&&c.position>=0?u&&(ze.bindBuffer(ze.ARRAY_BUFFER,o.__webglVertexBuffer),x(c.position),ze.vertexAttribPointer(c.position,3,ze.FLOAT,!1,0,0)):n.morphTargetBase&&_(i,o,n),u){if(o.__webglCustomAttributesList)for(s=0,h=o.__webglCustomAttributesList.length;h>s;s++)a=o.__webglCustomAttributesList[s],c[a.buffer.belongsToAttribute]>=0&&(ze.bindBuffer(ze.ARRAY_BUFFER,a.buffer),x(c[a.buffer.belongsToAttribute]),ze.vertexAttribPointer(c[a.buffer.belongsToAttribute],a.size,ze.FLOAT,!1,0,0));c.color>=0&&(ze.bindBuffer(ze.ARRAY_BUFFER,o.__webglColorBuffer),x(c.color),ze.vertexAttribPointer(c.color,3,ze.FLOAT,!1,0,0)),c.normal>=0&&(ze.bindBuffer(ze.ARRAY_BUFFER,o.__webglNormalBuffer),x(c.normal),ze.vertexAttribPointer(c.normal,3,ze.FLOAT,!1,0,0)),c.tangent>=0&&(ze.bindBuffer(ze.ARRAY_BUFFER,o.__webglTangentBuffer),x(c.tangent),ze.vertexAttribPointer(c.tangent,4,ze.FLOAT,!1,0,0)),c.uv>=0&&(ze.bindBuffer(ze.ARRAY_BUFFER,o.__webglUVBuffer),x(c.uv),ze.vertexAttribPointer(c.uv,2,ze.FLOAT,!1,0,0)),c.uv2>=0&&(ze.bindBuffer(ze.ARRAY_BUFFER,o.__webglUV2Buffer),x(c.uv2),ze.vertexAttribPointer(c.uv2,2,ze.FLOAT,!1,0,0)),i.skinning&&c.skinIndex>=0&&c.skinWeight>=0&&(ze.bindBuffer(ze.ARRAY_BUFFER,o.__webglSkinIndicesBuffer),x(c.skinIndex),ze.vertexAttribPointer(c.skinIndex,4,ze.FLOAT,!1,0,0),ze.bindBuffer(ze.ARRAY_BUFFER,o.__webglSkinWeightsBuffer),x(c.skinWeight),ze.vertexAttribPointer(c.skinWeight,4,ze.FLOAT,!1,0,0)),c.lineDistance>=0&&(ze.bindBuffer(ze.ARRAY_BUFFER,o.__webglLineDistanceBuffer),x(c.lineDistance),ze.vertexAttribPointer(c.lineDistance,1,ze.FLOAT,!1,0,0))}if(n instanceof THREE.Mesh)i.wireframe?(ae(i.wireframeLinewidth),u&&ze.bindBuffer(ze.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),ze.drawElements(ze.LINES,o.__webglLineCount,ze.UNSIGNED_SHORT,0)):(u&&ze.bindBuffer(ze.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),ze.drawElements(ze.TRIANGLES,o.__webglFaceCount,ze.UNSIGNED_SHORT,0)),je.info.render.calls++,je.info.render.vertices+=o.__webglFaceCount,je.info.render.faces+=o.__webglFaceCount/3;else if(n instanceof THREE.Line){var E=n.type===THREE.LineStrip?ze.LINE_STRIP:ze.LINES;ae(i.linewidth),ze.drawArrays(E,0,o.__webglLineCount),je.info.render.calls++}else n instanceof THREE.ParticleSystem?(ze.drawArrays(ze.POINTS,0,o.__webglParticleCount),je.info.render.calls++,je.info.render.points+=o.__webglParticleCount):n instanceof THREE.Ribbon&&(ze.drawArrays(ze.TRIANGLE_STRIP,0,o.__webglVertexCount),je.info.render.calls++)}},this.render=function(e,t,r,i){if(t instanceof THREE.Camera==!1)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");var o,n,a,s,h,l=e.__lights,c=e.fog;for(Ke=-1,_t=!0,e.autoUpdate===!0&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),yt.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),Tt.setFromMatrix(yt),this.autoUpdateObjects&&this.initWebGLObjects(e),M(this.renderPluginsPre,e,t),je.info.render.calls=0,je.info.render.vertices=0,je.info.render.faces=0,je.info.render.points=0,this.setRenderTarget(r),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),h=e.__webglObjects,o=0,n=h.length;n>o;o++)a=h[o],s=a.object,a.id=o,a.render=!1,s.visible&&((s instanceof THREE.Mesh||s instanceof THREE.ParticleSystem)&&s.frustumCulled&&!Tt.intersectsObject(s)||(re(s,t),L(a),a.render=!0,this.sortObjects===!0&&(null!==s.renderDepth?a.z=s.renderDepth:(xt.getPositionFromMatrix(s.matrixWorld),xt.applyProjection(yt),a.z=xt.z))));for(this.sortObjects&&h.sort(b),h=e.__webglObjectsImmediate,o=0,n=h.length;n>o;o++)a=h[o],s=a.object,s.visible&&(re(s,t),C(a));if(e.overrideMaterial){var u=e.overrideMaterial;this.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),this.setDepthTest(u.depthTest),this.setDepthWrite(u.depthWrite),se(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits),S(e.__webglObjects,!1,"",t,l,c,!0,u),A(e.__webglObjectsImmediate,"",t,l,c,!1,u)}else{var u=null;this.setBlending(THREE.NoBlending),S(e.__webglObjects,!0,"opaque",t,l,c,!1,u),A(e.__webglObjectsImmediate,"opaque",t,l,c,!1,u),S(e.__webglObjects,!1,"transparent",t,l,c,!0,u),A(e.__webglObjectsImmediate,"transparent",t,l,c,!0,u)}M(this.renderPluginsPost,e,t),r&&r.generateMipmaps&&r.minFilter!==THREE.NearestFilter&&r.minFilter!==THREE.LinearFilter&&Re(r),this.setDepthTest(!0),this.setDepthWrite(!0)},this.renderImmediateObject=function(e,t,r,i,o){var n=G(e,t,r,i,o);Ze=-1,je.setMaterialFaces(i),o.immediateRenderCallback?o.immediateRenderCallback(n,ze,Tt):o.render(function(e){je.renderBufferImmediate(e,n,i)})},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);e.__objectsAdded.length;)F(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);for(;e.__objectsRemoved.length;)N(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,r=e.__webglObjects.length;r>t;t++){var i=e.__webglObjects[t].object;void 0===i.__webglInit&&(void 0!==i.__webglActive&&N(i,e),F(i,e)),V(i)}},this.initMaterial=function(e,t,r,i){e.addEventListener("dispose",It);var o,n,a,s,h,l,c;e instanceof THREE.MeshDepthMaterial?c="depth":e instanceof THREE.MeshNormalMaterial?c="normal":e instanceof THREE.MeshBasicMaterial?c="basic":e instanceof THREE.MeshLambertMaterial?c="lambert":e instanceof THREE.MeshPhongMaterial?c="phong":e instanceof THREE.LineBasicMaterial?c="basic":e instanceof THREE.LineDashedMaterial?c="dashed":e instanceof THREE.ParticleBasicMaterial&&(c="particle_basic"),c&&k(e,THREE.ShaderLib[c]),s=be(t),l=we(t),h=_e(i),a={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:r,useFog:e.fog,fogExp:r instanceof THREE.FogExp2,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:h,useVertexTexture:Lt&&i&&i.useVertexTexture,boneTextureWidth:i&&i.boneTextureWidth,boneTextureHeight:i&&i.boneTextureHeight,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:s.directional,maxPointLights:s.point,maxSpotLights:s.spot,maxHemiLights:s.hemi,maxShadows:l,shadowMapEnabled:this.shadowMapEnabled&&i.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide},e.program=le(c,e.fragmentShader,e.vertexShader,e.uniforms,e.attributes,e.defines,a);var u=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var p,f="morphTarget";for(n=0;n<this.maxMorphTargets;n++)p=f+n,u[p]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;var p,f="morphNormal";for(n=0;n<this.maxMorphNormals;n++)p=f+n,u[p]>=0&&e.numSupportedMorphNormals++}e.uniformsList=[];for(o in e.uniforms)e.uniformsList.push([e.uniforms[o],o])},this.setFaceCulling=function(e,t){e===THREE.CullFaceNone?ze.disable(ze.CULL_FACE):(t===THREE.FrontFaceDirectionCW?ze.frontFace(ze.CW):ze.frontFace(ze.CCW),e===THREE.CullFaceBack?ze.cullFace(ze.BACK):e===THREE.CullFaceFront?ze.cullFace(ze.FRONT):ze.cullFace(ze.FRONT_AND_BACK),ze.enable(ze.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===THREE.DoubleSide,r=e.side===THREE.BackSide;et!==t&&(t?ze.disable(ze.CULL_FACE):ze.enable(ze.CULL_FACE),et=t),tt!==r&&(r?ze.frontFace(ze.CW):ze.frontFace(ze.CCW),tt=r)},this.setDepthTest=function(e){at!==e&&(e?ze.enable(ze.DEPTH_TEST):ze.disable(ze.DEPTH_TEST),at=e)},this.setDepthWrite=function(e){st!==e&&(ze.depthMask(e),st=e)},this.setBlending=function(e,t,r,i){e!==rt&&(e===THREE.NoBlending?ze.disable(ze.BLEND):e===THREE.AdditiveBlending?(ze.enable(ze.BLEND),ze.blendEquation(ze.FUNC_ADD),ze.blendFunc(ze.SRC_ALPHA,ze.ONE)):e===THREE.SubtractiveBlending?(ze.enable(ze.BLEND),ze.blendEquation(ze.FUNC_ADD),ze.blendFunc(ze.ZERO,ze.ONE_MINUS_SRC_COLOR)):e===THREE.MultiplyBlending?(ze.enable(ze.BLEND),ze.blendEquation(ze.FUNC_ADD),ze.blendFunc(ze.ZERO,ze.SRC_COLOR)):e===THREE.CustomBlending?ze.enable(ze.BLEND):(ze.enable(ze.BLEND),ze.blendEquationSeparate(ze.FUNC_ADD,ze.FUNC_ADD),ze.blendFuncSeparate(ze.SRC_ALPHA,ze.ONE_MINUS_SRC_ALPHA,ze.ONE,ze.ONE_MINUS_SRC_ALPHA)),rt=e),e===THREE.CustomBlending?(t!==it&&(ze.blendEquation(He(t)),it=t),(r!==ot||i!==nt)&&(ze.blendFunc(He(r),He(i)),ot=r,nt=i)):(it=null,ot=null,nt=null)},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",Nt),e.__webglTexture=ze.createTexture(),je.info.memory.textures++),ze.activeTexture(ze.TEXTURE0+t),ze.bindTexture(ze.TEXTURE_2D,e.__webglTexture),ze.pixelStorei(ze.UNPACK_FLIP_Y_WEBGL,e.flipY),ze.pixelStorei(ze.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),ze.pixelStorei(ze.UNPACK_ALIGNMENT,e.unpackAlignment);var r=e.image,i=Ee(r.width)&&Ee(r.height),o=He(e.format),n=He(e.type);de(ze.TEXTURE_2D,e,i);var a,s=e.mipmaps;if(e instanceof THREE.DataTexture)if(s.length>0&&i){for(var h=0,l=s.length;l>h;h++)a=s[h],ze.texImage2D(ze.TEXTURE_2D,h,o,a.width,a.height,0,o,n,a.data);e.generateMipmaps=!1}else ze.texImage2D(ze.TEXTURE_2D,0,o,r.width,r.height,0,o,n,r.data);else if(e instanceof THREE.CompressedTexture)for(var h=0,l=s.length;l>h;h++)a=s[h],ze.compressedTexImage2D(ze.TEXTURE_2D,h,o,a.width,a.height,0,a.data);else if(s.length>0&&i){for(var h=0,l=s.length;l>h;h++)a=s[h],ze.texImage2D(ze.TEXTURE_2D,h,o,o,n,a);e.generateMipmaps=!1}else ze.texImage2D(ze.TEXTURE_2D,0,o,o,n,e.image);e.generateMipmaps&&i&&ze.generateMipmap(ze.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else ze.activeTexture(ze.TEXTURE0+t),ze.bindTexture(ze.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",Bt),e.__webglTexture=ze.createTexture(),je.info.memory.textures++;var r=Ee(e.width)&&Ee(e.height),i=He(e.format),o=He(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],ze.bindTexture(ze.TEXTURE_CUBE_MAP,e.__webglTexture),de(ze.TEXTURE_CUBE_MAP,e,r);for(var n=0;6>n;n++)e.__webglFramebuffer[n]=ze.createFramebuffer(),e.__webglRenderbuffer[n]=ze.createRenderbuffer(),ze.texImage2D(ze.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,i,e.width,e.height,0,i,o,null),Te(e.__webglFramebuffer[n],e,ze.TEXTURE_CUBE_MAP_POSITIVE_X+n),ye(e.__webglRenderbuffer[n],e);r&&ze.generateMipmap(ze.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=ze.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=ze.createRenderbuffer(),ze.bindTexture(ze.TEXTURE_2D,e.__webglTexture),de(ze.TEXTURE_2D,e,r),ze.texImage2D(ze.TEXTURE_2D,0,i,e.width,e.height,0,i,o,null),Te(e.__webglFramebuffer,e,ze.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?ze.framebufferRenderbuffer(ze.FRAMEBUFFER,ze.DEPTH_ATTACHMENT,ze.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&ze.framebufferRenderbuffer(ze.FRAMEBUFFER,ze.DEPTH_STENCIL_ATTACHMENT,ze.RENDERBUFFER,e.__webglRenderbuffer):ye(e.__webglRenderbuffer,e),r&&ze.generateMipmap(ze.TEXTURE_2D);t?ze.bindTexture(ze.TEXTURE_CUBE_MAP,null):ze.bindTexture(ze.TEXTURE_2D,null),ze.bindRenderbuffer(ze.RENDERBUFFER,null),ze.bindFramebuffer(ze.FRAMEBUFFER,null)}var a,s,h,l,c;e?(a=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,s=e.width,h=e.height,l=0,c=0):(a=null,s=Et,h=dt,l=pt,c=ft),a!==qe&&(ze.bindFramebuffer(ze.FRAMEBUFFER,a),ze.viewport(l,c,s,h),qe=a),mt=s,gt=h},this.shadowMapPlugin=new THREE.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new THREE.SpritePlugin),this.addPostPlugin(new THREE.LensFlarePlugin)},THREE.WebGLRenderTarget=function(e,t,r){this.width=e,this.height=t,r=r||{},this.wrapS=void 0!==r.wrapS?r.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==r.wrapT?r.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==r.magFilter?r.magFilter:THREE.LinearFilter,this.minFilter=void 0!==r.minFilter?r.minFilter:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=void 0!==r.format?r.format:THREE.RGBAFormat,this.type=void 0!==r.type?r.type:THREE.UnsignedByteType,this.depthBuffer=void 0!==r.depthBuffer?r.depthBuffer:!0,this.stencilBuffer=void 0!==r.stencilBuffer?r.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,clone:function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype),THREE.WebGLRenderTargetCube=function(e,t,r){THREE.WebGLRenderTarget.call(this,e,t,r),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype),THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableFace3=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.centroidModel=new THREE.Vector3,this.normalModel=new THREE.Vector3,this.normalModelView=new THREE.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsModelView=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.color=null,this.material=null,this.uvs=[[]],this.z=0},THREE.RenderableFace4=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.v4=new THREE.RenderableVertex,this.centroidModel=new THREE.Vector3,this.normalModel=new THREE.Vector3,this.normalModelView=new THREE.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsModelView=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.color=null,this.material=null,this.uvs=[[]],this.z=0},THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0},THREE.RenderableParticle=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=null,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0},THREE.GeometryUtils={merge:function(e,t,r){var i,o,n=e.vertices.length,a=(e.faceVertexUvs[0].length,t instanceof THREE.Mesh?t.geometry:t),s=e.vertices,h=a.vertices,l=e.faces,c=a.faces,u=e.faceVertexUvs[0],p=a.faceVertexUvs[0];void 0===r&&(r=0),t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,o=(new THREE.Matrix3).getNormalMatrix(i));for(var f=0,E=h.length;E>f;f++){var d=h[f],m=d.clone();i&&m.applyMatrix4(i),s.push(m)}for(f=0,E=c.length;E>f;f++){var g,v,T,y=c[f],R=y.vertexNormals,x=y.vertexColors;y instanceof THREE.Face3?g=new THREE.Face3(y.a+n,y.b+n,y.c+n):y instanceof THREE.Face4&&(g=new THREE.Face4(y.a+n,y.b+n,y.c+n,y.d+n)),g.normal.copy(y.normal),o&&g.normal.applyMatrix3(o).normalize();for(var H=0,_=R.length;_>H;H++)v=R[H].clone(),o&&v.applyMatrix3(o).normalize(),g.vertexNormals.push(v);g.color.copy(y.color);for(var H=0,_=x.length;_>H;H++)T=x[H],g.vertexColors.push(T.clone());g.materialIndex=y.materialIndex+r,g.centroid.copy(y.centroid),i&&g.centroid.applyMatrix4(i),l.push(g)}for(f=0,E=p.length;E>f;f++){for(var b=p[f],w=[],H=0,_=b.length;_>H;H++)w.push(new THREE.Vector2(b[H].x,b[H].y));u.push(w)}},removeMaterials:function(e,t){for(var r={},i=0,o=t.length;o>i;i++)r[t[i]]=!0;for(var n,a=[],i=0,o=e.faces.length;o>i;i++)n=e.faces[i],n.materialIndex in r||a.push(n);e.faces=a},randomPointInTriangle:function(){var e=new THREE.Vector3;return function(t,r,i){var o=new THREE.Vector3,n=THREE.Math.random16(),a=THREE.Math.random16();n+a>1&&(n=1-n,a=1-a);var s=1-n-a;return o.copy(t),o.multiplyScalar(n),e.copy(r),e.multiplyScalar(a),o.add(e),e.copy(i),e.multiplyScalar(s),o.add(e),o}}(),randomPointInFace:function(e,t,r){var i,o,n,a;if(e instanceof THREE.Face3)return i=t.vertices[e.a],o=t.vertices[e.b],n=t.vertices[e.c],THREE.GeometryUtils.randomPointInTriangle(i,o,n);if(e instanceof THREE.Face4){i=t.vertices[e.a],o=t.vertices[e.b],n=t.vertices[e.c],a=t.vertices[e.d];var s,h;r?e._area1&&e._area2?(s=e._area1,h=e._area2):(s=THREE.GeometryUtils.triangleArea(i,o,a),h=THREE.GeometryUtils.triangleArea(o,n,a),e._area1=s,e._area2=h):(s=THREE.GeometryUtils.triangleArea(i,o,a),h=THREE.GeometryUtils.triangleArea(o,n,a));var l=THREE.Math.random16()*(s+h);return s>l?THREE.GeometryUtils.randomPointInTriangle(i,o,a):THREE.GeometryUtils.randomPointInTriangle(o,n,a)}},randomPointsInGeometry:function(e,t){function r(e){function t(r,i){if(r>i)return r;var o=r+Math.floor((i-r)/2);return f[o]>e?t(r,o-1):f[o]<e?t(o+1,i):o}var r=t(0,f.length-1);return r}var i,o,n,a,s,h,l=e.faces,c=e.vertices,u=l.length,p=0,f=[];for(o=0;u>o;o++)i=l[o],i instanceof THREE.Face3?(n=c[i.a],a=c[i.b],s=c[i.c],i._area=THREE.GeometryUtils.triangleArea(n,a,s)):i instanceof THREE.Face4&&(n=c[i.a],a=c[i.b],s=c[i.c],h=c[i.d],i._area1=THREE.GeometryUtils.triangleArea(n,a,h),i._area2=THREE.GeometryUtils.triangleArea(a,s,h),i._area=i._area1+i._area2),p+=i._area,f[o]=p;var E,d,m=[],g={};for(o=0;t>o;o++)E=THREE.Math.random16()*p,d=r(E),m[o]=THREE.GeometryUtils.randomPointInFace(l[d],e,!0),g[d]?g[d]+=1:g[d]=1;return m},triangleArea:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r,i,o){return e.subVectors(i,r),t.subVectors(o,r),e.cross(t),.5*e.length()}}(),center:function(e){e.computeBoundingBox();var t=e.boundingBox,r=new THREE.Vector3;return r.addVectors(t.min,t.max),r.multiplyScalar(-.5),e.applyMatrix((new THREE.Matrix4).makeTranslation(r.x,r.y,r.z)),e.computeBoundingBox(),r},triangulateQuads:function(e){var t,r,i,o,n=[],a=[],s=[];for(t=0,r=e.faceUvs.length;r>t;t++)a[t]=[];for(t=0,r=e.faceVertexUvs.length;r>t;t++)s[t]=[];for(t=0,r=e.faces.length;r>t;t++){var h=e.faces[t];if(h instanceof THREE.Face4){var l=h.a,c=h.b,u=h.c,p=h.d,f=new THREE.Face3,E=new THREE.Face3;for(f.color.copy(h.color),E.color.copy(h.color),f.materialIndex=h.materialIndex,E.materialIndex=h.materialIndex,f.a=l,f.b=c,f.c=p,E.a=c,E.b=u,E.c=p,4===h.vertexColors.length&&(f.vertexColors[0]=h.vertexColors[0].clone(),f.vertexColors[1]=h.vertexColors[1].clone(),f.vertexColors[2]=h.vertexColors[3].clone(),E.vertexColors[0]=h.vertexColors[1].clone(),E.vertexColors[1]=h.vertexColors[2].clone(),E.vertexColors[2]=h.vertexColors[3].clone()),n.push(f,E),i=0,o=e.faceVertexUvs.length;o>i;i++)if(e.faceVertexUvs[i].length){var d=e.faceVertexUvs[i][t],m=d[0],g=d[1],v=d[2],T=d[3],y=[m.clone(),g.clone(),T.clone()],R=[g.clone(),v.clone(),T.clone()];s[i].push(y,R)}for(i=0,o=e.faceUvs.length;o>i;i++)if(e.faceUvs[i].length){var x=e.faceUvs[i][t];a[i].push(x,x)}}else{for(n.push(h),i=0,o=e.faceUvs.length;o>i;i++)a[i].push(e.faceUvs[i][t]);for(i=0,o=e.faceVertexUvs.length;o>i;i++)s[i].push(e.faceVertexUvs[i][t])}}e.faces=n,e.faceUvs=a,e.faceVertexUvs=s,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()},setMaterialIndex:function(e,t,r,i){for(var o=e.faces,n=r||0,a=i||o.length-1,s=n;a>=s;s++)o[s].materialIndex=t}},THREE.ImageUtils={crossOrigin:"anonymous",loadTexture:function(e,t,r,i){var o=new Image,n=new THREE.Texture(o,t),a=new THREE.ImageLoader;return a.crossOrigin=this.crossOrigin,a.load(e,function(e){n.image=e,n.needsUpdate=!0,r&&r(n)}),n.sourceFile=e,n},loadCompressedTexture:function(e,t,r,i){var o=new THREE.CompressedTexture;o.mapping=t;var n=new XMLHttpRequest;return n.onload=function(){var e=n.response,t=THREE.ImageUtils.parseDDS(e,!0);o.format=t.format,o.mipmaps=t.mipmaps,o.image.width=t.width,o.image.height=t.height,o.generateMipmaps=!1,o.needsUpdate=!0,r&&r(o)},n.onerror=i,n.open("GET",e,!0),n.responseType="arraybuffer",n.send(null),o},loadTextureCube:function(e,t,r,i){var o=[];o.loadCount=0;var n=new THREE.Texture;n.image=o,void 0!==t&&(n.mapping=t),n.flipY=!1;for(var a=0,s=e.length;s>a;++a){var h=new Image;o[a]=h,h.onload=function(){o.loadCount+=1,6===o.loadCount&&(n.needsUpdate=!0,r&&r(n))},h.onerror=i,h.crossOrigin=this.crossOrigin,h.src=e[a]}return n},loadCompressedTextureCube:function(e,t,r,i){var o=[];o.loadCount=0;var n=new THREE.CompressedTexture;n.image=o,void 0!==t&&(n.mapping=t),n.flipY=!1,n.generateMipmaps=!1;var a=function(e,t){return function(){var i=e.response,a=THREE.ImageUtils.parseDDS(i,!0);t.format=a.format,t.mipmaps=a.mipmaps,t.width=a.width,t.height=a.height,o.loadCount+=1,6===o.loadCount&&(n.format=a.format,n.needsUpdate=!0,r&&r(n))}};if(e instanceof Array)for(var s=0,h=e.length;h>s;++s){var l={};o[s]=l;var c=new XMLHttpRequest;c.onload=a(c,l),c.onerror=i;var u=e[s];c.open("GET",u,!0),c.responseType="arraybuffer",c.send(null)}else{var u=e,c=new XMLHttpRequest;c.onload=function(){var e=c.response,t=THREE.ImageUtils.parseDDS(e,!0);if(t.isCubemap){for(var i=t.mipmaps.length/t.mipmapCount,a=0;i>a;a++){o[a]={mipmaps:[]};for(var s=0;s<t.mipmapCount;s++)o[a].mipmaps.push(t.mipmaps[a*t.mipmapCount+s]),o[a].format=t.format,o[a].width=t.width,o[a].height=t.height}n.format=t.format,n.needsUpdate=!0,r&&r(n)}},c.onerror=i,c.open("GET",u,!0),c.responseType="arraybuffer",c.send(null)}return n},parseDDS:function(e,t){function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function i(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}var o={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},n=542327876,a=131072,s=512,h=4,l=r("DXT1"),c=r("DXT3"),u=r("DXT5"),p=31,f=0,E=1,d=2,m=3,g=4,v=7,T=20,y=21,R=28,x=new Int32Array(e,0,p);if(x[f]!==n)return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),o;if(!x[T]&h)return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),o;var H,_=x[y];switch(_){case l:H=8,o.format=THREE.RGB_S3TC_DXT1_Format;break;case c:H=16,o.format=THREE.RGBA_S3TC_DXT3_Format;break;case u:H=16,o.format=THREE.RGBA_S3TC_DXT5_Format;break;default:return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",i(_)),o}o.mipmapCount=1,x[d]&a&&t!==!1&&(o.mipmapCount=Math.max(1,x[v])),o.isCubemap=x[R]&s?!0:!1,o.width=x[g],o.height=x[m];for(var b=x[E]+4,w=o.width,M=o.height,S=o.isCubemap?6:1,A=0;S>A;A++){for(var C=0;C<o.mipmapCount;C++){var L=Math.max(4,w)/4*Math.max(4,M)/4*H,P=new Uint8Array(e,b,L),F={data:P,width:w,height:M};o.mipmaps.push(F),b+=L,w=Math.max(.5*w,1),M=Math.max(.5*M,1)}w=o.width,M=o.height}return o},getNormalMap:function(e,t){var r=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},i=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},o=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t=1|t;var n=e.width,a=e.height,s=document.createElement("canvas");s.width=n,s.height=a;var h=s.getContext("2d");h.drawImage(e,0,0);for(var l=h.getImageData(0,0,n,a).data,c=h.createImageData(n,a),u=c.data,p=0;n>p;p++)for(var f=0;a>f;f++){var E=0>f-1?0:f-1,d=f+1>a-1?a-1:f+1,m=0>p-1?0:p-1,g=p+1>n-1?n-1:p+1,v=[],T=[0,0,l[4*(f*n+p)]/255*t];v.push([-1,0,l[4*(f*n+m)]/255*t]),v.push([-1,-1,l[4*(E*n+m)]/255*t]),v.push([0,-1,l[4*(E*n+p)]/255*t]),v.push([1,-1,l[4*(E*n+g)]/255*t]),v.push([1,0,l[4*(f*n+g)]/255*t]),v.push([1,1,l[4*(d*n+g)]/255*t]),v.push([0,1,l[4*(d*n+p)]/255*t]),v.push([-1,1,l[4*(d*n+m)]/255*t]);for(var y=[],R=v.length,x=0;R>x;x++){var H=v[x],_=v[(x+1)%R];H=i(H,T),_=i(_,T),y.push(o(r(H,_)))}for(var b=[0,0,0],x=0;x<y.length;x++)b[0]+=y[x][0],b[1]+=y[x][1],b[2]+=y[x][2];b[0]/=y.length,b[1]/=y.length,b[2]/=y.length;var w=4*(f*n+p);u[w]=(b[0]+1)/2*255|0,u[w+1]=(b[1]+1)/2*255|0,u[w+2]=255*b[2]|0,u[w+3]=255}return h.putImageData(c,0,0),s},generateDataTexture:function(e,t,r){for(var i=e*t,o=new Uint8Array(3*i),n=Math.floor(255*r.r),a=Math.floor(255*r.g),s=Math.floor(255*r.b),h=0;i>h;h++)o[3*h]=n,o[3*h+1]=a,o[3*h+2]=s;var l=new THREE.DataTexture(o,e,t,THREE.RGBFormat);return l.needsUpdate=!0,l}},THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var r=new THREE.Object3D,i=0,o=t.length;o>i;i++)r.add(new THREE.Mesh(e,t[i]));return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld),t.remove(e),r.add(e)},attach:function(e,t,r){var i=new THREE.Matrix4;i.getInverse(r.matrixWorld),e.applyMatrix(i),t.remove(e),r.add(e)}},THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase(),r=this;r.faces[t]=r.faces[t]||{},r.faces[t][e.cssFontWeight]=r.faces[t][e.cssFontWeight]||{},r.faces[t][e.cssFontWeight][e.cssFontStyle]=e;r.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t,r=this.getFace(),i=this.size/r.resolution,o=0,n=String(e).split(""),a=n.length,s=[];for(t=0;a>t;t++){var h=new THREE.Path,l=this.extractGlyphPoints(n[t],r,i,o,h);o+=l.offset,s.push(l.path)}var c=o/2;return{paths:s,offset:c}},extractGlyphPoints:function(e,t,r,i,o){var n,a,s,h,l,c,u,p,f,E,d,m,g,v,T,y,R,x,H,_=[],b=t.glyphs[e]||t.glyphs["?"];if(b){if(b.o)for(h=b._cachedOutline||(b._cachedOutline=b.o.split(" ")),c=h.length,u=r,p=r,n=0;c>n;)switch(l=h[n++]){case"m":f=h[n++]*u+i,E=h[n++]*p,o.moveTo(f,E);\r\nbreak;case"l":f=h[n++]*u+i,E=h[n++]*p,o.lineTo(f,E);break;case"q":if(d=h[n++]*u+i,m=h[n++]*p,T=h[n++]*u+i,y=h[n++]*p,o.quadraticCurveTo(T,y,d,m),H=_[_.length-1])for(g=H.x,v=H.y,a=1,s=this.divisions;s>=a;a++){var w=a/s;THREE.Shape.Utils.b2(w,g,T,d),THREE.Shape.Utils.b2(w,v,y,m)}break;case"b":if(d=h[n++]*u+i,m=h[n++]*p,T=h[n++]*u+i,y=h[n++]*-p,R=h[n++]*u+i,x=h[n++]*-p,o.bezierCurveTo(d,m,T,y,R,x),H=_[_.length-1])for(g=H.x,v=H.y,a=1,s=this.divisions;s>=a;a++){var w=a/s;THREE.Shape.Utils.b3(w,g,T,R,d),THREE.Shape.Utils.b3(w,v,y,x,m)}}return{offset:b.ha*r,path:o}}}},THREE.FontUtils.generateShapes=function(e,t){t=t||{};var r=void 0!==t.size?t.size:100,i=void 0!==t.curveSegments?t.curveSegments:4,o=void 0!==t.font?t.font:"helvetiker",n=void 0!==t.weight?t.weight:"normal",a=void 0!==t.style?t.style:"normal";THREE.FontUtils.size=r,THREE.FontUtils.divisions=i,THREE.FontUtils.face=o,THREE.FontUtils.weight=n,THREE.FontUtils.style=a;for(var s=THREE.FontUtils.drawText(e),h=s.paths,l=[],c=0,u=h.length;u>c;c++)Array.prototype.push.apply(l,h[c].toShapes());return l},function(e){var t=1e-10,r=function(e,t){var r=e.length;if(3>r)return null;var n,a,s,h=[],l=[],c=[];if(i(e)>0)for(a=0;r>a;a++)l[a]=a;else for(a=0;r>a;a++)l[a]=r-1-a;var u=r,p=2*u;for(a=u-1;u>2;){if(p--<=0)return console.log("Warning, unable to triangulate polygon!"),t?c:h;if(n=a,n>=u&&(n=0),a=n+1,a>=u&&(a=0),s=a+1,s>=u&&(s=0),o(e,n,a,s,u,l)){var f,E,d,m,g;for(f=l[n],E=l[a],d=l[s],h.push([e[f],e[E],e[d]]),c.push([l[n],l[a],l[s]]),m=a,g=a+1;u>g;m++,g++)l[m]=l[g];u--,p=2*u}}return t?c:h},i=function(e){for(var t=e.length,r=0,i=t-1,o=0;t>o;i=o++)r+=e[i].x*e[o].y-e[o].x*e[i].y;return.5*r},o=function(e,r,i,o,n,a){var s,h,l,c,u,p,f,E,d;if(h=e[a[r]].x,l=e[a[r]].y,c=e[a[i]].x,u=e[a[i]].y,p=e[a[o]].x,f=e[a[o]].y,t>(c-h)*(f-l)-(u-l)*(p-h))return!1;var m,g,v,T,y,R,x,H,_,b,w,M,S,A,C;for(m=p-c,g=f-u,v=h-p,T=l-f,y=c-h,R=u-l,s=0;n>s;s++)if(s!==r&&s!==i&&s!==o&&(E=e[a[s]].x,d=e[a[s]].y,x=E-h,H=d-l,_=E-c,b=d-u,w=E-p,M=d-f,C=m*b-g*_,S=y*H-R*x,A=v*M-T*w,C>=0&&A>=0&&S>=0))return!1;return!0};return e.Triangulate=r,e.Triangulate.area=i,e}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.typeface_js=self._typeface_js,THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(e){return console.log("Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},THREE.Curve.prototype.getPoints=function(e){e||(e=5);var t,r=[];for(t=0;e>=t;t++)r.push(this.getPoint(t/e));return r},THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,r=[];for(t=0;e>=t;t++)r.push(this.getPointAt(t/e));return r},THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},THREE.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,i=[],o=this.getPoint(0),n=0;for(i.push(0),r=1;e>=r;r++)t=this.getPoint(r/e),n+=t.distanceTo(o),i.push(n),o=t;return this.cacheArcLengths=i,i},THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},THREE.Curve.prototype.getUtoTmapping=function(e,t){var r,i=this.getLengths(),o=0,n=i.length;r=t?t:e*i[n-1];for(var a,s=0,h=n-1;h>=s;)if(o=Math.floor(s+(h-s)/2),a=i[o]-r,0>a)s=o+1;else{if(!(a>0)){h=o;break}h=o-1}if(o=h,i[o]==r){var l=o/(n-1);return l}var c=i[o],u=i[o+1],p=u-c,f=(r-c)/p,l=(o+f)/(n-1);return l},THREE.Curve.prototype.getTangent=function(e){var t=1e-4,r=e-t,i=e+t;0>r&&(r=0),i>1&&(i=1);var o=this.getPoint(r),n=this.getPoint(i),a=n.clone().sub(o);return a.normalize()},THREE.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,r,i){return 2*(1-e)*(r-t)+2*e*(i-r)},tangentCubicBezier:function(e,t,r,i,o){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*i*(1-e)-3*e*e*i+3*e*e*o},tangentSpline:function(e,t,r,i,o){var n=6*e*e-6*e,a=3*e*e-4*e+1,s=-6*e*e+6*e,h=3*e*e-2*e;return n+a+s+h},interpolate:function(e,t,r,i,o){var n=.5*(r-e),a=.5*(i-t),s=o*o,h=o*s;return(2*t-2*r+n+a)*h+(-3*t+3*r-2*n-a)*s+n*o+t}},THREE.Curve.create=function(e,t){return e.prototype=Object.create(THREE.Curve.prototype),e.prototype.getPoint=t,e},THREE.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype),THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))},THREE.CurvePath.prototype.getPoint=function(e){for(var t,r,i=e*this.getLength(),o=this.getCurveLengths(),n=0;n<o.length;){if(o[n]>=i){t=o[n]-i,r=this.curves[n];var a=1-t/r.getLength();return r.getPointAt(a)}n++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],r=0,i=this.curves.length;for(e=0;i>e;e++)r+=this.curves[e].getLength(),t.push(r);return this.cacheLengths=t,t},THREE.CurvePath.prototype.getBoundingBox=function(){var e,t,r,i,o,n,a=this.getPoints();e=t=Number.NEGATIVE_INFINITY,i=o=Number.POSITIVE_INFINITY;var s,h,l,c,u=a[0]instanceof THREE.Vector3;for(c=u?new THREE.Vector3:new THREE.Vector2,h=0,l=a.length;l>h;h++)s=a[h],s.x>e?e=s.x:s.x<i&&(i=s.x),s.y>t?t=s.y:s.y<o&&(o=s.y),u&&(s.z>r?r=s.z:s.z<n&&(n=s.z)),c.add(s);var p={minX:i,minY:o,maxX:e,maxY:t,centroid:c.divideScalar(l)};return u&&(p.maxZ=r,p.minZ=n),p},THREE.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,r=0;r<e.length;r++)t.vertices.push(new THREE.Vector3(e[r].x,e[r].y,e[r].z||0));return t},THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var r,i,o=this.getPoints(e);for(t||(t=this.bends),r=0,i=t.length;i>r;r++)o=this.getWrapPoints(o,t[r]);return o},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var r,i,o=this.getSpacedPoints(e);for(t||(t=this.bends),r=0,i=t.length;i>r;r++)o=this.getWrapPoints(o,t[r]);return o},THREE.CurvePath.prototype.getWrapPoints=function(e,t){var r,i,o,n,a,s,h=this.getBoundingBox();for(r=0,i=e.length;i>r;r++){o=e[r],n=o.x,a=o.y,s=n/h.maxX,s=t.getUtoTmapping(s,n);var l=t.getPoint(s),c=t.getNormalVector(s).multiplyScalar(a);o.x=l.x+c.x,o.y=l.y+c.y}return e},THREE.Gyroscope=function(){THREE.Object3D.call(this)},THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype),THREE.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;r>t;t++)this.children[t].updateMatrixWorld(e)},THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3,THREE.Gyroscope.prototype.translationObject=new THREE.Vector3,THREE.Gyroscope.prototype.quaternionWorld=new THREE.Quaternion,THREE.Gyroscope.prototype.quaternionObject=new THREE.Quaternion,THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3,THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3,THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=Object.create(THREE.CurvePath.prototype),THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;r>t;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(e,t){var r=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:r})},THREE.Path.prototype.lineTo=function(e,t){var r=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,o=i[i.length-2],n=i[i.length-1],a=new THREE.LineCurve(new THREE.Vector2(o,n),new THREE.Vector2(e,t));this.curves.push(a),this.actions.push({action:THREE.PathActions.LINE_TO,args:r})},THREE.Path.prototype.quadraticCurveTo=function(e,t,r,i){var o=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,a=n[n.length-2],s=n[n.length-1],h=new THREE.QuadraticBezierCurve(new THREE.Vector2(a,s),new THREE.Vector2(e,t),new THREE.Vector2(r,i));this.curves.push(h),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:o})},THREE.Path.prototype.bezierCurveTo=function(e,t,r,i,o,n){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,h=s[s.length-2],l=s[s.length-1],c=new THREE.CubicBezierCurve(new THREE.Vector2(h,l),new THREE.Vector2(e,t),new THREE.Vector2(r,i),new THREE.Vector2(o,n));this.curves.push(c),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:a})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,i=r[r.length-2],o=r[r.length-1],n=[new THREE.Vector2(i,o)];Array.prototype.push.apply(n,e);var a=new THREE.SplineCurve(n);this.curves.push(a),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})},THREE.Path.prototype.arc=function(e,t,r,i,o,n){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],h=a[a.length-1];this.absarc(e+s,t+h,r,i,o,n)},THREE.Path.prototype.absarc=function(e,t,r,i,o,n){this.absellipse(e,t,r,r,i,o,n)},THREE.Path.prototype.ellipse=function(e,t,r,i,o,n,a){var s=this.actions[this.actions.length-1].args,h=s[s.length-2],l=s[s.length-1];this.absellipse(e+h,t+l,r,i,o,n,a)},THREE.Path.prototype.absellipse=function(e,t,r,i,o,n,a){var s=Array.prototype.slice.call(arguments),h=new THREE.EllipseCurve(e,t,r,i,o,n,a);this.curves.push(h);var l=h.getPoint(a?1:0);s.push(l.x),s.push(l.y),this.actions.push({action:THREE.PathActions.ELLIPSE,args:s})},THREE.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var r=[],i=0;e>i;i++)r.push(this.getPoint(i/e));return r},THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var r,i,o,n,a,s,h,l,c,u,p,f,E,d,m,g,v,T,y=[];for(r=0,i=this.actions.length;i>r;r++)switch(o=this.actions[r],n=o.action,a=o.args,n){case THREE.PathActions.MOVE_TO:y.push(new THREE.Vector2(a[0],a[1]));break;case THREE.PathActions.LINE_TO:y.push(new THREE.Vector2(a[0],a[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:for(s=a[2],h=a[3],u=a[0],p=a[1],y.length>0?(d=y[y.length-1],f=d.x,E=d.y):(d=this.actions[r-1].args,f=d[d.length-2],E=d[d.length-1]),m=1;e>=m;m++)g=m/e,v=THREE.Shape.Utils.b2(g,f,u,s),T=THREE.Shape.Utils.b2(g,E,p,h),y.push(new THREE.Vector2(v,T));break;case THREE.PathActions.BEZIER_CURVE_TO:for(s=a[4],h=a[5],u=a[0],p=a[1],l=a[2],c=a[3],y.length>0?(d=y[y.length-1],f=d.x,E=d.y):(d=this.actions[r-1].args,f=d[d.length-2],E=d[d.length-1]),m=1;e>=m;m++)g=m/e,v=THREE.Shape.Utils.b3(g,f,u,l,s),T=THREE.Shape.Utils.b3(g,E,p,c,h),y.push(new THREE.Vector2(v,T));break;case THREE.PathActions.CSPLINE_THRU:d=this.actions[r-1].args;var R=new THREE.Vector2(d[d.length-2],d[d.length-1]),x=[R],H=e*a[0].length;x=x.concat(a[0]);var _=new THREE.SplineCurve(x);for(m=1;H>=m;m++)y.push(_.getPointAt(m/H));break;case THREE.PathActions.ARC:var b,w=a[0],M=a[1],S=a[2],A=a[3],C=a[4],L=!!a[5],P=C-A,F=2*e;for(m=1;F>=m;m++)g=m/F,L||(g=1-g),b=A+g*P,v=w+S*Math.cos(b),T=M+S*Math.sin(b),y.push(new THREE.Vector2(v,T));break;case THREE.PathActions.ELLIPSE:var b,w=a[0],M=a[1],D=a[2],U=a[3],A=a[4],C=a[5],L=!!a[6],P=C-A,F=2*e;for(m=1;F>=m;m++)g=m/F,L||(g=1-g),b=A+g*P,v=w+D*Math.cos(b),T=M+U*Math.sin(b),y.push(new THREE.Vector2(v,T))}var V=y[y.length-1],O=1e-10;return Math.abs(V.x-y[0].x)<O&&Math.abs(V.y-y[0].y)<O&&y.splice(y.length-1,1),t&&y.push(y[0]),y},THREE.Path.prototype.toShapes=function(e){var t,r,i,o,n,a=[],s=new THREE.Path;for(t=0,r=this.actions.length;r>t;t++)i=this.actions[t],n=i.args,o=i.action,o==THREE.PathActions.MOVE_TO&&0!=s.actions.length&&(a.push(s),s=new THREE.Path),s[o].apply(s,n);if(0!=s.actions.length&&a.push(s),0==a.length)return[];var h,l,c,u=[];if(1==a.length)return l=a[0],c=new THREE.Shape,c.actions=l.actions,c.curves=l.curves,u.push(c),u;var p=!THREE.Shape.Utils.isClockWise(a[0].getPoints());if(p=e?!p:p)for(c=new THREE.Shape,t=0,r=a.length;r>t;t++)l=a[t],h=THREE.Shape.Utils.isClockWise(l.getPoints()),h=e?!h:h,h?(c.actions=l.actions,c.curves=l.curves,u.push(c),c=new THREE.Shape):c.holes.push(l);else{for(c=void 0,t=0,r=a.length;r>t;t++)l=a[t],h=THREE.Shape.Utils.isClockWise(l.getPoints()),h=e?!h:h,h?(c&&u.push(c),c=new THREE.Shape,c.actions=l.actions,c.curves=l.curves):c.holes.push(l);u.push(c)}return u},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=Object.create(THREE.Path.prototype),THREE.Shape.prototype.extrude=function(e){var t=new THREE.ExtrudeGeometry(this,e);return t},THREE.Shape.prototype.makeGeometry=function(e){var t=new THREE.ShapeGeometry(this,e);return t},THREE.Shape.prototype.getPointsHoles=function(e){var t,r=this.holes.length,i=[];for(t=0;r>t;t++)i[t]=this.holes[t].getTransformedPoints(e,this.bends);return i},THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,r=this.holes.length,i=[];for(t=0;r>t;t++)i[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return i},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},THREE.Shape.Utils={removeHoles:function(e,t){var r,i,o,n,a,s,h,l,c,u,p,f,E,d,m,g,v=e.concat(),T=v.concat(),y=[];for(a=0;a<t.length;a++){for(h=t[a],Array.prototype.push.apply(T,h),l=Number.POSITIVE_INFINITY,s=0;s<h.length;s++){p=h[s];var R=[];for(u=0;u<v.length;u++)f=v[u],c=p.distanceToSquared(f),R.push(c),l>c&&(l=c,o=s,n=u)}r=n-1>=0?n-1:v.length-1,i=o-1>=0?o-1:h.length-1;var x=[h[o],v[n],v[r]],H=THREE.FontUtils.Triangulate.area(x),_=[h[o],h[i],v[n]],b=THREE.FontUtils.Triangulate.area(_),w=1,M=-1,S=n,A=o;n+=w,o+=M,0>n&&(n+=v.length),n%=v.length,0>o&&(o+=h.length),o%=h.length,r=n-1>=0?n-1:v.length-1,i=o-1>=0?o-1:h.length-1,x=[h[o],v[n],v[r]];var C=THREE.FontUtils.Triangulate.area(x);_=[h[o],h[i],v[n]];var L=THREE.FontUtils.Triangulate.area(_);H+b>C+L&&(n=S,o=A,0>n&&(n+=v.length),n%=v.length,0>o&&(o+=h.length),o%=h.length,r=n-1>=0?n-1:v.length-1,i=o-1>=0?o-1:h.length-1),E=v.slice(0,n),d=v.slice(n),m=h.slice(o),g=h.slice(0,o);var P=[h[o],v[n],v[r]],F=[h[o],h[i],v[n]];y.push(P),y.push(F),v=E.concat(m).concat(g).concat(d)}return{shape:v,isolatedPts:y,allpoints:T}},triangulateShape:function(e,t){var r,i,o,n,a,s,h=THREE.Shape.Utils.removeHoles(e,t),l=h.shape,c=h.allpoints,u=h.isolatedPts,p=THREE.FontUtils.Triangulate(l,!1),f={};for(r=0,i=c.length;i>r;r++)a=c[r].x+":"+c[r].y,void 0!==f[a]&&console.log("Duplicate point",a),f[a]=r;for(r=0,i=p.length;i>r;r++)for(n=p[r],o=0;3>o;o++)a=n[o].x+":"+n[o].y,s=f[a],void 0!==s&&(n[o]=s);for(r=0,i=u.length;i>r;r++)for(n=u[r],o=0;3>o;o++)a=n[o].x+":"+n[o].y,s=f[a],void 0!==s&&(n[o]=s);return p.concat(u)},isClockWise:function(e){return THREE.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var r=1-e;return r*r*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,r,i){return this.b2p0(e,t)+this.b2p1(e,r)+this.b2p2(e,i)},b3p0:function(e,t){var r=1-e;return r*r*r*t},b3p1:function(e,t){var r=1-e;return 3*r*r*e*t},b3p2:function(e,t){var r=1-e;return 3*r*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,r,i,o){return this.b3p0(e,t)+this.b3p1(e,r)+this.b3p2(e,i)+this.b3p3(e,o)}},THREE.LineCurve=function(e,t){this.v1=e,this.v2=t},THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()},THREE.QuadraticBezierCurve=function(e,t,r){this.v0=e,this.v1=t,this.v2=r},THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t,r;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),r=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(t,r)},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t,r;t=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),r=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);var i=new THREE.Vector2(t,r);return i.normalize(),i},THREE.CubicBezierCurve=function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.CubicBezierCurve.prototype.getPoint=function(e){var t,r;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(t,r)},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t,r;t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var i=new THREE.Vector2(t,r);return i.normalize(),i},THREE.SplineCurve=function(e){this.points=void 0==e?[]:e},THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.SplineCurve.prototype.getPoint=function(e){var t,r,i,o=new THREE.Vector2,n=[],a=this.points;return t=(a.length-1)*e,r=Math.floor(t),i=t-r,n[0]=0==r?r:r-1,n[1]=r,n[2]=r>a.length-2?a.length-1:r+1,n[3]=r>a.length-3?a.length-1:r+2,o.x=THREE.Curve.Utils.interpolate(a[n[0]].x,a[n[1]].x,a[n[2]].x,a[n[3]].x,i),o.y=THREE.Curve.Utils.interpolate(a[n[0]].y,a[n[1]].y,a[n[2]].y,a[n[3]].y,i),o},THREE.EllipseCurve=function(e,t,r,i,o,n,a){this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=o,this.aEndAngle=n,this.aClockwise=a},THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype),THREE.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;this.aClockwise||(e=1-e);var r=this.aStartAngle+e*t,i=this.aX+this.xRadius*Math.cos(r),o=this.aY+this.yRadius*Math.sin(r);return new THREE.Vector2(i,o)},THREE.ArcCurve=function(e,t,r,i,o,n){THREE.EllipseCurve.call(this,e,t,r,r,i,o,n)},THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype),THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,r){this.v0=e,this.v1=t,this.v2=r},function(e){var t,r,i;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),r=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),i=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(t,r,i)}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},function(e){var t,r,i;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),i=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new THREE.Vector3(t,r,i)}),THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,r,i,o=new THREE.Vector3,n=[],a=this.points;t=(a.length-1)*e,r=Math.floor(t),i=t-r,n[0]=0==r?r:r-1,n[1]=r,n[2]=r>a.length-2?a.length-1:r+1,n[3]=r>a.length-3?a.length-1:r+2;var s=a[n[0]],h=a[n[1]],l=a[n[2]],c=a[n[3]];return o.x=THREE.Curve.Utils.interpolate(s.x,h.x,l.x,c.x,i),o.y=THREE.Curve.Utils.interpolate(s.y,h.y,l.y,c.y,i),o.z=THREE.Curve.Utils.interpolate(s.z,h.z,l.z,c.z,i),o}),THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,r,i,o=new THREE.Vector3,n=[],a=this.points;return t=(a.length-0)*e,r=Math.floor(t),i=t-r,r+=r>0?0:(Math.floor(Math.abs(r)/a.length)+1)*a.length,n[0]=(r-1)%a.length,n[1]=r%a.length,n[2]=(r+1)%a.length,n[3]=(r+2)%a.length,o.x=THREE.Curve.Utils.interpolate(a[n[0]].x,a[n[1]].x,a[n[2]].x,a[n[3]].x,i),o.y=THREE.Curve.Utils.interpolate(a[n[0]].y,a[n[1]].y,a[n[2]].y,a[n[3]].y,i),o.z=THREE.Curve.Utils.interpolate(a[n[0]].z,a[n[1]].z,a[n[2]].z,a[n[3]].z,i),o}),THREE.AnimationHandler=function(){var e=[],t={},r={};r.update=function(t){for(var r=0;r<e.length;r++)e[r].update(t)},r.addToUpdate=function(t){-1===e.indexOf(t)&&e.push(t)},r.removeFromUpdate=function(t){var r=e.indexOf(t);-1!==r&&e.splice(r,1)},r.add=function(e){void 0!==t[e.name]&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e,o(e)},r.get=function(e){return"string"==typeof e?t[e]?t[e]:(console.log("THREE.AnimationHandler.get: Couldn\'t find animation "+e),null):void 0},r.parse=function(e){var t=[];if(e instanceof THREE.SkinnedMesh)for(var r=0;r<e.bones.length;r++)t.push(e.bones[r]);else i(e,t);return t};var i=function(e,t){t.push(e);for(var r=0;r<e.children.length;r++)i(e.children[r],t)},o=function(e){if(e.initialized!==!0){for(var t=0;t<e.hierarchy.length;t++){for(var r=0;r<e.hierarchy[t].keys.length;r++)if(e.hierarchy[t].keys[r].time<0&&(e.hierarchy[t].keys[r].time=0),void 0!==e.hierarchy[t].keys[r].rot&&!(e.hierarchy[t].keys[r].rot instanceof THREE.Quaternion)){var i=e.hierarchy[t].keys[r].rot;e.hierarchy[t].keys[r].rot=new THREE.Quaternion(i[0],i[1],i[2],i[3])}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){for(var o={},r=0;r<e.hierarchy[t].keys.length;r++)for(var n=0;n<e.hierarchy[t].keys[r].morphTargets.length;n++){var a=e.hierarchy[t].keys[r].morphTargets[n];o[a]=-1}e.hierarchy[t].usedMorphTargets=o;for(var r=0;r<e.hierarchy[t].keys.length;r++){var s={};for(var a in o){for(var n=0;n<e.hierarchy[t].keys[r].morphTargets.length;n++)if(e.hierarchy[t].keys[r].morphTargets[n]===a){s[a]=e.hierarchy[t].keys[r].morphTargetsInfluences[n];break}n===e.hierarchy[t].keys[r].morphTargets.length&&(s[a]=0)}e.hierarchy[t].keys[r].morphTargetsInfluences=s}}for(var r=1;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].time===e.hierarchy[t].keys[r-1].time&&(e.hierarchy[t].keys.splice(r,1),r--);for(var r=0;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].index=r}var h=parseInt(e.length*e.fps,10);e.JIT={},e.JIT.hierarchy=[];for(var t=0;t<e.hierarchy.length;t++)e.JIT.hierarchy.push(new Array(h));e.initialized=!0}};return r.LINEAR=0,r.CATMULLROM=1,r.CATMULLROM_FORWARD=2,r}(),THREE.Animation=function(e,t,r){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.interpolationType=void 0!==r?r:THREE.AnimationHandler.LINEAR,this.points=[],this.target=new THREE.Vector3},THREE.Animation.prototype.play=function(e,t){if(this.isPlaying===!1){this.isPlaying=!0,this.loop=void 0!==e?e:!0,this.currentTime=void 0!==t?t:0;var r,i,o=this.hierarchy.length;for(r=0;o>r;r++){i=this.hierarchy[r],i.matrixAutoUpdate=!0,void 0===i.animationCache&&(i.animationCache={},i.animationCache.prevKey={pos:0,rot:0,scl:0},i.animationCache.nextKey={pos:0,rot:0,scl:0},i.animationCache.originalMatrix=i instanceof THREE.Bone?i.skinMatrix:i.matrix);var n=i.animationCache.prevKey,a=i.animationCache.nextKey;n.pos=this.data.hierarchy[r].keys[0],n.rot=this.data.hierarchy[r].keys[0],n.scl=this.data.hierarchy[r].keys[0],a.pos=this.getNextKeyWith("pos",r,1),a.rot=this.getNextKeyWith("rot",r,1),a.scl=this.getNextKeyWith("scl",r,1)}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.Animation.prototype.pause=function(){this.isPaused===!0?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.Animation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,THREE.AnimationHandler.removeFromUpdate(this)},THREE.Animation.prototype.update=function(e){if(this.isPlaying!==!1){var t,r,i,o,n,a,s,h,l,c,u,p,f,E,d,m=["pos","rot","scl"];this.data.JIT.hierarchy;this.currentTime+=e*this.timeScale,p=this.currentTime,u=this.currentTime=this.currentTime%this.data.length,c=parseInt(Math.min(u*this.data.fps,this.data.length*this.data.fps),10);for(var g=0,v=this.hierarchy.length;v>g;g++){h=this.hierarchy[g],l=h.animationCache;for(var T=0;3>T;T++){if(t=m[T],a=l.prevKey[t],s=l.nextKey[t],s.time<=p){if(p>u){if(!this.loop)return void this.stop();for(a=this.data.hierarchy[g].keys[0],s=this.getNextKeyWith(t,g,1);s.time<u;)a=s,s=this.getNextKeyWith(t,g,s.index+1)}else do a=s,s=this.getNextKeyWith(t,g,s.index+1);while(s.time<u);l.prevKey[t]=a,l.nextKey[t]=s}h.matrixAutoUpdate=!0,h.matrixWorldNeedsUpdate=!0,r=(u-a.time)/(s.time-a.time),o=a[t],n=s[t],(0>r||r>1)&&(console.log("THREE.Animation.update: Warning! Scale out of bounds:"+r+" on bone "+g),r=0>r?0:1),"pos"===t?(i=h.position,this.interpolationType===THREE.AnimationHandler.LINEAR?(i.x=o[0]+(n[0]-o[0])*r,i.y=o[1]+(n[1]-o[1])*r,i.z=o[2]+(n[2]-o[2])*r):(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)&&(this.points[0]=this.getPrevKeyWith("pos",g,a.index-1).pos,this.points[1]=o,this.points[2]=n,this.points[3]=this.getNextKeyWith("pos",g,s.index+1).pos,r=.33*r+.33,f=this.interpolateCatmullRom(this.points,r),i.x=f[0],i.y=f[1],i.z=f[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(E=this.interpolateCatmullRom(this.points,1.01*r),this.target.set(E[0],E[1],E[2]),this.target.sub(i),this.target.y=0,this.target.normalize(),d=Math.atan2(this.target.x,this.target.z),h.rotation.set(0,d,0)))):"rot"===t?THREE.Quaternion.slerp(o,n,h.quaternion,r):"scl"===t&&(i=h.scale,i.x=o[0]+(n[0]-o[0])*r,i.y=o[1]+(n[1]-o[1])*r,i.z=o[2]+(n[2]-o[2])*r)}}}},THREE.Animation.prototype.interpolateCatmullRom=function(e,t){var r,i,o,n,a,s,h,l,c,u=[],p=[];return r=(e.length-1)*t,i=Math.floor(r),o=r-i,u[0]=0===i?i:i-1,u[1]=i,u[2]=i>e.length-2?i:i+1,u[3]=i>e.length-3?i:i+2,s=e[u[0]],h=e[u[1]],l=e[u[2]],c=e[u[3]],n=o*o,a=o*n,p[0]=this.interpolate(s[0],h[0],l[0],c[0],o,n,a),p[1]=this.interpolate(s[1],h[1],l[1],c[1],o,n,a),p[2]=this.interpolate(s[2],h[2],l[2],c[2],o,n,a),p},THREE.Animation.prototype.interpolate=function(e,t,r,i,o,n,a){var s=.5*(r-e),h=.5*(i-t);return(2*(t-r)+s+h)*a+(-3*(t-r)-2*s-h)*n+s*o+t},THREE.Animation.prototype.getNextKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?r=r<i.length-1?r:i.length-1:r%=i.length;r<i.length;r++)if(void 0!==i[r][e])return i[r];return this.data.hierarchy[t].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(r=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?r>0?r:0:r>=0?r:r+i.length;r>=0;r--)if(void 0!==i[r][e])return i[r];return this.data.hierarchy[t].keys[i.length-1]},THREE.KeyFrameAnimation=function(e,t,r){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.JITCompile=void 0!==r?r:!0;for(var i=0,o=this.hierarchy.length;o>i;i++){var n=this.data.hierarchy[i].keys,a=this.data.hierarchy[i].sids,s=this.hierarchy[i];if(n.length&&a){for(var h=0;h<a.length;h++){var l=a[h],c=this.getNextKeyWith(l,i,0);c&&c.apply(l)}s.matrixAutoUpdate=!1,this.data.hierarchy[i].node.updateMatrix(),s.matrixWorldNeedsUpdate=!0}}},THREE.KeyFrameAnimation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0!==e?e:!0,this.currentTime=void 0!==t?t:0,this.startTimeMs=t,this.startTime=1e7,this.endTime=-this.startTime;var r,i,o,n=this.hierarchy.length;for(r=0;n>r;r++){i=this.hierarchy[r],o=this.data.hierarchy[r],void 0===o.animationCache&&(o.animationCache={},o.animationCache.prevKey=null,o.animationCache.nextKey=null,o.animationCache.originalMatrix=i instanceof THREE.Bone?i.skinMatrix:i.matrix);var a=this.data.hierarchy[r].keys;a.length&&(o.animationCache.prevKey=a[0],o.animationCache.nextKey=a[1],this.startTime=Math.min(a[0].time,this.startTime),this.endTime=Math.max(a[a.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],r=this.data.hierarchy[e];if(void 0!==r.animationCache){var i=r.animationCache.originalMatrix;t instanceof THREE.Bone?(i.copy(t.skinMatrix),t.skinMatrix=i):(i.copy(t.matrix),t.matrix=i),delete r.animationCache}}},THREE.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying){var t,r,i,o,n,a,s,h,l=this.data.JIT.hierarchy;if(this.currentTime+=e*this.timeScale,s=this.currentTime,a=this.currentTime=this.currentTime%this.data.length,a<this.startTimeMs&&(a=this.currentTime=this.startTimeMs+a),n=parseInt(Math.min(a*this.data.fps,this.data.length*this.data.fps),10),h=s>a,h&&!this.loop){for(var c=0,u=this.hierarchy.length;u>c;c++){var p=this.data.hierarchy[c].keys,f=this.data.hierarchy[c].sids,E=p.length-1,d=this.hierarchy[c];if(p.length){for(var m=0;m<f.length;m++){var g=f[m],v=this.getPrevKeyWith(g,c,E);v&&v.apply(g)}this.data.hierarchy[c].node.updateMatrix(),d.matrixWorldNeedsUpdate=!0}}return void this.stop()}if(!(a<this.startTime)){for(var c=0,u=this.hierarchy.length;u>c;c++){i=this.hierarchy[c],o=this.data.hierarchy[c];var p=o.keys,T=o.animationCache;if(this.JITCompile&&void 0!==l[c][n])i instanceof THREE.Bone?(i.skinMatrix=l[c][n],i.matrixWorldNeedsUpdate=!1):(i.matrix=l[c][n],i.matrixWorldNeedsUpdate=!0);else if(p.length){if(this.JITCompile&&T&&(i instanceof THREE.Bone?i.skinMatrix=T.originalMatrix:i.matrix=T.originalMatrix),t=T.prevKey,r=T.nextKey,t&&r){if(r.time<=s){if(h&&this.loop)for(t=p[0],r=p[1];r.time<a;)t=r,r=p[t.index+1];else if(!h)for(var y=p.length-1;r.time<a&&r.index!==y;)t=r,r=p[t.index+1];T.prevKey=t,T.nextKey=r}r.time>=a?t.interpolate(r,a):t.interpolate(r,r.time)}this.data.hierarchy[c].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===l[0][n]){this.hierarchy[0].updateMatrixWorld(!0);for(var c=0;c<this.hierarchy.length;c++)this.hierarchy[c]instanceof THREE.Bone?l[c][n]=this.hierarchy[c].skinMatrix.clone():l[c][n]=this.hierarchy[c].matrix.clone()}}}},THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(r%=i.length;r<i.length;r++)if(i[r].hasTarget(e))return i[r];\r\nreturn i[0]},THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(r=r>=0?r:r+i.length;r>=0;r--)if(i[r].hasTarget(e))return i[r];return i[i.length-1]},THREE.CubeCamera=function(e,t,r){THREE.Object3D.call(this);var i=90,o=1,n=new THREE.PerspectiveCamera(i,o,e,t);n.up.set(0,-1,0),n.lookAt(new THREE.Vector3(1,0,0)),this.add(n);var a=new THREE.PerspectiveCamera(i,o,e,t);a.up.set(0,-1,0),a.lookAt(new THREE.Vector3(-1,0,0)),this.add(a);var s=new THREE.PerspectiveCamera(i,o,e,t);s.up.set(0,0,1),s.lookAt(new THREE.Vector3(0,1,0)),this.add(s);var h=new THREE.PerspectiveCamera(i,o,e,t);h.up.set(0,0,-1),h.lookAt(new THREE.Vector3(0,-1,0)),this.add(h);var l=new THREE.PerspectiveCamera(i,o,e,t);l.up.set(0,-1,0),l.lookAt(new THREE.Vector3(0,0,1)),this.add(l);var c=new THREE.PerspectiveCamera(i,o,e,t);c.up.set(0,-1,0),c.lookAt(new THREE.Vector3(0,0,-1)),this.add(c),this.renderTarget=new THREE.WebGLRenderTargetCube(r,r,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(e,t){var r=this.renderTarget,i=r.generateMipmaps;r.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,n,r),r.activeCubeFace=1,e.render(t,a,r),r.activeCubeFace=2,e.render(t,s,r),r.activeCubeFace=3,e.render(t,h,r),r.activeCubeFace=4,e.render(t,l,r),r.generateMipmaps=i,r.activeCubeFace=5,e.render(t,c,r)}},THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.CombinedCamera=function(e,t,r,i,o,n,a){THREE.Camera.call(this),this.fov=r,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,n,a),this.cameraP=new THREE.PerspectiveCamera(r,e/t,i,o),this.zoom=1,this.toPerspective()},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){var e=this.fov,t=this.cameraP.aspect,r=this.cameraP.near,i=this.cameraP.far,o=(r+i)/2,n=Math.tan(e/2)*o,a=2*n,s=a*t,h=s/2;n/=this.zoom,h/=this.zoom,this.cameraO.left=-h,this.cameraO.right=h,this.cameraO.top=n,this.cameraO.bottom=-n,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t){void 0===t&&(t=24);var r=2*THREE.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(r),r},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CircleGeometry=function(e,t,r,i){THREE.Geometry.call(this),e=e||50,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,t=void 0!==t?Math.max(3,t):8;var o,n=[],a=new THREE.Vector3,s=new THREE.Vector2(.5,.5);for(this.vertices.push(a),n.push(s),o=0;t>=o;o++){var h=new THREE.Vector3,l=r+o/t*i;h.x=e*Math.cos(l),h.y=e*Math.sin(l),this.vertices.push(h),n.push(new THREE.Vector2((h.x/e+1)/2,(h.y/e+1)/2))}var c=new THREE.Vector3(0,0,1);for(o=1;t>=o;o++){var u=o,p=o+1,f=0;this.faces.push(new THREE.Face3(u,p,f,[c,c,c])),this.faceVertexUvs[0].push([n[o],n[o+1],s])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CubeGeometry=function(e,t,r,i,o,n){function a(e,t,r,i,o,n,a,h){var l,c,u,p=s.widthSegments,f=s.heightSegments,E=o/2,d=n/2,m=s.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?l="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(l="y",f=s.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(l="x",p=s.depthSegments);var g=p+1,v=f+1,T=o/p,y=n/f,R=new THREE.Vector3;for(R[l]=a>0?1:-1,u=0;v>u;u++)for(c=0;g>c;c++){var x=new THREE.Vector3;x[e]=(c*T-E)*r,x[t]=(u*y-d)*i,x[l]=a,s.vertices.push(x)}for(u=0;f>u;u++)for(c=0;p>c;c++){var H=c+g*u,_=c+g*(u+1),b=c+1+g*(u+1),w=c+1+g*u,M=new THREE.Face4(H+m,_+m,b+m,w+m);M.normal.copy(R),M.vertexNormals.push(R.clone(),R.clone(),R.clone(),R.clone()),M.materialIndex=h,s.faces.push(M),s.faceVertexUvs[0].push([new THREE.Vector2(c/p,1-u/f),new THREE.Vector2(c/p,1-(u+1)/f),new THREE.Vector2((c+1)/p,1-(u+1)/f),new THREE.Vector2((c+1)/p,1-u/f)])}}THREE.Geometry.call(this);var s=this;this.width=e,this.height=t,this.depth=r,this.widthSegments=i||1,this.heightSegments=o||1,this.depthSegments=n||1;var h=this.width/2,l=this.height/2,c=this.depth/2;a("z","y",-1,-1,this.depth,this.height,h,0),a("z","y",1,-1,this.depth,this.height,-h,1),a("x","z",1,1,this.width,this.depth,l,2),a("x","z",1,-1,this.width,this.depth,-l,3),a("x","y",1,-1,this.width,this.height,c,4),a("x","y",-1,-1,this.width,this.height,-c,5),this.computeCentroids(),this.mergeVertices()},THREE.CubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CylinderGeometry=function(e,t,r,i,o,n){THREE.Geometry.call(this),this.radiusTop=e=void 0!==e?e:20,this.radiusBottom=t=void 0!==t?t:20,this.height=r=void 0!==r?r:100,this.radialSegments=i=i||8,this.heightSegments=o=o||1,this.openEnded=n=void 0!==n?n:!1;var a,s,h=r/2,l=[],c=[];for(s=0;o>=s;s++){var u=[],p=[],f=s/o,E=f*(t-e)+e;for(a=0;i>=a;a++){var d=a/i,m=new THREE.Vector3;m.x=E*Math.sin(d*Math.PI*2),m.y=-f*r+h,m.z=E*Math.cos(d*Math.PI*2),this.vertices.push(m),u.push(this.vertices.length-1),p.push(new THREE.Vector2(d,1-f))}l.push(u),c.push(p)}var g,v,T=(t-e)/r;for(a=0;i>a;a++)for(0!==e?(g=this.vertices[l[0][a]].clone(),v=this.vertices[l[0][a+1]].clone()):(g=this.vertices[l[1][a]].clone(),v=this.vertices[l[1][a+1]].clone()),g.setY(Math.sqrt(g.x*g.x+g.z*g.z)*T).normalize(),v.setY(Math.sqrt(v.x*v.x+v.z*v.z)*T).normalize(),s=0;o>s;s++){var y=l[s][a],R=l[s+1][a],x=l[s+1][a+1],H=l[s][a+1],_=g.clone(),b=g.clone(),w=v.clone(),M=v.clone(),S=c[s][a].clone(),A=c[s+1][a].clone(),C=c[s+1][a+1].clone(),L=c[s][a+1].clone();this.faces.push(new THREE.Face4(y,R,x,H,[_,b,w,M])),this.faceVertexUvs[0].push([S,A,C,L])}if(n===!1&&e>0)for(this.vertices.push(new THREE.Vector3(0,h,0)),a=0;i>a;a++){var y=l[0][a],R=l[0][a+1],x=this.vertices.length-1,_=new THREE.Vector3(0,1,0),b=new THREE.Vector3(0,1,0),w=new THREE.Vector3(0,1,0),S=c[0][a].clone(),A=c[0][a+1].clone(),C=new THREE.Vector2(A.u,0);this.faces.push(new THREE.Face3(y,R,x,[_,b,w])),this.faceVertexUvs[0].push([S,A,C])}if(n===!1&&t>0)for(this.vertices.push(new THREE.Vector3(0,-h,0)),a=0;i>a;a++){var y=l[s][a+1],R=l[s][a],x=this.vertices.length-1,_=new THREE.Vector3(0,-1,0),b=new THREE.Vector3(0,-1,0),w=new THREE.Vector3(0,-1,0),S=c[s][a+1].clone(),A=c[s][a].clone(),C=new THREE.Vector2(A.u,1);this.faces.push(new THREE.Face3(y,R,x,[_,b,w])),this.faceVertexUvs[0].push([S,A,C])}this.computeCentroids(),this.computeFaceNormals()},THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry=function(e,t){return"undefined"==typeof e?void(e=[]):(THREE.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),void this.computeFaceNormals())},THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var r=e.length,i=0;r>i;i++){var o=e[i];this.addShape(o,t)}},THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function r(e,t,r){return t||console.log("die"),t.clone().multiplyScalar(r).add(e)}function i(e,t,r){return n(e,t,r)}function o(e,t,r){var i=Math.atan2(t.y-e.y,t.x-e.x),o=Math.atan2(r.y-e.y,r.x-e.x);i>o&&(o+=2*Math.PI);var n=(i+o)/2,a=-Math.cos(n),s=-Math.sin(n),h=new THREE.Vector2(a,s);return h}function n(e,t,r){var i,n,a,s,h,l,c=THREE.ExtrudeGeometry.__v1,u=THREE.ExtrudeGeometry.__v2,p=THREE.ExtrudeGeometry.__v3,f=THREE.ExtrudeGeometry.__v4,E=THREE.ExtrudeGeometry.__v5,d=THREE.ExtrudeGeometry.__v6;return c.set(e.x-t.x,e.y-t.y),u.set(e.x-r.x,e.y-r.y),i=c.normalize(),n=u.normalize(),p.set(-i.y,i.x),f.set(n.y,-n.x),E.copy(e).add(p),d.copy(e).add(f),E.equals(d)?f.clone():(E.copy(t).add(p),d.copy(r).add(f),a=i.dot(f),s=d.sub(E).dot(f),0===a&&(console.log("Either infinite or no solutions!"),0===s?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),h=s/a,0>h?o(e,t,r):(l=i.multiplyScalar(h).add(E),l.sub(e).clone()))}function a(){if(R){var e=0,t=X*e;for(K=0;Y>K;K++)W=z[K],c(W[2]+t,W[1]+t,W[0]+t,!0);for(e=H+2*y,t=X*e,K=0;Y>K;K++)W=z[K],c(W[0]+t,W[1]+t,W[2]+t,!1)}else{for(K=0;Y>K;K++)W=z[K],c(W[2],W[1],W[0],!0);for(K=0;Y>K;K++)W=z[K],c(W[0]+X*H,W[1]+X*H,W[2]+X*H,!1)}}function s(){var e=0;for(h(N,e),e+=N.length,C=0,L=V.length;L>C;C++)A=V[C],h(A,e),e+=A.length}function h(e,t){var r,i;for(K=e.length;--K>=0;){r=K,i=K-1,0>i&&(i=e.length-1);var o=0,n=H+2*y;for(o=0;n>o;o++){var a=X*o,s=X*(o+1),h=t+r+a,l=t+i+a,c=t+i+s,p=t+r+s;u(h,l,c,p,e,o,n,r,i)}}}function l(e,t,r){P.vertices.push(new THREE.Vector3(e,t,r))}function c(r,i,o,n){r+=F,i+=F,o+=F,P.faces.push(new THREE.Face3(r,i,o,null,null,w));var a=n?S.generateBottomUV(P,e,t,r,i,o):S.generateTopUV(P,e,t,r,i,o);P.faceVertexUvs[0].push(a)}function u(r,i,o,n,a,s,h,l,c){r+=F,i+=F,o+=F,n+=F,P.faces.push(new THREE.Face4(r,i,o,n,null,null,M));var u=S.generateSideWallUV(P,e,a,t,r,i,o,n,s,h,l,c);P.faceVertexUvs[0].push(u)}var p,f,E,d,m,g=void 0!==t.amount?t.amount:100,v=void 0!==t.bevelThickness?t.bevelThickness:6,T=void 0!==t.bevelSize?t.bevelSize:v-2,y=void 0!==t.bevelSegments?t.bevelSegments:3,R=void 0!==t.bevelEnabled?t.bevelEnabled:!0,x=void 0!==t.curveSegments?t.curveSegments:12,H=void 0!==t.steps?t.steps:1,_=t.extrudePath,b=!1,w=t.material,M=t.extrudeMaterial,S=void 0!==t.UVGenerator?t.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;this.shapebb;_&&(p=_.getSpacedPoints(H),b=!0,R=!1,f=void 0!==t.frames?t.frames:new THREE.TubeGeometry.FrenetFrames(_,H,!1),E=new THREE.Vector3,d=new THREE.Vector3,m=new THREE.Vector3),R||(y=0,v=0,T=0);var A,C,L,P=this,F=this.vertices.length,D=e.extractPoints(x),U=D.shape,V=D.holes,O=!THREE.Shape.Utils.isClockWise(U);if(O){for(U=U.reverse(),C=0,L=V.length;L>C;C++)A=V[C],THREE.Shape.Utils.isClockWise(A)&&(V[C]=A.reverse());O=!1}var z=THREE.Shape.Utils.triangulateShape(U,V),N=U;for(C=0,L=V.length;L>C;C++)A=V[C],U=U.concat(A);for(var B,I,k,G,j,W,X=U.length,Y=z.length,q=(N.length,180/Math.PI,[]),K=0,Z=N.length,Q=Z-1,J=K+1;Z>K;K++,Q++,J++){Q===Z&&(Q=0),J===Z&&(J=0);N[K],N[Q],N[J];q[K]=i(N[K],N[Q],N[J])}var $,ee=[],te=q.concat();for(C=0,L=V.length;L>C;C++){for(A=V[C],$=[],K=0,Z=A.length,Q=Z-1,J=K+1;Z>K;K++,Q++,J++)Q===Z&&(Q=0),J===Z&&(J=0),$[K]=i(A[K],A[Q],A[J]);ee.push($),te=te.concat($)}for(B=0;y>B;B++){for(k=B/y,G=v*(1-k),I=T*Math.sin(k*Math.PI/2),K=0,Z=N.length;Z>K;K++)j=r(N[K],q[K],I),l(j.x,j.y,-G);for(C=0,L=V.length;L>C;C++)for(A=V[C],$=ee[C],K=0,Z=A.length;Z>K;K++)j=r(A[K],$[K],I),l(j.x,j.y,-G)}for(I=T,K=0;X>K;K++)j=R?r(U[K],te[K],I):U[K],b?(d.copy(f.normals[0]).multiplyScalar(j.x),E.copy(f.binormals[0]).multiplyScalar(j.y),m.copy(p[0]).add(d).add(E),l(m.x,m.y,m.z)):l(j.x,j.y,0);var re;for(re=1;H>=re;re++)for(K=0;X>K;K++)j=R?r(U[K],te[K],I):U[K],b?(d.copy(f.normals[re]).multiplyScalar(j.x),E.copy(f.binormals[re]).multiplyScalar(j.y),m.copy(p[re]).add(d).add(E),l(m.x,m.y,m.z)):l(j.x,j.y,g/H*re);for(B=y-1;B>=0;B--){for(k=B/y,G=v*(1-k),I=T*Math.sin(k*Math.PI/2),K=0,Z=N.length;Z>K;K++)j=r(N[K],q[K],I),l(j.x,j.y,g+G);for(C=0,L=V.length;L>C;C++)for(A=V[C],$=ee[C],K=0,Z=A.length;Z>K;K++)j=r(A[K],$[K],I),b?l(j.x,j.y+p[H-1].y,p[H-1].x+G):l(j.x,j.y,g+G)}a(),s()},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,i,o,n){var a=e.vertices[i].x,s=e.vertices[i].y,h=e.vertices[o].x,l=e.vertices[o].y,c=e.vertices[n].x,u=e.vertices[n].y;return[new THREE.Vector2(a,s),new THREE.Vector2(h,l),new THREE.Vector2(c,u)]},generateBottomUV:function(e,t,r,i,o,n){return this.generateTopUV(e,t,r,i,o,n)},generateSideWallUV:function(e,t,r,i,o,n,a,s,h,l,c,u){var p=e.vertices[o].x,f=e.vertices[o].y,E=e.vertices[o].z,d=e.vertices[n].x,m=e.vertices[n].y,g=e.vertices[n].z,v=e.vertices[a].x,T=e.vertices[a].y,y=e.vertices[a].z,R=e.vertices[s].x,x=e.vertices[s].y,H=e.vertices[s].z;return Math.abs(f-m)<.01?[new THREE.Vector2(p,1-E),new THREE.Vector2(d,1-g),new THREE.Vector2(v,1-y),new THREE.Vector2(R,1-H)]:[new THREE.Vector2(f,1-E),new THREE.Vector2(m,1-g),new THREE.Vector2(T,1-y),new THREE.Vector2(x,1-H)]}},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.ShapeGeometry=function(e,t){THREE.Geometry.call(this),e instanceof Array==!1&&(e=[e]),this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()},THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShapeGeometry.prototype.addShapeList=function(e,t){for(var r=0,i=e.length;i>r;r++)this.addShape(e[r],t);return this},THREE.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var r,i,o,n=void 0!==t.curveSegments?t.curveSegments:12,a=t.material,s=void 0===t.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,h=(this.shapebb,this.vertices.length),l=e.extractPoints(n),c=l.shape,u=l.holes,p=!THREE.Shape.Utils.isClockWise(c);if(p){for(c=c.reverse(),r=0,i=u.length;i>r;r++)o=u[r],THREE.Shape.Utils.isClockWise(o)&&(u[r]=o.reverse());p=!1}var f=THREE.Shape.Utils.triangulateShape(c,u),E=c;for(r=0,i=u.length;i>r;r++)o=u[r],c=c.concat(o);var d,m,g=c.length,v=f.length;E.length;for(r=0;g>r;r++)d=c[r],this.vertices.push(new THREE.Vector3(d.x,d.y,0));for(r=0;v>r;r++){m=f[r];var T=m[0]+h,y=m[1]+h,R=m[2]+h;this.faces.push(new THREE.Face3(T,y,R,null,null,a)),this.faceVertexUvs[0].push(s.generateBottomUV(this,e,t,T,y,R))}},THREE.LatheGeometry=function(e,t,r,i){THREE.Geometry.call(this),t=t||12,r=r||0,i=i||2*Math.PI;for(var o=1/(e.length-1),n=1/t,a=0,s=t;s>=a;a++)for(var h=r+a*n*i,l=Math.cos(h),c=Math.sin(h),u=0,p=e.length;p>u;u++){var f=e[u],E=new THREE.Vector3;E.x=l*f.x-c*f.y,E.y=c*f.x+l*f.y,E.z=f.z,this.vertices.push(E)}for(var d=e.length,a=0,s=t;s>a;a++)for(var u=0,p=e.length-1;p>u;u++){var m=u+d*a,g=m,v=m+d,l=m+1+d,T=m+1;this.faces.push(new THREE.Face4(g,v,l,T));var y=a*n,R=u*o,x=y+n,H=R+o;this.faceVertexUvs[0].push([new THREE.Vector2(y,R),new THREE.Vector2(x,R),new THREE.Vector2(x,H),new THREE.Vector2(y,H)])}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PlaneGeometry=function(e,t,r,i){THREE.Geometry.call(this),this.width=e,this.height=t,this.widthSegments=r||1,this.heightSegments=i||1;var o,n,a=e/2,s=t/2,h=this.widthSegments,l=this.heightSegments,c=h+1,u=l+1,p=this.width/h,f=this.height/l,E=new THREE.Vector3(0,0,1);for(n=0;u>n;n++)for(o=0;c>o;o++){var d=o*p-a,m=n*f-s;this.vertices.push(new THREE.Vector3(d,-m,0))}for(n=0;l>n;n++)for(o=0;h>o;o++){var g=o+c*n,v=o+c*(n+1),T=o+1+c*(n+1),y=o+1+c*n,R=new THREE.Face4(g,v,T,y);R.normal.copy(E),R.vertexNormals.push(E.clone(),E.clone(),E.clone(),E.clone()),this.faces.push(R),this.faceVertexUvs[0].push([new THREE.Vector2(o/h,1-n/l),new THREE.Vector2(o/h,1-(n+1)/l),new THREE.Vector2((o+1)/h,1-(n+1)/l),new THREE.Vector2((o+1)/h,1-n/l)])}this.computeCentroids()},THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.RingGeometry=function(e,t,r,i,o,n){THREE.Geometry.call(this),e=e||0,t=t||50,o=void 0!==o?o:0,n=void 0!==n?n:2*Math.PI,r=void 0!==r?Math.max(3,r):8,i=void 0!==i?Math.max(3,i):8;var a,s,h=[],l=e,c=(t-e)/i;for(a=0;i>=a;a++){for(s=0;r>=s;s++){var u=new THREE.Vector3,p=o+s/r*n;u.x=l*Math.cos(p),u.y=l*Math.sin(p),this.vertices.push(u),h.push(new THREE.Vector2((u.x/l+1)/2,-(u.y/l+1)/2+1))}l+=c}var f=new THREE.Vector3(0,0,1);for(a=0;i>a;a++){var E=a*r;for(s=0;r>=s;s++){var p=s+E,d=p+a,m=p+r+a,g=p+r+1+a;this.faces.push(new THREE.Face3(d,m,g,[f,f,f])),this.faceVertexUvs[0].push([h[d],h[m],h[g]]),d=p+a,m=p+r+1+a,g=p+1+a,this.faces.push(new THREE.Face3(d,m,g,[f,f,f])),this.faceVertexUvs[0].push([h[d],h[m],h[g]])}}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,l)},THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.SphereGeometry=function(e,t,r,i,o,n,a){THREE.Geometry.call(this),this.radius=e=e||50,this.widthSegments=t=Math.max(3,Math.floor(t)||8),this.heightSegments=r=Math.max(2,Math.floor(r)||6),this.phiStart=i=void 0!==i?i:0,this.phiLength=o=void 0!==o?o:2*Math.PI,this.thetaStart=n=void 0!==n?n:0,this.thetaLength=a=void 0!==a?a:Math.PI;var s,h,l=[],c=[];for(h=0;r>=h;h++){var u=[],p=[];for(s=0;t>=s;s++){var f=s/t,E=h/r,d=new THREE.Vector3;d.x=-e*Math.cos(i+f*o)*Math.sin(n+E*a),d.y=e*Math.cos(n+E*a),d.z=e*Math.sin(i+f*o)*Math.sin(n+E*a),this.vertices.push(d),u.push(this.vertices.length-1),p.push(new THREE.Vector2(f,1-E))}l.push(u),c.push(p)}for(h=0;h<this.heightSegments;h++)for(s=0;s<this.widthSegments;s++){var m=l[h][s+1],g=l[h][s],v=l[h+1][s],T=l[h+1][s+1],y=this.vertices[m].clone().normalize(),R=this.vertices[g].clone().normalize(),x=this.vertices[v].clone().normalize(),H=this.vertices[T].clone().normalize(),_=c[h][s+1].clone(),b=c[h][s].clone(),w=c[h+1][s].clone(),M=c[h+1][s+1].clone();Math.abs(this.vertices[m].y)===this.radius?(this.faces.push(new THREE.Face3(m,v,T,[y,x,H])),this.faceVertexUvs[0].push([_,w,M])):Math.abs(this.vertices[v].y)===this.radius?(this.faces.push(new THREE.Face3(m,g,v,[y,R,x])),this.faceVertexUvs[0].push([_,b,w])):(this.faces.push(new THREE.Face4(m,g,v,T,[y,R,x,H])),this.faceVertexUvs[0].push([_,b,w,M]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TextGeometry=function(e,t){t=t||{};var r=THREE.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),THREE.ExtrudeGeometry.call(this,r,t)},THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype),THREE.TorusGeometry=function(e,t,r,i,o){THREE.Geometry.call(this);this.radius=e||100,this.tube=t||40,this.radialSegments=r||8,this.tubularSegments=i||6,this.arc=o||2*Math.PI;for(var n=new THREE.Vector3,a=[],s=[],h=0;h<=this.radialSegments;h++)for(var l=0;l<=this.tubularSegments;l++){var c=l/this.tubularSegments*this.arc,u=h/this.radialSegments*Math.PI*2;n.x=this.radius*Math.cos(c),n.y=this.radius*Math.sin(c);var p=new THREE.Vector3;p.x=(this.radius+this.tube*Math.cos(u))*Math.cos(c),p.y=(this.radius+this.tube*Math.cos(u))*Math.sin(c),p.z=this.tube*Math.sin(u),this.vertices.push(p),a.push(new THREE.Vector2(l/this.tubularSegments,h/this.radialSegments)),s.push(p.clone().sub(n).normalize())}for(var h=1;h<=this.radialSegments;h++)for(var l=1;l<=this.tubularSegments;l++){var f=(this.tubularSegments+1)*h+l-1,E=(this.tubularSegments+1)*(h-1)+l-1,d=(this.tubularSegments+1)*(h-1)+l,m=(this.tubularSegments+1)*h+l,g=new THREE.Face4(f,E,d,m,[s[f],s[E],s[d],s[m]]);g.normal.add(s[f]),g.normal.add(s[E]),g.normal.add(s[d]),g.normal.add(s[m]),g.normal.normalize(),this.faces.push(g),this.faceVertexUvs[0].push([a[f].clone(),a[E].clone(),a[d].clone(),a[m].clone()])}this.computeCentroids()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusKnotGeometry=function(e,t,r,i,o,n,a){function s(e,t,r,i,o){var n=Math.cos(e),a=Math.sin(e),s=t/r*e,h=Math.cos(s),l=i*(2+h)*.5*n,c=i*(2+h)*a*.5,u=o*i*Math.sin(s)*.5;return new THREE.Vector3(l,c,u)}THREE.Geometry.call(this);var h=this;this.radius=e||100,this.tube=t||40,this.radialSegments=r||64,this.tubularSegments=i||8,this.p=o||2,this.q=n||3,this.heightScale=a||1,this.grid=new Array(this.radialSegments);for(var l=new THREE.Vector3,c=new THREE.Vector3,u=new THREE.Vector3,p=0;p<this.radialSegments;++p){this.grid[p]=new Array(this.tubularSegments);var f=p/this.radialSegments*2*this.p*Math.PI,E=s(f,this.q,this.p,this.radius,this.heightScale),d=s(f+.01,this.q,this.p,this.radius,this.heightScale);l.subVectors(d,E),c.addVectors(d,E),u.crossVectors(l,c),c.crossVectors(u,l),u.normalize(),c.normalize();for(var m=0;m<this.tubularSegments;++m){var g=m/this.tubularSegments*2*Math.PI,v=-this.tube*Math.cos(g),T=this.tube*Math.sin(g),y=new THREE.Vector3;y.x=E.x+v*c.x+T*u.x,y.y=E.y+v*c.y+T*u.y,y.z=E.z+v*c.z+T*u.z,this.grid[p][m]=h.vertices.push(y)-1}}for(var p=0;p<this.radialSegments;++p)for(var m=0;m<this.tubularSegments;++m){var R=(p+1)%this.radialSegments,x=(m+1)%this.tubularSegments,H=this.grid[p][m],_=this.grid[R][m],b=this.grid[R][x],w=this.grid[p][x],M=new THREE.Vector2(p/this.radialSegments,m/this.tubularSegments),S=new THREE.Vector2((p+1)/this.radialSegments,m/this.tubularSegments),A=new THREE.Vector2((p+1)/this.radialSegments,(m+1)/this.tubularSegments),C=new THREE.Vector2(p/this.radialSegments,(m+1)/this.tubularSegments);this.faces.push(new THREE.Face4(H,_,b,w)),this.faceVertexUvs[0].push([M,S,A,C])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry=function(e,t,r,i,o){function n(e,t,r){return w.vertices.push(new THREE.Vector3(e,t,r))-1}THREE.Geometry.call(this),this.path=e,this.segments=t||64,this.radius=r||1,this.radialSegments=i||8,this.closed=o||!1,this.grid=[];var a,s,h,l,c,u,p,f,E,d,m,g,v,T,y,R,x,H,_,b,w=this,M=this.segments+1,S=new THREE.Vector3,A=new THREE.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),C=A.tangents,L=A.normals,P=A.binormals;for(this.tangents=C,this.normals=L,this.binormals=P,E=0;M>E;E++)for(this.grid[E]=[],l=E/(M-1),f=e.getPointAt(l),a=C[E],s=L[E],h=P[E],d=0;d<this.radialSegments;d++)c=d/this.radialSegments*2*Math.PI,u=-this.radius*Math.cos(c),p=this.radius*Math.sin(c),S.copy(f),S.x+=u*s.x+p*h.x,S.y+=u*s.y+p*h.y,S.z+=u*s.z+p*h.z,this.grid[E][d]=n(S.x,S.y,S.z);for(E=0;E<this.segments;E++)for(d=0;d<this.radialSegments;d++)m=this.closed?(E+1)%this.segments:E+1,g=(d+1)%this.radialSegments,v=this.grid[E][d],T=this.grid[m][d],y=this.grid[m][g],R=this.grid[E][g],x=new THREE.Vector2(E/this.segments,d/this.radialSegments),H=new THREE.Vector2((E+1)/this.segments,d/this.radialSegments),_=new THREE.Vector2((E+1)/this.segments,(d+1)/this.radialSegments),b=new THREE.Vector2(E/this.segments,(d+1)/this.radialSegments),this.faces.push(new THREE.Face4(v,T,y,R)),this.faceVertexUvs[0].push([x,H,_,b]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry.FrenetFrames=function(e,t,r){function i(){f[0]=new THREE.Vector3,E[0]=new THREE.Vector3,n=Number.MAX_VALUE,a=Math.abs(p[0].x),s=Math.abs(p[0].y),h=Math.abs(p[0].z),n>=a&&(n=a,u.set(1,0,0)),n>=s&&(n=s,u.set(0,1,0)),n>=h&&u.set(0,0,1),d.crossVectors(p[0],u).normalize(),f[0].crossVectors(p[0],d),E[0].crossVectors(p[0],f[0])}var o,n,a,s,h,l,c,u=(new THREE.Vector3,new THREE.Vector3),p=(new THREE.Vector3,[]),f=[],E=[],d=new THREE.Vector3,m=new THREE.Matrix4,g=t+1,v=1e-4;for(this.tangents=p,this.normals=f,this.binormals=E,l=0;g>l;l++)c=l/(g-1),p[l]=e.getTangentAt(c),p[l].normalize();for(i(),l=1;g>l;l++)f[l]=f[l-1].clone(),E[l]=E[l-1].clone(),d.crossVectors(p[l-1],p[l]),d.length()>v&&(d.normalize(),o=Math.acos(THREE.Math.clamp(p[l-1].dot(p[l]),-1,1)),f[l].applyMatrix4(m.makeRotationAxis(d,o))),E[l].crossVectors(p[l],f[l]);if(r)for(o=Math.acos(THREE.Math.clamp(f[0].dot(f[g-1]),-1,1)),o/=g-1,p[0].dot(d.crossVectors(f[0],f[g-1]))>0&&(o=-o),l=1;g>l;l++)f[l].applyMatrix4(m.makeRotationAxis(p[l],o*l)),E[l].crossVectors(p[l],f[l])},THREE.PolyhedronGeometry=function(e,t,r,i){function o(e){var t=e.normalize().clone();t.index=c.vertices.push(t)-1;var r=s(e)/2/Math.PI+.5,i=h(e)/Math.PI+.5;return t.uv=new THREE.Vector2(r,1-i),t}function n(e,t,r){var i=new THREE.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()]);i.centroid.add(e).add(t).add(r).divideScalar(3),c.faces.push(i);var o=s(i.centroid);c.faceVertexUvs[0].push([l(e.uv,e,o),l(t.uv,t,o),l(r.uv,r,o)])}function a(e,t){for(var r=Math.pow(2,t),i=(Math.pow(4,t),o(c.vertices[e.a])),a=o(c.vertices[e.b]),s=o(c.vertices[e.c]),h=[],l=0;r>=l;l++){h[l]=[];for(var u=o(i.clone().lerp(s,l/r)),p=o(a.clone().lerp(s,l/r)),f=r-l,E=0;f>=E;E++)0==E&&l==r?h[l][E]=u:h[l][E]=o(u.clone().lerp(p,E/f))}for(var l=0;r>l;l++)for(var E=0;2*(r-l)-1>E;E++){var d=Math.floor(E/2);E%2==0?n(h[l][d+1],h[l+1][d],h[l][d]):n(h[l][d+1],h[l+1][d+1],h[l+1][d])}}function s(e){return Math.atan2(e.z,-e.x)}function h(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function l(e,t,r){return 0>r&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new THREE.Vector2(r/2/Math.PI+.5,e.y)),e.clone()}THREE.Geometry.call(this),r=r||1,i=i||0;for(var c=this,u=0,p=e.length;p>u;u++)o(new THREE.Vector3(e[u][0],e[u][1],e[u][2]));for(var f=this.vertices,E=[],u=0,p=t.length;p>u;u++){var d=f[t[u][0]],m=f[t[u][1]],g=f[t[u][2]];E[u]=new THREE.Face3(d.index,m.index,g.index,[d.clone(),m.clone(),g.clone()])}for(var u=0,p=E.length;p>u;u++)a(E[u],i);for(var u=0,p=this.faceVertexUvs[0].length;p>u;u++){var v=this.faceVertexUvs[0][u],T=v[0].x,y=v[1].x,R=v[2].x,x=Math.max(T,Math.max(y,R)),H=Math.min(T,Math.min(y,R));x>.9&&.1>H&&(.2>T&&(v[0].x+=1),.2>y&&(v[1].x+=1),.2>R&&(v[2].x+=1))}for(var u=0,p=this.vertices.length;p>u;u++)this.vertices[u].multiplyScalar(r);this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,r)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.IcosahedronGeometry=function(e,t){this.radius=e,this.detail=t;var r=(1+Math.sqrt(5))/2,i=[[-1,r,0],[1,r,0],[-1,-r,0],[1,-r,0],[0,-1,r],[0,1,r],[0,-1,-r],[0,1,-r],[r,0,-1],[r,0,1],[-r,0,-1],[-r,0,1]],o=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];THREE.PolyhedronGeometry.call(this,i,o,e,t)},THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.OctahedronGeometry=function(e,t){var r=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],i=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];THREE.PolyhedronGeometry.call(this,r,i,e,t)},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TetrahedronGeometry=function(e,t){var r=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],i=[[2,1,0],[0,3,2],[1,3,0],[2,3,1]];THREE.PolyhedronGeometry.call(this,r,i,e,t)},THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometry=function(e,t,r,i){THREE.Geometry.call(this);var o=this.vertices,n=this.faces,a=this.faceVertexUvs[0];i=void 0===i?!1:i;var s,h,l,c,u,p=t+1;for(s=0;r>=s;s++)for(u=s/r,h=0;t>=h;h++)c=h/t,l=e(c,u),o.push(l);var f,E,d,m,g,v,T,y;for(s=0;r>s;s++)for(h=0;t>h;h++)f=s*p+h,E=s*p+h+1,d=(s+1)*p+h,m=(s+1)*p+h+1,g=new THREE.Vector2(h/t,s/r),v=new THREE.Vector2((h+1)/t,s/r),T=new THREE.Vector2(h/t,(s+1)/r),y=new THREE.Vector2((h+1)/t,(s+1)/r),i?(n.push(new THREE.Face3(f,E,d)),n.push(new THREE.Face3(E,m,d)),a.push([g,v,T]),a.push([v,y,T])):(n.push(new THREE.Face4(f,E,m,d)),a.push([g,v,y,T]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.AxisHelper=function(e){e=e||1;var t=new THREE.Geometry;t.vertices.push(new THREE.Vector3,new THREE.Vector3(e,0,0),new THREE.Vector3,new THREE.Vector3(0,e,0),new THREE.Vector3,new THREE.Vector3(0,0,e)),t.colors.push(new THREE.Color(16711680),new THREE.Color(16755200),new THREE.Color(65280),new THREE.Color(11206400),new THREE.Color(255),new THREE.Color(43775));var r=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,t,r,THREE.LinePieces)},THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype),THREE.ArrowHelper=function(e,t,r,i){THREE.Object3D.call(this),void 0===i&&(i=16776960),void 0===r&&(r=1),this.position=t;var o=new THREE.Geometry;o.vertices.push(new THREE.Vector3(0,0,0)),o.vertices.push(new THREE.Vector3(0,1,0)),this.line=new THREE.Line(o,new THREE.LineBasicMaterial({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line);var n=new THREE.CylinderGeometry(0,.05,.25,5,1);n.applyMatrix((new THREE.Matrix4).makeTranslation(0,.875,0)),this.cone=new THREE.Mesh(n,new THREE.MeshBasicMaterial({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r)},THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.ArrowHelper.prototype.setDirection=function(){var e,t=new THREE.Vector3;return function(r){r.y>.99999?this.quaternion.set(0,0,0,1):r.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(r.z,0,-r.x).normalize(),e=Math.acos(r.y),this.quaternion.setFromAxisAngle(t,e))}}(),THREE.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)},THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},THREE.BoxHelper=function(e){var t=[new THREE.Vector3(1,1,1),new THREE.Vector3(-1,1,1),new THREE.Vector3(-1,-1,1),new THREE.Vector3(1,-1,1),new THREE.Vector3(1,1,-1),new THREE.Vector3(-1,1,-1),new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,-1,-1)];this.vertices=t;var r=new THREE.Geometry;r.vertices.push(t[0],t[1],t[1],t[2],t[2],t[3],t[3],t[0],t[4],t[5],t[5],t[6],t[6],t[7],t[7],t[4],t[0],t[4],t[1],t[5],t[2],t[6],t[3],t[7]),THREE.Line.call(this,r,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces),void 0!==e&&this.update(e)},THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype),THREE.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var r=t.boundingBox.min,i=t.boundingBox.max,o=this.vertices;o[0].set(i.x,i.y,i.z),o[1].set(r.x,i.y,i.z),o[2].set(r.x,r.y,i.z),o[3].set(i.x,r.y,i.z),o[4].set(i.x,i.y,r.z),o[5].set(r.x,i.y,r.z),o[6].set(r.x,r.y,r.z),o[7].set(i.x,r.y,r.z),this.geometry.computeBoundingSphere(),this.geometry.verticesNeedUpdate=!0,this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},THREE.BoundingBoxHelper=function(e,t){var r=t||8947848;this.object=e,this.box=new THREE.Box3,THREE.Mesh.call(this,new THREE.CubeGeometry(1,1,1),new THREE.MeshBasicMaterial({color:r,wireframe:!0}))},THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.BoundingBoxHelper.prototype.update=function(){\r\nthis.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},THREE.CameraHelper=function(e){function t(e,t,i){r(e,i),r(t,i)}function r(e,t){i.vertices.push(new THREE.Vector3),i.colors.push(new THREE.Color(t)),void 0===n[e]&&(n[e]=[]),n[e].push(i.vertices.length-1)}var i=new THREE.Geometry,o=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),n={},a=16755200,s=16711680,h=43775,l=16777215,c=3355443;t("n1","n2",a),t("n2","n4",a),t("n4","n3",a),t("n3","n1",a),t("f1","f2",a),t("f2","f4",a),t("f4","f3",a),t("f3","f1",a),t("n1","f1",a),t("n2","f2",a),t("n3","f3",a),t("n4","f4",a),t("p","n1",s),t("p","n2",s),t("p","n3",s),t("p","n4",s),t("u1","u2",h),t("u2","u3",h),t("u3","u1",h),t("c","t",l),t("p","c",c),t("cn1","cn2",c),t("cn3","cn4",c),t("cf1","cf2",c),t("cf3","cf4",c),THREE.Line.call(this,i,o,THREE.LinePieces),this.camera=e,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=n,this.update()},THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype),THREE.CameraHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Camera,r=new THREE.Projector;return function(){function i(i,n,a,s){e.set(n,a,s),r.unprojectVector(e,t);var h=o.pointMap[i];if(void 0!==h)for(var l=0,c=h.length;c>l;l++)o.geometry.vertices[h[l]].copy(e)}var o=this,n=1,a=1;t.projectionMatrix.copy(this.camera.projectionMatrix),i("c",0,0,-1),i("t",0,0,1),i("n1",-n,-a,-1),i("n2",n,-a,-1),i("n3",-n,a,-1),i("n4",n,a,-1),i("f1",-n,-a,1),i("f2",n,-a,1),i("f3",-n,a,1),i("f4",n,a,1),i("u1",.7*n,1.1*a,-1),i("u2",.7*-n,1.1*a,-1),i("u3",0,2*a,-1),i("cf1",-n,0,1),i("cf2",n,0,1),i("cf3",0,-a,1),i("cf4",0,a,1),i("cn1",-n,0,-1),i("cn2",n,0,-1),i("cn3",0,-a,-1),i("cn4",0,a,-1),this.geometry.verticesNeedUpdate=!0}}(),THREE.DirectionalLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1;var r=new THREE.PlaneGeometry(t,t),i=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new THREE.Mesh(r,i),this.add(this.lightPlane),r=new THREE.Geometry,r.vertices.push(new THREE.Vector3),r.vertices.push(new THREE.Vector3),r.computeLineDistances(),i=new THREE.LineBasicMaterial({fog:!1}),i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new THREE.Line(r,i),this.add(this.targetLine),this.update()},THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.DirectionalLightHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){e.getPositionFromMatrix(this.light.matrixWorld).negate(),this.lightPlane.lookAt(e),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(e),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),THREE.FaceNormalsHelper=function(e,t,r,i){this.object=e,this.size=t||1;for(var o=r||16776960,n=i||1,a=new THREE.Geometry,s=this.object.geometry.faces,h=0,l=s.length;l>h;h++)a.vertices.push(new THREE.Vector3),a.vertices.push(new THREE.Vector3);THREE.Line.call(this,a,new THREE.LineBasicMaterial({color:o,linewidth:n}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new THREE.Matrix3,this.update()},THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype),THREE.FaceNormalsHelper.prototype.update=function(e){var t=new THREE.Vector3;return function(e){this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var r=this.geometry.vertices,i=this.object.geometry.faces,o=this.object.matrixWorld,n=0,a=i.length;a>n;n++){var s=i[n];t.copy(s.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);var h=2*n;r[h].copy(s.centroid).applyMatrix4(o),r[h+1].addVectors(r[h],t)}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.GridHelper=function(e,t){var r=new THREE.Geometry,i=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924),this.color2=new THREE.Color(8947848);for(var o=-e;e>=o;o+=t){r.vertices.push(new THREE.Vector3(-e,0,o),new THREE.Vector3(e,0,o),new THREE.Vector3(o,0,-e),new THREE.Vector3(o,0,e));var n=0===o?this.color1:this.color2;r.colors.push(n,n,n,n)}THREE.Line.call(this,r,i,THREE.LinePieces)},THREE.GridHelper.prototype=Object.create(THREE.Line.prototype),THREE.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},THREE.HemisphereLightHelper=function(e,t,r,i){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new THREE.Color,new THREE.Color];var o=new THREE.SphereGeometry(t,4,2);o.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(var n=0,a=8;a>n;n++)o.faces[n].color=this.colors[4>n?0:1];var s=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(o,s),this.add(this.lightSphere),this.update()},THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.HemisphereLightHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.getPositionFromMatrix(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),THREE.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var r=new THREE.SphereGeometry(t,4,2),i=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),THREE.Mesh.call(this,r,i),this.matrixWorld=this.light.matrixWorld,this.matrixAutoUpdate=!1},THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.SpotLightHelper=function(e){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new THREE.CylinderGeometry(0,1,1,8,1,!0);t.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0)),t.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var r=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(t,r),this.add(this.cone),this.update()},THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.SpotLightHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){var t=this.light.distance?this.light.distance:1e4,r=t*Math.tan(this.light.angle);this.cone.scale.set(r,r,t),this.cone.lookAt(e.getPositionFromMatrix(this.light.matrixWorld).negate()),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),THREE.VertexNormalsHelper=function(e,t,r,i){this.object=e,this.size=t||1;for(var o=r||16711680,n=i||1,a=new THREE.Geometry,s=(e.geometry.vertices,e.geometry.faces),h=0,l=s.length;l>h;h++)for(var c=s[h],u=0,p=c.vertexNormals.length;p>u;u++)a.vertices.push(new THREE.Vector3),a.vertices.push(new THREE.Vector3);THREE.Line.call(this,a,new THREE.LineBasicMaterial({color:o,linewidth:n}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new THREE.Matrix3,this.update()},THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype),THREE.VertexNormalsHelper.prototype.update=function(e){var t=new THREE.Vector3;return function(e){var r=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var i=this.geometry.vertices,o=this.object.geometry.vertices,n=this.object.geometry.faces,a=this.object.matrixWorld,s=0,h=0,l=n.length;l>h;h++)for(var c=n[h],u=0,p=c.vertexNormals.length;p>u;u++){var f=c[r[u]],E=o[f],d=c.vertexNormals[u];i[s].copy(E).applyMatrix4(a),t.copy(d).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),t.add(i[s]),s+=1,i[s].copy(t),s+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.VertexTangentsHelper=function(e,t,r,i){this.object=e,this.size=t||1;for(var o=r||255,n=i||1,a=new THREE.Geometry,s=(e.geometry.vertices,e.geometry.faces),h=0,l=s.length;l>h;h++)for(var c=s[h],u=0,p=c.vertexTangents.length;p>u;u++)a.vertices.push(new THREE.Vector3),a.vertices.push(new THREE.Vector3);THREE.Line.call(this,a,new THREE.LineBasicMaterial({color:o,linewidth:n}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.update()},THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype),THREE.VertexTangentsHelper.prototype.update=function(e){var t=new THREE.Vector3;return function(e){var r=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var i=this.geometry.vertices,o=this.object.geometry.vertices,n=this.object.geometry.faces,a=this.object.matrixWorld,s=0,h=0,l=n.length;l>h;h++)for(var c=n[h],u=0,p=c.vertexTangents.length;p>u;u++){var f=c[r[u]],E=o[f],d=c.vertexTangents[u];i[s].copy(E).applyMatrix4(a),t.copy(d).transformDirection(a).multiplyScalar(this.size),t.add(i[s]),s+=1,i[s].copy(t),s+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.WireframeHelper=function(e){for(var t=[0,0],r={},i=function(e,t){return e-t},o=["a","b","c","d"],n=new THREE.Geometry,a=e.geometry.vertices,s=e.geometry.faces,h=0,l=s.length;l>h;h++)for(var c=s[h],u=c instanceof THREE.Face4?4:3,p=0;u>p;p++){t[0]=c[o[p]],t[1]=c[o[(p+1)%u]],t.sort(i);var f=t.toString();void 0===r[f]&&(n.vertices.push(a[t[0]]),n.vertices.push(a[t[1]]),r[f]=!0)}THREE.Line.call(this,n,new THREE.LineBasicMaterial({color:16777215}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype),THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this),this.render=function(e){}},THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare=function(e,t,r,i,o){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,r,i,o)},THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare.prototype.add=function(e,t,r,i,o,n){void 0===t&&(t=-1),void 0===r&&(r=0),void 0===n&&(n=1),void 0===o&&(o=new THREE.Color(16777215)),void 0===i&&(i=THREE.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:1,opacity:n,color:o,blending:i})},THREE.LensFlare.prototype.updateLensFlares=function(){var e,t,r=this.lensFlares.length,i=2*-this.positionScreen.x,o=2*-this.positionScreen.y;for(e=0;r>e;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+i*t.distance,t.y=this.positionScreen.y+o*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length,i="__default",o=0,n=r-1,a=r/1;this.createAnimation(i,o,n,a),this.setAnimationWeight(i,1)},THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,r,i){var o={startFrame:t,endFrame:r,length:r-t+1,fps:i,duration:(r-t)/i,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=o,this.animationsList.push(o)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,r=/([a-z]+)(\\d+)/,i={},o=this.geometry,n=0,a=o.morphTargets.length;a>n;n++){var s=o.morphTargets[n],h=s.name.match(r);if(h&&h.length>1){var l=h[1];h[2];i[l]||(i[l]={start:1/0,end:-(1/0)});var c=i[l];n<c.start&&(c.start=n),n>c.end&&(c.end=n),t||(t=l)}}for(var l in i){var c=i[l];this.createAnimation(l,c.start,c.end,e)}this.firstAnimation=t},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];r&&(r.time=t)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,r=this.animationsMap[e];return r&&(t=r.time),t},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,r=this.animationsMap[e];return r&&(t=r.duration),t},THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},THREE.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,r=this.animationsList.length;r>t;t++){var i=this.animationsList[t];if(i.active){var o=i.duration/i.length;i.time+=i.direction*e,i.mirroredLoop?(i.time>i.duration||i.time<0)&&(i.direction*=-1,i.time>i.duration&&(i.time=i.duration,i.directionBackwards=!0),i.time<0&&(i.time=0,i.directionBackwards=!1)):(i.time=i.time%i.duration,i.time<0&&(i.time+=i.duration));var n=i.startFrame+THREE.Math.clamp(Math.floor(i.time/o),0,i.length-1),a=i.weight;n!==i.currentFrame&&(this.morphTargetInfluences[i.lastFrame]=0,this.morphTargetInfluences[i.currentFrame]=1*a,this.morphTargetInfluences[n]=0,i.lastFrame=i.currentFrame,i.currentFrame=n);var s=i.time%o/o;i.directionBackwards&&(s=1-s),this.morphTargetInfluences[i.currentFrame]=s*a,this.morphTargetInfluences[i.lastFrame]=(1-s)*a}}},THREE.LensFlarePlugin=function(){function e(e,r){var i=t.createProgram(),o=t.createShader(t.FRAGMENT_SHADER),n=t.createShader(t.VERTEX_SHADER),a="precision "+r+" float;\\n";return t.shaderSource(o,a+e.fragmentShader),t.shaderSource(n,a+e.vertexShader),t.compileShader(o),t.compileShader(n),t.attachShader(i,o),t.attachShader(i,n),t.linkProgram(i),i}var t,r,i,o={};this.init=function(n){t=n.context,r=n,i=n.getPrecision(),o.vertices=new Float32Array(16),o.faces=new Uint16Array(6);var a=0;o.vertices[a++]=-1,o.vertices[a++]=-1,o.vertices[a++]=0,o.vertices[a++]=0,o.vertices[a++]=1,o.vertices[a++]=-1,o.vertices[a++]=1,o.vertices[a++]=0,o.vertices[a++]=1,o.vertices[a++]=1,o.vertices[a++]=1,o.vertices[a++]=1,o.vertices[a++]=-1,o.vertices[a++]=1,o.vertices[a++]=0,o.vertices[a++]=1,a=0,o.faces[a++]=0,o.faces[a++]=1,o.faces[a++]=2,o.faces[a++]=0,o.faces[a++]=2,o.faces[a++]=3,o.vertexBuffer=t.createBuffer(),o.elementBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,o.vertices,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o.elementBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,o.faces,t.STATIC_DRAW),o.tempTexture=t.createTexture(),o.occlusionTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,o.tempTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,o.occlusionTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(o.hasVertexTexture=!1,o.program=e(THREE.ShaderFlares.lensFlare,i)):(o.hasVertexTexture=!0,o.program=e(THREE.ShaderFlares.lensFlareVertexTexture,i)),o.attributes={},o.uniforms={},o.attributes.vertex=t.getAttribLocation(o.program,"position"),o.attributes.uv=t.getAttribLocation(o.program,"uv"),o.uniforms.renderType=t.getUniformLocation(o.program,"renderType"),o.uniforms.map=t.getUniformLocation(o.program,"map"),o.uniforms.occlusionMap=t.getUniformLocation(o.program,"occlusionMap"),o.uniforms.opacity=t.getUniformLocation(o.program,"opacity"),o.uniforms.color=t.getUniformLocation(o.program,"color"),o.uniforms.scale=t.getUniformLocation(o.program,"scale"),o.uniforms.rotation=t.getUniformLocation(o.program,"rotation"),o.uniforms.screenPosition=t.getUniformLocation(o.program,"screenPosition")},this.render=function(e,i,n,a){var s=e.__webglFlares,h=s.length;if(h){var l=new THREE.Vector3,c=a/n,u=.5*n,p=.5*a,f=16/a,E=new THREE.Vector2(f*c,f),d=new THREE.Vector3(1,1,0),m=new THREE.Vector2(1,1),g=o.uniforms,v=o.attributes;t.useProgram(o.program),t.enableVertexAttribArray(o.attributes.vertex),t.enableVertexAttribArray(o.attributes.uv),t.uniform1i(g.occlusionMap,0),t.uniform1i(g.map,1),t.bindBuffer(t.ARRAY_BUFFER,o.vertexBuffer),t.vertexAttribPointer(v.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(v.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o.elementBuffer),t.disable(t.CULL_FACE),t.depthMask(!1);var T,y,R,x,H;for(T=0;h>T;T++)if(f=16/a,E.set(f*c,f),x=s[T],l.set(x.matrixWorld.elements[12],x.matrixWorld.elements[13],x.matrixWorld.elements[14]),l.applyMatrix4(i.matrixWorldInverse),l.applyProjection(i.projectionMatrix),d.copy(l),m.x=d.x*u+u,m.y=d.y*p+p,o.hasVertexTexture||m.x>0&&m.x<n&&m.y>0&&m.y<a)for(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,o.tempTexture),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,m.x-8,m.y-8,16,16,0),t.uniform1i(g.renderType,0),t.uniform2f(g.scale,E.x,E.y),t.uniform3f(g.screenPosition,d.x,d.y,d.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,o.occlusionTexture),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,m.x-8,m.y-8,16,16,0),t.uniform1i(g.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,o.tempTexture),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),x.positionScreen.copy(d),x.customUpdateCallback?x.customUpdateCallback(x):x.updateLensFlares(),t.uniform1i(g.renderType,2),t.enable(t.BLEND),y=0,R=x.lensFlares.length;R>y;y++)H=x.lensFlares[y],H.opacity>.001&&H.scale>.001&&(d.x=H.x,d.y=H.y,d.z=H.z,f=H.size*H.scale/a,E.x=f*c,E.y=f,t.uniform3f(g.screenPosition,d.x,d.y,d.z),t.uniform2f(g.scale,E.x,E.y),t.uniform1f(g.rotation,H.rotation),t.uniform1f(g.opacity,H.opacity),t.uniform3f(g.color,H.color.r,H.color.g,H.color.b),r.setBlending(H.blending,H.blendEquation,H.blendSrc,H.blendDst),r.setTexture(H.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},THREE.ShadowMapPlugin=function(){function e(e,t){var r=new THREE.DirectionalLight;r.isVirtual=!0,r.onlyShadow=!0,r.castShadow=!0,r.shadowCameraNear=e.shadowCameraNear,r.shadowCameraFar=e.shadowCameraFar,r.shadowCameraLeft=e.shadowCameraLeft,r.shadowCameraRight=e.shadowCameraRight,r.shadowCameraBottom=e.shadowCameraBottom,r.shadowCameraTop=e.shadowCameraTop,r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t],r.shadowMapWidth=e.shadowCascadeWidth[t],r.shadowMapHeight=e.shadowCascadeHeight[t],r.pointsWorld=[],r.pointsFrustum=[];for(var i=r.pointsWorld,o=r.pointsFrustum,n=0;8>n;n++)i[n]=new THREE.Vector3,o[n]=new THREE.Vector3;var a=e.shadowCascadeNearZ[t],s=e.shadowCascadeFarZ[t];return o[0].set(-1,-1,a),o[1].set(1,-1,a),o[2].set(-1,1,a),o[3].set(1,1,a),o[4].set(-1,-1,s),o[5].set(1,-1,s),o[6].set(-1,1,s),o[7].set(1,1,s),r}function t(e,t){var r=e.shadowCascadeArray[t];r.position.copy(e.position),r.target.position.copy(e.target.position),r.lookAt(r.target),r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t];var i=e.shadowCascadeNearZ[t],o=e.shadowCascadeFarZ[t],n=r.pointsFrustum;n[0].z=i,n[1].z=i,n[2].z=i,n[3].z=i,n[4].z=o,n[5].z=o,n[6].z=o,n[7].z=o}function r(e,t){var r=t.shadowCamera,i=t.pointsFrustum,o=t.pointsWorld;p.set(1/0,1/0,1/0),f.set(-(1/0),-(1/0),-(1/0));for(var n=0;8>n;n++){var a=o[n];a.copy(i[n]),THREE.ShadowMapPlugin.__projector.unprojectVector(a,e),a.applyMatrix4(r.matrixWorldInverse),a.x<p.x&&(p.x=a.x),a.x>f.x&&(f.x=a.x),a.y<p.y&&(p.y=a.y),a.y>f.y&&(f.y=a.y),a.z<p.z&&(p.z=a.z),a.z>f.z&&(f.z=a.z)}r.left=p.x,r.right=f.x,r.top=f.y,r.bottom=p.y,r.updateProjectionMatrix()}function i(e){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[0]:e.material}var o,n,a,s,h,l,c=new THREE.Frustum,u=new THREE.Matrix4,p=new THREE.Vector3,f=new THREE.Vector3,E=new THREE.Vector3;this.init=function(e){o=e.context,n=e;var t=THREE.ShaderLib.depthRGBA,r=THREE.UniformsUtils.clone(t.uniforms);a=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:r}),s=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:r,morphTargets:!0}),h=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:r,skinning:!0}),l=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:r,morphTargets:!0,skinning:!0}),a._shadowPass=!0,s._shadowPass=!0,h._shadowPass=!0,l._shadowPass=!0},this.render=function(e,t){n.shadowMapEnabled&&n.shadowMapAutoUpdate&&this.update(e,t)},this.update=function(p,f){var d,m,g,v,T,y,R,x,H,_,b,w,M,S,A=[],C=0,L=null;for(o.clearColor(1,1,1,1),o.disable(o.BLEND),o.enable(o.CULL_FACE),o.frontFace(o.CCW),n.shadowMapCullFace===THREE.CullFaceFront?o.cullFace(o.FRONT):o.cullFace(o.BACK),n.setDepthTest(!0),d=0,m=p.__lights.length;m>d;d++)if(M=p.__lights[d],M.castShadow)if(M instanceof THREE.DirectionalLight&&M.shadowCascade)for(T=0;T<M.shadowCascadeCount;T++){var P;if(M.shadowCascadeArray[T])P=M.shadowCascadeArray[T];else{P=e(M,T),P.originalCamera=f;var F=new THREE.Gyroscope;F.position=M.shadowCascadeOffset,F.add(P),F.add(P.target),f.add(F),M.shadowCascadeArray[T]=P,console.log("Created virtualLight",P)}t(M,T),A[C]=P,C++}else A[C]=M,C++;for(d=0,m=A.length;m>d;d++){if(M=A[d],!M.shadowMap){var D=THREE.LinearFilter;n.shadowMapType===THREE.PCFSoftShadowMap&&(D=THREE.NearestFilter);var U={minFilter:D,magFilter:D,format:THREE.RGBAFormat};M.shadowMap=new THREE.WebGLRenderTarget(M.shadowMapWidth,M.shadowMapHeight,U),M.shadowMapSize=new THREE.Vector2(M.shadowMapWidth,M.shadowMapHeight),M.shadowMatrix=new THREE.Matrix4}if(!M.shadowCamera){if(M instanceof THREE.SpotLight)M.shadowCamera=new THREE.PerspectiveCamera(M.shadowCameraFov,M.shadowMapWidth/M.shadowMapHeight,M.shadowCameraNear,M.shadowCameraFar);else{if(!(M instanceof THREE.DirectionalLight)){console.error("Unsupported light type for shadow");continue}M.shadowCamera=new THREE.OrthographicCamera(M.shadowCameraLeft,M.shadowCameraRight,M.shadowCameraTop,M.shadowCameraBottom,M.shadowCameraNear,M.shadowCameraFar)}p.add(M.shadowCamera),p.autoUpdate===!0&&p.updateMatrixWorld()}for(M.shadowCameraVisible&&!M.cameraHelper&&(M.cameraHelper=new THREE.CameraHelper(M.shadowCamera),M.shadowCamera.add(M.cameraHelper)),M.isVirtual&&P.originalCamera==f&&r(f,M),y=M.shadowMap,R=M.shadowMatrix,x=M.shadowCamera,x.position.getPositionFromMatrix(M.matrixWorld),E.getPositionFromMatrix(M.target.matrixWorld),x.lookAt(E),x.updateMatrixWorld(),x.matrixWorldInverse.getInverse(x.matrixWorld),M.cameraHelper&&(M.cameraHelper.visible=M.shadowCameraVisible),M.shadowCameraVisible&&M.cameraHelper.update(),R.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),R.multiply(x.projectionMatrix),R.multiply(x.matrixWorldInverse),u.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse),c.setFromMatrix(u),n.setRenderTarget(y),n.clear(),S=p.__webglObjects,g=0,v=S.length;v>g;g++)b=S[g],w=b.object,b.render=!1,w.visible&&w.castShadow&&((w instanceof THREE.Mesh||w instanceof THREE.ParticleSystem)&&w.frustumCulled&&!c.intersectsObject(w)||(w._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,w.matrixWorld),b.render=!0));var V,O,z;for(g=0,v=S.length;v>g;g++)b=S[g],b.render&&(w=b.object,H=b.buffer,V=i(w),O=w.geometry.morphTargets.length>0&&V.morphTargets,z=w instanceof THREE.SkinnedMesh&&V.skinning,_=w.customDepthMaterial?w.customDepthMaterial:z?O?l:h:O?s:a,H instanceof THREE.BufferGeometry?n.renderBufferDirect(x,p.__lights,L,_,H,w):n.renderBuffer(x,p.__lights,L,_,H,w));for(S=p.__webglObjectsImmediate,g=0,v=S.length;v>g;g++)b=S[g],w=b.object,w.visible&&w.castShadow&&(w._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,w.matrixWorld),n.renderImmediateObject(x,p.__lights,L,a,w))}var N=n.getClearColor(),B=n.getClearAlpha();o.clearColor(N.r,N.g,N.b,B),o.enable(o.BLEND),n.shadowMapCullFace===THREE.CullFaceFront&&o.cullFace(o.BACK)}},THREE.ShadowMapPlugin.__projector=new THREE.Projector,THREE.SpritePlugin=function(){function e(e,t){var i=r.createProgram(),o=r.createShader(r.FRAGMENT_SHADER),n=r.createShader(r.VERTEX_SHADER),a="precision "+t+" float;\\n";return r.shaderSource(o,a+e.fragmentShader),r.shaderSource(n,a+e.vertexShader),r.compileShader(o),r.compileShader(n),r.attachShader(i,o),r.attachShader(i,n),r.linkProgram(i),i}function t(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var r,i,o,n={};this.init=function(t){r=t.context,i=t,o=t.getPrecision(),n.vertices=new Float32Array(16),n.faces=new Uint16Array(6);var a=0;n.vertices[a++]=-1,n.vertices[a++]=-1,n.vertices[a++]=0,n.vertices[a++]=0,n.vertices[a++]=1,n.vertices[a++]=-1,n.vertices[a++]=1,n.vertices[a++]=0,n.vertices[a++]=1,n.vertices[a++]=1,n.vertices[a++]=1,n.vertices[a++]=1,n.vertices[a++]=-1,n.vertices[a++]=1,n.vertices[a++]=0,n.vertices[a++]=1,a=0,n.faces[a++]=0,n.faces[a++]=1,n.faces[a++]=2,n.faces[a++]=0,n.faces[a++]=2,n.faces[a++]=3,n.vertexBuffer=r.createBuffer(),n.elementBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,n.vertexBuffer),r.bufferData(r.ARRAY_BUFFER,n.vertices,r.STATIC_DRAW),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n.elementBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,n.faces,r.STATIC_DRAW),n.program=e(THREE.ShaderSprite.sprite,o),n.attributes={},n.uniforms={},n.attributes.position=r.getAttribLocation(n.program,"position"),n.attributes.uv=r.getAttribLocation(n.program,"uv"),n.uniforms.uvOffset=r.getUniformLocation(n.program,"uvOffset"),n.uniforms.uvScale=r.getUniformLocation(n.program,"uvScale"),n.uniforms.rotation=r.getUniformLocation(n.program,"rotation"),n.uniforms.scale=r.getUniformLocation(n.program,"scale"),n.uniforms.alignment=r.getUniformLocation(n.program,"alignment"),n.uniforms.color=r.getUniformLocation(n.program,"color"),n.uniforms.map=r.getUniformLocation(n.program,"map"),n.uniforms.opacity=r.getUniformLocation(n.program,"opacity"),n.uniforms.useScreenCoordinates=r.getUniformLocation(n.program,"useScreenCoordinates"),n.uniforms.sizeAttenuation=r.getUniformLocation(n.program,"sizeAttenuation"),n.uniforms.screenPosition=r.getUniformLocation(n.program,"screenPosition"),n.uniforms.modelViewMatrix=r.getUniformLocation(n.program,"modelViewMatrix"),n.uniforms.projectionMatrix=r.getUniformLocation(n.program,"projectionMatrix"),n.uniforms.fogType=r.getUniformLocation(n.program,"fogType"),n.uniforms.fogDensity=r.getUniformLocation(n.program,"fogDensity"),n.uniforms.fogNear=r.getUniformLocation(n.program,"fogNear"),n.uniforms.fogFar=r.getUniformLocation(n.program,"fogFar"),n.uniforms.fogColor=r.getUniformLocation(n.program,"fogColor"),n.uniforms.alphaTest=r.getUniformLocation(n.program,"alphaTest")},this.render=function(e,o,a,s){var h=e.__webglSprites,l=h.length;if(l){var c=n.attributes,u=n.uniforms,p=s/a,f=.5*a,E=.5*s;r.useProgram(n.program),r.enableVertexAttribArray(c.position),r.enableVertexAttribArray(c.uv),r.disable(r.CULL_FACE),r.enable(r.BLEND),r.bindBuffer(r.ARRAY_BUFFER,n.vertexBuffer),r.vertexAttribPointer(c.position,2,r.FLOAT,!1,16,0),r.vertexAttribPointer(c.uv,2,r.FLOAT,!1,16,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n.elementBuffer),r.uniformMatrix4fv(u.projectionMatrix,!1,o.projectionMatrix.elements),r.activeTexture(r.TEXTURE0),r.uniform1i(u.map,0);var d=0,m=0,g=e.fog;g?(r.uniform3f(u.fogColor,g.color.r,g.color.g,g.color.b),g instanceof THREE.Fog?(r.uniform1f(u.fogNear,g.near),r.uniform1f(u.fogFar,g.far),r.uniform1i(u.fogType,1),d=1,m=1):g instanceof THREE.FogExp2&&(r.uniform1f(u.fogDensity,g.density),r.uniform1i(u.fogType,2),d=2,m=2)):(r.uniform1i(u.fogType,0),d=0,m=0);var v,T,y,R,x,H=[];for(v=0;l>v;v++)T=h[v],y=T.material,T.visible&&0!==y.opacity&&(y.useScreenCoordinates?T.z=-T.position.z:(T._modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,T.matrixWorld),T.z=-T._modelViewMatrix.elements[14]));for(h.sort(t),v=0;l>v;v++)T=h[v],y=T.material,T.visible&&0!==y.opacity&&y.map&&y.map.image&&y.map.image.width&&(r.uniform1f(u.alphaTest,y.alphaTest),y.useScreenCoordinates===!0?(r.uniform1i(u.useScreenCoordinates,1),r.uniform3f(u.screenPosition,(T.position.x*i.devicePixelRatio-f)/f,(E-T.position.y*i.devicePixelRatio)/E,Math.max(0,Math.min(1,T.position.z))),H[0]=i.devicePixelRatio,H[1]=i.devicePixelRatio):(r.uniform1i(u.useScreenCoordinates,0),r.uniform1i(u.sizeAttenuation,y.sizeAttenuation?1:0),r.uniformMatrix4fv(u.modelViewMatrix,!1,T._modelViewMatrix.elements),H[0]=1,H[1]=1),x=e.fog&&y.fog?m:0,d!==x&&(r.uniform1i(u.fogType,x),d=x),R=1/(y.scaleByViewport?s:1),H[0]*=R*p*T.scale.x,H[1]*=R*T.scale.y,r.uniform2f(u.uvScale,y.uvScale.x,y.uvScale.y),r.uniform2f(u.uvOffset,y.uvOffset.x,y.uvOffset.y),r.uniform2f(u.alignment,y.alignment.x,y.alignment.y),r.uniform1f(u.opacity,y.opacity),r.uniform3f(u.color,y.color.r,y.color.g,y.color.b),r.uniform1f(u.rotation,T.rotation),r.uniform2fv(u.scale,H),i.setBlending(y.blending,y.blendEquation,y.blendSrc,y.blendDst),i.setDepthTest(y.depthTest),i.setDepthWrite(y.depthWrite),i.setTexture(y.map,0),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0));r.enable(r.CULL_FACE)}}},THREE.DepthPassPlugin=function(){function e(e){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[0]:e.material}this.enabled=!1,this.renderTarget=null;var t,r,i,o,n,a,s=new THREE.Frustum,h=new THREE.Matrix4;this.init=function(e){t=e.context,r=e;var s=THREE.ShaderLib.depthRGBA,h=THREE.UniformsUtils.clone(s.uniforms);i=new THREE.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:h}),o=new THREE.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:h,morphTargets:!0}),n=new THREE.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:h,skinning:!0}),a=new THREE.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:h,morphTargets:!0,skinning:!0}),i._shadowPass=!0,o._shadowPass=!0,n._shadowPass=!0,a._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(l,c){var u,p,f,E,d,m,g,v=null;for(t.clearColor(1,1,1,1),t.disable(t.BLEND),r.setDepthTest(!0),l.autoUpdate===!0&&l.updateMatrixWorld(),c.matrixWorldInverse.getInverse(c.matrixWorld),h.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),s.setFromMatrix(h),r.setRenderTarget(this.renderTarget),r.clear(),g=l.__webglObjects,u=0,p=g.length;p>u;u++)d=g[u],m=d.object,d.render=!1,m.visible&&((m instanceof THREE.Mesh||m instanceof THREE.ParticleSystem)&&m.frustumCulled&&!s.intersectsObject(m)||(m._modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,m.matrixWorld),d.render=!0));var T,y,R;for(u=0,p=g.length;p>u;u++)if(d=g[u],d.render){if(m=d.object,f=d.buffer,m instanceof THREE.ParticleSystem&&!m.customDepthMaterial)continue;T=e(m),T&&r.setMaterialFaces(m.material),y=m.geometry.morphTargets.length>0&&T.morphTargets,R=m instanceof THREE.SkinnedMesh&&T.skinning,\r\nE=m.customDepthMaterial?m.customDepthMaterial:R?y?a:n:y?o:i,f instanceof THREE.BufferGeometry?r.renderBufferDirect(c,l.__lights,v,E,f,m):r.renderBuffer(c,l.__lights,v,E,f,m)}for(g=l.__webglObjectsImmediate,u=0,p=g.length;p>u;u++)d=g[u],m=d.object,m.visible&&(m._modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,m.matrixWorld),r.renderImmediateObject(c,l.__lights,v,i,m));var x=r.getClearColor(),H=r.getClearAlpha();t.clearColor(x.r,x.g,x.b,H),t.enable(t.BLEND)}},THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\\n")},lensFlare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\\n")}},THREE.ShaderSprite={sprite:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\\n")}},THREE.TrackballControls=function(e,t){function r(e){u.enabled!==!1&&(window.removeEventListener("keydown",r),m=d,d===p.NONE&&(e.keyCode!==u.keys[p.ROTATE]||u.noRotate?e.keyCode!==u.keys[p.ZOOM]||u.noZoom?e.keyCode!==u.keys[p.PAN]||u.noPan||(d=p.PAN):d=p.ZOOM:d=p.ROTATE))}function i(e){u.enabled!==!1&&(d=m,window.addEventListener("keydown",r,!1))}function o(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),d===p.NONE&&(d=e.button),d!==p.ROTATE||u.noRotate?d!==p.ZOOM||u.noZoom?d!==p.PAN||u.noPan||(w.copy(L(e.pageX,e.pageY)),M.copy(w)):(x.copy(L(e.pageX,e.pageY)),H.copy(x)):(T.copy(P(e.pageX,e.pageY)),v.copy(T)),document.addEventListener("mousemove",n,!1),document.addEventListener("mouseup",a,!1),u.dispatchEvent(A))}function n(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),d!==p.ROTATE||u.noRotate?d!==p.ZOOM||u.noZoom?d!==p.PAN||u.noPan||M.copy(L(e.pageX,e.pageY)):H.copy(L(e.pageX,e.pageY)):(v.copy(T),T.copy(P(e.pageX,e.pageY))))}function a(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),d=p.NONE,document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",a),u.dispatchEvent(C))}function s(e){if(u.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),x.y+=.01*t,u.dispatchEvent(A),u.dispatchEvent(C)}}function h(e){if(u.enabled!==!1){switch(e.touches.length){case 1:d=p.TOUCH_ROTATE,T.copy(P(e.touches[0].pageX,e.touches[0].pageY)),v.copy(T);break;case 2:d=p.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;b=_=Math.sqrt(t*t+r*r);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;w.copy(L(i,o)),M.copy(w);break;default:d=p.NONE}u.dispatchEvent(A)}}function l(e){if(u.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:v.copy(T),T.copy(P(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;b=Math.sqrt(t*t+r*r);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;M.copy(L(i,o));break;default:d=p.NONE}}function c(e){if(u.enabled!==!1){switch(e.touches.length){case 1:v.copy(T),T.copy(P(e.touches[0].pageX,e.touches[0].pageY));break;case 2:_=b=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;M.copy(L(t,r)),w.copy(M)}d=p.NONE,u.dispatchEvent(C)}}var u=this,p={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var f=1e-6,E=new THREE.Vector3,d=p.NONE,m=p.NONE,g=new THREE.Vector3,v=new THREE.Vector2,T=new THREE.Vector2,y=new THREE.Vector3,R=0,x=new THREE.Vector2,H=new THREE.Vector2,_=0,b=0,w=new THREE.Vector2,M=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var S={type:"change"},A={type:"start"},C={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var L=function(){var e=new THREE.Vector2;return function(t,r){return e.set((t-u.screen.left)/u.screen.width,(r-u.screen.top)/u.screen.height),e}}(),P=function(){var e=new THREE.Vector2;return function(t,r){return e.set((t-.5*u.screen.width-u.screen.left)/(.5*u.screen.width),(u.screen.height+2*(u.screen.top-r))/u.screen.width),e}}();this.rotateCamera=function(){var e,t=new THREE.Vector3,r=new THREE.Quaternion,i=new THREE.Vector3,o=new THREE.Vector3,n=new THREE.Vector3,a=new THREE.Vector3;return function(){a.set(T.x-v.x,T.y-v.y,0),e=a.length(),e?(g.copy(u.object.position).sub(u.target),i.copy(g).normalize(),o.copy(u.object.up).normalize(),n.crossVectors(o,i).normalize(),o.setLength(T.y-v.y),n.setLength(T.x-v.x),a.copy(o.add(n)),t.crossVectors(a,g).normalize(),e*=u.rotateSpeed,r.setFromAxisAngle(t,e),g.applyQuaternion(r),u.object.up.applyQuaternion(r),y.copy(t),R=e):!u.staticMoving&&R&&(R*=Math.sqrt(1-u.dynamicDampingFactor),g.copy(u.object.position).sub(u.target),r.setFromAxisAngle(y,R),g.applyQuaternion(r),u.object.up.applyQuaternion(r)),v.copy(T)}}(),this.zoomCamera=function(){var e;d===p.TOUCH_ZOOM_PAN?(e=_/b,_=b,g.multiplyScalar(e)):(e=1+(H.y-x.y)*u.zoomSpeed,1!==e&&e>0&&(g.multiplyScalar(e),u.staticMoving?x.copy(H):x.y+=(H.y-x.y)*this.dynamicDampingFactor))},this.panCamera=function(){var e=new THREE.Vector2,t=new THREE.Vector3,r=new THREE.Vector3;return function(){e.copy(M).sub(w),e.lengthSq()&&(e.multiplyScalar(g.length()*u.panSpeed),r.copy(g).cross(u.object.up).setLength(e.x),r.add(t.copy(u.object.up).setLength(e.y)),u.object.position.add(r),u.target.add(r),u.staticMoving?w.copy(M):w.add(e.subVectors(M,w).multiplyScalar(u.dynamicDampingFactor)))}}(),this.checkDistances=function(){u.noZoom&&u.noPan||(g.lengthSq()>u.maxDistance*u.maxDistance&&u.object.position.addVectors(u.target,g.setLength(u.maxDistance)),g.lengthSq()<u.minDistance*u.minDistance&&u.object.position.addVectors(u.target,g.setLength(u.minDistance)))},this.update=function(){g.subVectors(u.object.position,u.target),u.noRotate||u.rotateCamera(),u.noZoom||u.zoomCamera(),u.noPan||u.panCamera(),u.object.position.addVectors(u.target,g),u.checkDistances(),u.object.lookAt(u.target),E.distanceToSquared(u.object.position)>f&&(u.dispatchEvent(S),E.copy(u.object.position))},this.reset=function(){d=p.NONE,m=p.NONE,u.target.copy(u.target0),u.object.position.copy(u.position0),u.object.up.copy(u.up0),g.subVectors(u.object.position,u.target),u.object.lookAt(u.target),u.dispatchEvent(S),E.copy(u.object.position)},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",o,!1),this.domElement.addEventListener("mousewheel",s,!1),this.domElement.addEventListener("DOMMouseScroll",s,!1),this.domElement.addEventListener("touchstart",h,!1),this.domElement.addEventListener("touchend",c,!1),this.domElement.addEventListener("touchmove",l,!1),window.addEventListener("keydown",r,!1),window.addEventListener("keyup",i,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls,function(){function e(e){this.object=e,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25;var t,r,i=this,o=1e-6,n=0,a=0,s=1,h=new THREE.Vector3,l=!1;this.getPolarAngle=function(){return r},this.getAzimuthalAngle=function(){return t},this.rotateLeft=function(e){a-=e},this.rotateUp=function(e){n-=e},this.panLeft=function(){var e=new THREE.Vector3;return function(t){var r=this.object.matrix.elements;e.set(r[0],r[1],r[2]),e.multiplyScalar(-t),h.add(e)}}(),this.panUp=function(){var e=new THREE.Vector3;return function(t){var r=this.object.matrix.elements;e.set(r[4],r[5],r[6]),e.multiplyScalar(t),h.add(e)}}(),this.pan=function(e,t,r,o){if(i.object instanceof THREE.PerspectiveCamera){var n=i.object.position,a=n.clone().sub(i.target),s=a.length();s*=Math.tan(i.object.fov/2*Math.PI/180),i.panLeft(2*e*s/o),i.panUp(2*t*s/o)}else i.object instanceof THREE.OrthographicCamera?(i.panLeft(e*(i.object.right-i.object.left)/r),i.panUp(t*(i.object.top-i.object.bottom)/o)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){i.object instanceof THREE.PerspectiveCamera?s/=e:i.object instanceof THREE.OrthographicCamera?(i.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*e)),i.object.updateProjectionMatrix(),l=!0):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.dollyOut=function(e){i.object instanceof THREE.PerspectiveCamera?s*=e:i.object instanceof THREE.OrthographicCamera?(i.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/e)),i.object.updateProjectionMatrix(),l=!0):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.update=function(){var i=new THREE.Vector3,c=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),u=c.clone().inverse(),p=new THREE.Vector3,f=new THREE.Quaternion;return function(){var e=this.object.position;i.copy(e).sub(this.target),i.applyQuaternion(c),t=Math.atan2(i.x,i.z),r=Math.atan2(Math.sqrt(i.x*i.x+i.z*i.z),i.y),t+=a,r+=n,t=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,t)),r=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,r)),r=Math.max(o,Math.min(Math.PI-o,r));var E=i.length()*s;return E=Math.max(this.minDistance,Math.min(this.maxDistance,E)),this.target.add(h),i.x=E*Math.sin(r)*Math.sin(t),i.y=E*Math.cos(r),i.z=E*Math.sin(r)*Math.cos(t),i.applyQuaternion(u),e.copy(this.target).add(i),this.object.lookAt(this.target),this.enableDamping===!0?(a*=1-this.dampingFactor,n*=1-this.dampingFactor):(a=0,n=0),s=1,h.set(0,0,0),l||p.distanceToSquared(this.object.position)>o||8*(1-f.dot(this.object.quaternion))>o?(p.copy(this.object.position),f.copy(this.object.quaternion),l=!1,!0):!1}}()}THREE.OrbitControls=function(t,r){function i(e,t){var r=m.domElement===document?m.domElement.body:m.domElement;d.pan(e,t,r.clientWidth,r.clientHeight)}function o(){return 2*Math.PI/60/60*m.autoRotateSpeed}function n(){return Math.pow(.95,m.zoomSpeed)}function a(e){if(e.stopPropagation(),m.enabled!==!1){if(e.preventDefault(),e.button===m.mouseButtons.ORBIT){if(m.enableRotate===!1)return;M=w.ROTATE,g.set(e.clientX,e.clientY)}else if(e.button===m.mouseButtons.ZOOM){if(m.enableZoom===!1)return;M=w.DOLLY,H.set(e.clientX,e.clientY)}else if(e.button===m.mouseButtons.PAN){if(m.enablePan===!1)return;M=w.PAN,y.set(e.clientX,e.clientY)}M!==w.NONE&&(document.addEventListener("mousemove",s,!1),document.addEventListener("mouseup",h,!1),m.dispatchEvent(A))}}function s(e){if(m.enabled!==!1){e.preventDefault(),e.stopPropagation();m.domElement===document?m.domElement.body:m.domElement;if(M===w.ROTATE){if(m.enableRotate===!1)return;v.set(e.clientX,e.clientY),T.subVectors(v,g),d.rotateLeft(2*Math.PI*T.x/r.offsetHeight*m.rotateSpeed),d.rotateUp(2*Math.PI*T.y/r.offsetHeight*m.rotateSpeed),g.copy(v)}else if(M===w.DOLLY){if(m.enableZoom===!1)return;_.set(e.clientX,e.clientY),b.subVectors(_,H),b.y>0?d.dollyIn(n()):b.y<0&&d.dollyOut(n()),H.copy(_)}else if(M===w.PAN){if(m.enablePan===!1)return;R.set(e.clientX,e.clientY),x.subVectors(R,y),i(x.x,x.y),y.copy(R)}M!==w.NONE&&m.update()}}function h(){m.enabled!==!1&&(document.removeEventListener("mousemove",s,!1),document.removeEventListener("mouseup",h,!1),m.dispatchEvent(C),M=w.NONE)}function l(e){if(m.enabled!==!1&&m.enableZoom!==!1&&M===w.NONE){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?d.dollyOut(n()):0>t&&d.dollyIn(n()),m.update(),m.dispatchEvent(A),m.dispatchEvent(C)}}function c(e){if(m.enabled!==!1&&m.enableKeys!==!1&&m.enablePan!==!1)switch(e.keyCode){case m.keys.UP:i(0,m.keyPanSpeed),m.update();break;case m.keys.BOTTOM:i(0,-m.keyPanSpeed),m.update();break;case m.keys.LEFT:i(m.keyPanSpeed,0),m.update();break;case m.keys.RIGHT:i(-m.keyPanSpeed,0),m.update()}}function u(e){if(m.enabled!==!1){switch(e.touches.length){case 1:if(m.enableRotate===!1)return;M=w.TOUCH_ROTATE,g.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(m.enableZoom===!1)return;M=w.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+r*r);H.set(0,i);break;case 3:if(m.enablePan===!1)return;M=w.TOUCH_PAN,y.set(e.touches[0].pageX,e.touches[0].pageY);break;default:M=w.NONE}M!==w.NONE&&m.dispatchEvent(A)}}function p(e){if(m.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=m.domElement===document?m.domElement.body:m.domElement;switch(e.touches.length){case 1:if(m.enableRotate===!1)return;if(M!==w.TOUCH_ROTATE)return;v.set(e.touches[0].pageX,e.touches[0].pageY),T.subVectors(v,g),d.rotateLeft(2*Math.PI*T.x/t.clientWidth*m.rotateSpeed),d.rotateUp(2*Math.PI*T.y/t.clientHeight*m.rotateSpeed),g.copy(v),m.update();break;case 2:if(m.enableZoom===!1)return;if(M!==w.TOUCH_DOLLY)return;var r=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(r*r+o*o);_.set(0,a),b.subVectors(_,H),b.y>0?d.dollyOut(n()):b.y<0&&d.dollyIn(n()),H.copy(_),m.update();break;case 3:if(m.enablePan===!1)return;if(M!==w.TOUCH_PAN)return;R.set(e.touches[0].pageX,e.touches[0].pageY),x.subVectors(R,y),i(x.x,x.y),y.copy(R),m.update();break;default:M=w.NONE}}}function f(){m.enabled!==!1&&(m.dispatchEvent(C),M=w.NONE)}function E(e){e.preventDefault()}var d=new e(t),r=this.domElement=void 0!==r?r:document;Object.defineProperty(this,"constraint",{get:function(){return d}}),this.getPolarAngle=function(){return d.getPolarAngle()},this.getAzimuthalAngle=function(){return d.getAzimuthalAngle()},this.enabled=!0,this.center=this.target,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=1,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2};var m=this,g=new THREE.Vector2,v=new THREE.Vector2,T=new THREE.Vector2,y=new THREE.Vector2,R=new THREE.Vector2,x=new THREE.Vector2,H=new THREE.Vector2,_=new THREE.Vector2,b=new THREE.Vector2,w={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},M=w.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom;var S={type:"change"},A={type:"start"},C={type:"end"};this.update=function(){this.autoRotate&&M===w.NONE&&d.rotateLeft(o()),d.update()===!0&&this.dispatchEvent(S)},this.reset=function(){M=w.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(S),this.update()},this.dispose=function(){this.domElement.removeEventListener("contextmenu",E,!1),this.domElement.removeEventListener("mousedown",a,!1),this.domElement.removeEventListener("mousewheel",l,!1),this.domElement.removeEventListener("DOMMouseScroll",l,!1),this.domElement.removeEventListener("touchstart",u,!1),this.domElement.removeEventListener("touchend",f,!1),this.domElement.removeEventListener("touchmove",p,!1),document.removeEventListener("mousemove",s,!1),document.removeEventListener("mouseup",h,!1),this.domElement.removeEventListener("keydown",c,!1)},this.domElement.addEventListener("contextmenu",E,!1),this.domElement.addEventListener("mousedown",a,!1),this.domElement.addEventListener("mousewheel",l,!1),this.domElement.addEventListener("DOMMouseScroll",l,!1),this.domElement.addEventListener("touchstart",u,!1),this.domElement.addEventListener("touchend",f,!1),this.domElement.addEventListener("touchmove",p,!1),this.domElement.addEventListener("keydown",c,!1),this.domElement.addEventListener("pointerdown",function(e){e.stopPropagation()},!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{object:{get:function(){return this.constraint.object}},target:{get:function(){return this.constraint.target},set:function(e){console.warn("THREE.OrbitControls: target is now immutable. Use target.set() instead."),this.constraint.target.copy(e)}},minDistance:{get:function(){return this.constraint.minDistance},set:function(e){this.constraint.minDistance=e}},maxDistance:{get:function(){return this.constraint.maxDistance},set:function(e){this.constraint.maxDistance=e}},minZoom:{get:function(){return this.constraint.minZoom},set:function(e){this.constraint.minZoom=e}},maxZoom:{get:function(){return this.constraint.maxZoom},set:function(e){this.constraint.maxZoom=e}},minPolarAngle:{get:function(){return this.constraint.minPolarAngle},set:function(e){this.constraint.minPolarAngle=e}},maxPolarAngle:{get:function(){return this.constraint.maxPolarAngle},set:function(e){this.constraint.maxPolarAngle=e}},minAzimuthAngle:{get:function(){return this.constraint.minAzimuthAngle},set:function(e){this.constraint.minAzimuthAngle=e}},maxAzimuthAngle:{get:function(){return this.constraint.maxAzimuthAngle},set:function(e){this.constraint.maxAzimuthAngle=e}},enableDamping:{get:function(){return this.constraint.enableDamping},set:function(e){this.constraint.enableDamping=e}},dampingFactor:{get:function(){return this.constraint.dampingFactor},set:function(e){this.constraint.dampingFactor=e}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.constraint.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.constraint.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor=e}}})}(),function(){var e,t,r,i,o,n,a,s,h,l,c=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};s=function(){var e,t,r,i;return null!=window.WebGLRenderingContext?(i=["WEBKIT","MOZ","MS","O"],r=/^WEBKIT_(.*)|MOZ_(.*)|MS_(.*)|O_(.*)/,e=WebGLRenderingContext.prototype.getExtension,WebGLRenderingContext.prototype.getExtension=function(t){var o,n,a,s,h;if(n=t.match(r),null!==n&&(t=n[1]),o=e.call(this,t),null===o){for(s=0,h=i.length;h>s;s++)if(a=i[s],o=e.call(this,a+"_"+t),null!==o)return o;return null}return o},t=WebGLRenderingContext.prototype.getSupportedExtensions,WebGLRenderingContext.prototype.getSupportedExtensions=function(){var e,i,o,n,a,s;for(n=t.call(this),o=[],a=0,s=n.length;s>a;a++)e=n[a],i=e.match(r),null!==i&&(e=i[1]),c.call(o,e)<0&&o.push(e);return o}):void 0},h=function(){var e,t,r,i,o,n,a,s,h,l,u,p,f,E;if(o=function(){var e,t,r;return e=document.createElement("canvas"),e.width=2,e.height=2,t=e.getContext("2d"),r=t.getImageData(0,0,2,2),r.data.set(new Uint8ClampedArray([0,0,0,0,255,255,255,255,0,0,0,0,255,255,255,255])),t.putImageData(r,0,0),e},o(),t=function(e,t){var r,i,n,a,s,h,l,c,u,p,f,E,d,m;if(h=e.createProgram(),d=e.createShader(e.VERTEX_SHADER),e.attachShader(h,d),e.shaderSource(d,"attribute vec2 position;\\nvoid main(){\\n    gl_Position = vec4(position, 0.0, 1.0);\\n}"),e.compileShader(d),!e.getShaderParameter(d,e.COMPILE_STATUS))throw e.getShaderInfoLog(d);if(n=e.createShader(e.FRAGMENT_SHADER),e.attachShader(h,n),e.shaderSource(n,"uniform sampler2D source;\\nvoid main(){\\n    gl_FragColor = texture2D(source, vec2(1.0, 1.0));\\n}"),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw e.getShaderInfoLog(n);if(e.linkProgram(h),!e.getProgramParameter(h,e.LINK_STATUS))throw e.getProgramInfoLog(h);return e.useProgram(h),i=function(){return e.deleteShader(n),e.deleteShader(d),e.deleteProgram(h),e.deleteBuffer(r),e.deleteTexture(u),e.deleteTexture(E),e.deleteFramebuffer(a),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null),e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null)},E=e.createTexture(),e.bindTexture(e.TEXTURE_2D,E),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,2,2,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),a=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,E,0),p=o(),u=e.createTexture(),e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,t,p),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),m=new Float32Array([1,1,-1,1,-1,-1,1,1,-1,-1,1,-1]),r=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,m,e.STATIC_DRAW),s=e.getAttribLocation(h,"position"),f=e.getUniformLocation(h,"source"),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),e.uniform1i(f,0),e.drawArrays(e.TRIANGLES,0,6),l=new Uint8Array(16),e.readPixels(0,0,2,2,e.RGBA,e.UNSIGNED_BYTE,l),c=Math.abs(l[0]-127)<10,i(),c},i=function(e,t){var r;return r=e.createTexture(),e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,2,2,0,e.RGBA,t,null),0===e.getError()?(e.deleteTexture(r),!0):(e.deleteTexture(r),!1)},e=function(e,t){var r,i,o;return o=e.createTexture(),e.bindTexture(e.TEXTURE_2D,o),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,2,2,0,e.RGBA,t,null),i=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o,0),r=e.checkFramebufferStatus(e.FRAMEBUFFER),e.deleteTexture(o),e.deleteFramebuffer(i),e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),r===e.FRAMEBUFFER_COMPLETE?!0:!1},h=[],l={},u=[],r=function(){var r,o,n,a,s,c,p;r=document.createElement("canvas"),n=null;try{n=r.getContext("experimental-webgl"),null===n&&(n=r.getContext("webgl"))}catch(f){}return null!=n&&(c=n.getExtension("OES_texture_float"),null===c?i(n,n.FLOAT)?(p=!0,h.push("OES_texture_float"),l.OES_texture_float={shim:!0}):(p=!1,u.push("OES_texture_float")):i(n,n.FLOAT)?(p=!0,h.push("OES_texture_float")):(p=!1,u.push("OES_texture_float")),p&&(o=n.getExtension("WEBGL_color_buffer_float"),null===o?e(n,n.FLOAT)?(h.push("WEBGL_color_buffer_float"),l.WEBGL_color_buffer_float={shim:!0,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863}):u.push("WEBGL_color_buffer_float"):e(n,n.FLOAT)?h.push("WEBGL_color_buffer_float"):u.push("WEBGL_color_buffer_float"),o=n.getExtension("OES_texture_float_linear"),null===o?t(n,n.FLOAT)?(h.push("OES_texture_float_linear"),l.OES_texture_float_linear={shim:!0}):u.push("OES_texture_float_linear"):t(n,n.FLOAT)?h.push("OES_texture_float_linear"):u.push("OES_texture_float_linear")),a=n.getExtension("OES_texture_half_float"),null===a?i(n,36193)?(s=!0,h.push("OES_texture_half_float"),a=l.OES_texture_half_float={HALF_FLOAT_OES:36193,shim:!0}):(s=!1,u.push("OES_texture_half_float")):i(n,a.HALF_FLOAT_OES)?(s=!0,h.push("OES_texture_half_float")):(s=!1,u.push("OES_texture_half_float")),s)?(o=n.getExtension("EXT_color_buffer_half_float"),null===o?e(n,a.HALF_FLOAT_OES)?(h.push("EXT_color_buffer_half_float"),l.EXT_color_buffer_half_float={shim:!0,RGBA16F_EXT:34842,RGB16F_EXT:34843,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863}):u.push("EXT_color_buffer_half_float"):e(n,a.HALF_FLOAT_OES)?h.push("EXT_color_buffer_half_float"):u.push("EXT_color_buffer_half_float"),o=n.getExtension("OES_texture_half_float_linear"),null===o?t(n,a.HALF_FLOAT_OES)?(h.push("OES_texture_half_float_linear"),l.OES_texture_half_float_linear={shim:!0}):u.push("OES_texture_half_float_linear"):t(n,a.HALF_FLOAT_OES)?h.push("OES_texture_half_float_linear"):u.push("OES_texture_half_float_linear")):void 0},null!=window.WebGLRenderingContext){for(r(),p={},f=0,E=u.length;E>f;f++)s=u[f],p[s]=!0;return n=WebGLRenderingContext.prototype.getExtension,WebGLRenderingContext.prototype.getExtension=function(e){var t;return t=l[e],void 0===t?p[e]?null:n.call(this,e):t},a=WebGLRenderingContext.prototype.getSupportedExtensions,WebGLRenderingContext.prototype.getSupportedExtensions=function(){var e,t,r,i,o,n,s;for(r=a.call(this),t=[],i=0,n=r.length;n>i;i++)e=r[i],void 0===p[e]&&t.push(e);for(o=0,s=h.length;s>o;o++)e=h[o],c.call(t,e)<0&&t.push(e);return t},WebGLRenderingContext.prototype.getFloatExtension=function(e){var t,r,i,o,n,a,h,l,c,u,p,f,E,d,m,g,v,T,y,R,x,H,_,b,w,M;for(null==e.prefer&&(e.prefer=["half"]),null==e.require&&(e.require=[]),null==e["throws"]&&(e["throws"]=!0),d=this.getExtension("OES_texture_float"),a=this.getExtension("OES_texture_half_float"),f=this.getExtension("WEBGL_color_buffer_float"),o=this.getExtension("EXT_color_buffer_half_float"),E=this.getExtension("OES_texture_float_linear"),n=this.getExtension("OES_texture_half_float_linear"),p={texture:null!==d,filterable:null!==E,renderable:null!==f,score:0,precision:"single",half:!1,single:!0,type:this.FLOAT},i={texture:null!==a,filterable:null!==n,renderable:null!==o,score:0,precision:"half",\r\nhalf:!0,single:!1,type:null!=(b=null!=a?a.HALF_FLOAT_OES:void 0)?b:null},r=[],p.texture&&r.push(p),i.texture&&r.push(i),u=[],g=0,y=r.length;y>g;g++){for(t=r[g],m=!0,w=e.require,v=0,R=w.length;R>v;v++)s=w[v],t[s]===!1&&(m=!1);m&&u.push(t)}for(T=0,x=u.length;x>T;T++)for(t=u[T],M=e.prefer,h=_=0,H=M.length;H>_;h=++_)c=M[h],l=Math.pow(2,e.prefer.length-h-1),t[c]&&(t.score+=l);if(u.sort(function(e,t){return e.score===t.score?0:e.score<t.score?1:e.score>t.score?-1:void 0}),0===u.length){if(e["throws"])throw"No floating point texture support that is "+e.require.join(", ");return null}return u=u[0],{filterable:u.filterable,renderable:u.renderable,type:u.type,precision:u.precision}}}},s(),h(),i=function(){function e(e,t){var r,i;this.gl=e,i=t.vertex,r=t.fragment,this.program=this.gl.createProgram(),this.vs=this.gl.createShader(this.gl.VERTEX_SHADER),this.fs=this.gl.createShader(this.gl.FRAGMENT_SHADER),this.gl.attachShader(this.program,this.vs),this.gl.attachShader(this.program,this.fs),this.compileShader(this.vs,i),this.compileShader(this.fs,r),this.link(),this.value_cache={},this.uniform_cache={},this.attribCache={}}return e.prototype.attribLocation=function(e){var t;return t=this.attribCache[e],void 0===t&&(t=this.attribCache[e]=this.gl.getAttribLocation(this.program,e)),t},e.prototype.compileShader=function(e,t){if(this.gl.shaderSource(e,t),this.gl.compileShader(e),!this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS))throw"Shader Compile Error: "+this.gl.getShaderInfoLog(e)},e.prototype.link=function(){if(this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))throw"Shader Link Error: "+this.gl.getProgramInfoLog(this.program)},e.prototype.use=function(){return this.gl.useProgram(this.program),this},e.prototype.uniformLoc=function(e){var t;return t=this.uniform_cache[e],void 0===t&&(t=this.uniform_cache[e]=this.gl.getUniformLocation(this.program,e)),t},e.prototype["int"]=function(e,t){var r,i;return r=this.value_cache[e],r!==t&&(this.value_cache[e]=t,i=this.uniformLoc(e),i&&this.gl.uniform1i(i,t)),this},e.prototype.vec2=function(e,t,r){var i;return i=this.uniformLoc(e),i&&this.gl.uniform2f(i,t,r),this},e.prototype["float"]=function(e,t){var r,i;return r=this.value_cache[e],r!==t&&(this.value_cache[e]=t,i=this.uniformLoc(e),i&&this.gl.uniform1f(i,t)),this},e}(),e=function(){function e(e){this.gl=e,this.buffer=this.gl.createFramebuffer()}return e.prototype.destroy=function(){return this.gl.deleteFRamebuffer(this.buffer)},e.prototype.bind=function(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buffer),this},e.prototype.unbind=function(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this},e.prototype.check=function(){var e;switch(e=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER)){case this.gl.FRAMEBUFFER_UNSUPPORTED:throw"Framebuffer is unsupported";case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"Framebuffer incomplete attachment";case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"Framebuffer incomplete dimensions";case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"Framebuffer incomplete missing attachment"}return this},e.prototype.color=function(e){return this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,e.target,e.handle,0),this.check(),this},e.prototype.depth=function(e){return this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,e.id),this.check(),this},e.prototype.destroy=function(){return this.gl.deleteFramebuffer(this.buffer)},e}(),o=function(){function e(e,t){var r,i;switch(this.gl=e,null==t&&(t={}),this.channels=this.gl[(null!=(r=t.channels)?r:"rgba").toUpperCase()],"number"==typeof t.type?this.type=t.type:this.type=this.gl[(null!=(i=t.type)?i:"unsigned_byte").toUpperCase()],this.channels){case this.gl.RGBA:this.chancount=4;break;case this.gl.RGB:this.chancount=3;break;case this.gl.LUMINANCE_ALPHA:this.chancount=2;break;default:this.chancount=1}this.target=this.gl.TEXTURE_2D,this.handle=this.gl.createTexture()}return e.prototype.destroy=function(){return this.gl.deleteTexture(this.handle)},e.prototype.bind=function(e){if(null==e&&(e=0),e>15)throw"Texture unit too large: "+e;return this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.target,this.handle),this},e.prototype.setSize=function(e,t){return this.width=e,this.height=t,this.gl.texImage2D(this.target,0,this.channels,this.width,this.height,0,this.channels,this.type,null),this},e.prototype.upload=function(e){return this.width=e.width,this.height=e.height,this.gl.texImage2D(this.target,0,this.channels,this.channels,this.type,e),this},e.prototype.linear=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this},e.prototype.nearest=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this},e.prototype.clampToEdge=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this},e.prototype.repeat=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this},e}(),r=function(){function t(t,r,i){var n;this.gl=t,this.width=r,this.height=i,n=this.gl.getFloatExtension({require:["renderable"]}),this.texture=new o(this.gl,{type:n.type}).bind(0).setSize(this.width,this.height).nearest().clampToEdge(),this.fbo=new e(this.gl).bind().color(this.texture).unbind()}return t.prototype.use=function(){return this.fbo.bind()},t.prototype.bind=function(e){return this.texture.bind(e)},t.prototype.end=function(){return this.fbo.unbind()},t.prototype.resize=function(e,t){return this.width=e,this.height=t,this.texture.bind(0).setSize(this.width,this.height)},t}(),l="attribute vec4 position;\\nvarying vec2 texcoord;\\nvoid main(){\\n    texcoord = position.xy*0.5+0.5;\\n    gl_Position = position;\\n}",a="#ifdef GL_FRAGMENT_PRECISION_HIGH\\n    precision highp int;\\n    precision highp float;\\n#else\\n    precision mediump int;\\n    precision mediump float;\\n#endif\\nuniform sampler2D source;\\nvarying vec2 texcoord;",t=function(){function e(e,t,o,n){var s,h,c;for(this.heatmap=e,this.gl=t,this.width=o,this.height=n,this.shader=new i(this.gl,{vertex:"attribute vec4 position, intensity;\\nvarying vec2 off, dim;\\nvarying float vIntensity;\\nuniform vec2 viewport;\\n\\nvoid main(){\\n    dim = abs(position.zw);\\n    off = position.zw;\\n    vec2 pos = position.xy + position.zw;\\n    vIntensity = intensity.x;\\n    gl_Position = vec4((pos/viewport)*2.0-1.0, 0.0, 1.0);\\n}",fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\\n    precision highp int;\\n    precision highp float;\\n#else\\n    precision mediump int;\\n    precision mediump float;\\n#endif\\nvarying vec2 off, dim;\\nvarying float vIntensity;\\nvoid main(){\\n    float falloff = (1.0 - smoothstep(0.0, 1.0, length(off/dim)));\\n    float intensity = falloff*vIntensity;\\n    gl_FragColor = vec4(intensity);\\n}"}),this.clampShader=new i(this.gl,{vertex:l,fragment:a+"uniform float low, high;\\nvoid main(){\\n    gl_FragColor = vec4(clamp(texture2D(source, texcoord).rgb, low, high), 1.0);\\n}"}),this.multiplyShader=new i(this.gl,{vertex:l,fragment:a+"uniform float value;\\nvoid main(){\\n    gl_FragColor = vec4(texture2D(source, texcoord).rgb*value, 1.0);\\n}"}),this.blurShader=new i(this.gl,{vertex:l,fragment:a+"uniform vec2 viewport;\\nvoid main(){\\n    vec4 result = vec4(0.0);\\n    for(int x=-1; x<=1; x++){\\n        for(int y=-1; y<=1; y++){\\n            vec2 off = vec2(x,y)/viewport;\\n            //float factor = 1.0 - smoothstep(0.0, 1.5, length(off));\\n            float factor = 1.0;\\n            result += vec4(texture2D(source, texcoord+off).rgb*factor, factor);\\n        }\\n    }\\n    gl_FragColor = vec4(result.rgb/result.w, 1.0);\\n}"}),this.nodeBack=new r(this.gl,this.width,this.height),this.nodeFront=new r(this.gl,this.width,this.height),this.vertexBuffer=this.gl.createBuffer(),this.vertexSize=8,this.maxPointCount=10240,this.vertexBufferData=new Float32Array(this.maxPointCount*this.vertexSize*6),this.vertexBufferViews=[],s=h=0,c=this.maxPointCount;c>=0?c>h:h>c;s=c>=0?++h:--h)this.vertexBufferViews.push(new Float32Array(this.vertexBufferData.buffer,0,s*this.vertexSize*6));this.bufferIndex=0,this.pointCount=0}return e.prototype.resize=function(e,t){return this.width=e,this.height=t,this.nodeBack.resize(this.width,this.height),this.nodeFront.resize(this.width,this.height)},e.prototype.update=function(){var e,t;return this.pointCount>0?(this.gl.enable(this.gl.BLEND),this.nodeFront.use(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexBufferViews[this.pointCount],this.gl.STREAM_DRAW),t=this.shader.attribLocation("position"),e=this.shader.attribLocation("intensity"),this.gl.enableVertexAttribArray(1),this.gl.vertexAttribPointer(t,4,this.gl.FLOAT,!1,32,0),this.gl.vertexAttribPointer(e,4,this.gl.FLOAT,!1,32,16),this.shader.use().vec2("viewport",this.width,this.height),this.gl.drawArrays(this.gl.TRIANGLES,0,6*this.pointCount),this.gl.disableVertexAttribArray(1),this.pointCount=0,this.bufferIndex=0,this.nodeFront.end(),this.gl.disable(this.gl.BLEND)):void 0},e.prototype.clear=function(){return this.nodeFront.use(),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.nodeFront.end()},e.prototype.clamp=function(e,t){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.heatmap.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.nodeFront.bind(0),this.nodeBack.use(),this.clampShader.use()["int"]("source",0)["float"]("low",e)["float"]("high",t),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.nodeBack.end(),this.swap()},e.prototype.multiply=function(e){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.heatmap.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.nodeFront.bind(0),this.nodeBack.use(),this.multiplyShader.use()["int"]("source",0)["float"]("value",e),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.nodeBack.end(),this.swap()},e.prototype.blur=function(){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.heatmap.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.nodeFront.bind(0),this.nodeBack.use(),this.blurShader.use()["int"]("source",0).vec2("viewport",this.width,this.height),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.nodeBack.end(),this.swap()},e.prototype.swap=function(){var e;return e=this.nodeFront,this.nodeFront=this.nodeBack,this.nodeBack=e},e.prototype.addVertex=function(e,t,r,i,o){return this.vertexBufferData[this.bufferIndex++]=e,this.vertexBufferData[this.bufferIndex++]=t,this.vertexBufferData[this.bufferIndex++]=r,this.vertexBufferData[this.bufferIndex++]=i,this.vertexBufferData[this.bufferIndex++]=o,this.vertexBufferData[this.bufferIndex++]=o,this.vertexBufferData[this.bufferIndex++]=o,this.vertexBufferData[this.bufferIndex++]=o},e.prototype.addPoint=function(e,t,r,i){var o;return null==r&&(r=50),null==i&&(i=.2),this.pointCount>=this.maxPointCount-1&&this.update(),t=this.height-t,o=r/2,this.addVertex(e,t,-o,-o,i),this.addVertex(e,t,+o,-o,i),this.addVertex(e,t,-o,+o,i),this.addVertex(e,t,-o,+o,i),this.addVertex(e,t,+o,-o,i),this.addVertex(e,t,+o,+o,i),this.pointCount+=1},e}(),n=function(){function e(e){var r,n,s,h,c,u,p,f,E,d,m,g,v;g=null!=e?e:{},this.canvas=g.canvas,this.width=g.width,this.height=g.height,f=g.intensityToAlpha,u=g.gradientTexture,n=g.alphaRange,this.canvas||(this.canvas=document.createElement("canvas"));try{if(this.gl=this.canvas.getContext("experimental-webgl",{depth:!1,antialias:!1}),!this.gl&&(this.gl=this.canvas.getContext("webgl",{depth:!1,antialias:!1}),!this.gl))throw"WebGL not supported"}catch(T){throw h=T,"WebGL not supported"}null!=window.WebGLDebugUtils&&(console.log("debugging mode"),this.gl=WebGLDebugUtils.makeDebugContext(this.gl,function(e,t,r){throw WebGLDebugUtils.glEnumToString(e)+" was caused by call to: "+t})),this.gl.enableVertexAttribArray(0),this.gl.blendFunc(this.gl.ONE,this.gl.ONE),u?(m=this.gradientTexture=new o(this.gl,{channels:"rgba"}).bind(0).setSize(2,2).nearest().clampToEdge(),"string"==typeof u?(p=new Image,p.onload=function(){return m.bind().upload(p)},p.src=u):u.width>0&&u.height>0?m.upload(u):u.onload=function(){return m.upload(u)},c="uniform sampler2D gradientTexture;\\nvec3 getColor(float intensity){\\n    return texture2D(gradientTexture, vec2(intensity, 0.0)).rgb;\\n}"):(m=null,c="vec3 getColor(float intensity){\\n    vec3 blue = vec3(0.0, 0.0, 1.0);\\n    vec3 cyan = vec3(0.0, 1.0, 1.0);\\n    vec3 green = vec3(0.0, 1.0, 0.0);\\n    vec3 yellow = vec3(1.0, 1.0, 0.0);\\n    vec3 red = vec3(1.0, 0.0, 0.0);\\n\\n    vec3 color = (\\n        fade(-0.25, 0.25, intensity)*blue +\\n        fade(0.0, 0.5, intensity)*cyan +\\n        fade(0.25, 0.75, intensity)*green +\\n        fade(0.5, 1.0, intensity)*yellow +\\n        smoothstep(0.75, 1.0, intensity)*red\\n    );\\n    return color;\\n}"),null==f&&(f=!0),f?(v=null!=n?n:[0,1],s=v[0],r=v[1],E="vec4 alphaFun(vec3 color, float intensity){\\n    float alpha = smoothstep("+s.toFixed(8)+", "+r.toFixed(8)+", intensity);\\n    return vec4(color*alpha, alpha);\\n}"):E="vec4 alphaFun(vec3 color, float intensity){\\n    return vec4(color, 1.0);\\n}",this.shader=new i(this.gl,{vertex:l,fragment:a+("float linstep(float low, float high, float value){\\n    return clamp((value-low)/(high-low), 0.0, 1.0);\\n}\\n\\nfloat fade(float low, float high, float value){\\n    float mid = (low+high)*0.5;\\n    float range = (high-low)*0.5;\\n    float x = 1.0 - clamp(abs(mid-value)/range, 0.0, 1.0);\\n    return smoothstep(0.0, 1.0, x);\\n}\\n\\n"+c+"\\n"+E+"\\n\\nvoid main(){\\n    float intensity = smoothstep(0.0, 1.0, texture2D(source, texcoord).r);\\n    vec3 color = getColor(intensity);\\n    gl_FragColor = alphaFun(color, intensity);\\n}")}),null==this.width&&(this.width=this.canvas.offsetWidth||2),null==this.height&&(this.height=this.canvas.offsetHeight||2),this.canvas.width=this.width,this.canvas.height=this.height,this.gl.viewport(0,0,this.width,this.height),this.quad=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.quad),d=new Float32Array([-1,-1,0,1,1,-1,0,1,-1,1,0,1,-1,1,0,1,1,-1,0,1,1,1,0,1]),this.gl.bufferData(this.gl.ARRAY_BUFFER,d,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.heights=new t(this,this.gl,this.width,this.height)}return e.prototype.adjustSize=function(){var e,t;return t=this.canvas.offsetWidth||2,e=this.canvas.offsetHeight||2,this.width!==t||this.height!==e?(this.gl.viewport(0,0,t,e),this.canvas.width=t,this.canvas.height=e,this.width=t,this.height=e,this.heights.resize(this.width,this.height)):void 0},e.prototype.display=function(){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.heights.nodeFront.bind(0),this.gradientTexture&&this.gradientTexture.bind(1),this.shader.use()["int"]("source",0)["int"]("gradientTexture",1),this.gl.drawArrays(this.gl.TRIANGLES,0,6)},e.prototype.update=function(){return this.heights.update()},e.prototype.clear=function(){return this.heights.clear()},e.prototype.clamp=function(e,t){return null==e&&(e=0),null==t&&(t=1),this.heights.clamp(e,t)},e.prototype.multiply=function(e){return null==e&&(e=.95),this.heights.multiply(e)},e.prototype.blur=function(){return this.heights.blur()},e.prototype.addPoint=function(e,t,r,i){return this.heights.addPoint(e,t,r,i)},e.prototype.addPoints=function(e){var t,r,i,o;for(o=[],r=0,i=e.length;i>r;r++)t=e[r],o.push(this.addPoint(t.x,t.y,t.size,t.intensity));return o},e}(),window.WebGLHeatmap=n}.call(this);');
}var a,r,o,n,n=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var n;!function(n){var s=e.data.DataRoleHelper,l=function(){function n(){this.data=[],this.locationsToLoad=0,this.locationsLoaded=0,this.renderLoopEnabled=!0,this.needsRender=!1}return n.converter=function(e){return{}},n.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;switch(e.objectName){case"dataPoint":this.enumerateDataPoints(i)}return i.complete()},n.prototype.enumerateDataPoints=function(e){var i=this.data;if(i)for(var a=this.dataPointsToEnumerate,r=a.length,o=0;r>o;o++){var n=a[o];e.pushInstance({objectName:"dataPoint",displayName:n.label,selector:t.ColorHelper.normalizeSelector(n.identity.getSelector()),properties:{fill:{solid:{color:n.color}}}})}},n.prototype.init=function(e){this.container=e.element,this.viewport=e.viewport,this.readyToRender=!1,this.globeMapLocationCache||(this.globeMapLocationCache={}),this.style=e.style,this.colors=this.style.colorPalette.dataColors,this.colorHelper=new t.ColorHelper(this.colors,n.Properties.dataPoint.fill),a||i(),a&&this.setup()},n.prototype.setup=function(){this.initSettings(),this.initTextures(),this.initMercartorSphere(),this.initZoomControl(),this.initScene(),this.initHeatmap(),this.readyToRender=!0,this.composeRenderData(),this.initRayCaster()},n.prototype.initSettings=function(){var e=this.settings={};e.autoRotate=!1,e.earthRadius=30,e.cameraRadius=100,e.earthSegments=100,e.heatmapSize=1e3,e.heatPointSize=7,e.heatIntensity=10,e.heatmapScaleOnZoom=.95,e.barWidth=.3,e.barHeight=5,e.rotateSpeed=.5,e.zoomSpeed=.8,e.cameraAnimDuration=1e3,e.clickInterval=200},n.prototype.initScene=function(){var e=this.viewport,t=this.settings,i=new a.Clock,r=this.renderer=new a.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});this.container.append(r.domElement),this.domElement=r.domElement;var o=this.camera=new a.PerspectiveCamera(35,e.width/e.height,.1,1e4),n=this.orbitControls=new a.OrbitControls(o,this.domElement),s=this.scene=new a.Scene;r.setSize(e.width,e.height),r.setClearColor(12240082,1),o.position.z=t.cameraRadius,n.maxDistance=t.cameraRadius,n.minDistance=t.earthRadius+1,n.rotateSpeed=t.rotateSpeed,n.zoomSpeed=t.zoomSpeed,n.autoRotate=t.autoRotate;var l=new a.AmbientLight(0),c=new a.DirectionalLight(16777215,.4),h=new a.DirectionalLight(16777215,.4),u=this.earth=this.createEarth();s.add(l),s.add(c),s.add(h),s.add(u),c.position.set(20,20,20),h.position.set(0,0,-20);var p=this;requestAnimationFrame(function d(){try{if(p.renderLoopEnabled&&requestAnimationFrame(d),!p.shouldRender())return;n.update(i.getDelta()),p.setEarthTexture(),p.intersectBars(),p.heatmap&&p.heatmap.display&&p.heatmap.display(),r.render(s,o),p.needsRender=!1}catch(e){}})},n.prototype.shouldRender=function(){return this.readyToRender&&this.needsRender},n.prototype.createEarth=function(){var e=new n.MercartorSphere(this.settings.earthRadius,this.settings.earthSegments,this.settings.earthSegments),t=new a.MeshPhongMaterial({map:this.mapTextures[0],side:a.DoubleSide,shininess:1,emissive:11184810});return new a.Mesh(e,t)},n.prototype.zoomClicked=function(e){this.orbitControls.enabled!==!1&&this.orbitControls.enableZoom!==!1&&(-1===e?this.orbitControls.constraint.dollyOut(Math.pow(.95,this.settings.zoomSpeed)):1===e&&this.orbitControls.constraint.dollyIn(Math.pow(.95,this.settings.zoomSpeed)),this.orbitControls.update(),this.animateCamera(this.camera.position))},n.prototype.rotateCam=function(e,t){this.orbitControls.enabled!==!1&&this.orbitControls.enableRotate!==!1&&(this.orbitControls.constraint.rotateLeft(2*Math.PI*e/this.domElement.offsetHeight*this.settings.rotateSpeed),this.orbitControls.constraint.rotateUp(2*Math.PI*t/this.domElement.offsetHeight*this.settings.rotateSpeed),this.orbitControls.update(),this.animateCamera(this.camera.position))},n.prototype.initTextures=function(){var e=this;if(!o){o=[];for(var t=2;5>=t;++t){var i=this.getBingMapCanvas(t);o.push(i)}}var r=function(t){var i=new a.Texture(t.get(0));return i.needsUpdate=!0,t.on("ready",function(t,a){i.needsUpdate=!0,e.needsRender=!0}),i};this.mapTextures=[];for(var n=0;n<o.length;++n)this.mapTextures.push(r(o[n]))},n.prototype.initHeatmap=function(){var e=this.settings;try{var t=this.heatmap=new r({width:e.heatmapSize,height:e.heatmapSize,intensityToAlpha:!0})}catch(i){}var o=this.heatTexture=new a.Texture(t.canvas);o.needsUpdate=!0;var n=new a.MeshBasicMaterial({map:o,transparent:!0}),s=new a.SphereGeometry(e.earthRadius+.01,e.earthSegments,e.earthSegments),l=new a.Mesh(s,n);window.heatmap=t,window.heatmapTexture=o,this.scene.add(l)},n.prototype.setEarthTexture=function(){if(this.camera){var e,t=this.settings.cameraRadius-this.settings.earthRadius,i=(this.camera.position.length()-this.settings.earthRadius)/t;e=.2>=i?this.mapTextures[3]:.4>=i?this.mapTextures[2]:.6>=i?this.mapTextures[1]:this.mapTextures[0],this.earth.material.map!==e&&(this.earth.material.map=e),this.selectedBar?this.orbitControls.rotateSpeed=this.settings.rotateSpeed:this.orbitControls.rotateSpeed=this.settings.rotateSpeed*i}},n.prototype.update=function(e){if(this.needsRender=!0,e.viewport.height!==this.viewport.height||e.viewport.width!==this.viewport.width){var t=this.viewport=e.viewport;return void(this.camera&&this.renderer&&(this.camera.aspect=t.width/t.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(t.width,t.height)))}this.cleanHeatAndBar(),e.dataViews[0]&&(e.dataViews[0].categorical||e.dataViews[0].metadata)&&this.composeRenderData(e.dataViews[0].categorical,e.dataViews[0].metadata)},n.prototype.cleanHeatAndBar=function(){this.heatmap.clear(),this.heatTexture.needsUpdate=!0,this.barsGroup&&this.scene.remove(this.barsGroup)},n.prototype.renderMagic=function(){if(!this.readyToRender)return void this.defferedRender();var e=this.data,t=this.heatmap,i=this.settings;t.clear(),this.barsGroup&&this.scene.remove(this.barsGroup),this.barsGroup=new a.Object3D,this.scene.add(this.barsGroup),this.averageBarVector=new a.Vector3;for(var r=0,o=e.length;o>r;++r){var n=e[r];if(n.lat&&n.lng){if(n.heat>.001){n.heat<.1&&(n.heat=.1);var s=(180+n.lng)/360*i.heatmapSize,l=(1-(90+n.lat)/180)*i.heatmapSize;t.addPoint(s,l,i.heatPointSize,n.heat*i.heatIntensity)}if(n.height>=0){n.height<.01&&(n.height=.01);var c=n.lat/180*Math.PI,h=n.lng/180*Math.PI,s=Math.cos(h)*Math.cos(c),u=-Math.sin(h)*Math.cos(c),l=Math.sin(c),p=new a.Vector3(s,l,u);this.averageBarVector.add(p);var d=i.barHeight*n.height,m=[],g=[];if(n.heightBySeries)for(var f=0;f<n.heightBySeries.length;f++)n.heightBySeries[f]&&m.push(n.heightBySeries[f]),g.push(n.seriesToolTipData[f]);else m.push(1);for(var y=0,v=0;v<m.length;v++){y+=m[v];var x=new a.CubeGeometry(i.barWidth,i.barWidth,d*m[v]),E=new a.Mesh(x,this.getBarMaterialByIndex(v));E.position=p.clone().multiplyScalar(i.earthRadius+d/2*y),E.lookAt(p),E.toolTipData=0===g.length?n.toolTipData:this.getToolTipDataForSeries(n.toolTipData,g[v]),this.barsGroup.add(E),y+=m[v]}}}}this.barsGroup.children.length>0&&this.camera&&(this.averageBarVector.multiplyScalar(1/this.barsGroup.children.length),this.locationsLoaded===this.locationsToLoad&&this.animateCamera(this.averageBarVector)),t.update(),t.blur(),this.heatTexture.needsUpdate=!0,this.needsRender=!0},n.prototype.getBarMaterialByIndex=function(e){return new a.MeshPhongMaterial({color:this.dataPointsToEnumerate[e].color})},n.prototype.getToolTipDataForSeries=function(e,t){var i=jQuery.extend(!0,{series:{displayName:t.displayName,value:t.value}},e);return i.height.value=t.dataPointValue,i},n.prototype.createDataPointForEnumeration=function(e,i,a,r){var o=e.values[i].source,n=t.converterHelper.getFormattedLegendLabel(o,e.values,null),s=t.SelectionId.createWithId(e.identity),l=t.converterHelper.getSeriesName(o),c=e.objects&&e.objects.dataPoint?e.objects.dataPoint.fill.solid.color:r&&r.objects?this.colorHelper.getColorForMeasure(r.objects,""):this.colors.getColorByIndex(a).value;return{label:n,identity:s,category:l,color:c,selected:null}},n.prototype.composeRenderData=function(e,i){e?this.categoricalView=e:e=this.categoricalView,this.data=[],this.dataPointsToEnumerate=[];var a=[],r=this.globeMapLocationCache;if(e){var o=0,n=0,l=[];try{e.categories&&(l=e.categories);var c=e.values.grouped();o=s.getMeasureIndexOfRole(c,"Height"),n=s.getMeasureIndexOfRole(c,"Heat");var h=s.getMeasureIndexOfRole(c,"X"),u=s.getMeasureIndexOfRole(c,"Y")}catch(p){}var d,m,g,f,y,v,x,E,b,T,w,S;if(l&&l.length>0&&l[0].values){var R=l[0];a=R.values,E=R.source.displayName,d=R.source.type.category?R.source.type.category.toLowerCase():""}else a=[];if(void 0!==o&&e.values[o]&&void 0!==e.values)if(b=e.values[o].source.displayName,w=e.values[o].source.format,c.length>1){m=new Array(a.length),g=new Array(a.length),f=new Array(a.length),this.dataPointsToEnumerate=new Array(c.length);for(var C=0;C<c.length;C++){var A=c[C].values[o].values;this.dataPointsToEnumerate[C]=this.createDataPointForEnumeration(c[C],o,C);for(var M=0;M<A.length;M++)m[M]||(m[M]=0),m[M]+=A[M]?A[M]:0,g[M]||(g[M]=[]),g[M][C]=A[M],f[M]||(f[M]=[]),f[M][C]={displayName:e.values.source.displayName,value:c[C].name,dataPointValue:A[M]}}for(var C=0;C<c.length;C++)for(var A=c[C].values[o].values,M=0;M<A.length;M++)g[M][C]=A[M]/m[M]}else m=e.values[o].values,g=new Array(c.length),this.dataPointsToEnumerate[0]=this.createDataPointForEnumeration(c[0],o,0,i);else g=new Array(a.length),m=new Array(a.length);if(void 0!==n&&e.values[n]){if(c.length>1){y=new Array(a.length);for(var C=0;C<c.length;C++)for(var A=c[C].values[n].values,M=0;M<A.length;M++)y[M]||(y[M]=0),y[M]+=A[M]?A[M]:0}else y=e.values[n].values;T=e.values[n].source.displayName,S=e.values[n].source.format}else y=new Array(a.length);void 0!==h&&e.values[h]&&void 0!==u&&e.values[u]?(x=e.values[h].values,v=e.values[u].values):(x=null,v=null);for(var H=Math.max.apply(null,m)||1,P=Math.max.apply(null,y)||1,D=t.valueFormatter.create({format:S,value:y[0],value2:y[1]}),_=t.valueFormatter.create({format:w,value:m[0],value2:m[1]}),C=0,L=a.length;L>C;++C){var N,V,z,I,F,O=a[C];if(O&&"string"==typeof O){O=O.toLowerCase();var k=O+"/"+d;!x&&r[k]?(z=r[k],N=z.latitude,V=z.longitude):x&&(N=v[C],V=x[C]),I=m[C]/H,F=y[C]/P;var j={lat:N,lng:V,height:I?I||.01:void 0,heightBySeries:g[C],seriesToolTipData:f?f[C]:void 0,heat:F||0,toolTipData:{location:{displayName:E,value:a[C]},height:{displayName:b,value:_.format(m[C])},heat:{displayName:T,value:D.format(y[C])}}};this.data.push(j),x||z||this.geocodeRenderDatum(j,O,d)}}try{this.renderMagic()}catch(p){}}},n.prototype.geocodeRenderDatum=function(i,a,r){var o=this,n=a+"/"+r;this.globeMapLocationCache[n]={},this.locationsToLoad++;try{var s=e.visuals.BI.Services.GeocodingManager.geocode}catch(l){s=t.services.geocode}s&&s(a,r).always(function(e){o.globeMapLocationCache[n]=e,o.locationsLoaded++,e.latitude&&e.longitude&&(i.lat=e.latitude,i.lng=e.longitude,o.defferedRender())})},n.prototype.defferedRender=function(){var e=this;this.deferredRenderTimerId||(this.deferredRenderTimerId=setTimeout(function(){e.deferredRenderTimerId=null,e.composeRenderData()},500))},n.prototype.initRayCaster=function(){var e=this;this.rayCaster=new a.Raycaster;var t,i=this.settings,r=this.mousePosNormalized=new a.Vector2,o=this.mousePos=new a.Vector2,n=this.container.get(0);$(this.domElement).on("mousemove",function(t){var i=n.getBoundingClientRect();o.x=t.clientX,o.y=t.clientY,r.x=(t.clientX-i.left)/i.width*2-1,r.y=2*-((t.clientY-i.top)/i.height)+1,e.needsRender=!0}).on("mousedown",function(e){t=Date.now()}).on("mouseup",function(a){Date.now()-t>i.clickInterval||(e.hoveredBar&&a.shiftKey?(e.selectedBar=e.hoveredBar,e.animateCamera(e.selectedBar.position,function(){e.selectedBar&&(e.orbitControls.center.copy(e.selectedBar.position.clone().normalize().multiplyScalar(i.earthRadius)),e.orbitControls.minDistance=1)})):e.selectedBar&&(e.animateCamera(e.selectedBar.position,function(){e.orbitControls.center.set(0,0,0),e.orbitControls.minDistance=i.earthRadius+1}),e.selectedBar=null))}).on("mousewheel DOMMouseScroll",function(t){if(e.needsRender=!0,e.orbitControls.enabled&&e.orbitControls.enableZoom){e.heatTexture.needsUpdate=!0,t=t.originalEvent;var i=t.wheelDelta>0||t.detail<0?1:-1,a=i>0?e.settings.heatmapScaleOnZoom:1/e.settings.heatmapScaleOnZoom;e.heatmap.multiply(a),e.heatmap.update()}})},n.prototype.intersectBars=function(){if(this.rayCaster&&this.barsGroup){var e=this.rayCaster;e.setFromCamera(this.mousePosNormalized,this.camera);var i=e.intersectObjects(this.barsGroup.children);if(i&&i.length>0){var a=i[0].object;if(!a||!a.toolTipData)return;var r=a.toolTipData,o=[];r.location.displayName&&o.push(r.location),r.series&&o.push(r.series),r.height.displayName&&o.push(r.height),r.heat.displayName&&o.push(r.heat),this.hoveredBar=a,t.TooltipManager.ToolTipInstance.show(o,{x:this.mousePos.x,y:this.mousePos.y,width:0,height:0})}else this.hoveredBar=null,t.TooltipManager.ToolTipInstance.hide()}},n.prototype.animateCamera=function(e,t){var i=this;if(this.camera){var r=Date.now(),o=this.settings.cameraAnimDuration,n=r+o,s=this.camera.position.clone().normalize(),l=e.clone().normalize(),c=this.camera.position.length(),h=function(e){return e*=2,1>e?e*e*e/2:(e-=2,(e*e*e+2)/2)},u=function(){var e=Date.now(),p=(e-r)/o;p>1&&(p=1),p=h(p);var d=(new a.Vector3).add(s.clone().multiplyScalar(1-p)).add(l.clone().multiplyScalar(p)).normalize().multiplyScalar(c);i.camera.position=d,n>e?requestAnimationFrame(u):t&&t(),i.needsRender=!0};requestAnimationFrame(u)}},n.prototype.destroy=function(){if(clearTimeout(this.deferredRenderTimerId),this.renderLoopEnabled=!1,this.scene=null,this.heatmap=null,this.heatTexture=null,this.camera=null,this.renderer){if(this.renderer.context){var e=this.renderer.context.getExtension("WEBGL_lose_context");e&&e.loseContext(),this.renderer.context=null}this.renderer.domElement=null}this.renderer=null,this.data=null,this.barsGroup=null,this.orbitControls&&this.orbitControls.dispose(),this.orbitControls=null,this.domElement&&$(this.domElement).off("mousemove mouseup mousedown mousewheel DOMMouseScroll"),this.domElement=null,this.container&&this.container.empty()},n.prototype.initZoomControl=function(){var e=this,t=17,i=8.5*t,a=8.5*t,r=3*t,o=t+3,n=2*t,s={position:"absolute",left:"calc(100% - "+i+"px)",top:"calc(100% - "+a+"px)",zIndex:"1000"},l=d3.select(this.container[0]).append("div").style(s);this.zoomControl=l.append("svg").attr({width:i,height:a});var c=this.zoomControl.append("g").on("click",function(){return e.rotateCam(0,-5)});c.append("circle").attr({cx:r+n,cy:o+2*n,r:t,fill:"white",opacity:.5,stroke:"gray"}),c.append("path").attr({d:"M"+(r+2*t)+" "+(o+4.7*t)+" l12 -20 a40,70 0 0,1 -24,0z",fill:"gray"});var h=this.zoomControl.append("g").on("click",function(){return e.rotateCam(5,0)});h.append("circle").attr({cx:r,cy:o+n,r:t,fill:"white",stroke:"gray",opacity:.5}),h.append("path").attr({d:"M"+(r-t/1.5)+" "+(o+2*t)+" l20 -12 a70,40 0 0,0 0,24z",fill:"gray"});var u=this.zoomControl.append("g").on("click",function(){return e.rotateCam(0,5)});u.append("circle").attr({cx:r+n,cy:o,r:t,fill:"white",stroke:"gray",opacity:.5}),u.append("path").attr({d:"M"+(r+2*t)+" "+(o-t/1.5)+" l12 20 a40,70 0 0,0 -24,0z",fill:"gray"});var p=this.zoomControl.append("g").on("click",function(){return e.rotateCam(-5,0)});p.append("circle").attr({cx:r+2*n,cy:o+n,r:t,fill:"white",stroke:"gray",opacity:.5}),p.append("path").attr({d:"M"+(r+4.7*t)+" "+(o+2*t)+" l-20 -12 a70,40 0 0,1 0,24z",fill:"gray"});var d=this.zoomControl.append("g").on("click",function(){return e.zoomClicked(-1)});d.append("circle").attr({cx:r+4*t,cy:o+6*t,r:t,fill:"white",stroke:"gray",opacity:.5}),d.append("rect").attr({x:r+3.5*t,y:o+5.9*t,width:t,height:t/3,fill:"gray"}),d.append("rect").attr({x:r+4*t-t/6,y:o+5.55*t,width:t/3,height:t,fill:"gray"});var m=this.zoomControl.append("g").on("click",function(){return e.zoomClicked(1)});m.append("circle").attr({cx:r,cy:o+6*t,r:t,fill:"white",stroke:"gray",opacity:"0.50"}),m.append("rect").attr({x:r-t/2,y:o+5.9*t,width:t,height:t/3,fill:"gray"})},n.prototype.initMercartorSphere=function(){if(!n.MercartorSphere){var e=function(e,t,i){function r(e,t,i){return(1-i)*e+i*t}function o(e,t,i){var o=2*Math.PI,n=Math.PI,s=this.radius,l=-s*Math.cos(e*o)*Math.sin(t*n),c=-s*Math.cos(t*n),h=s*Math.sin(e*o)*Math.sin(t*n),u=e*s*2-s,p=t*s*2-s,d=0,m=r(l,u,i),g=r(c,p,i),f=r(h,d,i);return new a.Vector3(m,g,f)}function n(e,t,i){var r=90*(t-.5)*2/180*Math.PI,o=Math.sin(r),n=.5+.25*Math.log((1+o)/(1-o))/Math.PI;return new a.Vector2(e,n)}a.Geometry.call(this),this.radius=e,this.widthSegments=t,this.heightSegments=i,this.t=0;var s,l,c=[],h=[];for(l=0;i>=l;l++){var u=[],p=[];for(s=0;t>=s;s++){var d=s/t,m=l/i;this.vertices.push(o.call(this,d,m,this.t)),p.push(n.call(this,d,m,this.t)),u.push(this.vertices.length-1)}c.push(u),h.push(p)}for(l=0;l<this.heightSegments;l++)for(s=0;s<this.widthSegments;s++){var g=c[l][s+1],f=c[l][s],y=c[l+1][s],v=c[l+1][s+1],x=this.vertices[g].clone().normalize(),E=this.vertices[f].clone().normalize(),b=this.vertices[y].clone().normalize(),T=this.vertices[v].clone().normalize(),w=h[l][s+1].clone(),S=h[l][s].clone(),R=h[l+1][s].clone(),C=h[l+1][s+1].clone(),A=[x,E,b,T];this.faces.push(new a.Face4(g,f,y,v,A)),this.faceVertexUvs[0].push([w,S,R,C])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new a.Sphere(new a.Vector3,e)};e.prototype=Object.create(a.Geometry.prototype),n.MercartorSphere=e}},n.prototype.getBingMapCanvas=function(e){function t(a,r){e>=a&&(a===e&&i(r),t(a+1,r+"0"),t(a+1,r+"1"),t(a+1,r+"2"),t(a+1,r+"3"))}function i(t){var i="https://t{server}.tiles.virtualearth.net/tiles/r{quad}.jpeg?g=0&mkt={language}",o=7,l=Math.round(Math.random()*o),h=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language,p=i.replace("{server}",l).replace("{quad}",t).replace("{language}",h),d=a(t),m=new Image;m.onload=function(){s++,u.drawImage(m,d.x*r,d.y*r,r,r),s===n&&c.trigger("ready",e)},m.crossOrigin="",m.src=p}function a(e){for(var t=0,i=0,a=e.length-1,r=a;r>=0;r--){var o=e.charAt(r),n=Math.pow(2,a-r);"1"===o?t+=n:"2"===o?i+=n:"3"===o&&(t+=n,i+=n)}return{x:t,y:i}}var r=256,o=Math.pow(2,e),n=o*o,s=0,l=r*o,c=$("<canvas/>").attr({width:l,height:l}),h=c.get(0),u=h.getContext("2d");return t(0,""),c},n.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Location"),preferredTypes:[{geography:{address:!0}},{geography:{city:!0}},{geography:{continent:!0}},{geography:{country:!0}},{geography:{county:!0}},{geography:{place:!0}},{geography:{postalCode:!0}},{geography:{region:!0}},{geography:{stateOrProvince:!0}}]},{name:"Series",kind:e.VisualDataRoleKind.Grouping,displayName:"Legend"},{name:"X",kind:e.VisualDataRoleKind.Measure,displayName:"Longitude",description:"Use to override the longitude of locations",preferredTypes:[{geography:{longitude:!0}}]},{name:"Y",kind:e.VisualDataRoleKind.Measure,displayName:"Latitude",description:"Use to override the latitude of locations",preferredTypes:[{geography:{latitude:!0}}]},{name:"Height",kind:e.VisualDataRoleKind.Measure,displayName:"Bar Height"},{name:"Heat",kind:e.VisualDataRoleKind.Measure,displayName:"Heat Intensity"}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},legend:{displayName:e.data.createDisplayNameGetter("Visual_Legend"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_LegendPosition"),type:{formatting:{legendPosition:!0}}},showTitle:{displayName:e.data.createDisplayNameGetter("Visual_LegendShowTitle"),type:{bool:!0}},titleText:{displayName:e.data.createDisplayNameGetter("Visual_LegendTitleText"),type:{text:!0}}}},dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),properties:{defaultColor:{displayName:e.data.createDisplayNameGetter("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint_Show_All"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fillRule:{displayName:e.data.createDisplayNameGetter("Visual_Gradient"),type:{fillRule:{}},rule:{inputRole:"Gradient",output:{property:"fill",selector:["Category"]}}}}},categoryLabels:{displayName:e.data.createDisplayNameGetter("Visual_CategoryLabels"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),type:{fill:{solid:{color:!0}}}}}}},dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:1},Height:{max:1},Heat:{max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{bind:{to:"Height"}},{bind:{to:"Heat"}},{bind:{to:"X"}},{bind:{to:"Y"}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:2}}}}],sorting:{custom:{}}},n.Properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}}},n}();n.GlobeMap=l}(n=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(n||(n={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=a.CssConstants.createClassAndSelector,o=a.PixelConverter,n=function(){function e(){}return e.prototype.bindEvents=function(e,t){var i=this.selection=e.selection,a=e.clearCatcher;i.on("click",function(e){t.handleSelection(e,d3.event.ctrlKey),d3.event.stopPropagation()}),a.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){this.selection.style("opacity",function(t){return e&&!t.selected?s.DimmedAreaFillOpacity:s.NodeFillOpacity})},e}();i.RadarChartWebBehavior=n;var s=function(){function i(e){e&&(e.svg&&(this.svg=e.svg),e.animator&&(this.animator=e.animator),e.margin&&(this.margin=e.margin))}return i.converter=function(e,r){if(!(e&&e.categorical&&e.categorical.categories&&e.categorical.categories.length>0&&e.categorical.categories[0]&&e.categorical.values&&e.categorical.values.length>0&&r))return{legendData:{dataPoints:[]},settings:{showLegend:!0},series:[],dataLabelsSettings:t.dataLabelUtils.getDefaultPointLabelSettings()};for(var o=e.categorical,n=o.values,s=o&&o.values?o.values.grouped():null,l=[],c=new t.ColorHelper(r,i.Properties.dataPoint.fill),h={fontSize:8.25,dataPoints:[],title:""},u=i.parseSettings(e),p=i.parseLabelSettings(e),d=0,m=n.length;m>d;d++){var g,f,y,v=r.getColorByIndex(d).value,x=[],E=s&&s.length>d&&s[d].values?s[d]:null;if(n[d].source){var b=n[d].source;if(b.queryName&&(f=b.queryName,g=t.SelectionId.createWithMeasure(f)),b.displayName&&(y=b.displayName),b.objects){var T=b.objects;v=c.getColorForMeasure(T,f)}}h.dataPoints.push({label:y,color:v,icon:t.LegendIcon.Box,selected:!1,identity:g});for(var w=0,S=n[d].values.length;S>w;w++){var R=t.SelectionIdBuilder.builder().withMeasure(f).withCategory(o.categories[0],w).withSeries(e.categorical.values,E).createSelectionId(),C=t.TooltipBuilder.createTooltipInfo(i.formatStringProp,o,o.categories[0].values[w],n[d].values[w],null,null,d),A=t.valueFormatter.getFormatString(o.values[d].source,i.formatStringProp),M=a.PixelConverter.fromPoint(p.fontSize);x.push({x:w,y:n[d].values[w],color:v,identity:R,selected:!1,tooltipInfo:C,value:n[d].values[w],labelFormatString:A,labelFontSize:M})}x.length>0&&l.push({fill:v,name:y,data:x,identity:g})}return{legendData:h,settings:u,series:l,dataLabelsSettings:p}},i.prototype.init=function(e){var a=e.element;this.svg||(this.svg=d3.select(a.get(0)).append("svg"),this.svg.style("position","absolute")),this.margin||(this.margin=i.DefaultMargin),this.svg.classed(i.VisualClassName,!0),this.interactivityService=t.createInteractivityService(e.host),this.isInteractiveChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.legend=t.createLegend(a,this.isInteractiveChart,this.interactivityService,!0,t.LegendPosition.Top),this.colors=e.style.colorPalette.dataColors,this.mainGroupElement=this.svg.append("g"),this.segments=this.mainGroupElement.append("g").classed(i.Segments["class"],!0),this.zeroSegment=this.mainGroupElement.append("g").classed(i.ZeroSegment["class"],!0),this.axis=this.mainGroupElement.append("g").classed(i.Axis["class"],!0),this.chart=this.mainGroupElement.append("g").classed(i.Chart["class"],!0)},i.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){var a=e.dataViews[0];this.radarChartData=i.converter(a,this.colors);var r,o=[],n=this.radarChartData.series,s=t.AnimatorCommon.GetAnimationDuration(this.animator,e.suppressAnimations);a.categorical&&a.categorical.categories&&a.categorical.categories[0]&&a.categorical.categories[0].values&&(o=a.categorical.categories[0].values),a.metadata&&a.metadata.columns&&a.metadata.columns.length>0&&(r=a.metadata.columns[0]),this.viewport={height:e.viewport.height>0?e.viewport.height:0,width:e.viewport.width>0?e.viewport.width:0},this.parseLegendProperties(a),this.renderLegend(this.radarChartData),this.updateViewport(),this.svg.attr({height:this.viewport.height,width:this.viewport.width});var l=this.mainGroupElement;l.attr("transform",t.SVGUtil.translate(this.viewport.width/2,this.viewport.height/2));var c=this.viewport.width-this.margin.left-this.margin.right,h=this.viewport.height-this.margin.top-this.margin.bottom;this.angle=i.Radians/o.length,this.radius=i.SegmentFactor*i.Scale*Math.min(c,h)/2,this.drawCircularSegments(o),this.drawAxes(o),this.drawAxesLabels(o,r),this.drawChart(n,s),this.drawDataLabels(n),this.drawZeroCircularSegment(o),0!==this.zeroPointRadius?this.drawZeroLabel():this.mainGroupElement.selectAll(i.ZeroLabel.selector).remove()}},i.prototype.getRadarChartLabelLayout=function(e,i){var a=t.dataLabelUtils.createColumnFormatterCacheManager(),r=this.angle,n=this.viewport,s=this.viewport.height/2,l=this.viewport.width/2,c=this.calculateChartDomain(this.radarChartData.series);return{labelText:function(r){var o=a.getOrCreate(r.labelFormatString,e);if(0===e.displayUnits){var s=_.max(i,function(e){return e.value}),l=s.value>0?s.value:0;o=a.getOrCreate(r.labelFormatString,e,l)}return t.dataLabelUtils.getLabelFormattedText({label:o.format(r.value),maxWidth:n.width,fontSize:e.fontSize})},labelLayout:{x:function(e){return-1*c(e.y)*Math.sin(e.x*r)+l},y:function(e){return-1*c(e.y)*Math.cos(e.x*r)+s-7}},filter:function(e){return null!=e&&null!=e.value},style:{fill:e.labelColor,"font-size":function(t){return o.fromPoint(e.fontSize)}}}},i.prototype.drawCircularSegments=function(e){for(var a=[],r=this.angle,o=i.SegmentFactor,n=i.SegmentLevels,s=this.radius,l=0;n-1>l;l++)for(var c=s*((l+1)/n),h=-1*c,u=0;u<e.length;u++)a.push({x1:c*(1-o*Math.sin(u*r)),y1:c*(1-o*Math.cos(u*r)),x2:c*(1-o*Math.sin((u+1)*r)),y2:c*(1-o*Math.cos((u+1)*r)),translate:t.SVGUtil.translate(h,h)});var p=this.mainGroupElement.select(i.Segments.selector).selectAll(i.SegmentNode.selector).data(a);p.enter().append("svg:line").classed(i.SegmentNode["class"],!0),p.attr({x1:function(e){return e.x1},y1:function(e){return e.y1},x2:function(e){return e.x2},y2:function(e){return e.y2},transform:function(e){return e.translate}}),p.exit().remove()},i.prototype.drawDataLabels=function(e){var i=this.getAllDataPointsList(e);if(this.radarChartData.dataLabelsSettings.show){var a=this.getRadarChartLabelLayout(this.radarChartData.dataLabelsSettings,i),r=this.viewport,o=t.dataLabelUtils.drawDefaultLabelsForDataPointChart(i,this.mainGroupElement,a,r);o.attr("transform",t.SVGUtil.translate(-(r.width/2),-(r.height/2)))}else t.dataLabelUtils.cleanDataLabels(this.mainGroupElement)},i.prototype.drawAxes=function(e){var t=this.angle,a=-1*this.radius,r=this.mainGroupElement.select(i.Axis.selector).selectAll(i.AxisNode.selector),o=r.data(e);o.enter().append("svg:line"),o.attr({x1:0,y1:0,x2:function(e,i){return a*Math.sin(i*t)},y2:function(e,i){return a*Math.cos(i*t)}}).classed(i.AxisNode["class"],!0),o.exit().remove()},i.prototype.drawAxesLabels=function(a,r){var o=this,n=this.angle,s=-1*this.radius,l=a.length,c=t.valueFormatter.create({format:t.valueFormatter.getFormatString(r,i.formatStringProp,!0),value:a[0],value2:a[l-1]}),h=this.mainGroupElement.select(i.Axis.selector).selectAll(i.AxisLabel.selector),u=h.data(a);u.enter().append("svg:text"),u.attr({"text-anchor":"middle",dy:"1.5em",transform:t.SVGUtil.translate(0,-10),x:function(e,t){return(s-30)*Math.sin(t*n)},y:function(e,t){return(s-20)*Math.cos(t*n)}}).text(function(t){var a={fontFamily:i.AxesLabelsFontFamily,fontSize:i.AxesLabelsfontSize,text:c.format(t)};return e.TextMeasurementService.getTailoredTextOrDefault(a,Math.min(i.AxesLabelsMaxWidth,o.viewport.width))}).classed(i.AxisLabel["class"],!0),u.exit().remove()},i.prototype.drawChart=function(e,a){var r=this.angle,o=5,s=this.getDataPoints(e),l=d3.layout.stack(),c=l(s),h=this.calculateChartDomain(e),u=function(e){return e.map(function(e){var t=-1*h(e.y)*Math.sin(e.x*r),i=-1*h(e.y)*Math.cos(e.x*r);return t+","+i}).join(" ")},p=this.chart.selectAll(i.ChartArea.selector).data(c);p.enter().append("g").classed(i.ChartArea["class"],!0);var d=p.selectAll(i.ChartPolygon.selector).data(function(e){return e&&e.length>0?[e]:[]});d.enter().append("polygon").classed(i.ChartPolygon["class"],!0),d.style("fill",function(e){return e[0].color}).style("opacity",i.DimmedAreaFillOpacity).on("mouseover",function(e){d3.select(this).transition().duration(a).style("opacity",i.AreaFillOpacity)}).on("mouseout",function(e){d3.select(this).transition().duration(a).style("opacity",i.DimmedAreaFillOpacity)}).attr("points",u),d.exit().remove(),p.exit().remove();var m=this.chart.selectAll(i.ChartNode.selector).data(c);m.enter().append("g").classed(i.ChartNode["class"],!0);var g=m.selectAll(i.ChartDot.selector).data(function(e){return e.filter(function(e){return null!=e.y})});g.enter().append("svg:circle").classed(i.ChartDot["class"],!0),g.attr("r",o).attr({cx:function(e){return-1*h(e.y)*Math.sin(e.x*r)},cy:function(e){return-1*h(e.y)*Math.cos(e.x*r)}}).style("fill",function(e){return e.color}),g.exit().remove(),t.TooltipManager.addTooltip(g,function(e){return e.data.tooltipInfo},!0),m.exit().remove();var f=void 0;if(this.interactivityService){var y=this.getAllDataPointsList(e);f={selection:g,clearCatcher:this.svg},this.interactivityService.bind(y,new n,f)}},i.prototype.calculateChartDomain=function(e){var t=this.radius,i=this.getAllDataPointsList(e),a=d3.min(i,function(e){return e.y}),r=d3.max(i,function(e){return e.y});this.isPercentChart(i)&&(a=a>=0?0:-1,r=0>=r?0:1);var o=d3.scale.linear().domain([a,r]).range([0,t]);return this.zeroPointRadius=0>a&&r>0?o(0):0,o},i.prototype.renderLegend=function(e){if(e.legendData){var i=e.legendData;if(this.legendObjectProperties){t.LegendData.update(i,this.legendObjectProperties);var a=this.legendObjectProperties[t.legendProps.position];a&&this.legend.changeOrientation(t.LegendPosition[a])}else this.legend.changeOrientation(t.LegendPosition.Top);var r=this.viewport;this.legend.drawLegend(i,{height:r.height,width:r.width}),t.Legend.positionChartArea(this.svg,this.legend)}},i.prototype.drawZeroCircularSegment=function(e){for(var a=[],r=this.angle,o=i.SegmentFactor,n=this.zeroPointRadius,s=-1*n,l=0;l<e.length;l++)a.push({x1:n*(1-o*Math.sin(l*r)),y1:n*(1-o*Math.cos(l*r)),x2:n*(1-o*Math.sin((l+1)*r)),y2:n*(1-o*Math.cos((l+1)*r)),translate:t.SVGUtil.translate(s,s)});var c=this.mainGroupElement.select(i.ZeroSegment.selector).selectAll(i.ZeroSegmentNode.selector).data(a);c.enter().append("svg:line").classed(i.ZeroSegmentNode["class"],!0),c.attr({x1:function(e){return e.x1},y1:function(e){return e.y1},x2:function(e){return e.x2},y2:function(e){return e.y2},transform:function(e){return e.translate;
}}),c.exit().remove()},i.prototype.drawZeroLabel=function(){var e=[];e.push({x:this.zeroPointRadius*(1-i.SegmentFactor)+5,y:-1*this.zeroPointRadius});var t=this.mainGroupElement.select(i.ZeroSegment.selector).selectAll(i.ZeroLabel.selector).data(e);t.enter().append("text").classed(i.ZeroLabel["class"],!0).text("0"),t.attr({x:function(e){return e.x},y:function(e){return e.y}})},i.prototype.getDataPoints=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].data);return t},i.prototype.getAllDataPointsList=function(e){for(var t=[],i=0;i<e.length;i++)t=t.concat(e[i].data);return t},i.prototype.isPercentChart=function(e){for(var t=0;t<e.length;t++)if(-1===e[t].labelFormatString.indexOf("%"))return!1;return!0},i.prototype.parseLegendProperties=function(t){return t&&t.metadata?void(this.legendObjectProperties=e.DataViewObjects.getObject(t.metadata.objects,"legend",{})):void(this.legendObjectProperties={})},i.parseSettings=function(t){var a;return a=t&&t.metadata&&t.metadata.columns&&t.metadata.objects?t.metadata.objects:null,{showLegend:e.DataViewObjects.getValue(a,i.Properties.legend.show,!0)}},i.parseLabelSettings=function(a){var r;r=a&&a.metadata&&a.metadata.objects?a.metadata.objects:null;var o=t.dataLabelUtils.getDefaultPointLabelSettings(),n={show:e.DataViewObjects.getValue(r,i.Properties.labels.show,o.show),labelColor:e.DataViewObjects.getFillColor(r,i.Properties.labels.color,o.labelColor),displayUnits:e.DataViewObjects.getValue(r,i.Properties.labels.displayUnits,o.displayUnits),precision:e.DataViewObjects.getValue(r,i.Properties.labels.precision,o.precision),fontSize:e.DataViewObjects.getValue(r,i.Properties.labels.fontSize,o.fontSize),position:o.position};return n},i.prototype.enumerateObjectInstances=function(e){var i,a=new t.ObjectEnumerationBuilder;if(!this.radarChartData||!this.radarChartData.settings)return[];switch(i=this.radarChartData.settings,e.objectName){case"legend":a.pushInstance(this.enumerateLegend(i));break;case"dataPoint":this.enumerateDataPoint(a);break;case"labels":this.enumerateDataLabels(a)}return a.complete()},i.prototype.getLabelSettingsOptions=function(e,t){return{enumeration:e,dataLabelsSettings:t,show:!0,displayUnits:!0,precision:!0,fontSize:!0}},i.prototype.enumerateDataLabels=function(e){var i=this.radarChartData.dataLabelsSettings;t.dataLabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,i))},i.prototype.enumerateLegend=function(i){var a,r,o=!0,n="",s=8;return o=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.showTitle,o),n=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.titleText,n),r=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.labelColor,r),s=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.fontSize,s),a={objectName:"legend",displayName:"legend",selector:null,properties:{show:i.showLegend,position:t.LegendPosition[this.legend.getOrientation()],showTitle:o,titleText:n,labelColor:r,fontSize:s}}},i.prototype.enumerateDataPoint=function(e){if(this.radarChartData&&this.radarChartData.series)for(var i=this.radarChartData.series,a=0;a<i.length;a++){var r=i[a];e.pushInstance({objectName:"dataPoint",displayName:r.name,selector:t.ColorHelper.normalizeSelector(r.identity.getSelector(),!1),properties:{fill:{solid:{color:r.fill}}}})}},i.prototype.updateViewport=function(){var e,i=this.legend.getMargins();switch(e=t.LegendPosition[this.legendObjectProperties[t.legendProps.position]]){case t.LegendPosition.Top:case t.LegendPosition.TopCenter:case t.LegendPosition.Bottom:case t.LegendPosition.BottomCenter:this.viewport.height-=i.height;break;case t.LegendPosition.Left:case t.LegendPosition.LeftCenter:case t.LegendPosition.Right:case t.LegendPosition.RightCenter:this.viewport.width-=i.width}},i.capabilities={dataRoles:[{displayName:"Category",name:"Category",kind:e.VisualDataRoleKind.Grouping},{displayName:"Y Axis",name:"Y",kind:e.VisualDataRoleKind.Measure}],dataViewMappings:[{conditions:[{Category:{min:1,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:"Y"}}]}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},legend:{displayName:e.data.createDisplayNameGetter("Visual_Legend"),description:e.data.createDisplayNameGetter("Visual_LegendDescription"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_LegendPosition"),description:e.data.createDisplayNameGetter("Visual_LegendPositionDescription"),type:{enumeration:t.legendPosition.type}},showTitle:{displayName:e.data.createDisplayNameGetter("Visual_LegendShowTitle"),description:e.data.createDisplayNameGetter("Visual_LegendShowTitleDescription"),type:{bool:!0}},titleText:{displayName:e.data.createDisplayNameGetter("Visual_LegendName"),description:e.data.createDisplayNameGetter("Visual_LegendNameDescription"),type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:e.data.createDisplayNameGetter("Visual_LegendTitleColor"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),description:e.data.createDisplayNameGetter("Visual_DataPointDescription"),properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}},labels:{displayName:e.data.createDisplayNameGetter("Visual_DataPointsLabels"),description:e.data.createDisplayNameGetter("Visual_DataPointsLabelsDescription"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),description:e.data.createDisplayNameGetter("Visual_LabelsFillDescription"),type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:e.data.createDisplayNameGetter("Visual_DisplayUnits"),description:e.data.createDisplayNameGetter("Visual_DisplayUnitsDescription"),type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},labelPrecision:{displayName:e.data.createDisplayNameGetter("Visual_Precision"),description:e.data.createDisplayNameGetter("Visual_PrecisionDescription"),placeHolderText:e.data.createDisplayNameGetter("Visual_Precision_Auto"),type:{numeric:!0},suppressFormatPainterCopy:!0},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}}}},i.formatStringProp={objectName:"general",propertyName:"formatString"},i.Properties={legend:{show:{objectName:"legend",propertyName:"show"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},displayUnits:{objectName:"labels",propertyName:"labelDisplayUnits"},precision:{objectName:"labels",propertyName:"labelPrecision"},fontSize:{objectName:"labels",propertyName:"fontSize"}}},i.VisualClassName="radarChart",i.Segments=r("segments"),i.SegmentNode=r("segmentNode"),i.ZeroSegment=r("zeroSegment"),i.ZeroSegmentNode=r("zeroSegmentNode"),i.ZeroLabel=r("zeroLabel"),i.Axis=r("axis"),i.AxisNode=r("axisNode"),i.AxisLabel=r("axisLabel"),i.Chart=r("chart"),i.ChartNode=r("chartNode"),i.ChartArea=r("chartArea"),i.ChartPolygon=r("chartPolygon"),i.ChartDot=r("chartDot"),i.DefaultMargin={top:50,bottom:50,right:100,left:100},i.SegmentLevels=6,i.SegmentFactor=1,i.Radians=2*Math.PI,i.Scale=1,i.NodeFillOpacity=1,i.AreaFillOpacity=.6,i.DimmedAreaFillOpacity=.4,i.AxesLabelsFontFamily="sans-serif",i.AxesLabelsfontSize="11px",i.AxesLabelsMaxWidth=200,i}();i.RadarChart=s}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=a.CssConstants.createClassAndSelector,o=e.visuals.axisScale,n=e.data.DataRoleHelper,s=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.selection=e.selection,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.selection.on("click",function(e){t.handleSelection(e,d3.event.ctrlKey)}),this.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){this.selection.style("fill-opacity",function(i){return e&&!i.selected?t.LineChart.DimmedAreaFillOpacity:t.LineChart.AreaFillOpacity})},e}(),l=function(){function i(e){this.scaleType=o.linear,e&&(this.animator=e.animator),this.margin=i.DefaultMargin}return i.prototype.init=function(e){var a=e.element;this.colors=e.style.colorPalette.dataColors,this.behavior=new s;var r=e.interactivity;this.interactivityService=t.createInteractivityService(e.host),this.svg=d3.select(a.get(0)).append("svg").classed(i.VisualClassName,!0),this.clearCatcher=t.appendClearCatcher(this.svg),this.chart=this.svg.append("g").classed(i.Chart["class"],!0),this.axis=this.svg.append("g").classed(i.Axis["class"],!0),this.axisX=this.axis.append("g").classed(i.Axis["class"],!0),this.axisY=this.axis.append("g").classed(i.Axis["class"],!0),this.legend=t.createLegend(a,r&&r.isInteractiveLegend,this.interactivityService,!0)},i.prototype.isSizeAvailable=function(e){return!(e.height<i.DefaultViewport.height||e.width<i.DefaultViewport.width)},i.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){var i=e.dataViews[0];if(!(i&&i.categorical&&i.categorical.values&&i.categorical.values[0]&&i.categorical.values[0].values&&this.isSizeAvailable(e.viewport)))return void this.clearChart();if(this.cartesianMinOrdinalRectThickness=t.CartesianChart.MinOrdinalRectThickness,this.setSize(e.viewport),this.setData(e.dataViews),!this.data)return void this.clearChart();this.calculateAxesProperties(),this.render(e.suppressAnimations),t.CartesianChart.MinOrdinalRectThickness=this.cartesianMinOrdinalRectThickness}},i.getColor=function(e,t,i,a,r,o){var n;return t?a&&a[r]&&(n=a[r].objects):i[r]&&(n=i[r].source.objects),t&&o?e.getColorForSeriesValue(n,i.identityFields,o.name):e.getColorForMeasure(n,i[r].source.queryName)},i.prototype.setData=function(a){if(this.data={series:[],axesLabels:{x:null,y:null},hasDynamicSeries:!1,categories:[],categoryMetadata:void 0,lowerMeasureIndex:void 0,upperMeasureIndex:void 0},a.length>0){var r=a[0];if(r&&r.categorical){var o=this.dataViewCat=r.categorical,n=o.categories,s=e.ValueType.fromDescriptor({text:!0});n&&n.length>0&&n[0].source&&n[0].source.type&&(s=n[0].source.type);var l=i.properties.general.formatString;this.data=i.converter(r,t.valueFormatter.format(null),this.colors,t.CartesianChart.getIsScalar(r.metadata?r.metadata.objects:null,l,s),this.interactivityService)}}},i.converter=function(a,r,o,s,l){var c=a.categorical,h=c.categories&&c.categories.length>0?c.categories[0]:{source:void 0,values:[r],identity:void 0},u="";0!==h.values.length&&(u=h.values.reduce(function(e,t){return e&&t?e.length>t.length?e:t:e?e:t?t:r}));var p={text:u,fontFamily:i.defaultTextProperties.fontFamily,fontSize:i.defaultTextProperties.fontSize},d=e.TextMeasurementService.measureSvgTextWidth(p);t.CartesianChart.MinOrdinalRectThickness=d+4;var m=t.CartesianHelper.getCategoryAxisProperties(a.metadata);s=t.CartesianHelper.isScalar(s,m),c=t.ColumnUtil.applyUserMinMax(s,c,m);var g,f=i.properties.general.formatString,y=t.AxisHelper.getCategoryValueType(h.source,s),v=t.AxisHelper.isDateTime(y),x=h.values,E=[],b=c.values?c.values.length:0,T=!(!c.values||!c.values.source),w=c.values;if(a.metadata&&a.metadata.objects){var S=a.metadata.objects;g=e.DataViewObjects.getFillColor(S,t.lineChartProps.dataPoint.defaultColor)}var R=i.parseSettings(a);if(R){var C,A=new t.ColorHelper(o,t.lineChartProps.dataPoint.fill,g);w&&(C=w.grouped());var M=n.getMeasureIndexOfRole(C,i.RoleNames.Lower),H=n.getMeasureIndexOfRole(C,i.RoleNames.Upper);if(!(0>M||0>H)){b=C.length;for(var P=t.valueFormatter.create({format:"0",value:1e6}),D=0;b>D;D++){for(var _=c.values[D],L=[],N=C[D],V=T&&N?t.SelectionId.createWithIdAndMeasure(N.identity,_.source.queryName):t.SelectionId.createWithMeasure(_.source.queryName),z=V.getKey(),I=i.getColor(A,T,w,C,D,N),F=N.values[M],O=N.values[H],k=0,j=_.values.length;j>k;k++){var B=x[k],G=t.AxisHelper.normalizeNonFiniteNumber(_.values[k]);if(!s||null!==B&&null!==G){var U=F.values[k],W=O.values[k],X=null!=U&&String(U).length>=6?P.format(U):U,Y=null!=W&&String(W).length>=6?P.format(W):W,K=[{value:X,metadata:F},{value:Y,metadata:O}],q=t.TooltipBuilder.createTooltipInfo(f,c,B,G,null,K,D,k);L.push({categoryValue:v&&B?B.getTime():B,value:G,categoryIndex:k,seriesIndex:D,tooltipInfo:q,selected:!1,identity:V,key:JSON.stringify({ser:z,catIdx:k}),y0:U,y1:W,pointColor:I})}}l&&l.applySelectionStateToData(L),L.length>0&&E.push({displayName:C[D].name,key:z,lineIndex:D,color:I,xCol:h.source,yCol:_.source,data:L,identity:V,selected:!1})}m=t.CartesianHelper.getCategoryAxisProperties(a.metadata);var Z=t.CartesianHelper.getValueAxisProperties(a.metadata),Q=[];if(w)for(var J=0,$=w;J<$.length;J++){var G=$[J];G&&G.source&&G.source.displayName&&Q.push({displayName:G.source.displayName})}var ee=t.converterHelper.createAxesLabels(m,Z,h.source,Q);return l&&l.applySelectionStateToData(E),{series:E,isScalar:s,axesLabels:{x:ee.xAxisLabel,y:ee.yAxisLabel},hasDynamicSeries:T,categoryMetadata:h.source,categories:x,lowerMeasureIndex:M,upperMeasureIndex:H,settings:R}}}},i.prototype.clearChart=function(){this.chart.selectAll("*").remove(),this.axisY.selectAll("*").remove(),this.axisX.selectAll("*").remove()},i.prototype.render=function(e){var i,a=t.AnimatorCommon.GetAnimationDuration(this.animator,e),r=this.data;this.renderAxis(r,a),this.renderChart(r,a);var o=this.createLegendDataPoints(0);r.settings&&r.settings.legend&&(t.LegendData.update(o,r.settings.legend),this.legend.changeOrientation(r.settings.legend.position));var n=!1;return n&&this.legend.drawLegend(o,this.viewport),i},i.prototype.setSize=function(e){var t,a;t=e.height-this.margin.top-this.margin.bottom,a=e.width-this.margin.left-this.margin.right,t=Math.max(t,i.DefaultViewport.height),a=Math.max(a,i.DefaultViewport.width),this.viewport={height:t,width:a},this.updateElements(e.height,e.width)},i.prototype.updateElements=function(e,i){this.svg.attr({height:e+"px",width:i+"px"}),this.axisY.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top)),this.axisX.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top+this.viewport.height))},i.getObjectsFromDataView=function(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.objects?e.metadata.objects:null},i.getLegendSettings=function(t){var a=t.legend;return a.show=e.DataViewObjects.getValue(t,i.properties.legend.show,i.DefaultSettings.legend.show),a.position=e.DataViewObjects.getValue(t,i.properties.legend.position,i.DefaultSettings.legend.position),a.showTitle=e.DataViewObjects.getValue(t,i.properties.legend.showTitle,i.DefaultSettings.legend.showTitle),a.titleText=e.DataViewObjects.getValue(t,i.properties.legend.titleText,i.DefaultSettings.legend.titleText),a},i.getDataColorsSettings=function(e){var t=e.dataPoints;return t},i.parseSettings=function(e){var t,a={};return a.displayName=i.DefaultSettings.displayName,a.fillColor=i.DefaultSettings.fillColor,t=i.getObjectsFromDataView(e),t&&(a.legend=i.getLegendSettings(t),a.colors=i.getDataColorsSettings(t)),a},i.prototype.calculateAxesProperties=function(){return this.data.xAxisProperties=this.getXAxisProperties(),this.data.yAxisProperties=this.getYAxisProperties(),[this.data.xAxisProperties,this.data.yAxisProperties]},i.prototype.lookupXValue=function(e,i){var a=t.AxisHelper.isDateTime(i);if(this.data.isScalar)return a?new Date(e):e;if(this.data&&this.data.series&&this.data.series.length>0){var r=this.data.series[0];if(r){var o=r.data;if(o){var n=o[e];if(n)return a&&null!=n.categoryValue?new Date(n.categoryValue):n.categoryValue}}}return e},i.prototype.getXAxisProperties=function(){var a=this,r=this.data,o=t.AxisHelper.getCategoryValueType(r.series[0].xCol),n=t.AxisHelper.createDomain(r.series,o,r.isScalar,null),s=r.series&&r.series.length>0?r.series[0].data.length:0,l=t.CartesianChart.getCategoryThickness(r.series,s,this.viewport.width,n,r.isScalar,!1),c=r.series[0].xCol,h=t.AxisHelper.createAxis({pixelSpan:this.viewport.width,dataDomain:n,metaDataColumn:c,formatString:t.valueFormatter.getFormatString(c,i.properties.general.formatString),outerPadding:0,isScalar:r.isScalar,isVertical:!1,forcedTickCount:void 0,useTickIntervalForDisplayUnits:!0,getValueFn:function(e,t){return a.lookupXValue(e,t)},categoryThickness:l,isCategoryAxis:!0,scaleType:this.scaleType,axisDisplayUnits:void 0,axisPrecision:void 0});return h.willLabelsFit=t.AxisHelper.LabelLayoutStrategy.willLabelsFit(h,this.viewport.width,e.TextMeasurementService.measureSvgTextWidth,i.defaultTextProperties),h.willLabelsWordBreak=!h.willLabelsFit&&t.AxisHelper.LabelLayoutStrategy.willLabelsWordBreak(h,this.margin,this.viewport.width,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.estimateSvgTextHeight,e.TextMeasurementService.getTailoredTextOrDefault,i.defaultTextProperties),h},i.createValueDomain=function(e,t){if(0===e.length)return null;var i=d3.min(e,function(e){return d3.min(e.data,function(e){return e.y0})}),a=d3.min(e,function(e){return d3.min(e.data,function(e){return e.y1})}),r=d3.max(e,function(e){return d3.max(e.data,function(e){return e.y0})}),o=d3.max(e,function(e){return d3.max(e.data,function(e){return e.y1})}),n=Math.min(i,a),s=Math.max(r,o);return t?[Math.min(n,0),Math.max(s,0)]:[n,s]},i.prototype.getYAxisProperties=function(){var e=i.createValueDomain(this.data.series,!1),a=1===this.data.series.length?0:this.data.lowerMeasureIndex,r=this.data.series.length?this.data.series[a].yCol:void 0,o=t.AxisHelper.createAxis({pixelSpan:this.viewport.height,dataDomain:e,metaDataColumn:r,formatString:t.valueFormatter.getFormatString(r,i.properties.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:this.scaleType});return o},i.prototype.renderAxis=function(e,t){var i=e.xAxisProperties.axis,a=e.yAxisProperties.axis;i.orient("bottom"),a.orient("left"),this.axisX.transition().duration(1).duration(t).call(i),this.axisY.transition().duration(t).call(a)},i.prototype.renderChart=function(e,a){var r=e.series,o=e.isScalar,n=e.xAxisProperties.scale,s=e.yAxisProperties.scale,l=this.interactivityService&&this.interactivityService.hasSelection(),c=d3.svg.area().x(function(e){return n(o?e.categoryValue:e.categoryIndex)}).y0(function(e){return s(e.y0)}).y1(function(e){return s(e.y1)}),h=this.chart.selectAll(i.Area.selector).data(r);h.enter().append("svg:path").classed(i.Area["class"],!0),h.attr("fill",function(e){return e.color}).attr("stroke",function(e){return e.color}).style("fill-opacity",function(e){return l&&!e.selected?t.LineChart.DimmedAreaFillOpacity:t.LineChart.AreaFillOpacity}).transition().duration(a).attr("d",function(e){return c(e.data)}),h.exit().remove();var u=this.interactivityService;if(u){var p={selection:h,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService};u.bind(r,this.behavior,p)}this.renderTooltip(h,n,e.isScalar);var d=this.getXOfFirstCategory();this.chart.attr("transform",t.SVGUtil.translate(this.margin.left+d,this.margin.top))},i.prototype.getXOfFirstCategory=function(){if(!this.data.isScalar){var e=this.data.xAxisProperties.scale;if(e.rangeBand&&!isNaN(e.rangeBand()))return e.rangeBand()/2}return 0},i.findClosestXAxisIndex=function(e,t,i){var a=-1,r=Number.MAX_VALUE;for(var o in t){var n=t[o],s=i?n.categoryValue:n.categoryIndex,l=Math.abs(e-s);r>l&&(r=l,a=o)}return a},i.getTooltipInfoByPointX=function(t,a,r,o){var n=0,s=e.visuals.AxisHelper.invertScale(a,o);return n=i.findClosestXAxisIndex(s,t.data,r),t.data[n].tooltipInfo},i.prototype.renderTooltip=function(e,a,r){t.TooltipManager.addTooltip(e,function(e){var t=e.elementCoordinates[0];return i.getTooltipInfoByPointX(e.data,a,r,t)},!0)},i.prototype.createLegendDataPoints=function(e){var i=this.data;if(!i)return null;var a,r=[];if(i.series.length>0){var o=i.series[0].data[e],n=t.AxisHelper.isDateTime(this.data.xAxisProperties.axisType),s=n&&this.data.isScalar&&o?o.categoryValue:e;a=o&&this.lookupXValue(s,this.data.xAxisProperties.axisType)}for(var l=t.lineChartProps.general.formatString,c=null,h=0,u=i.series.length;u>h;h++){var p=i.series[h],d=p.data,m=d[e],g=m&&m.value,f=t.converterHelper.getFormattedLegendLabel(p.yCol,this.dataViewCat.values,l);c=p.yCol,r.push({color:p.color,icon:t.LegendIcon.Line,label:f,category:t.valueFormatter.format(a,t.valueFormatter.getFormatString(p.xCol,l)),measure:t.valueFormatter.format(g,t.valueFormatter.getFormatString(p.yCol,l)),identity:p.identity,selected:!1})}var y=this.dataViewCat?this.dataViewCat.values:null,v=y&&y.source?y.source.displayName:"";return{title:v,dataPoints:r}},i.prototype.enumerateLegend=function(a){var r=this.data;if("undefined"!=typeof r){var o={legend:r.settings.legend},n=e.DataViewObjects.getValue(o,i.properties.legend.show,this.legend.isVisible()),s=e.DataViewObjects.getValue(o,i.properties.legend.showTitle,!0),l=e.DataViewObjects.getValue(o,i.properties.legend.titleText,null);a.pushInstance({selector:null,objectName:"legend",properties:{show:n,position:t.LegendPosition[this.legend.getOrientation()],showTitle:s,titleText:l}})}},i.prototype.enumerateDataPoints=function(e){var i=this.data;if(i)for(var a=i.series,r=0,o=a;r<o.length;r++){var n=o[r],s=n.color,l=n.identity.getSelector(),c=!!l.data;e.pushInstance({objectName:"dataPoint",displayName:n.displayName,selector:t.ColorHelper.normalizeSelector(l,c),properties:{fill:{solid:{color:s}}}})}},i.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;switch(e.objectName){case"legend":this.enumerateLegend(i);break;case"dataPoint":this.enumerateDataPoints(i)}return i.complete()},i.properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},legend:{show:{objectName:"legend",propertyName:"show"},position:{objectName:"legend",propertyName:"position"},showTitle:{objectName:"legend",propertyName:"showTitle"},titleText:{objectName:"legend",propertyName:"titleText"}},dataPoint:{defaultColor:{objectName:"dataPoint",propertyName:"defaultColor"},fill:{objectName:"dataPoint",propertyName:"fill"},showAllDataPoints:{objectName:"dataPoint",propertyName:"showAllDataPoints"}}},i.RoleNames={Category:"Category",Series:"Series",Lower:"Lower",Upper:"Upper"},i.capabilities={dataRoles:[{name:i.RoleNames.Category,kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Axis"),description:e.data.createDisplayNameGetter("Role_DisplayName_AxisDescription")},{name:i.RoleNames.Series,kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Legend"),description:e.data.createDisplayNameGetter("Role_DisplayName_LegendDescription")},{name:i.RoleNames.Lower,kind:e.VisualDataRoleKind.Measure,displayName:"Y1"},{name:i.RoleNames.Upper,kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Y2")}],dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:1},Lower:{max:1},Upper:{max:1}}],categorical:{categories:{"for":{"in":i.RoleNames.Category},dataReductionAlgorithm:{top:{}}},values:{group:{by:i.RoleNames.Series,select:[{bind:{to:i.RoleNames.Lower}},{bind:{to:i.RoleNames.Upper}}]}}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},legend:{displayName:e.data.createDisplayNameGetter("Visual_Legend"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_LegendPosition"),type:{formatting:{legendPosition:!0}}},showTitle:{displayName:e.data.createDisplayNameGetter("Visual_LegendShowTitle"),type:{bool:!0}},titleText:{displayName:e.data.createDisplayNameGetter("Visual_LegendNameDescription"),type:{text:!0}}}},dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),properties:{defaultColor:{displayName:e.data.createDisplayNameGetter("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint_Show_All"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}}}},i.VisualClassName="areaRangeChart",i.Chart=r("chart"),i.Area=r("area"),i.Axis=r("axis"),i.DefaultSettings={displayName:"Area Range Chart",legend:{show:!0,position:t.LegendPosition.Top,showTitle:!0}},i.defaultTextProperties={fontFamily:"wf_segoe-ui_normal",fontSize:a.PixelConverter.toString(9)},i.DefaultMargin={top:20,bottom:50,right:20,left:40},i.DefaultViewport={width:50,height:50},i}();i.AreaRangeChart=l}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=t.utility.SelectionManager,o=e.visuals.valueFormatter,n=t.AnimatorCommon.GetAnimationDuration,s=a.CssConstants.createClassAndSelector,l=a.PixelConverter,c=function(){function e(e){this.message=e}return Object.defineProperty(e.prototype,"code",{get:function(){return"BulletChartWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){return{message:this.message,title:e.get(""),detail:e.get("")}},e.ErrorInvalidDataValues="Some data values are invalid or too big",e}();i.HistogramChartWarning=c;var h=function(){function i(e){this.ColumnPadding=1,this.MinColumnHeight=1,this.MinOpacity=.3,this.MaxOpacity=1,this.TooltipDisplayName="Range",this.SeparatorNumbers=", ",this.LegendSize=50,this.YLegendSize=50,this.XLegendSize=50,this.AxisSize=30,this.DataLabelMargin=0,this.widthOfColumn=0,this.yTitleMargin=0,this.outerPadding=5,this.ExcludeBrackets={left:"(",right:")"},this.IncludeBrackets={left:"[",right:"]"},this.margin={top:10,right:10,bottom:10,left:10},this.durationAnimations=200,this.oldInnerPaddingRatio=t.CartesianChart.InnerPaddingRatio,this.oldMinOrdinalRectThickness=t.CartesianChart.MinOrdinalRectThickness,this.textProperties={fontFamily:"wf_segoe-ui_normal",fontSize:l.toString(9)},e&&(e.svg&&(this.svg=e.svg),e.animator&&(this.animator=e.animator),this.margin=e.margin||this.margin)}return Object.defineProperty(i.prototype,"columnsSelection",{get:function(){return this.main.select(i.Columns.selector).selectAll(i.Column.selector)},enumerable:!0,configurable:!0}),i.prototype.init=function(e){this.hostService=e.host,this.svg?this.root=this.svg:this.root=d3.select(e.element.get(0)).append("svg");var a=e.style;this.colors=a&&a.colorPalette?a.colorPalette.dataColors:new t.DataColorPalette,this.root.classed(i.ClassName,!0),this.main=this.root.append("g"),this.axes=this.main.append("g").classed(i.Axes["class"],!0),this.axisX=this.axes.append("g").classed(i.Axis["class"],!0),this.axisY=this.axes.append("g").classed(i.Axis["class"],!0),this.legend=this.main.append("g").classed(i.Legends["class"],!0),this.columns=this.main.append("g").classed(i.Columns["class"],!0),this.labels=this.main.append("g").classed(i.Labels["class"],!0),this.selectionManager=new r({hostServices:e.host})},i.prototype.converter=function(e){if(!(e&&e.categorical&&e.categorical.categories&&e.categorical.categories[0]&&e.categorical.categories[0].values&&e.categorical.categories[0].values.length>0))return null;var t,a,r,n,s,l,c,h,u,p=[],d=[],m=[],g=0,f=0;if(e.categorical.values&&e.categorical.values[0]&&e.categorical.values[0].values&&(d=e.categorical.values[0].values),e.categorical.categories[0].identity&&e.categorical.categories[0].identity.length>0&&(m=e.categorical.categories[0].identity),t=this.parseSettings(e),!t)return null;r=i.getValuesByFrequencies(e.categorical.categories[0].values,d,m),r.forEach(function(e){p.push(e.value),f+=e.frequency}),a=d3.layout.histogram(),t.bins&&t.bins>i.MinNumberOfBins&&(a=a.bins(t.bins)),n=a.frequency(t.frequency)(p),n.forEach(function(e,a){var o,n;o=r.filter(function(t){return i.isValueContainedInRange(t,e,a)}),n=o.reduce(function(e,t){return e+t.frequency},0),e.y=t.frequency?n:n/f,g+=e.length});var y=t.yAxisSettings,v=null!==y.end&&y.end>y.start?y.end:d3.max(n,function(e){return e.y}),x=y.start<v?y.start:0;return t.yAxisSettings.end=v,t.yAxisSettings.start=x,t.maxX=d3.max(n,function(e){return d3.max(e)}),s=d3.scale.linear().domain([d3.min(n,function(e){return d3.min(e)}),d3.max(n,function(e){return d3.max(e)})]).range([0,this.viewport.width-this.YLegendSize-this.AxisSize]),l=d3.scale.linear().domain([x,v]).range([this.viewport.height-this.LegendSize,this.outerPadding]),c=o.create({format:o.getFormatString(e.categorical.categories[0].source,i.Properties.general.formatString),value:r[0].value,value2:r[r.length-1].value,precision:t.precision}),h=o.create({value:0===t.xAxisSettings.displayUnits?r[r.length-1].value:t.xAxisSettings.displayUnits,precision:t.xAxisSettings.precision}),u=o.create({value:t.yAxisSettings.displayUnits,precision:t.yAxisSettings.precision}),{xScale:s,yScale:l,settings:t,data:this.getData(r,p,n,t,u,h),formatter:c,xLabelFormatter:h,yLabelFormatter:u}},i.getValuesByFrequencies=function(e,i,a){var r=[];return e.forEach(function(e,o){var n=1,s=Number(e);s=isNaN(s)?0:s,i&&i[o]&&!isNaN(i[o])&&i[o]>1&&(n=i[o]),r.push({value:s,frequency:n,selectionId:t.SelectionId.createWithId(a[o])})}),r},i.prototype.getData=function(e,t,a,r,o,n){var s=this,c=d3.min(t),h=d3.max(t),u=l.fromPoint(r.labelSettings.fontSize);return a.map(function(t,a){return t.range=i.getRange(c,h,t.dx,a),t.tooltipInfo=s.getTooltipData(t.y,t.range,r,0===a,o,n),t.selectionIds=i.getSelectionIds(e,t,a),t.labelFontSize=u,t})},i.getRange=function(e,t,i,a){var r=e+a*i,o=r+i;return[r,o]},i.prototype.getTooltipData=function(e,t,a,r,o,n){return[{displayName:i.getLegendText(a),value:o.format(e)},{displayName:this.TooltipDisplayName,value:this.rangeToString(t,r,n)}]},i.getSelectionIds=function(e,t,a){var r=[];return e.forEach(function(e){i.isValueContainedInRange(e,t,a)&&r.push(e.selectionId)}),r},i.isValueContainedInRange=function(e,t,i){return(0===i&&e.value>=t.x||e.value>t.x)&&e.value<=t.x+t.dx},i.prototype.parseSettings=function(e){if(!(e&&e.metadata&&e.metadata.columns&&e.metadata.columns[0]))return null;var a,r,o={};r=new t.ColorHelper(this.colors,i.Properties.dataPoint.fill,i.DefaultHistogramSettings.fillColor),o.displayName=e.metadata.columns[0].displayName||i.DefaultHistogramSettings.displayName,a=i.getObjectsFromDataView(e);var n={axisColor:i.getXAxisColor(a).solid.color,title:i.getXTitle(a),precision:i.getXPrecision(a),style:i.getXStyle(a),displayUnits:i.getXDisplayUnit(a),show:i.getXAxisShow(a)},s={axisColor:i.getYAxisColor(a).solid.color,title:i.getYTitle(a),precision:i.getYPrecision(a),style:i.getYStyle(a),displayUnits:i.getYDisplayUnit(a),show:i.getYAxisShow(a),start:i.getYStart(a),end:i.getYEnd(a),position:i.getYPosition(a)},l={show:i.getLabelShow(a),color:i.getLabelColor(a).solid.color,displayUnits:i.getLabelDisplayUnits(a),precision:i.getLabelPrecision(a),fontSize:i.getLabelFontSize(a)};return o.fillColor=r.getColorForMeasure(a,""),o.bins=i.getBins(a),o.frequency=i.getFrequency(a),o.precision=i.getPrecision(a),o.displayName=i.getLegend(o.displayName,n.style,n.displayUnits),o.xAxisSettings=n,o.yAxisSettings=s,o.labelSettings=l,o},i.getLegend=function(e,i,a){var r,n=o.create({value:a});switch(i){case t.axisStyle.showTitleOnly:r=e;break;case t.axisStyle.showUnitOnly:r=0===a||1===a?e:n.displayUnit.title;break;case t.axisStyle.showBoth:r=0===a||1===a?e:e+" ("+n.displayUnit.title+")"}return r},i.getLabelFontSize=function(t){return e.DataViewObjects.getValue(t,i.Properties.labels.fontSize,i.DefaultHistogramSettings.labelSettings.fontSize);
},i.getLabelShow=function(t){return e.DataViewObjects.getValue(t,i.Properties.labels.show,i.DefaultHistogramSettings.labelSettings.show)},i.getLabelColor=function(t){return e.DataViewObjects.getValue(t,i.Properties.labels.color,{solid:{color:i.DefaultHistogramSettings.labelSettings.color}})},i.getLabelDisplayUnits=function(t){return e.DataViewObjects.getValue(t,i.Properties.labels.displayUnits,i.DefaultHistogramSettings.labelSettings.displayUnits)},i.getLabelPrecision=function(t){var a=e.DataViewObjects.getValue(t,i.Properties.labels.precision,i.DefaultHistogramSettings.labelSettings.precision);return a<=i.MinPrecision?i.MinPrecision:a>=i.MaxPrecision?i.MaxPrecision:a},i.getXStyle=function(t){return e.DataViewObjects.getValue(t,i.Properties.xAxis.style,i.DefaultHistogramSettings.xAxisSettings.style)},i.getXDisplayUnit=function(t){return e.DataViewObjects.getValue(t,i.Properties.xAxis.displayUnits,i.DefaultHistogramSettings.xAxisSettings.displayUnits)},i.getXPrecision=function(t){var a=e.DataViewObjects.getValue(t,i.Properties.xAxis.precision,i.DefaultHistogramSettings.xAxisSettings.precision);return a<=i.MinPrecision?i.MinPrecision:a>=i.MaxPrecision?i.MaxPrecision:a},i.getXAxisShow=function(t){return e.DataViewObjects.getValue(t,i.Properties.xAxis.show,i.DefaultHistogramSettings.xAxisSettings.show)},i.getXAxisColor=function(t){return e.DataViewObjects.getValue(t,i.Properties.xAxis.axisColor,{solid:{color:i.DefaultHistogramSettings.xAxisSettings.axisColor}})},i.getXTitle=function(t){return e.DataViewObjects.getValue(t,i.Properties.xAxis.title,i.DefaultHistogramSettings.xAxisSettings.title)},i.getYStyle=function(t){return e.DataViewObjects.getValue(t,i.Properties.yAxis.style,i.DefaultHistogramSettings.yAxisSettings.style)},i.getYPosition=function(t){return e.DataViewObjects.getValue(t,i.Properties.yAxis.position,i.DefaultHistogramSettings.yAxisSettings.position)},i.getYAxisShow=function(t){return e.DataViewObjects.getValue(t,i.Properties.yAxis.show,i.DefaultHistogramSettings.yAxisSettings.show)},i.getYAxisColor=function(t){return e.DataViewObjects.getValue(t,i.Properties.yAxis.axisColor,{solid:{color:i.DefaultHistogramSettings.yAxisSettings.axisColor}})},i.getYStart=function(t){return e.DataViewObjects.getValue(t,i.Properties.yAxis.start,i.DefaultHistogramSettings.yAxisSettings.start)},i.getYEnd=function(t){return e.DataViewObjects.getValue(t,i.Properties.yAxis.end,i.DefaultHistogramSettings.yAxisSettings.end)},i.getYDisplayUnit=function(t){return e.DataViewObjects.getValue(t,i.Properties.yAxis.displayUnits,i.DefaultHistogramSettings.yAxisSettings.displayUnits)},i.getYPrecision=function(t){var a=e.DataViewObjects.getValue(t,i.Properties.yAxis.precision,i.DefaultHistogramSettings.yAxisSettings.precision);return a<=i.MinPrecision?i.MinPrecision:a>=i.MaxPrecision?i.MaxPrecision:a},i.getYTitle=function(t){return e.DataViewObjects.getValue(t,i.Properties.yAxis.title,i.DefaultHistogramSettings.yAxisSettings.title)},i.getBins=function(t){var a=Number(e.DataViewObjects.getValue(t,i.Properties.general.bins,i.DefaultHistogramSettings.bins));return!a||isNaN(a)||a<=i.MinNumberOfBins?i.DefaultHistogramSettings.bins:a>i.MaxNumberOfBins?i.MaxNumberOfBins:a},i.getFrequency=function(t){return e.DataViewObjects.getValue(t,i.Properties.general.frequency,i.DefaultHistogramSettings.frequency)},i.getPrecision=function(t){var a=e.DataViewObjects.getValue(t,i.Properties.labels.precision,i.DefaultHistogramSettings.precision);return a<=i.MinPrecision?i.MinPrecision:a>=i.MaxPrecision?i.MaxPrecision:a},i.prototype.validateData=function(e){return e&&e.data.some(function(e){return e.range.some(function(e){return isNaN(e)||e===1/0||e===-(1/0)})})?(this.hostService.setWarnings([new c(c.ErrorInvalidDataValues)]),!1):!0},i.prototype.update=function(e){if(e&&e.dataViews&&e.dataViews[0]){t.CartesianChart.InnerPaddingRatio=1;var i=e.dataViews[0];if(this.durationAnimations=n(this.animator,e.suppressAnimations),this.setSize(e.viewport),this.histogramDataView=this.converter(i),this.validateData(this.histogramDataView)||(this.histogramDataView.data=[]),this.histogramDataView){this.YLegendSize=this.histogramDataView.settings.yAxisSettings.title?50:25,this.XLegendSize=this.histogramDataView.settings.xAxisSettings.title?50:25,this.fixXTicSize(),this.xAxisProperties=this.calculateXAxes(i.categorical.categories[0].source,this.textProperties,!1);var a=i.categorical.values&&i.categorical.values[0]&&i.categorical.values[0].values?i.categorical.values[0].source:i.categorical.categories[0].source;this.yAxisProperties=this.calculateYAxes(a,this.textProperties,!1),this.render(),t.CartesianChart.InnerPaddingRatio=this.oldInnerPaddingRatio,t.CartesianChart.MinOrdinalRectThickness=this.oldMinOrdinalRectThickness}}},i.prototype.fixXTicSize=function(){if(this.histogramDataView&&this.histogramDataView.settings){var i=this.histogramDataView.xLabelFormatter.format(this.histogramDataView.settings.maxX),a={text:i,fontFamily:this.textProperties.fontFamily,fontSize:this.textProperties.fontSize},r=e.TextMeasurementService.measureSvgTextWidth(a);t.CartesianChart.MinOrdinalRectThickness=r+3}},i.prototype.setSize=function(e){var t,i;t=e.height-this.margin.top-this.margin.bottom,i=e.width-this.margin.left-this.margin.right,this.viewport={height:t,width:i},this.updateElements(e.height,e.width)},i.prototype.updateElements=function(e,i){this.root.attr({height:e,width:i}),this.main.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top)),this.legend.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top)),this.axisX.attr("transform",t.SVGUtil.translate(0,this.viewport.height-this.XLegendSize))},i.prototype.shouldShowYOnRight=function(){return this.histogramDataView.settings.yAxisSettings.position===t.yAxisPosition.right},i.prototype.columsAndAxesTransform=function(e){var i=20,a=this.shouldShowYOnRight()?10:this.histogramDataView.settings.yAxisSettings.title?this.margin.left+e+i:this.margin.left+e;this.DataLabelMargin=a,this.columns.attr("transform",t.SVGUtil.translate(a,0)),this.axes.attr("transform",t.SVGUtil.translate(a,0)),this.axisY.attr("transform",t.SVGUtil.translate(this.shouldShowYOnRight()?this.viewport.width-this.AxisSize-this.YLegendSize+.01:0,0)),this.axisX.attr("transform",t.SVGUtil.translate(0,this.viewport.height-this.XLegendSize))},i.prototype.render=function(){if(this.histogramDataView&&this.histogramDataView.settings){this.renderAxes();var e=this.renderColumns();this.adjustTransformToAxisLabels(),this.renderLegend(),this.histogramDataView.settings.labelSettings.show?this.renderLabels():this.main.selectAll(".labels").selectAll("*").remove(),this.bindSelectionHandler(e)}},i.prototype.adjustTransformToAxisLabels=function(){var t=0;this.main.selectAll("g.axis").filter(function(e,t){return 1===t}).selectAll("g.tick text").each(function(i,a){var r=e.TextMeasurementService.getSvgMeasurementProperties(this),o={text:r.text,fontFamily:r.fontFamily,fontSize:r.fontSize},n=e.TextMeasurementService.measureSvgTextWidth(o);n>t&&(t=n)});var i=70;this.yTitleMargin=this.shouldShowYOnRight()?this.viewport.width-this.AxisSize-i+this.YLegendSize+t:0,this.columsAndAxesTransform(t)},i.prototype.renderColumns=function(){var e,a,r=this,o=this.histogramDataView.data,n=this.histogramDataView.yScale,s=o.length;return e=s&&(this.viewport.width-this.AxisSize-this.YLegendSize)/s-this.ColumnPadding,0>e&&(e=0),this.widthOfColumn=e,a=this.columnsSelection.data(o),a.enter().append("svg:rect"),a.attr("x",this.ColumnPadding/2).attr("width",e).attr("height",function(e){return r.getColumnHeight(e,n)}).style("fill",this.histogramDataView.settings.fillColor).attr("class",i.Column["class"]).attr("transform",function(i,a){return t.SVGUtil.translate(e*a+r.ColumnPadding*a,n(i.y)-r.ColumnPadding/2.5)}),s&&a.classed(i.Column["class"]),a.exit().remove(),i.renderTooltip(a),a},i.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipInfo})},i.prototype.getColumnHeight=function(e,t){var i=this.viewport.height-this.XLegendSize-t(e.y);return i>0?i:this.MinColumnHeight},i.prototype.renderAxes=function(){var e,t,i=this;e=this.xAxisProperties.axis.tickFormat(function(e){return i.histogramDataView.xLabelFormatter.format(e)}).orient("bottom"),t=this.yAxisProperties.axis.orient(this.histogramDataView.settings.yAxisSettings.position.toLowerCase()).tickFormat(function(e){return i.histogramDataView.yLabelFormatter.format(e)});var a=this.histogramDataView.settings.xAxisSettings.show,r=this.histogramDataView.settings.yAxisSettings.show;a?this.axisX.transition().duration(1).call(e):this.axisX.selectAll("*").remove(),r?this.axisY.call(t):this.axisY.selectAll("*").remove(),this.main.selectAll("g.axis").filter(function(e,t){return 0===t}).selectAll("g.tick text").style({fill:this.histogramDataView.settings.xAxisSettings.axisColor}),this.main.selectAll("g.axis").filter(function(e,t){return 1===t}).selectAll("g.tick text").style({fill:this.histogramDataView.settings.yAxisSettings.axisColor})},i.prototype.getLabaelLayout=function(){var e=this,t=this.histogramDataView.settings.labelSettings,i=l.fromPoint(t.fontSize),a=o.create({value:t.displayUnits,precision:t.precision});return{labelText:function(e){return a.format(e.y).toString()},labelLayout:{x:function(t){return e.DataLabelMargin+e.histogramDataView.xScale(t.x)+e.widthOfColumn/2},y:function(t){return e.histogramDataView.yScale(t.y)-5}},filter:function(e){return null!=e},style:{fill:t.color,"font-size":i}}},i.prototype.renderLabels=function(){var e=this.getLabaelLayout(),i=this.histogramDataView.data;t.dataLabelUtils.drawDefaultLabelsForDataPointChart(i,this.main,e,this.viewport)},i.rangesToArray=function(e){return e.reduce(function(e,t,i){var a;return a=0===i?t.range:t.range.slice(1),e.concat(a)},[])},i.prototype.rangeToString=function(e,t,i){var a,r=this.IncludeBrackets.right,o=i.format(e[0]),n=i.format(e[1]);return a=t?this.IncludeBrackets.left:this.ExcludeBrackets.left,""+a+o+this.SeparatorNumbers+n+r},i.prototype.renderLegend=function(){var e,t,a=this.getDataLegends(this.histogramDataView.settings);e=this.main.select(i.Legends.selector).selectAll(i.Legend.selector),t=e.data(a),t.enter().append("svg:text"),t.attr("x",0).attr("y",0).attr("dx",function(e){return e.dx}).attr("dy",function(e){return e.dy}).attr("transform",function(e){return e.transform}).attr("class",i.Legend["class"]).text(function(e){return e.text}).classed(i.Legend["class"],!0),t.exit().remove(),this.legend.select("text").style({display:this.histogramDataView.settings.xAxisSettings.title===!0?"block":"none"}),this.legend.selectAll("text").filter(function(e,t){return 1===t}).style({display:this.histogramDataView.settings.yAxisSettings.title===!0?"block":"none"})},i.prototype.getDataLegends=function(e){var a=i.getLegendText(e);return a=i.getLegend(a,e.yAxisSettings.style,e.yAxisSettings.displayUnits),[{transform:t.SVGUtil.translate(this.viewport.width/2,this.viewport.height),text:e.displayName,dx:"1em",dy:"-1em"},{transform:t.SVGUtil.translateAndRotate(this.shouldShowYOnRight()?this.yTitleMargin:0,this.viewport.height/2,0,0,270),text:a,dx:"3em"}]},i.getLegendText=function(e){return e.frequency?i.FrequencyText:i.DensityText},i.prototype.bindSelectionHandler=function(e){var t=this;this.setSelection(e),e.on("click",function(i){t.selectionManager.clear(),i.selectionIds.forEach(function(a){t.selectionManager.select(a,!0).then(function(a){a.length>0?t.setSelection(e,i):t.setSelection(e)})}),d3.event.stopPropagation()}),this.root.on("click",function(){t.selectionManager.clear(),t.setSelection(e)})},i.prototype.setSelection=function(e,t){e.transition().duration(this.durationAnimations).style("fill-opacity",this.MaxOpacity),t&&e.filter(function(e){return e!==t}).transition().duration(this.durationAnimations).style("fill-opacity",this.MinOpacity)},i.prototype.enumerateObjectInstances=function(e){var t,i=[];if(!this.histogramDataView||!this.histogramDataView.settings)return i;switch(t=this.histogramDataView.settings,e.objectName){case"general":var a={objectName:"general",displayName:"general",selector:null,properties:{bins:t.bins,frequency:t.frequency}};i.push(a);break;case"dataPoint":var r={objectName:"dataPoint",displayName:"dataPoint",selector:null,properties:{fill:t.fillColor}};i.push(r);break;case"labels":var o=t.labelSettings,n={objectName:"labels",displayName:"labels",selector:null,properties:{show:o.show,color:o.color,displayUnits:o.displayUnits,precision:o.precision,fontSize:o.fontSize}};i.push(n);break;case"xAxis":var s=t.xAxisSettings,l={objectName:"xAxis",displayName:"X-Axis",selector:null,properties:{show:s.show,title:s.title,style:s.style,axisColor:s.axisColor,displayUnits:s.displayUnits,precision:s.precision}};i.push(l);break;case"yAxis":var c=t.yAxisSettings,h={objectName:"yAxis",displayName:"Y-Axis",selector:null,properties:{show:c.show,position:c.position,start:c.start,end:c.end,title:c.title,style:c.style,axisColor:c.axisColor,displayUnits:c.displayUnits,precision:c.precision}};i.push(h)}return i},i.getObjectsFromDataView=function(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.objects?e.metadata.objects:null},i.prototype.destroy=function(){this.root=null},i.prototype.calculateXAxes=function(a,r,o){var n={viewport:this.viewport,margin:this.margin,forcedXDomain:i.rangesToArray(this.histogramDataView.data),forceMerge:!0,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:t.axisScale.linear,valueAxisScaleType:null,trimOrdinalDataOnOverflow:!1},s=this.viewport.width,l=this.calculateXAxesProperties(n,a);return l.willLabelsFit=t.AxisHelper.LabelLayoutStrategy.willLabelsFit(l,s,e.TextMeasurementService.measureSvgTextWidth,r),l.willLabelsWordBreak=!l.willLabelsFit&&!o&&t.AxisHelper.LabelLayoutStrategy.willLabelsWordBreak(l,this.margin,s,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.estimateSvgTextHeight,e.TextMeasurementService.getTailoredTextOrDefault,r),l},i.prototype.calculateXAxesProperties=function(e,a){var r=t.AxisHelper.createAxis({pixelSpan:this.viewport.width-this.YLegendSize-this.AxisSize,dataDomain:e.forcedXDomain,metaDataColumn:a,formatString:t.valueFormatter.getFormatString(a,i.Properties.general.formatString),outerPadding:0,isScalar:!1,isVertical:!1,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,getValueFn:function(e,t){return e},scaleType:e.categoryAxisScaleType});return r.axisLabel=this.histogramDataView.settings.displayName,r},i.prototype.calculateYAxes=function(e,i,a){var r={viewport:this.viewport,margin:this.margin,forceMerge:!0,showCategoryAxisLabel:!0,showValueAxisLabel:!1,categoryAxisScaleType:t.axisScale.linear,valueAxisScaleType:null,trimOrdinalDataOnOverflow:!1},o=this.histogramDataView.settings.yAxisSettings;r.forcedYDomain=t.AxisHelper.applyCustomizedDomain([o.start,o.end],r.forcedYDomain);var n=this.calculateYAxesProperties(r,e);return n},i.prototype.calculateYAxesProperties=function(e,a){var r=this.histogramDataView.settings.yAxisSettings,o=t.AxisHelper.createAxis({pixelSpan:this.viewport.height-this.XLegendSize+5,dataDomain:t.AxisHelper.combineDomain(e.forcedYDomain,[r.start,r.end]),metaDataColumn:a,formatString:t.valueFormatter.getFormatString(a,i.Properties.general.formatString),outerPadding:this.outerPadding,isScalar:!0,isVertical:!0,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,getValueFn:function(e,t){return e},scaleType:e.categoryAxisScaleType});return o},i.ClassName="histogram",i.FrequencyText="Frequency",i.DensityText="Density",i.Properties={general:{bins:{objectName:"general",propertyName:"bins"},frequency:{objectName:"general",propertyName:"frequency"},formatString:{objectName:"general",propertyName:"formatString"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},displayUnits:{objectName:"labels",propertyName:"displayUnits"},precision:{objectName:"labels",propertyName:"precision"},fontSize:{objectName:"labels",propertyName:"fontSize"}},xAxis:{show:{objectName:"xAxis",propertyName:"show"},axisColor:{objectName:"xAxis",propertyName:"axisColor"},title:{objectName:"xAxis",propertyName:"title"},displayUnits:{objectName:"xAxis",propertyName:"displayUnits"},precision:{objectName:"xAxis",propertyName:"precision"},style:{objectName:"xAxis",propertyName:"style"}},yAxis:{show:{objectName:"yAxis",propertyName:"show"},axisColor:{objectName:"yAxis",propertyName:"axisColor"},title:{objectName:"yAxis",propertyName:"title"},displayUnits:{objectName:"yAxis",propertyName:"displayUnits"},precision:{objectName:"yAxis",propertyName:"precision"},style:{objectName:"yAxis",propertyName:"style"},start:{objectName:"yAxis",propertyName:"start"},end:{objectName:"yAxis",propertyName:"end"},position:{objectName:"yAxis",propertyName:"position"}}},i.DefaultHistogramSettings={frequency:!0,displayName:"Histogram",bins:null,fillColor:"#5f9ea0",precision:2,xAxisSettings:{show:!0,axisColor:"#5f9ea0",title:!0,displayUnits:0,precision:2,style:t.axisStyle.showTitleOnly},yAxisSettings:{show:!0,axisColor:"#5f9ea0",title:!0,displayUnits:0,precision:2,style:t.axisStyle.showTitleOnly,start:0,position:t.yAxisPosition.left},labelSettings:{show:!1,color:"#5f9ea0",displayUnits:0,precision:2,fontSize:9}},i.Axes=s("axes"),i.Axis=s("axis"),i.Labels=s("labels"),i.Columns=s("columns"),i.Column=s("column"),i.Legends=s("legends"),i.Legend=s("legend"),i.capabilities={dataRoles:[{name:"Values",kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Values")},{name:"Frequency",kind:e.VisualDataRoleKind.Measure,displayName:"Frequency"}],dataViewMappings:[{conditions:[{Values:{min:1,max:1},Frequency:{min:0,max:1}}],categorical:{categories:{bind:{to:"Values"},dataReductionAlgorithm:{top:{}}},values:{"for":{"in":"Frequency"}}}}],sorting:{implicit:{clauses:[{role:"Values",direction:1}]}},objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}},bins:{displayName:"Bins",type:{numeric:!0}},frequency:{displayName:"Frequency",type:{bool:!0}}}},dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}},xAxis:{displayName:"X-Axis",properties:{show:{displayName:"Show",type:{bool:!0}},axis:{displayName:"Axis",type:{bool:!0}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},title:{displayName:"Title",type:{bool:!0}},displayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}},precision:{displayName:"Decimal Places",type:{numeric:!0}},style:{displayName:"Style",type:{enumeration:t.axisStyle.type}}}},yAxis:{displayName:"Y-Axis",properties:{show:{displayName:"Show",type:{bool:!0}},axis:{displayName:"yAxis",type:{bool:!0}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},title:{displayName:"Title",type:{bool:!0}},displayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}},precision:{displayName:"Decimal Places",type:{numeric:!0}},style:{displayName:"Style",type:{enumeration:t.axisStyle.type}},start:{displayName:"Start",type:{numeric:!0},placeHolderText:"Start",suppressFormatPainterCopy:!0},end:{displayName:"End",type:{numeric:!0},placeHolderText:"End",suppressFormatPainterCopy:!0},position:{displayName:"Position",type:{enumeration:t.yAxisPosition.type}}}},labels:{displayName:"Data Labels",properties:{show:{displayName:"Show",type:{bool:!0}},color:{displayName:"Color",type:{fill:{solid:{color:!0}}}},displayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},precision:{displayName:"Decimal Places",type:{numeric:!0},suppressFormatPainterCopy:!0},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}}}},i.MinNumberOfBins=0,i.MaxNumberOfBins=100,i.MinPrecision=0,i.MaxPrecision=17,i}();i.Histogram=h}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=t.AnimatorCommon.GetAnimationDuration,o=a.CssConstants.createClassAndSelector,n=e.visuals.axisScale,s=a.PixelConverter,l=40,c=15,h=5,u=1,p="#00B8AA",d=0,m=17;i.DotPlotProperties={general:{formatString:{objectName:"general",propertyName:"formatString"}},labels:{show:{objectName:"labels",propertyName:"show"},fontSize:{objectName:"labels",propertyName:"fontSize"},labelPrecision:{objectName:"labels",propertyName:"labelPrecision"},labelDisplayUnits:{objectName:"labels",propertyName:"labelDisplayUnits"},labelColor:{objectName:"labels",propertyName:"color"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},categories:{show:{objectName:"categories",propertyName:"show"},fontColor:{objectName:"categories",propertyName:"fontColor"},fontSize:{objectName:"categories",propertyName:"fontSize"}},categoryAxis:{show:{objectName:"categoryAxis",propertyName:"show"},showAxisTitle:{objectName:"categoryAxis",propertyName:"showAxisTitle"},labelColor:{objectName:"categoryAxis",propertyName:"labelColor"}}};var g=function(){function g(e){this.DefaultMargin={top:10,bottom:10,right:20,left:20},this.durationAnimations=200,this.scaleType=n.linear,this.textProperties={fontFamily:"wf_segoe-ui_normal",fontSize:a.PixelConverter.toString(9)},this.dotPlotSelectors={svgPlotSelector:o("dotplot"),plotSelector:o("dotplotSelector"),plotGroupSelector:o("dotplotGroup"),axisSelector:o("axisGraphicsContext"),xAxisSelector:o("x axis"),circleSeletor:o("circleSelector")},this.DefaultDotPlotSettings={labelSettings:{show:!0,precision:2,fontSize:t.dataLabelUtils.DefaultFontSizeInPt,displayUnits:0,labelColor:t.dataLabelUtils.defaultLabelColor},categorySettings:{show:!0,fontColor:t.LegendData.DefaultLegendLabelFillColor},defaultDataPointColor:p,categoryAxisSettings:{show:!0,showAxisTitle:!0,labelColor:{solid:{color:t.dataLabelUtils.defaultLabelColor}}}},e&&(e.svg&&(this.svg=e.svg),e.animator&&(this.animator=e.animator),this.radius=e.radius||h,this.strokeWidth=e.strokeWidth||u)}return g.getTooltipData=function(e){return[{displayName:"Value",value:e.toString()}]},g.converter=function(a,r,o,n,c,h,u,p){var d,m=a.categorical.values,f=[],y=a.categorical.categories[0].source.displayName,v=e.DataViewObjects.getFillColor(r,i.DotPlotProperties.dataPoint.fill,h.getColorByIndex(0).value),x=a.categorical.categories[0].values.map(function(e,i){return{value:e,selectionId:t.SelectionId.createWithId(a.categorical.categories[0].identity[i])}});d={categorySettings:this.getCategorySettings(r,c),defaultDataPointColor:v,labelSettings:this.parseSettings(r,c),categoryAxisSettings:this.parseCategoryAxisSettings(r,c)};for(var E=a.categorical.categories[0],b=2*p+1,T=u.height-p-l,w=Math.floor((T-n.top)/b)-1,S=s.fromPoint(d.labelSettings.fontSize),R=d3.scale.linear().domain([0,w]).range([T-n.bottom,n.top+n.bottom]),C=0,A=m;C<A.length;C++)for(var M=A[C],H=_.min(M.values),P=_.max(M.values),D=e.DataViewObjects.getFillColor(r,i.DotPlotProperties.dataPoint.fill,h.getColorByIndex(0).value),L=M&&M.values?M.values.length:0,N=H/(P/w),V=d3.scale.log().domain([0>H?1:H,P]).range([0>=N?1:N,w]).clamp(!0),z=0;L>z;z++){for(var I=V(M.values[z]),F=[],O=0;I>O;O++)F.push({x:o(x[z].value)+o.rangeBand()/2,y:R(O),tooltipInfo:g.getTooltipData(M.values[z].toFixed(d.labelSettings.precision))});var k=t.SelectionIdBuilder.builder().withCategory(E,z).createSelectionId(),j=g.getTooltipData(M.values[z].toFixed(d.labelSettings.precision));f.push({selected:!1,value:M.values[z],label:M.values[z],color:D,identity:k,tooltipInfo:j,dataPoints:F,labelFontSize:S})}return{dataPoints:f,values:a.categorical.categories[0].values,displayName:y,categories:x,settings:d}},g.prototype.init=function(e){var i=e.element;this.behavior=new f,this.interactivityService=t.createInteractivityService(e.host),this.radius=h,this.strokeWidth=u,this.colors=e.style.colorPalette.dataColors,this.svg=d3.select(i.get(0)).append("svg").classed(this.dotPlotSelectors.svgPlotSelector["class"],!0).style("position","absolute"),this.clearCatcher=t.appendClearCatcher(this.svg);var a=this.svg.append("g").classed(this.dotPlotSelectors.axisSelector["class"],!0);this.dotPlot=this.svg.append("g").classed(this.dotPlotSelectors.plotSelector["class"],!0),this.xAxis=a.append("g").classed(this.dotPlotSelectors.xAxisSelector["class"],!0)},g.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){this.durationAnimations=r(this.animator,e.suppressAnimations);var i=this.dataView=e.dataViews[0],a=e.viewport;if(!i||!i.categorical||!i.categorical.values||i.categorical.values.length<1||!i.categorical||!i.categorical.categories||!i.categorical.categories[0])return void this.clearData();var o={height:a.height-this.DefaultMargin.top,width:a.width-this.DefaultMargin.left};this.viewportIn=o,this.svg.style({height:s.toString(a.height),width:s.toString(a.width)});var n=g.getObjectsFromDataView(i),c=g.parseCategoryAxisSettings(n,this.DefaultDotPlotSettings),h=this.calculateAxes(o,c,this.textProperties,n,!1),u=g.converter(i,n,h.scale,this.DefaultMargin,this.DefaultDotPlotSettings,this.colors,a,this.radius);this.dotPlotDataView=u;var p=u.dataPoints;this.interactivityService&&this.interactivityService.applySelectionStateToData(p),this.renderAxis(o.height-l,o,h,c,u,this.durationAnimations),this.drawDotPlot(p,u.settings);var d=u.settings.labelSettings;if(d.show){var m=this.getEnhanchedDotplotLayout(d,o),f=t.dataLabelUtils.drawDefaultLabelsForDataPointChart(p,this.svg,m,o,!e.suppressAnimations,this.durationAnimations);f&&f.attr("transform",function(e){return t.SVGUtil.translate(5+e.size.width/2,5+e.size.height/2)})}else t.dataLabelUtils.cleanDataLabels(this.svg)}},g.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;switch(e.objectName){case"dataPoint":this.enumerateDataPoints(i,this.dataView);break;case"labels":this.enumerateDataLabels(i,this.dataView);break;case"categories":this.enumerateCategories(i,this.dataView);break;case"categoryAxis":this.enumerateCategoryAxisValues(i,this.dataView)}return i.complete()},g.prototype.enumerateCategoryAxisValues=function(t,a){var r=a&&a.metadata?a.metadata.objects:void 0;t.pushInstance({objectName:"categoryAxis",displayName:"Category Axis",selector:null,properties:{show:e.DataViewObjects.getValue(r,i.DotPlotProperties.categoryAxis.show,this.DefaultDotPlotSettings.categoryAxisSettings.show),showAxisTitle:e.DataViewObjects.getValue(r,i.DotPlotProperties.categoryAxis.showAxisTitle,this.DefaultDotPlotSettings.categoryAxisSettings.showAxisTitle),labelColor:r&&r.categoryAxis&&r.categoryAxis.labelColor?r.categoryAxis.labelColor:this.DefaultDotPlotSettings.categoryAxisSettings.labelColor}})},g.getObjectsFromDataView=function(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.objects?e.metadata.objects:null},g.parseSettings=function(t,a){var r=this.getPrecision(t,a);return{show:e.DataViewObjects.getValue(t,i.DotPlotProperties.labels.show,a.labelSettings.show),precision:r,fontSize:e.DataViewObjects.getValue(t,i.DotPlotProperties.labels.fontSize,a.labelSettings.fontSize),displayUnits:e.DataViewObjects.getValue(t,i.DotPlotProperties.labels.labelDisplayUnits,a.labelSettings.displayUnits),labelColor:e.DataViewObjects.getFillColor(t,i.DotPlotProperties.labels.labelColor,a.labelSettings.labelColor)}},g.parseCategoryAxisSettings=function(t,a){return{show:e.DataViewObjects.getValue(t,i.DotPlotProperties.categoryAxis.show,a.categoryAxisSettings.show),showAxisTitle:e.DataViewObjects.getValue(t,i.DotPlotProperties.categoryAxis.showAxisTitle,a.categoryAxisSettings.showAxisTitle),labelColor:t&&t.categoryAxis&&t.categoryAxis.labelColor?t.categoryAxis.labelColor:a.categoryAxisSettings.labelColor}},g.getCategorySettings=function(t,a){return{show:e.DataViewObject.getValue(t,i.DotPlotProperties.categories.show,a.categorySettings.show),fontColor:e.DataViewObjects.getFillColor(t,i.DotPlotProperties.categories.fontColor,a.categorySettings.fontColor)}},g.getPrecision=function(t,a){var r=e.DataViewObjects.getValue(t,i.DotPlotProperties.labels.labelPrecision,a.labelSettings.precision);return d>=r?d:r>=m?m:r},g.prototype.drawDotPlot=function(e,i){var a=this.dotPlot.selectAll(this.dotPlotSelectors.plotGroupSelector.selector).data(e),r=this.interactivityService&&this.interactivityService.hasSelection();a.enter().append("g").attr({stroke:"black","stroke-width":this.strokeWidth}).style("fill-opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,e.highlight,r,!1)}).classed(this.dotPlotSelectors.plotGroupSelector["class"],!0);var o=a.selectAll(this.dotPlotSelectors.circleSeletor.selector).data(function(e){return e.dataPoints});o.enter().append("circle").classed(this.dotPlotSelectors.circleSeletor["class"],!0),o.attr({cx:function(e){return e.x},cy:function(e){return e.y},r:this.radius,fill:i.defaultDataPointColor}),this.renderTooltip(a),o.exit().remove(),a.exit().remove();var n=this.interactivityService;if(n){n.applySelectionStateToData(e);var s={columns:a,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService};n.bind(e,this.behavior,s)}},g.prototype.getEnhanchedDotplotLayout=function(e,r){var o=a.PixelConverter.fromPoint(e.fontSize),n=t.valueFormatter.create({format:t.valueFormatter.getFormatString(this.dataView.categorical.categories[0].source,i.DotPlotProperties.general.formatString),precision:e.precision,value:e.displayUnits});return{labelText:function(i){return t.dataLabelUtils.getLabelFormattedText({label:n.format(i.label),fontSize:e.fontSize,maxWidth:r.width})},labelLayout:{x:function(e){return e.dataPoints[e.dataPoints.length-1].x-5},y:function(e){return e.dataPoints[e.dataPoints.length-1].y-c-5}},filter:function(e){return e&&e.dataPoints&&e.dataPoints[e.dataPoints.length-1]},style:{fill:e.labelColor,"font-size":o}}},g.prototype.enumerateDataLabels=function(t,a){var r=a&&a.metadata?a.metadata.objects:void 0;t.pushInstance({objectName:"labels",displayName:"Labels",selector:null,properties:{show:e.DataViewObjects.getValue(r,i.DotPlotProperties.labels.show,this.DefaultDotPlotSettings.labelSettings.show),fontSize:e.DataViewObjects.getValue(r,i.DotPlotProperties.labels.fontSize,this.DefaultDotPlotSettings.labelSettings.fontSize),labelPrecision:e.DataViewObjects.getValue(r,i.DotPlotProperties.labels.labelPrecision,this.DefaultDotPlotSettings.labelSettings.precision),labelDisplayUnits:e.DataViewObjects.getValue(r,i.DotPlotProperties.labels.labelDisplayUnits,this.DefaultDotPlotSettings.labelSettings.displayUnits),color:e.DataViewObjects.getFillColor(r,i.DotPlotProperties.labels.labelColor,this.DefaultDotPlotSettings.labelSettings.labelColor)}})},g.prototype.enumerateDataPoints=function(t,a){var r=a&&a.metadata?a.metadata.objects:void 0,o=e.DataViewObjects.getFillColor(r,i.DotPlotProperties.dataPoint.fill,this.DefaultDotPlotSettings.defaultDataPointColor);t.pushInstance({objectName:"dataPoint",displayName:"Data Points",selector:null,properties:{fill:{solid:{color:o}}}})},g.prototype.enumerateCategories=function(e,t){var i=t&&t.metadata?t.metadata.objects:void 0,a=g.getCategorySettings(i,this.DefaultDotPlotSettings);e.pushInstance({objectName:"categories",displayName:"Categories",selector:null,properties:{show:a.show,fontSize:a.fontSize,fontColor:a.fontColor}})},g.prototype.clearData=function(){this.dotPlot.selectAll("*").remove(),this.xAxis.selectAll("*").remove(),t.dataLabelUtils.cleanDataLabels(this.svg)},g.prototype.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipInfo})},g.prototype.calculateAxes=function(i,a,r,o,n){var s=this.dataView.categorical.categories&&this.dataView.categorical.categories.length>0?this.dataView.categorical.categories[0]:{source:void 0,values:[t.valueFormatter.format(null)],identity:void 0},l={viewport:i,margin:this.DefaultMargin,forcedXDomain:this.dataView.categorical.categories[0].values,forceMerge:!1,
showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:this.scaleType,valueAxisScaleType:null,valueAxisDisplayUnits:0,categoryAxisDisplayUnits:0,trimOrdinalDataOnOverflow:!1},c=i.width,h=this.calculateAxesProperties(i,a,l,s.source,o);return h.willLabelsFit=t.AxisHelper.LabelLayoutStrategy.willLabelsFit(h,c,e.TextMeasurementService.measureSvgTextWidth,r),h.willLabelsWordBreak=!h.willLabelsFit&&!n&&t.AxisHelper.LabelLayoutStrategy.willLabelsWordBreak(h,this.DefaultMargin,c,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.estimateSvgTextHeight,e.TextMeasurementService.getTailoredTextOrDefault,r),h},g.prototype.calculateAxesProperties=function(e,a,r,o,n){var s=t.AxisHelper.createAxis({pixelSpan:e.width,dataDomain:r.forcedXDomain,metaDataColumn:o,formatString:t.valueFormatter.getFormatString(o,i.DotPlotProperties.general.formatString),outerPadding:0,isScalar:!1,isVertical:!1,forcedTickCount:r.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,getValueFn:function(e,t){return a.show?e:""},scaleType:r.categoryAxisScaleType,axisDisplayUnits:r.categoryAxisDisplayUnits});return a.show&&(s.axisLabel=t.AxisHelper.createAxisLabel(n,"","")),s},g.prototype.renderAxis=function(i,a,r,o,n,s){this.xAxis.attr({transform:t.SVGUtil.translate(0,i)});var l=r.axis;l.orient("bottom"),this.xAxis.transition().duration(s).call(l).call(g.setAxisLabelColor,o.labelColor);var c=this.xAxis.selectAll(".tick text");c.data(r.values),c.call(t.AxisHelper.LabelLayoutStrategy.clip,r.xLabelMaxWidth,e.TextMeasurementService.svgEllipsis),c.append("title").text(function(e){return e}),this.xAxis.selectAll("line").style("opacity",n.settings.categoryAxisSettings.show?1:0),this.xAxis.selectAll(".xAxisLabel").remove(),n.settings.categoryAxisSettings.showAxisTitle&&this.xAxis.append("text").text(this.dataView.categorical.categories[0].source.displayName).style("text-anchor","middle").attr("class","xAxisLabel").style("fill",o.labelColor.solid.color).attr("transform","translate("+a.width/2+",40)")},g.setAxisLabelColor=function(e,t){e.selectAll("g.tick text").style("fill",t&&t.solid?t.solid.color:null)},g.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Category:{max:1},Values:{max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{"for":{"in":"Values"}}],dataReductionAlgorithm:{top:{}}}}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}}}},categoryAxis:{displayName:"X-Axis",properties:{show:{displayName:"Show",type:{bool:!0}},showAxisTitle:{displayName:"Title",description:"Title options",type:{bool:!0}},labelColor:{displayName:"Label color",type:{fill:{solid:{color:!0}}}}}},dataPoint:{displayName:"Data colors",properties:{fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}}}},labels:{displayName:"Data labels",description:"Display data label options",properties:{show:{displayName:"Show",type:{bool:!0}},showSeries:{displayName:"Show",type:{bool:!0}},color:{displayName:"Color",description:"Select color for data labels",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display units",description:"Select the units (millions, billions, etc.)",type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},labelPrecision:{displayName:"Decimal places",description:"Select the number of decimal places to display",placeHolderText:"Auto",type:{numeric:!0},suppressFormatPainterCopy:!0},showAll:{displayName:"Customize series",type:{bool:!0}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}}}},g}();i.DotPlot=g;var f=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.columns=e.columns,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.columns.on("click",function(e,i){t.handleSelection(e,d3.event.ctrlKey)}),e.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var i=this.interactivityService.hasSelection();this.columns.style("fill-opacity",function(a){return t.ColumnUtil.getFillOpacity(a.selected,a.highlight,!a.highlight&&e,!a.selected&&i)})},e}();i.DotplotBehavior=f}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=a.PixelConverter;!function(e){e[e.ByWeight="By Weight"]="ByWeight",e[e.ByLinkType="By Link Type"]="ByLinkType",e[e.Interactive="Interactive"]="Interactive"}(i.LinkColorType||(i.LinkColorType={}));var o=i.LinkColorType,n=function(){function i(){this.labels={show:!0,color:t.dataLabelUtils.defaultLabelColor,fontSize:t.dataLabelUtils.DefaultFontSizeInPt},this.links={showArrow:!1,showLabel:!1,colorLink:o.Interactive,thickenLink:!0,displayUnits:0,decimalPlaces:null},this.nodes={displayImage:!1,defaultImage:"Home",imageUrl:"",imageExt:".png",nameMaxLength:10,highlightReachableLinks:!1},this.size={charge:-15}}return Object.defineProperty(i,"Default",{get:function(){return new this},enumerable:!0,configurable:!0}),i.parse=function(e,t){var i=new this;if(!e||!e.metadata||!e.metadata.objects)return i;var a=this.getProperties(t);for(var r in t.objects)for(var o in t.objects[r].properties)if(i[r]&&_.has(i[r],o)){var n=t.objects[r].properties[o].type,s=this.getValueFnByType(n);i[r][o]=s(e.metadata.objects,a[r][o],i[r][o])}return i},i.getProperties=function(e){var t={};for(var i in e.objects){t[i]={};for(var a in e.objects[i].properties)t[i][a]={objectName:i,propertyName:a}}return t},i.createEnumTypeFromEnum=function(t){var i=!1;return e.createEnumType(Object.keys(t).filter(function(e,a){return!!(a%2)===i&&t[e]===e&&!void(i=!i)||!!(a%2)!==i}).map(function(e){return{value:e,displayName:e}}))},i.getValueFnByType=function(t){switch(_.keys(t)[0]){case"fill":return e.DataViewObjects.getFillColor;default:return e.DataViewObjects.getValue}},i.enumerateObjectInstances=function(e,i,a){var r=new t.ObjectEnumerationBuilder,o=e&&e[i.objectName];if(!o)return r.complete();var n={objectName:i.objectName,selector:null,properties:{}};for(var s in o)_.has(o,s)&&(n.properties[s]=o[s]);return r.pushInstance(n),r.complete()},i}();i.ForceGraphSettings=n;var s=function(){function e(){this.Source=null,this.Target=null,this.Weight=null,this.LinkType=null,this.SourceType=null,this.TargetType=null}return e.getMetadataColumns=function(t){var i=t&&t.metadata&&t.metadata.columns;return i&&_.mapValues(new e,function(e,t){return i.filter(function(e){return e.roles&&e.roles[t]})[0]})},e.getTableValues=function(e){var t=e&&e.table,i=this.getMetadataColumns(e);return i&&t&&_.mapValues(i,function(e,i){return e&&t.rows.map(function(t){return t[e.index]})})},e.getTableRows=function(e){var t=e&&e.table,i=this.getMetadataColumns(e);return i&&t&&t.rows.map(function(e){return _.mapValues(i,function(t,i){return t&&e[t.index]})})},e.Roles=Object.freeze(_.mapValues(new e,function(e,t){return t})),e}();i.ForceGraphColumns=s;var l=function(){function i(){this.uniqieId="_"+i.Count++ +"_"}return Object.defineProperty(i,"Href",{get:function(){return window.location.href.replace(window.location.hash,"")},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"settings",{get:function(){return this.data&&this.data.settings},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"margin",{get:function(){return this.marginValue||{left:0,right:0,top:0,bottom:0}},set:function(e){this.marginValue=$.extend({},e),this.viewportInValue=i.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewport",{get:function(){return this.viewportValue||{width:0,height:0}},set:function(e){this.viewportValue=$.extend({},e),this.viewportInValue=i.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),i.substractMargin=function(e,t){return{width:Math.max(e.width-(t.left+t.right),0),height:Math.max(e.height-(t.top+t.bottom),0)}},i.prototype.scale1to10=function(e){var t=d3.scale.linear().domain([this.data.minFiles,this.data.maxFiles]).rangeRound([1,10]).clamp(!0);return t(e)},i.prototype.getLinkColor=function(e){switch(this.settings.links.colorLink){case o.ByWeight:return this.colors.getColorByIndex(this.scale1to10(e.weight)).value;case o.ByLinkType:return e.type&&this.data.linkTypes[e.type]?this.data.linkTypes[e.type].color:i.DefaultValues.defaultLinkColor}return i.DefaultValues.defaultLinkColor},i.prototype.enumerateObjectInstances=function(e){return n.enumerateObjectInstances(this.settings,e,i.capabilities)},i.converter=function(e,a){var r=e.categorical,o=i.parseSettings(e),l={},c=Number.MAX_VALUE,h=0,u={},p=[],d={},m=0,g=[],f=s.getMetadataColumns(e);if(!f||!f.Source||!f.Target)return null;var y=s.getTableRows(e),v=n.getProperties(i.capabilities).general.formatString,x=t.valueFormatter.getFormatString(r.categories[0].source,v),E=t.valueFormatter.getFormatString(r.categories[1].source,v),b=f.Weight&&t.valueFormatter.create({format:t.valueFormatter.getFormatString(f.Weight,v,!0),precision:o.links.decimalPlaces,value:o.links.displayUnits||_.max(y,function(e){return e.Weight}).Weight});return y.forEach(function(i){u[i.Source+","+i.Target]=1;var r=l[i.Source]||(l[i.Source]={name:i.Source,image:i.SourceType||"",adj:{}}),o=l[i.Target]||(l[i.Target]={name:i.Target,image:i.TargetType||"",adj:{}});r.adj[o.name]=1,o.adj[r.name]=1,g=[{displayName:e.metadata.columns[0].displayName,value:t.valueFormatter.format(r.name,x)},{displayName:e.metadata.columns[1].displayName,value:t.valueFormatter.format(o.name,E)}],f.Weight&&g.push({displayName:e.metadata.columns[2].displayName,value:i.Weight});var n={source:r,target:o,weight:Math.max(i.Weight,0),formattedWeight:i.Weight&&b.format(i.Weight),type:i.LinkType||"",tooltipInfo:g};f.LinkType&&(d[i.LinkType]||(d[i.LinkType]={label:i.LinkType,color:a.getColorByIndex(m++).value})),n.weight<c&&(c=n.weight),n.weight>h&&(h=n.weight),p.push(n)}),{nodes:l,links:p,minFiles:c,maxFiles:h,linkedByName:u,linkTypes:d,settings:o}},i.parseSettings=function(e){var t=n.parse(e,i.capabilities);return t.size.charge=Math.min(Math.max(t.size.charge,-100),-.1),t.links.decimalPlaces=t.links.decimalPlaces&&Math.min(Math.max(t.links.decimalPlaces,0),5),t},i.prototype.init=function(e){var t=this;this.root=d3.select(e.element.get(0)),this.forceLayout=d3.layout.force(),this.forceLayout.drag().on("dragstart",function(e){e.isDrag=!0,t.fadeNode(e)}).on("dragend",function(e){e.isDrag=!1,t.fadeNode(e)}).on("drag",function(e){return t.fadeNode(e)}),this.colors=e.style.colorPalette.dataColors},i.prototype.update=function(e){var a=this;if(e.dataViews&&!(e.dataViews.length<1)&&(this.data=i.converter(this.dataView=e.dataViews[0],this.colors),this.data)){this.viewport=e.viewport;var n=Math.sqrt(Object.keys(this.data.nodes).length/(this.viewport.width*this.viewport.height));this.root.selectAll("svg").remove();var s=this.root.append("svg").attr("width",this.viewport.width).attr("height",this.viewport.height).classed(i.VisualClassName,!0);if(this.forceLayout.gravity(100*n).links(this.data.links).size([this.viewport.width,this.viewport.height]).linkDistance(100).charge(this.settings.size.charge/n).on("tick",this.tick()),this.updateNodes(),this.forceLayout.start(),this.paths=s.selectAll(".link").data(this.forceLayout.links()).enter().append("path").attr("class","link").attr("id",function(e,t){return"linkid_"+a.uniqieId+t}).attr("stroke-width",function(e){return a.settings.links.thickenLink?a.scale1to10(e.weight):i.DefaultValues.defaultLinkThickness}).style("stroke",function(e){return a.getLinkColor(e)}).style("fill",function(e){return a.settings.links.showArrow?a.getLinkColor(e):void 0}).on("mouseover",this.fadePath(.3,i.DefaultValues.defaultLinkHighlightColor)).on("mouseout",this.fadePath(1,i.DefaultValues.defaultLinkColor)),t.TooltipManager.addTooltip(this.paths,function(e){return e.data.tooltipInfo}),this.settings.links.showLabel){var l=s.selectAll(".linklabelholder").data(this.forceLayout.links());l.enter().append("g").attr("class","linklabelholder").append("text").attr("class","linklabel").attr("y","-12").attr("text-anchor","middle").style("fill","#000").append("textPath").attr("xlink:href",function(e,t){return i.Href+"#linkid_"+a.uniqieId+t}).attr("startOffset","25%").text(function(e){return a.settings.links.colorLink===o.ByLinkType?e.type:e.formattedWeight}),l.exit().remove()}this.nodes=s.selectAll(".node").data(this.forceLayout.nodes()).enter().append("g").attr("class","node").call(this.forceLayout.drag).on("mouseover",function(e){e.isOver=!0,a.fadeNode(e)}).on("mouseout",function(e){e.isOver=!1,a.fadeNode(e)}).on("mousedown",function(){return d3.event.stopPropagation()}).attr("drag-resize-disabled",!0),this.settings.nodes.displayImage?this.nodes.append("image").attr("xlink:href",function(e){return e.image&&""!==e.image?a.settings.nodes.imageUrl+e.image+a.settings.nodes.imageExt:a.settings.nodes.defaultImage&&""!==a.settings.nodes.defaultImage?a.settings.nodes.imageUrl+a.settings.nodes.defaultImage+a.settings.nodes.imageExt:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAMAAAHNDTTxAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACuUExURQAAAMbGxvLy8sfHx/Hx8fLy8vHx8cnJycrKyvHx8fHx8cvLy/Ly8szMzM3NzfHx8dDQ0PHx8fLy8vHx8e/v79LS0tPT0/Ly8tTU1NXV1dbW1vHx8fHx8fDw8NjY2PT09PLy8vLy8vHx8fLy8vHx8fHx8enp6fDw8PLy8uPj4+Tk5OXl5fHx8b+/v/Pz8+bm5vHx8ejo6PLy8vHx8fLy8sTExPLy8vLy8sXFxfHx8YCtMbUAAAA6dFJOUwD/k/+b7/f///+r/////0z/w1RcEP//ZP///4fj/v8Yj3yXn/unDEhQ////YP9Y/8//aIMU/9+L/+fzC4s1AAAACXBIWXMAABcRAAAXEQHKJvM/AAABQElEQVQoU5WS61LCMBCFFymlwSPKVdACIgWkuNyL+P4v5ibZ0jKjP/xm0uw5ySa7mRItAhnMoIC5TwQZdCZiZjcoC8WU6EVsmZgzoqGdxafgvJAvjUXCb2M+0cXNsd/GDarZqSf7av3M2P1E3xhfLkPUvLD5joEYwVVJQXM6+9McWUwLf4nDTCQZAy96UoDjNI/jhl3xPLbQamu8xD7iaIsPKw7GJ7KZEnWLY3Gi8EFj5nqibXnwD5VEGjJXk5sbpLppfvvo1RazQVrhSopPK4TODrtnjS3dY4ic8KurruWQYF+UG60BacexTMyT2jlNg41dOmKvTpkUd/Jevy7ZxQ61ULRUpoododx8GeDPvIrktbFVdUsK6f8Na5VlVpjZJtowTXVy7kfXF5wCaV1tqXAFuIdWJu+JviaQzNzfQvQDGKRXXEmy83cAAAAASUVORK5CYII="}).attr("x","-12px").attr("y","-12px").attr("width","24px").attr("height","24px"):this.nodes.append("circle").attr("r",function(e){return e.weight<5?5:e.weight}),this.settings.labels.show&&this.nodes.append("text").attr({x:12,dy:".35em"}).style({fill:this.settings.labels.color,"font-size":r.fromPoint(this.settings.labels.fontSize)}).text(function(e){return e.name?e.name.length>a.settings.nodes.nameMaxLength?e.name.substr(0,a.settings.nodes.nameMaxLength):e.name:""})}},i.prototype.updateNodes=function(){var e=this.forceLayout.nodes();this.forceLayout.nodes(d3.values(this.data.nodes)),this.forceLayout.nodes().forEach(function(t,i){e[i]&&(t.x=e[i].x,t.y=e[i].y,t.px=e[i].px,t.py=e[i].py,t.weight=e[i].weight)})},i.prototype.tick=function(){var e=this,t=this.viewportIn,i=20*t.width,a=20*t.height,r=function(e){return Math.max((t.width-i)/2,Math.min((t.width+i)/2,e))},o=function(e){return Math.max((t.height-a)/2,Math.min((t.height+a)/2,e))},n=this.settings.links.showArrow?function(e){e.source.x=r(e.source.x),e.source.y=o(e.source.y),e.target.x=r(e.target.x),e.target.y=o(e.target.y);var t=e.target.x-e.source.x,i=e.target.y-e.source.y,a=Math.sqrt(t*t+i*i),n=Math.atan2(i,t)+Math.PI/7.85,s=Math.PI/2,l=e.target.x-6*Math.cos(n),c=e.target.y-6*Math.sin(n);return"M"+e.source.x+","+e.source.y+"A"+a+","+a+" 0 0 1,"+e.target.x+","+e.target.y+"A"+a+","+a+" 0 0 0,"+e.source.x+","+e.source.y+"M"+l+","+c+"l"+(3.5*Math.cos(s-n)-10*Math.cos(n))+","+(-3.5*Math.sin(s-n)-10*Math.sin(n))+"L"+(l-3.5*Math.cos(s-n)-10*Math.cos(n))+","+(c+3.5*Math.sin(s-n)-10*Math.sin(n))+"z"}:function(e){e.source.x=r(e.source.x),e.source.y=o(e.source.y),e.target.x=r(e.target.x),e.target.y=o(e.target.y);var t=e.target.x-e.source.x,i=e.target.y-e.source.y,a=Math.sqrt(t*t+i*i);return"M"+e.source.x+","+e.source.y+"A"+a+","+a+" 0 0,1 "+e.target.x+","+e.target.y};return function(){e.paths.each(function(){this.parentNode.insertBefore(this,this)}),e.paths.attr("d",n),e.nodes.attr("transform",function(e){return"translate("+r(e.x)+","+o(e.y)+")"})}},i.prototype.fadePath=function(e,t){var a=this;if(this.settings.links.colorLink===o.Interactive)return function(r){a.paths.style("stroke-opacity",function(t){return t.source===r.source&&t.target===r.target?1:e}),a.paths.style("stroke",function(e){return e.source===r.source&&e.target===r.target?t:i.DefaultValues.defaultLinkColor})}},i.prototype.isReachable=function(e,t){if(e.name===t.name)return!0;if(this.data.linkedByName[e.name+","+t.name])return!0;var i={};for(var a in this.data.nodes)i[a]=!1;i[e.name]=!0;var r=[];for(r.push(e.name);r.length>0;){var o=r.pop(),n=this.data.nodes[o];for(var s in n.adj){if(s===t.name)return!0;i[s]||(i[s]=!0,r.push(s))}}return!1},i.prototype.fadeNode=function(e){var t=this;if(this.settings.links.colorLink===o.Interactive){var a=function(e,i){return t.data.linkedByName[e.name+","+i.name]||t.data.linkedByName[i.name+","+e.name]||e.name===i.name},r=e.isOver||e.isDrag,n=r?.3:1,s=r?i.DefaultValues.defaultLinkHighlightColor:i.DefaultValues.defaultLinkColor,l=this;this.nodes.style("stroke-opacity",function(t){var i=(l.settings.nodes.highlightReachableLinks?l.isReachable(e,t):a(e,t))?1:n;return this.setAttribute("fill-opacity",i),i}),this.paths.style("stroke-opacity",function(i){return(t.settings.nodes.highlightReachableLinks?t.isReachable(e,i.source):i.source===e||i.target===e)?1:n}),this.paths.style("stroke",function(a){return(t.settings.nodes.highlightReachableLinks?t.isReachable(e,a.source):a.source===e||a.target===e)?s:i.DefaultValues.defaultLinkColor})}},i.prototype.destroy=function(){this.root=null},i.VisualClassName="forceGraph",i.Count=0,i.DefaultValues={defaultLinkColor:"#bbb",defaultLinkHighlightColor:"#f00",defaultLinkThickness:"1.5px"},i.capabilities={dataRoles:[{name:s.Roles.Source,kind:e.VisualDataRoleKind.Grouping,displayName:"Source"},{name:s.Roles.Target,kind:e.VisualDataRoleKind.Grouping,displayName:"Target"},{name:s.Roles.Weight,kind:e.VisualDataRoleKind.Measure,displayName:"Weight"},{name:s.Roles.LinkType,kind:e.VisualDataRoleKind.Grouping,displayName:"Link Type",description:"Links can be colored by link types"},{name:s.Roles.SourceType,kind:e.VisualDataRoleKind.Grouping,displayName:"Source Type",description:"Source type represents the image name for source entities"},{name:s.Roles.TargetType,kind:e.VisualDataRoleKind.Grouping,displayName:"Target Type",description:"Target type represents the image name for target entities"}],objects:{general:{properties:{formatString:{type:{formatting:{formatString:!0}}}}},labels:{displayName:"Data labels",properties:{show:{displayName:"Show",type:{bool:!0}},color:{displayName:"Fill",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},links:{displayName:"Links",properties:{showArrow:{type:{bool:!0},displayName:"Arrow"},showLabel:{type:{bool:!0},displayName:"Label",description:"Displays weight on links"},colorLink:{type:{enumeration:n.createEnumTypeFromEnum(o)},displayName:"Color"},thickenLink:{type:{bool:!0},displayName:"Thickness",description:"Thickenss of links represents weight"},displayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}},decimalPlaces:{displayName:"Decimal Places",placeHolderText:"Auto",type:{numeric:!0}}}},nodes:{displayName:"Nodes",properties:{displayImage:{type:{bool:!0},displayName:"Image",description:"Images are loaded from image url + source or target type + image extension"},defaultImage:{type:{text:!0},displayName:"Default image"},imageUrl:{type:{text:!0},displayName:"Image url"},imageExt:{type:{text:!0},displayName:"Image extension"},nameMaxLength:{type:{numeric:!0},displayName:"Max name length",description:"Max length of the name of entities displayed"},highlightReachableLinks:{type:{bool:!0},displayName:"Highlight all reachable links",description:"In interactive mode, whether a node's all reachable links will be highlighted"}}},size:{displayName:"Size",properties:{charge:{type:{numeric:!0},displayName:"Charge",description:"The larger the negative charge the more apart the entities, must be negative but greater than -100"}}}},dataViewMappings:[{conditions:[{Source:{max:1},Target:{max:1},Weight:{max:1},LinkType:{max:1},SourceType:{max:1},TargetType:{max:1}}],categorical:{categories:{"for":{"in":"Source"},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:"Target"}},{bind:{to:"Weight"}},{bind:{to:"LinkType"}},{bind:{to:"SourceType"}},{bind:{to:"TargetType"}}]},rowCount:{preferred:{min:1}}}}],suppressDefaultTitle:!0},i}();i.ForceGraph=l}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){function r(t){var i=!1;return e.createEnumType(Object.keys(t).filter(function(e,a){return!!(a%2)===i&&t[e]===e&&!void(i===!i)||!!(a%2)!==i}).map(function(e){return{value:e,displayName:e}}))}var o=t.utility.SelectionManager,n=a.PixelConverter,s="0.00 %;-0.00 %;0.00 %",l=864e5,c=6048e5,h=2629746e3,u=31556952e3,p=40,d=5;!function(e){e[e.Day="Day"]="Day",e[e.Week="Week"]="Week",e[e.Month="Month"]="Month",e[e.Year="Year"]="Year"}(i.GanttDateType||(i.GanttDateType={}));var m,g=i.GanttDateType;!function(e){var t=a.CssConstants.createClassAndSelector;e.ClassName=t("gantt"),e.Chart=t("chart"),e.ChartLine=t("chart-line"),e.Body=t("gantt-body"),e.AxisGroup=t("axis"),e.Domain=t("domain"),e.AxisTick=t("tick"),e.Tasks=t("tasks"),e.TaskGroup=t("task-group"),e.SingleTask=t("task"),e.TaskRect=t("task-rect"),e.TaskProgress=t("task-progress"),e.TaskResource=t("task-resource"),e.SingleMilestone=t("milestone"),e.TaskLabels=t("task-labels"),e.TaskLines=t("task-lines"),e.SingleTaskLine=t("task-line"),e.Label=t("label"),e.LegendItems=t("legendItem"),e.LegendTitle=t("legendTitle")}(m||(m={}));var f=function(){function i(){this.textProperties={fontFamily:"wf_segoe-ui_normal",fontSize:a.PixelConverter.toString(9)},this.margin=i.DefaultMargin}return i.getProperties=function(e){var t={};for(var i in e.objects){t[i]={};for(var a in e.objects[i].properties)t[i][a]={objectName:i,propertyName:a}}return t},Object.defineProperty(i,"DefaultMargin",{get:function(){return{top:50,right:40,bottom:40,left:10}},enumerable:!0,configurable:!0}),i.prototype.init=function(e){this.viewport=_.clone(e.viewport),this.style=e.style,this.body=d3.select(e.element.get(0)),this.hostServices=e.host,this.selectionManager=new o({hostServices:e.host}),this.isInteractiveChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.interactivityService=t.createInteractivityService(this.hostServices),this.createViewport(e.element),this.updateChartSize(),this.behavior=new y,this.colors=e.style.colorPalette.dataColors},i.prototype.createViewport=function(e){this.ganttDiv=this.body.append("div").classed(m.Body["class"],!0),this.ganttSvg=this.ganttDiv.append("svg").classed(m.ClassName["class"],!0),this.clearCatcher=t.appendClearCatcher(this.ganttSvg),this.axisGroup=this.ganttSvg.append("g").classed(m.AxisGroup["class"],!0),this.lineGroup=this.ganttSvg.append("g").classed(m.TaskLines["class"],!0),this.chartGroup=this.ganttSvg.append("g").classed(m.Chart["class"],!0),this.taskGroup=this.chartGroup.append("g").classed(m.Tasks["class"],!0),this.legend=t.createLegend(e,this.isInteractiveChart,this.interactivityService,!0,t.LegendPosition.Top)},i.prototype.clearViewport=function(){this.body.selectAll(m.LegendItems.selector).remove(),this.body.selectAll(m.LegendTitle.selector).remove(),this.axisGroup.selectAll(m.AxisTick.selector).remove(),this.axisGroup.selectAll(m.Domain.selector).remove(),this.lineGroup.selectAll("*").remove(),this.chartGroup.selectAll(m.ChartLine.selector).remove(),this.chartGroup.selectAll(m.TaskGroup.selector).remove(),this.chartGroup.selectAll(m.SingleTask.selector).remove()},i.prototype.updateChartSize=function(){this.ganttDiv.style({height:n.toString(this.viewport.height),width:n.toString(this.viewport.width)})},i.getTaskProperty=function(e,t,i){if(!(t&&e&&e.length>0&&e[0].roles))return null;var a=e.indexOf(e.filter(function(e){return e.roles[i]})[0]);return-1!==a?t[a]:null},i.hasRole=function(e,t){var i=e.roles;return i&&i[t]},i.getTooltipInfo=function(e,t,a){void 0===a&&(a="Days");var r=[];return e.taskType&&r.push({displayName:i.capabilities.dataRoles[0].name,value:e.taskType}),r.push({displayName:i.capabilities.dataRoles[1].name,value:e.name}),isNaN(e.start.getDate())||r.push({displayName:i.capabilities.dataRoles[2].name,value:t.startDateFormatter.format(e.start.toLocaleDateString())}),r.push({displayName:i.capabilities.dataRoles[3].name,value:t.durationFormatter.format(e.duration)+" "+a}),r.push({displayName:i.capabilities.dataRoles[4].name,value:t.completionFormatter.format(e.completion)}),e.resource&&r.push({displayName:i.capabilities.dataRoles[5].name,value:e.resource}),r},i.isChartHasTask=function(e){if(e.table&&e.table.columns)for(var t=0,a=e.table.columns;t<a.length;t++){var r=a[t];if(i.hasRole(r,"Task"))return!0}return!1},i.getFormatters=function(e){if(!e||!e.metadata||!e.metadata.columns)return null;for(var a="d",r="#",o=0,n=e.metadata.columns;o<n.length;o++){var l=n[o];if(e.categorical.categories)for(var c=0,h=e.categorical.categories;c<h.length;c++){var u=h[c];i.hasRole(u.source,"StartDate")&&(a=l.format)}}return{startDateFormatter:t.valueFormatter.create({format:a}),durationFormatter:t.valueFormatter.create({format:r}),completionFormatter:t.valueFormatter.create({format:s,value:1,allowFormatBeautification:!0})}},i.createTasks=function(e,a,r){var o=e.table.columns,n=e.table.rows,s=e.categorical.categories[0],l=new t.ColorHelper(r,void 0);return n.map(function(r,n){var c=i.getTaskProperty(o,r,"StartDate");c=i.isValidDate(c)?c:new Date(Date.now());var h=i.getTaskProperty(o,r,"Duration"),u=i.getTaskProperty(o,r,"Completion"),p=i.convertToDecimal(u);p=1>=p?p:1;var d=i.getTaskProperty(o,r,"Legend"),m=l.getColorForMeasure(e.metadata.objects,d),g={id:n,name:i.getTaskProperty(o,r,"Task"),start:c?c:new Date(Date.now()),duration:h>0?h:1,end:null,completion:p>0?p:0,resource:i.getTaskProperty(o,r,"Resource"),taskType:d,color:m?m:i.DefaultValues.TaskColor,tooltipInfo:null,description:"",identity:t.SelectionId.createWithIdAndMeasure(s.identity[n],d),selected:!1};return g.end=d3.time.day.offset(g.start,g.duration),g.tooltipInfo=i.getTooltipInfo(g,a),g})},i.createSeries=function(e,a,r,o){var n=new t.ColorHelper(o,void 0),s=_.groupBy(a,function(e){return e.taskType}),l=i.getAllTasksTypes(r),c=_.map(l.types,function(i){return{tasks:s[i],fill:n.getColorForMeasure(e,i),name:i,identity:t.SelectionId.createWithMeasure(i),selected:!1}});return c},i.converter=function(e,a){if(!e||!e.categorical||!i.isChartHasTask(e)||0===e.table.rows.length)return null;var r=i.parseSettings(e,a),o=i.getAllTasksTypes(e),n={fontSize:r.legend.fontSize,dataPoints:[],title:o.typeName},s=new t.ColorHelper(a,void 0);n.dataPoints=_.map(o.types,function(i){return{label:i,color:s.getColorForMeasure(e.metadata.objects,i),icon:t.LegendIcon.Circle,selected:!1,identity:t.SelectionId.createWithMeasure(i)}});var l=this.getFormatters(e),c=i.createTasks(e,l,a),h=i.createSeries(e.metadata.objects,c,e,a),u={dataView:e,settings:r,tasks:c,series:h,legendData:n,taskTypes:o};return u},i.parseSettings=function(t,a){var r=_.cloneDeep(i.DefaultSettings);if(!t||!t.metadata||!t.metadata.objects)return r;var o=t.metadata.objects;return r.general.groupTasks=e.DataViewObjects.getValue(o,i.Properties.general.groupTasks,i.DefaultSettings.general.groupTasks),r.taskLabels.show=e.DataViewObjects.getValue(o,i.Properties.taskLabels.show,i.DefaultSettings.taskLabels.show),r.taskLabels.fill=e.DataViewObjects.getFillColor(o,i.Properties.taskLabels.fill,i.DefaultSettings.taskLabels.fill),r.taskLabels.fontSize=e.DataViewObjects.getValue(o,i.Properties.taskLabels.fontSize,i.DefaultSettings.taskLabels.fontSize),r.taskLabels.width=e.DataViewObjects.getValue(o,i.Properties.taskLabels.width,r.taskLabels.show?i.DefaultSettings.taskLabels.width:0),r.taskCompletion.show=e.DataViewObjects.getValue(o,i.Properties.taskCompletion.show,i.DefaultSettings.taskCompletion.show),delete r.taskCompletion.show,r.taskCompletion.fill=e.DataViewObjects.getFillColor(o,i.Properties.taskCompletion.fill,i.DefaultSettings.taskCompletion.fill),r.taskResource.show=e.DataViewObjects.getValue(o,i.Properties.taskResource.show,i.DefaultSettings.taskResource.show),r.taskResource.fontSize=e.DataViewObjects.getValue(o,i.Properties.taskResource.fontSize,i.DefaultSettings.taskResource.fontSize),r.taskResource.fill=e.DataViewObjects.getFillColor(o,i.Properties.taskResource.fill,i.DefaultSettings.taskResource.fill),r.dateType.type=e.DataViewObjects.getValue(o,i.Properties.dateType.type,i.DefaultSettings.dateType.type),r.legend.show=e.DataViewObjects.getValue(o,i.Properties.legend.show,i.DefaultSettings.legend.show),r.legend.fontSize=e.DataViewObjects.getValue(o,i.Properties.legend.fontSize,i.DefaultSettings.legend.fontSize),r.legend.labelColor=e.DataViewObjects.getFillColor(o,i.Properties.legend.labelColor,i.DefaultSettings.legend.labelColor),r.legend.position=e.DataViewObjects.getValue(o,i.Properties.legend.position,i.DefaultSettings.legend.position),r.legend.showTitle=e.DataViewObjects.getValue(o,i.Properties.legend.showTitle,i.DefaultSettings.legend.showTitle),r.legend.titleText=e.DataViewObjects.getValue(o,i.Properties.legend.titleText,i.DefaultSettings.legend.titleText),r},i.isValidDate=function(e){return"[object Date]"!==Object.prototype.toString.call(e)?!1:!isNaN(e.getTime())},i.convertToDecimal=function(e){return e>=0&&1>=e?e:e/100},i.getAllTasksTypes=function(e){var t,i=[],a="",r=e.table.rows,o=_.findIndex(e.table.columns,function(e){return e.roles.hasOwnProperty("Legend")});return-1!==o&&(a=e.table.columns[o].displayName,i=_.unique(r,function(e){return e[o]}).map(function(e){return e[o]})),t={typeName:a,types:i}},i.prototype.renderLegend=function(){if(this.viewModel.legendData){t.LegendData.update(this.viewModel.legendData,e.DataViewObjects.getObject(this.viewModel.dataView.metadata.objects,"legend",{}));var i=this.viewModel.settings.legend.show?t.LegendPosition[this.viewModel.settings.legend.position]:t.LegendPosition.None;switch(this.legend.changeOrientation(i),this.legend.drawLegend(this.viewModel.legendData,_.clone(this.viewport)),t.Legend.positionChartArea(this.ganttDiv,this.legend),this.legend.getOrientation()){case t.LegendPosition.Left:case t.LegendPosition.LeftCenter:case t.LegendPosition.Right:case t.LegendPosition.RightCenter:this.viewport.width-=this.legend.getMargins().width;break;case t.LegendPosition.Top:case t.LegendPosition.TopCenter:case t.LegendPosition.Bottom:case t.LegendPosition.BottomCenter:this.viewport.height-=this.legend.getMargins().height}}},i.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){if(this.viewModel=i.converter(e.dataViews[0],this.colors),!this.viewModel)return void this.clearViewport();this.viewport=_.clone(e.viewport),this.margin=i.DefaultMargin,this.renderLegend(),this.updateChartSize();var t=this.viewModel.tasks;if(this.interactivityService&&(this.interactivityService.applySelectionStateToData(t),this.interactivityService.applySelectionStateToData(this.viewModel.series)),t.length>0){var a=_.sortBy(t,function(e){return e.start}),r=_.sortBy(t,function(e){return e.end}),o=this.getDateType(),s=a[0].start,l=r[t.length-1].end,c=Math.ceil(Math.round(l.valueOf()-s.valueOf())/o),h=this.groupTasks(t);c=0===c||1===c?2:c;var u=50*c;this.ganttSvg.attr({height:n.toString(h.length*p+this.margin.top),width:n.toString(this.margin.left+this.viewModel.settings.taskLabels.width+u+i.DefaultValues.ResourceWidth)
});var d={height:this.viewport.height,width:u},g=this.calculateAxes(d,this.textProperties,s,l,u,c,!1);if(this.timeScale=g.scale,this.renderAxis(g,200),this.renderTasks(h),this.createMilestoneLine(h),this.updateTaskLabels(h,this.viewModel.settings.taskLabels.width),this.updateElementsPositions(this.viewport,this.margin),this.interactivityService){var f={clearCatcher:this.clearCatcher,taskSelection:this.taskGroup.selectAll(m.SingleTask.selector),legendSelection:this.body.selectAll(m.LegendItems.selector),interactivityService:this.interactivityService};this.interactivityService.bind(t,this.behavior,f)}}}},i.prototype.getDateType=function(){var e=c;switch(this.viewModel.settings.dateType.type){case"Day":e=l;break;case"Week":e=c;break;case"Month":e=h;break;case"Year":e=u}return e},i.prototype.calculateAxes=function(i,a,r,o,n,s,l){var c=e.ValueType.fromPrimitiveTypeAndCategory(e.PrimitiveType.Date),h={displayName:"StartDate",queryName:"StartDate",type:c,index:0},u={viewport:i,margin:this.margin,forcedXDomain:[r,o],forceMerge:!1,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:e.visuals.axisScale.linear,valueAxisScaleType:null,valueAxisDisplayUnits:0,categoryAxisDisplayUnits:0,trimOrdinalDataOnOverflow:!1,forcedTickCount:s},p=i.width,d=this.calculateAxesProperties(i,u,n,h);return d.willLabelsFit=t.AxisHelper.LabelLayoutStrategy.willLabelsFit(d,p,e.TextMeasurementService.measureSvgTextWidth,a),d.willLabelsWordBreak=!d.willLabelsFit&&!l&&t.AxisHelper.LabelLayoutStrategy.willLabelsWordBreak(d,this.margin,p,e.TextMeasurementService.measureSvgTextWidth,e.TextMeasurementService.estimateSvgTextHeight,e.TextMeasurementService.getTailoredTextOrDefault,a),d},i.prototype.calculateAxesProperties=function(e,a,r,o){var n=this,s=t.AxisHelper.createAxis({pixelSpan:e.width,dataDomain:a.forcedXDomain,metaDataColumn:o,formatString:i.DefaultValues.DateFormatStrings[this.viewModel.settings.dateType.type],outerPadding:0,isScalar:!0,isVertical:!1,forcedTickCount:a.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,getValueFn:function(e,a){return t.valueFormatter.format(new Date(e),i.DefaultValues.DateFormatStrings[n.viewModel.settings.dateType.type])},scaleType:a.categoryAxisScaleType,axisDisplayUnits:a.categoryAxisDisplayUnits});return s.axisLabel=o.displayName,s},i.prototype.groupTasks=function(e){if(this.viewModel.settings.general.groupTasks){var t=_.groupBy(e,function(e){return e.name}),i=_.map(t,function(e,i){return{name:i,tasks:t[i]}});return i.forEach(function(e,t){e.tasks.forEach(function(e){return e.id=t}),e.id=t}),i}return e.map(function(e){return{name:e.name,id:e.id,tasks:[e]}})},i.prototype.renderAxis=function(e,t){var i=e.axis;i.orient("bottom"),this.axisGroup.transition().duration(t).call(i)},i.prototype.updateTaskLabels=function(a,r){var o,s=this,l=15,c=this.viewModel?this.viewModel.settings.taskLabels.show:!0,h=this.viewModel?this.viewModel.settings.taskLabels.fill:i.DefaultSettings.taskLabels.fill,u=this.viewModel?this.viewModel.settings.taskLabels.fontSize:i.DefaultSettings.taskLabels.fontSize;c?(o=this.lineGroup.selectAll(m.Label.selector).data(a),o.enter().append("text").classed(m.Label["class"],!0),o.attr({x:l,y:function(e,t){return s.getTaskLabelCoordinateY(e.id)},fill:h,"stroke-width":1}).style("font-size",n.fromPoint(u)).text(function(e){return e.name}),o.call(t.AxisHelper.LabelLayoutStrategy.clip,r-20,e.TextMeasurementService.svgEllipsis),o.append("title").text(function(e){return e.name}),o.exit().remove()):this.lineGroup.selectAll(m.Label.selector).remove()},i.prototype.renderTasks=function(a){var r=this,o=this.taskGroup.selectAll(m.TaskGroup.selector).data(a),s=this.viewModel?this.viewModel.settings.taskCompletion.fill:i.DefaultSettings.taskCompletion.fill,l=this.viewModel?this.viewModel.settings.taskResource.show:!0,c=4,h=this.viewModel?this.viewModel.settings.taskResource.fill:i.DefaultSettings.taskResource.fill,u=this.viewModel?this.viewModel.settings.taskResource.fontSize:i.DefaultSettings.taskResource.fontSize;o.enter().append("g").classed(m.TaskGroup["class"],!0);var p=o.selectAll(m.SingleTask.selector).data(function(e){return e.tasks});p.enter().append("g").classed(m.SingleTask["class"],!0);var d=p.selectAll(m.TaskRect.selector).data(function(e){return[e]});d.enter().append("rect").classed(m.TaskRect["class"],!0),d.classed(m.TaskRect["class"],!0).attr({x:function(e){return r.timeScale(e.start)},y:function(e){return r.getBarYCoordinate(e.id)},width:function(e){return r.taskDurationToWidth(e)},height:function(){return r.getBarHeight()}}).style("fill",function(e){return e.color}),d.exit().remove();var g=p.selectAll(m.TaskProgress.selector).data(function(e){return[e]});if(g.enter().append("rect").classed(m.TaskProgress["class"],!0),g.attr({x:function(e){return r.timeScale(e.start)},y:function(e){return r.getBarYCoordinate(e.id)+r.getBarHeight()/2-i.DefaultValues.ProgressBarHeight/2},width:function(e){return r.setTaskProgress(e)},height:i.DefaultValues.ProgressBarHeight}).style("fill",s),g.exit().remove(),l){var f=p.selectAll(m.TaskResource.selector).data(function(e){return[e]});f.enter().append("text").classed(m.TaskResource["class"],!0),f.attr({x:function(e){return r.timeScale(e.end)+c},y:function(e){return r.getBarYCoordinate(e.id)+r.getBarHeight()/2+c}}).text(function(e){return e.resource}).style({fill:h,"font-size":n.fromPoint(u)}).call(t.AxisHelper.LabelLayoutStrategy.clip,i.DefaultValues.ResourceWidth-10,e.TextMeasurementService.svgEllipsis),f.exit().remove()}else p.selectAll(m.TaskResource.selector).remove();t.TooltipManager.addTooltip(p,function(e){return e.data.tooltipInfo}),p.exit().remove(),o.exit().remove()},i.prototype.onClearSelection=function(){this.selectionManager.clear()},i.prototype.getTaskLabelCoordinateY=function(e){var t=+this.viewModel.settings.taskLabels.fontSize;return p*e+(this.getBarHeight()+5-(40-t)/4)},i.prototype.setTaskProgress=function(e){var t=e.completion/1,i=this.timeScale,a=(i(e.end)-i(e.start))*t;return a},i.prototype.getBarYCoordinate=function(e){return p*e+d},i.prototype.getBarHeight=function(){return p/1.5},i.prototype.taskDurationToWidth=function(e){return this.timeScale(e.end)-this.timeScale(e.start)},i.prototype.getTooltipForMilstoneLine=function(e,t){var i=new Date(e).toDateString(),a=[{displayName:t,value:i}];return a},i.prototype.createMilestoneLine=function(e,i,a){void 0===i&&(i="Today"),void 0===a&&(a=Date.now());var r=[{x1:this.timeScale(a),y1:0,x2:this.timeScale(a),y2:this.getMilestoneLineLength(e.length),tooltipInfo:this.getTooltipForMilstoneLine(a,i)}],o=this.chartGroup.selectAll(m.ChartLine.selector).data(r);o.enter().append("line").classed(m.ChartLine["class"],!0),o.attr({x1:function(e){return e.x1},y1:function(e){return e.y1},x2:function(e){return e.x2},y2:function(e){return e.y2},tooltipInfo:function(e){return e.tooltipInfo}}),t.TooltipManager.addTooltip(o,function(e){return e.data.tooltipInfo}),o.exit().remove()},i.prototype.updateElementsPositions=function(e,i){this.axisGroup.attr("transform",t.SVGUtil.translate(this.viewModel.settings.taskLabels.width+i.left,15)),this.chartGroup.attr("transform",t.SVGUtil.translate(this.viewModel.settings.taskLabels.width+i.left,i.top)),this.lineGroup.attr("transform",t.SVGUtil.translate(0,i.top))},i.prototype.getMilestoneLineLength=function(e){return e*p},i.prototype.enumerateGeneral=function(e){return[]},i.prototype.enumerateLegend=function(e){return[{displayName:i.Properties.legend.show.objectName,selector:null,properties:e.legend,objectName:i.Properties.legend.show.objectName}]},i.prototype.enumerateDataPoints=function(e){return this.viewModel.series.map(function(e){return{objectName:"dataPoint",displayName:e.name,selector:t.ColorHelper.normalizeSelector(e.identity.getSelector(),!1),properties:{fill:{solid:{color:e.fill}}}}})},i.prototype.enumerateTaskCompletion=function(e){return[{selector:null,properties:e.taskCompletion,objectName:i.Properties.taskCompletion.show.objectName}]},i.prototype.enumerateTaskLabels=function(e){return[{selector:null,properties:e.taskLabels,objectName:i.Properties.taskLabels.show.objectName}]},i.prototype.enumerateTaskResources=function(e){return[{selector:null,properties:e.taskResource,objectName:i.Properties.taskResource.show.objectName}]},i.prototype.enumerateDateType=function(e){return[{selector:null,properties:e.dateType,objectName:i.Properties.dateType.type.objectName}]},i.prototype.enumerateObjectInstances=function(e){var a=this.viewModel&&this.viewModel.settings||i.DefaultSettings,r=new t.ObjectEnumerationBuilder,o=function(e){return e.forEach(function(e){return r.pushInstance(e)})};switch(e.objectName){case"general":o(this.enumerateGeneral(a));break;case"legend":o(this.enumerateLegend(a));break;case"dataPoint":o(this.enumerateDataPoints(a));break;case"taskLabels":o(this.enumerateTaskLabels(a));break;case"taskCompletion":o(this.enumerateTaskCompletion(a));break;case"taskResource":o(this.enumerateTaskResources(a));break;case"dateType":o(this.enumerateDateType(a))}return r.complete()},i.DefaultSettings={general:{groupTasks:!1},legend:{show:!0,position:t.legendPosition.right,showTitle:!0,titleText:"",labelColor:"#000000",fontSize:8},taskLabels:{show:!0,fill:"#000000",fontSize:9,width:110},taskCompletion:{show:!0,fill:"#000000"},taskResource:{show:!0,fill:"#000000",fontSize:9},dateType:{type:g.Week}},i.DefaultValues={AxisTickSize:6,MaxTaskOpacity:1,MinTaskOpacity:.4,ProgressBarHeight:4,ResourceWidth:100,TaskColor:"#00B099",TaskLineWidth:15,DefaultDateType:g.Week,DateFormatStrings:{Day:"MMM dd",Week:"MMM dd",Month:"MMM yyyy",Year:"yyyy"}},i.capabilities={dataRoles:[{name:"Legend",kind:e.VisualDataRoleKind.Grouping,displayName:"Legend"},{name:"Task",kind:e.VisualDataRoleKind.Grouping,displayName:"Task"},{name:"StartDate",kind:e.VisualDataRoleKind.Grouping,displayName:"Start Date"},{name:"Duration",kind:e.VisualDataRoleKind.Measure,displayName:"Duration",requiredTypes:[{numeric:!0},{integer:!0}]},{name:"Completion",kind:e.VisualDataRoleKind.Measure,displayName:"% Completion",requiredTypes:[{numeric:!0},{integer:!0}]},{name:"Resource",kind:e.VisualDataRoleKind.Grouping,displayName:"Resource"}],dataViewMappings:[{conditions:[{Legend:{min:0,max:1},Task:{min:1,max:1},StartDate:{min:0,max:0},Duration:{min:0,max:0},Completion:{min:0,max:0},Resource:{min:0,max:0}},{Legend:{min:0,max:1},Task:{min:1,max:1},StartDate:{min:0,max:1},Duration:{min:0,max:0},Completion:{min:0,max:0},Resource:{min:0,max:0}},{Legend:{min:0,max:1},Task:{min:0,max:1},StartDate:{min:0,max:1},Duration:{min:0,max:1},Completion:{min:0,max:1},Resource:{min:0,max:1}}],table:{rows:{select:[{"for":{"in":"Legend"}},{"for":{"in":"Task"}},{"for":{"in":"StartDate"}},{"for":{"in":"Duration"}},{"for":{"in":"Completion"}},{"for":{"in":"Resource"}}]}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{groupTasks:{displayName:"Group Tasks",type:{bool:!0}}}},legend:{displayName:"Legend",description:"Display legend options",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",description:"Select the location for the legend",type:{enumeration:t.legendPosition.type}},showTitle:{displayName:"Title",description:"Display a title for legend symbols",type:{bool:!0}},titleText:{displayName:"Legend Name",description:"Title text",type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},taskLabels:{displayName:"Category Labels",properties:{show:{displayName:"Show",type:{bool:!0}},fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Font Size",type:{formatting:{fontSize:!0}}},width:{displayName:"Width",type:{numeric:!0}}}},taskCompletion:{displayName:"Task Completion",properties:{show:{type:{bool:!0}},fill:{displayName:"Completion Color",type:{fill:{solid:{color:!0}}}}}},taskResource:{displayName:"Data Labels",properties:{show:{displayName:"Show",type:{bool:!0}},fill:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Font Size",type:{formatting:{fontSize:!0}}}}},dateType:{displayName:"Gantt Date Type",properties:{type:{displayName:"Type",type:{enumeration:r(g)}}}}},sorting:{"default":{}}},i.Properties=i.getProperties(i.capabilities),i}();i.Gantt=f;var y=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.options=e;var i=e.clearCatcher;e.taskSelection.on("click",function(e){t.handleSelection(e,d3.event.ctrlKey),d3.event.stopPropagation()}),i.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){this.options.taskSelection.style("opacity",function(t){return e&&!t.selected?f.DefaultValues.MinTaskOpacity:f.DefaultValues.MaxTaskOpacity})},e}();i.GanttChartBehavior=y;var v=function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"GanttChartWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){var t,i="This visual requires task value",a="",r="";return t={message:i,title:e.get(a),detail:e.get(r)}},e}();i.GanttChartWarning=v}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi,r=(window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft,this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});!function(e){var t;!function(t){var i;!function(i){var o=a.CssConstants.createClassAndSelector,n=t.utility.SelectionManager,s=a.PixelConverter.toString,l=a.PixelConverter.fromPoint,c=a.PixelConverter.fromPointToPixel;i.Months=e.createEnumType([{value:1,displayName:"January"},{value:2,displayName:"February"},{value:3,displayName:"March"},{value:4,displayName:"April"},{value:5,displayName:"May"},{value:6,displayName:"June"},{value:7,displayName:"July"},{value:8,displayName:"August"},{value:9,displayName:"September"},{value:10,displayName:"October"},{value:11,displayName:"November"},{value:12,displayName:"December"}]),i.WeekDays=e.createEnumType([{value:0,displayName:"Sunday"},{value:1,displayName:"Monday"},{value:2,displayName:"Tuesday"},{value:3,displayName:"Wednesday"},{value:4,displayName:"Thursday"},{value:5,displayName:"Friday"},{value:6,displayName:"Saturday"}]),function(e){e[e.year=0]="year",e[e.quarter=1]="quarter",e[e.month=2]="month",e[e.week=3]="week",e[e.day=4]="day"}(i.GranularityType||(i.GranularityType={}));var h=i.GranularityType,u={objectName:"cells",propertyName:"fillSelected"},p={objectName:"cells",propertyName:"fillUnselected"},d={objectName:"rangeHeader",propertyName:"fontColor"},m={objectName:"rangeHeader",propertyName:"textSize"},g={objectName:"rangeHeader",propertyName:"show"},f={objectName:"labels",propertyName:"fontColor"},y={objectName:"labels",propertyName:"textSize"},v={objectName:"labels",propertyName:"show"},x={objectName:"calendar",propertyName:"month"},E={objectName:"calendar",propertyName:"day"},b={objectName:"weekDay",propertyName:"day"},T=[{granularityType:h.year,name:"year"},{granularityType:h.quarter,name:"quarter"},{granularityType:h.month,name:"month"},{granularityType:h.week,name:"week"},{granularityType:h.day,name:"day"}],w=function(){function e(){this.datePeriods=[]}return e.prototype.shortMonthName=function(e){return e.toString().split(" ")[1]},e.prototype.resetDatePeriods=function(){this.datePeriods=[]},e.prototype.getDatePeriods=function(){return this.datePeriods},e.prototype.getExtendedLabel=function(){return this.extendedLabel},e.prototype.setExtendedLabel=function(e){this.extendedLabel=e},e.prototype.createLabels=function(e){var t,i=[];return _.map(this.datePeriods,function(a){!_.isEmpty(i)&&e.sameLabel(a,t)||(t=a,i.push(e.generateLabel(a)))}),i},e.prototype.addDate=function(e,t){var i=this.getDatePeriods(),a=i[i.length-1];0!==i.length&&_.isEqual(a.identifierArray,t)?a.endDate=e:(i.length>0&&(a.endDate=e),i.push({identifierArray:t,startDate:e,endDate:e,week:this.determineWeek(e),year:this.determineYear(e),fraction:1,index:i.length}))},e.prototype.setNewEndDate=function(e){_.last(this.datePeriods).endDate=e},e.prototype.splitPeriod=function(e,t,i){var a=this.datePeriods[e];a.fraction-=t;var r={identifierArray:a.identifierArray,startDate:i,endDate:a.endDate,week:this.determineWeek(i),year:this.determineYear(i),fraction:t,index:a.index+a.fraction};a.endDate=i,this.datePeriods.splice(e+1,0,r)},e.prototype.previousMonth=function(e){return e>0?e-1:11},e.prototype.nextMonth=function(e){return 11>e?e+1:0},e.prototype.countWeeks=function(e,t){var i;if(t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()>=e.getDate())i=t.getDate()-e.getDate();else{i=t.getDate()-1;for(var a=this.nextMonth(e.getMonth()),r=t.getMonth();r!==a;)i+=new Date(t.getFullYear(),r,0).getDate(),r=this.previousMonth(r);i+=new Date(t.getFullYear(),a,0).getDate()-e.getDate()}return 1+Math.floor(i/7)},e.prototype.determineWeek=function(e){var t=e.getFullYear();this.inPreviousYear(e)&&t--;var i=L.calendar.getDateOfFirstWeek(t),a=this.countWeeks(i,e);return[a,t]},e.prototype.inPreviousYear=function(e){var t=L.calendar.getDateOfFirstWeek(e.getFullYear());return t>e},e.prototype.determineYear=function(e){var t=new Date(e.getFullYear(),L.calendar.getFirstMonthOfYear(),L.calendar.getFirstDayOfYear());return e.getFullYear()-(e>=t?0:1)},e}();i.TimelineGranularity=w;var S=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.getType=function(){return h.day},t.prototype.splitDate=function(e){return[this.shortMonthName(e),e.getDate(),e.getFullYear()]},t.prototype.sameLabel=function(e,t){return e.startDate.getTime()===t.startDate.getTime()},t.prototype.generateLabel=function(e){return{title:this.shortMonthName(e.startDate)+" "+e.startDate.getDate()+" - "+e.year,text:e.startDate.getDate().toString(),id:e.index}},t}(w);i.DayGranularity=S;var R=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.getType=function(){return h.month},t.prototype.splitDate=function(e){return[this.shortMonthName(e),e.getFullYear()]},t.prototype.sameLabel=function(e,t){return this.shortMonthName(e.startDate)===this.shortMonthName(t.startDate)},t.prototype.generateLabel=function(e){var t=this.shortMonthName(e.startDate);return{title:t,text:t,id:e.index}},t}(w);i.MonthGranularity=R;var C=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.getType=function(){return h.week},t.prototype.splitDate=function(e){return this.determineWeek(e)},t.prototype.sameLabel=function(e,t){return _.isEqual(e.week,t.week)},t.prototype.generateLabel=function(e){return{title:"Week "+e.week[0]+" - "+e.week[1],text:"W"+e.week[0],id:e.index}},t}(w);i.WeekGranularity=C;var A=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.quarterText=function(e){for(var t=3,i=e.getFullYear();e<L.calendar.getQuarterStartDate(i,t);)t>0?t--:(t=3,i--);return t++,"Q"+t},t.prototype.getType=function(){return h.quarter},t.prototype.splitDate=function(e){return[this.quarterText(e),e.getFullYear()]},t.prototype.sameLabel=function(e,t){return this.quarterText(e.startDate)===this.quarterText(t.startDate)&&e.year===t.year},t.prototype.generateLabel=function(e){var t=this.quarterText(e.startDate);return{title:t+" "+e.year,text:t,id:e.index}},t}(w);i.QuarterGranularity=A;var M=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.getType=function(){return h.year},t.prototype.splitDate=function(e){return[e.getFullYear()]},t.prototype.sameLabel=function(e,t){return e.year===t.year},t.prototype.generateLabel=function(e){return{title:"Year "+e.year,text:e.year.toString(),id:e.index}},t}(w);i.YearGranularity=M;var H=function(){function e(t,i){this.granularities=[],this.setDatesRange(t,i);var a=this.dates[this.dates.length-1];this.endingDate=e.nextDay(a)}return e.previousDay=function(e){var t=new Date(e.getTime());return t.setDate(t.getDate()-1),t},e.nextDay=function(e){var t=new Date(e.getTime());return t.setDate(t.getDate()+1),t},e.prototype.setDatesRange=function(t,i){this.dates=[];for(var a=t;i>=a;)this.dates.push(a),a=e.nextDay(a)},e.prototype.addGranularity=function(e){e.resetDatePeriods();for(var t=0,i=this.dates;t<i.length;t++){var a=i[t],r=e.splitDate(a);e.addDate(a,r)}e.setNewEndDate(this.endingDate),this.granularities.push(e)},e.prototype.getGranularity=function(e){return this.granularities[e]},e.prototype.createGranularities=function(){this.granularities=[],this.addGranularity(new M),this.addGranularity(new A),this.addGranularity(new R),this.addGranularity(new C),this.addGranularity(new S)},e.prototype.createLabels=function(){var e=this;this.granularities.forEach(function(t){t.setExtendedLabel({dayLabels:t.getType()>=h.day?t.createLabels(e.granularities[h.day]):[],weekLabels:t.getType()>=h.week?t.createLabels(e.granularities[h.week]):[],monthLabels:t.getType()>=h.month?t.createLabels(e.granularities[h.month]):[],quarterLabels:t.getType()>=h.quarter?t.createLabels(e.granularities[h.quarter]):[],yearLabels:t.getType()>=h.year?t.createLabels(e.granularities[h.year]):[]})})},e}();i.TimelineGranularityData=H;var P=function(){function e(){}return e.getStartSelectionDate=function(e){return e.currentGranularity.getDatePeriods()[e.selectionStartIndex].startDate},e.getEndSelectionDate=function(e){return e.currentGranularity.getDatePeriods()[e.selectionEndIndex].endDate},e.getEndSelectionPeriod=function(e){return e.currentGranularity.getDatePeriods()[e.selectionEndIndex]},e.getCellColor=function(t,i,a){var r=t.datePeriod.startDate>=e.getStartSelectionDate(i)&&t.datePeriod.endDate<=e.getEndSelectionDate(i);return r?a.colorInProperty:a.colorOutProperty},e.getGranularityType=function(e){var t=_.findIndex(T,function(t){return t.name===e});return T[t].granularityType},e.getGranularityName=function(e){var t=_.findIndex(T,function(t){return t.granularityType===e});return T[t].name},e.separateSelection=function(t,i,a){var r=t.currentGranularity.getDatePeriods(),o=_.findIndex(r,function(e){return i<e.endDate}),n=_.findIndex(r,function(e){return a<=e.endDate});t.selectionStartIndex=o,t.selectionEndIndex=n;var s=e.getDateRatio(r[o],i,!0),l=e.getDateRatio(r[n],a,!1);if(l>0&&t.currentGranularity.splitPeriod(n,l,a),s>0){var c=r[o].fraction-s;t.currentGranularity.splitPeriod(o,c,i),t.selectionStartIndex++,t.selectionEndIndex++}},e.getDateRatio=function(e,t,i){var a=i?t.getTime()-e.startDate.getTime():e.endDate.getTime()-t.getTime(),r=e.endDate.getTime()-e.startDate.getTime();return 0===r?0:a/r},e.timeRangeText=function(t){var i=t.currentGranularity.splitDate(e.getStartSelectionDate(t)),a=t.currentGranularity.splitDate(e.getEndSelectionPeriod(t).startDate);return i.join(" ")+" - "+a.join(" ")},e.dateRangeText=function(e){return e.startDate.toDateString()+" - "+H.previousDay(e.endDate).toDateString()},e.unseparateSelection=function(e){var t=_.findIndex(e,function(e){return e.fraction<1});return t>=0?(e[t].endDate=e[t+1].endDate,e[t].fraction+=e[t+1].fraction,e.splice(t+1,1),!0):!1},e}();i.Utils=P;var D=function(){function e(e){var t=this;this.firstDayOfWeek=e.weekDayProperty,this.firstMonthOfYear=e.firstMonthProperty-1,this.firstDayOfYear=e.firstDayProperty,this.dateOfFirstWeek={},this.quarterFirstMonths=[0,3,6,9].map(function(e){return e+t.firstMonthOfYear})}return e.prototype.getFirstDayOfWeek=function(){return this.firstDayOfWeek},e.prototype.getFirstMonthOfYear=function(){return this.firstMonthOfYear},e.prototype.getFirstDayOfYear=function(){return this.firstDayOfYear},e.prototype.getQuarterStartDate=function(e,t){return new Date(e,this.quarterFirstMonths[t],this.firstDayOfYear)},e.prototype.isChanged=function(e){return this.firstMonthOfYear!==e.firstMonthProperty-1||this.firstDayOfYear!==e.firstDayProperty||this.firstDayOfWeek!==e.weekDayProperty},e.prototype.calculateDateOfFirstWeek=function(e){for(var t=new Date(e,this.firstMonthOfYear,this.firstDayOfYear);t.getDay()!==this.firstDayOfWeek;)t=H.nextDay(t);return t},e.prototype.getDateOfFirstWeek=function(e){return this.dateOfFirstWeek[e]||(this.dateOfFirstWeek[e]=this.calculateDateOfFirstWeek(e)),this.dateOfFirstWeek[e]},e}();i.Calendar=D;var L=function(){function a(){var e=this;this.requiresNoUpdate=!1,this.datasetsChangedState=!1,this.selector=["Y","Q","M","W","D"],this.timelineMargins={LeftMargin:15,RightMargin:15,TopMargin:15,BottomMargin:10,CellWidth:40,CellHeight:25,StartXpoint:10,StartYpoint:20,ElementWidth:30,MinCellWidth:30,MaxCellHeight:60,PeriodSlicerRectWidth:15,PeriodSlicerRectHeight:23},this.defaultTimelineProperties={DefaultLabelsShow:!0,TimelineDefaultTextSize:9,TimelineDefaultCellColor:"#ADD8E6",TimelineDefaultCellColorOut:"#FFFFFF",TimelineDefaultTimeRangeShow:!0,DefaultTimeRangeColor:"#777777",DefaultLabelColor:"#777777",DefaultGranularity:h.month,DefaultFirstMonth:1,DefaultFirstDay:1,DefaultFirstWeekDay:0},this.timelineSelectors={TimelineVisual:o("Timeline"),SelectionRangeContainer:o("selectionRangeContainer"),textLabel:o("label"),LowerTextCell:o("lowerTextCell"),UpperTextCell:o("upperTextCell"),UpperTextArea:o("upperTextArea"),LowerTextArea:o("lowerTextArea"),RangeTextArea:o("rangeTextArea"),CellsArea:o("cellsArea"),CursorsArea:o("cursorsArea"),MainArea:o("mainArea"),SelectionCursor:o("selectionCursor"),Cell:o("cell"),CellRect:o("cellRect"),VertLine:o("timelineVertLine"),TimelineSlicer:o("timelineSlicer"),PeriodSlicerGranularities:o("periodSlicerGranularities"),PeriodSlicerSelection:o("periodSlicerSelection"),PeriodSlicerSelectionRect:o("periodSlicerSelectionRect"),PeriodSlicerRect:o("periodSlicerRect")},this.drag=d3.behavior.drag().origin(function(t){return t.x=t.selectionIndex*e.timelineProperties.cellWidth,t}).on("dragstart",function(){e.dragstarted()}).on("drag",function(t){e.dragged(t)}).on("dragend",function(){e.dragended()})}return a.prototype.changeGranularity=function(e,t,i){P.unseparateSelection(this.timelineData.currentGranularity.getDatePeriods())&&P.unseparateSelection(this.timelineData.currentGranularity.getDatePeriods()),this.timelineData.currentGranularity=this.timelineGranularityData.getGranularity(e),P.separateSelection(this.timelineData,t,i)},a.prototype.init=function(e){this.hostServices=e.host,this.initialized=!1;var t=e.element;this.selectionManager=new n({hostServices:e.host}),this.timelineProperties={element:t,textYPosition:50,cellsYPosition:3*this.timelineMargins.TopMargin+65,topMargin:this.timelineMargins.TopMargin,bottomMargin:this.timelineMargins.BottomMargin,leftMargin:this.timelineMargins.LeftMargin,startXpoint:this.timelineMargins.StartXpoint,startYpoint:this.timelineMargins.StartYpoint,cellWidth:this.timelineMargins.CellWidth,cellHeight:this.timelineMargins.CellHeight,elementWidth:this.timelineMargins.ElementWidth,rightMargin:this.timelineMargins.RightMargin},this.body=d3.select(t.get(0)),this.timelineDiv=this.body.append("div"),this.svg=this.timelineDiv.append("svg").attr("width",s(e.viewport.width)).classed(this.timelineSelectors.TimelineVisual["class"],!0),this.addWrappElements()},a.prototype.addWrappElements=function(){this.clearCatcher=t.appendClearCatcher(this.svg),this.clearCatcher.data([this]).on("click",function(e){return e.clear()}).on("touchstart",function(e){return e.clear()}),this.rangeText=this.svg.append("g").classed(this.timelineSelectors.RangeTextArea["class"],!0).append("text"),this.mainGroupElement=this.svg.append("g").classed(this.timelineSelectors.MainArea["class"],!0),this.yearLabelsElement=this.mainGroupElement.append("g"),this.quarterLabelsElement=this.mainGroupElement.append("g"),this.monthLabelsElement=this.mainGroupElement.append("g"),this.weekLabelsElement=this.mainGroupElement.append("g"),this.dayLabelsElement=this.mainGroupElement.append("g"),this.cellsElement=this.mainGroupElement.append("g").classed(this.timelineSelectors.CellsArea["class"],!0),this.cursorGroupElement=this.svg.append("g").classed(this.timelineSelectors.CursorsArea["class"],!0)},a.prototype.clear=function(){this.initialized&&(this.selectionManager.clear(),this.timelineData&&(this.timelineData.selectionStartIndex=0,this.timelineData.selectionEndIndex=this.timelineData.currentGranularity.getDatePeriods().length-1,_.any(this.timelineData.timelineDatapoints,function(e){return e.index%1!==0})?this.selectPeriod(this.timelineData.currentGranularity.getType()):(a.updateCursors(this.timelineData,this.timelineProperties.cellWidth),this.fillCells(this.timelineFormat.cellFormat),this.renderCursors(this.timelineData,this.timelineFormat,this.timelineProperties.cellHeight,this.timelineProperties.cellsYPosition),this.renderTimeRangeText(this.timelineData,this.timelineFormat.rangeTextFormat)),this.setSelection(this.timelineData)))},a.prototype.drawGranular=function(e){var t=this,i=!1,a=e.startXpoint,r=e.startYpoint,o=e.elementWidth;this.selectorContainer=this.svg.append("g").classed(this.timelineSelectors.TimelineSlicer["class"],!0),this.selectorContainer.on("mouseleave",function(e){return i=!1});var n=this.selectorContainer.append("rect"),l=this.selector;n.attr({height:s(1),x:s(a),y:s(r+2),width:s((l.length-1)*o)});var c=this.selectorContainer.selectAll("vertLines").data(l).enter().append("rect");c.classed(this.timelineSelectors.VertLine["class"],!0).attr({x:function(e,t){return s(a+t*o)},y:s(r),width:s(2),height:s(3)}).style({cursor:"pointer"});var h,u=this.selectorContainer.selectAll(this.timelineSelectors.PeriodSlicerGranularities.selector).data(l).enter().append("text").classed(this.timelineSelectors.PeriodSlicerGranularities["class"],!0);h=u.text(function(e){return e}).attr({x:function(e,t){return s(a-3+t*o)},y:s(r-3)}),this.selectedText=this.selectorContainer.append("text").classed(this.timelineSelectors.PeriodSlicerSelection["class"],!0),this.selectedText.text(P.getGranularityName(this.defaultTimelineProperties.DefaultGranularity)).attr({x:s(a+2*o),y:s(r+17)});var p=this.selectorContainer.selectAll(this.timelineSelectors.PeriodSlicerSelectionRect.selector).data(l).enter().append("rect").classed(this.timelineSelectors.PeriodSlicerSelectionRect["class"],!0),d=function(e,a){t.selectPeriod(a),i=!0};p.attr({x:function(e,t){return s(a-o/2+t*o)},y:s(3),width:s(o),height:s(23)}).style({cursor:"pointer"}).on("mousedown",d).on("touchstart",d).on("mouseup",function(){return i=!1}).on("touchend",function(){return i=!1}).on("mouseover",function(e,a){i&&t.selectPeriod(a)});var m=d3.behavior.drag().on("dragstart",function(e,t){i=!0}).on("dragend",function(e,t){i=!1});this.periodSlicerRect=this.selectorContainer.append("rect").classed(this.timelineSelectors.PeriodSlicerRect["class"],!0).attr({x:s(a-6+this.defaultTimelineProperties.DefaultGranularity*o),y:s(r-16),rx:s(4),width:s(15),height:s(23)}).on("mouseup",function(e){return i=!1}),this.periodSlicerRect.call(m)},a.prototype.redrawPeriod=function(e){var t=this.timelineMargins.StartXpoint+e*this.timelineMargins.ElementWidth;this.periodSlicerRect.transition().attr("x",s(t-7)),this.selectedText.text(P.getGranularityName(e));var i=P.getStartSelectionDate(this.timelineData),a=P.getEndSelectionDate(this.timelineData);this.changeGranularity(e,i,a)},a.setMeasures=function(e,t,i,a,r,o){r.cellsYPosition=r.textYPosition;var n=c(e.sizeProperty);e.showProperty&&(r.cellsYPosition+=1.5*n*(t+1));var s=Math.max(0,a.height-o.TopMargin),l=a.width-o.RightMargin-o.MinCellWidth*i,h=Math.max(o.MinCellWidth,Math.min(o.MaxCellHeight,l,s-r.cellsYPosition-20)),u=Math.max(o.MinCellWidth,(a.width-h-o.RightMargin)/i);r.cellHeight=h,r.cellWidth=u},a.prototype.visualChangeOnly=function(e){if(e&&e.dataViews&&e.dataViews[0]&&e.dataViews[0].metadata&&this.options&&this.options.dataViews&&this.options.dataViews[0]&&this.options.dataViews[0].metadata){var t=e.dataViews[0].metadata.objects,i=this.options.dataViews[0].metadata.objects,a=["rangeHeader","cells","labels"],r=!a.every(function(e){return _.isEqual(t?t[e]:void 0,i?i[e]:void 0)});return e.suppressAnimations||r}return!1},a.prototype.datasetsChanged=function(e){
if(e&&e.dataViews&&e.dataViews[0]&&e.dataViews[0].categorical&&e.dataViews[0].categorical.categories&&e.dataViews[0].categorical.categories[0]&&e.dataViews[0].categorical.categories[0].source&&this.options&&this.options.dataViews&&this.options.dataViews[0]&&this.options.dataViews[0].categorical&&this.options.dataViews[0].categorical.categories&&this.options.dataViews[0].categorical.categories[0]&&this.options.dataViews[0].categorical.categories[0].source){var t=e.dataViews[0].categorical.categories[0].source.displayName,i=this.options.dataViews[0].categorical.categories[0].source.displayName;if(!_.isEqual(t,i))return!0}return!1},a.prototype.unavailableType=function(e){return!(e.categories&&1===e.categories.length&&e.categories[0].values&&0!==e.categories[0].values.length&&e.categories[0].source&&e.categories[0].source.type)},a.prototype.unavailableChildIdentityField=function(e){return!e.root||!e.root.childIdentityFields||0===e.root.childIdentityFields.length},a.prototype.createTimelineOptions=function(e){if(this.dataView=e,!e.categorical||!e.metadata||this.unavailableType(e.categorical)||!e.tree||this.unavailableChildIdentityField(e.tree))return!1;var t=e.tree.root.childIdentityFields[0];return this.valueType=t?t.ref:null,e.categorical.categories[0].source.type.dateTime||e.categorical.categories[0].source.type.numeric&&("Year"===this.valueType||"Date"===this.valueType)?(this.values=this.prepareValues(this.dataView.categorical.categories[0].values),!0):!1},a.prototype.prepareValues=function(e){e=e.filter(Boolean);for(var t in e){var i=e[t];if("String"==typeof i&&"Invalid Date"!==String(new Date(i)))return e[t]=new Date(i)}return e},a.prototype.createTimelineData=function(){var e,t;if("Year"===this.valueType){var i=this.values;e=new Date(_.min(i),0),t=new Date(_.max(i),11)}else{var r=this.values;e=_.min(r),t=_.max(r)}if(this.initialized||this.drawGranular(this.timelineProperties),this.initialized){var o=H.nextDay(t),n=this.timelineGranularityData.getGranularity(h.day).getDatePeriods(),s=n[0].startDate,l=n[n.length-1].endDate,c=e.getTime()>=s.getTime()&&o.getTime()<=l.getTime();this.newGranularity=this.timelineData.currentGranularity.getType(),c?(this.changeGranularity(this.newGranularity,e,o),this.timelineFormat=a.fillTimelineFormat(this.options.dataViews[0].metadata.objects,this.defaultTimelineProperties)):(l>o&&(t=n[n.length-1].startDate),e>s&&(e=s),this.initialized=!1)}this.initialized||(this.timelineGranularityData=new H(e,t),this.timelineData={elementsCount:0,timelineDatapoints:[],cursorDataPoints:new Array})},a.prototype.update=function(e){var t=this.visualChangeOnly(e);if(this.datasetsChangedState=this.datasetsChanged(e),this.requiresNoUpdate=this.requiresNoUpdate&&!this.datasetsChangedState&&!t,this.requiresNoUpdate)return void(this.requiresNoUpdate=!1);if(this.options=e,e.dataViews&&e.dataViews[0]){var i=this.createTimelineOptions(e.dataViews[0]);if(!i)return void this.clearData();this.newGranularity=this.defaultTimelineProperties.DefaultGranularity,t||this.createTimelineData(),this.timelineFormat=a.converter(this.timelineData,this.timelineProperties,this.defaultTimelineProperties,this.timelineGranularityData,e.dataViews[0],this.initialized,this.newGranularity,e.viewport,this.timelineMargins),this.render(this.timelineData,this.timelineFormat,this.timelineProperties,e),this.initialized=!0}},a.prototype.selectPeriod=function(e){this.redrawPeriod(e),this.timelineFormat=a.converter(this.timelineData,this.timelineProperties,this.defaultTimelineProperties,this.timelineGranularityData,this.options.dataViews[0],this.initialized,this.timelineData.currentGranularity.getType(),this.options.viewport,this.timelineMargins),this.render(this.timelineData,this.timelineFormat,this.timelineProperties,this.options)},a.isDataNotMatch=function(e){return e.categorical.categories.length<=0||void 0===e.categorical.categories[0]||void 0===e.categorical.categories[0].identityFields||e.categorical.categories[0].identityFields.length<=0},a.converter=function(e,t,i,r,o,n,s,l,c){var h=a.fillTimelineFormat(o.metadata.objects,i);if(n||(e.cursorDataPoints.push({x:0,selectionIndex:0,cursorIndex:0}),e.cursorDataPoints.push({x:0,selectionIndex:0,cursorIndex:1})),n&&!a.calendar.isChanged(h.calendarFormat)||(a.calendar=new D(h.calendarFormat),r.createGranularities(),r.createLabels(),e.currentGranularity=r.getGranularity(s),e.selectionStartIndex=0,e.selectionEndIndex=e.currentGranularity.getDatePeriods().length-1),e.categorySourceName=o.categorical.categories[0].source.displayName,e.columnIdentity=o.categorical.categories[0].identityFields[0],o.categorical.categories[0].source.type.numeric&&(e.columnIdentity.ref="Date"),!this.isDataNotMatch(o)){var u=e.currentGranularity.getDatePeriods();e.elementsCount=u.length,e.timelineDatapoints=[];for(var p=0,d=u;p<d.length;p++){var m=d[p],g={index:m.index,datePeriod:m};e.timelineDatapoints.push(g)}var f=e.currentGranularity.getDatePeriods().filter(function(e){return e.index%1===0}).length;return a.setMeasures(h.labelFormat,e.currentGranularity.getType(),f,l,t,c),a.updateCursors(e,t.cellWidth),h}},a.prototype.render=function(e,i,a,r){var o=this.timelineData.timelineDatapoints.filter(function(e){return e.index%1===0}).length;this.svgWidth=1+this.timelineProperties.cellHeight+a.cellWidth*o,this.renderTimeRangeText(e,i.rangeTextFormat),this.timelineDiv.attr({height:s(r.viewport.height),width:s(r.viewport.width),"drag-resize-disabled":!0}).style({"overflow-x":"auto","overflow-y":"auto"}),this.svg.attr({height:s(Math.max(0,r.viewport.height-this.timelineMargins.TopMargin)),width:s(Math.max(0,this.svgWidth))});var n=t.SVGUtil.translate(a.leftMargin,a.topMargin),l=t.SVGUtil.translate(a.cellHeight/2,a.topMargin);this.mainGroupElement.attr("transform",l),this.selectorContainer.attr("transform",n),this.cursorGroupElement.attr("transform",l);var c=this.timelineData.currentGranularity.getExtendedLabel(),h=this.timelineData.currentGranularity.getType(),u=0,p=1.5;this.renderLabels(c.yearLabels,this.yearLabelsElement,u,0===h),u+=p,this.renderLabels(c.quarterLabels,this.quarterLabelsElement,u,1===h),u+=p,this.renderLabels(c.monthLabels,this.monthLabelsElement,u,2===h),u+=p,this.renderLabels(c.weekLabels,this.weekLabelsElement,u,3===h),u+=p,this.renderLabels(c.dayLabels,this.dayLabelsElement,u,4===h),this.renderCells(e,i,a,r.suppressAnimations),this.renderCursors(e,i,a.cellHeight,a.cellsYPosition)},a.prototype.renderLabels=function(i,a,r,o){var n=this,s=a.selectAll(this.timelineSelectors.textLabel.selector);if(!this.timelineFormat.labelFormat.showProperty)return void s.remove();var h=s.data(i);h.enter().append("text").classed(this.timelineSelectors.textLabel["class"],!0),h.text(function(a,r){if(!o&&0===r&&i.length>1){var s=l(n.timelineFormat.labelFormat.sizeProperty),c={text:i[0].text,fontFamily:"arial",fontSize:s},h=e.TextMeasurementService.measureSvgTextWidth(c)/2;c={text:i[1].text,fontFamily:"arial",fontSize:s};var u=e.TextMeasurementService.measureSvgTextWidth(c)/2,p=n.timelineProperties.cellWidth*(i[1].id-i[0].id);if(h+u>p)return""}var d={label:a.text,maxWidth:n.timelineProperties.cellWidth*(o?.9:3),fontSize:n.timelineFormat.labelFormat.sizeProperty};return t.dataLabelUtils.getLabelFormattedText(d)}).style("font-size",l(this.timelineFormat.labelFormat.sizeProperty)).attr({x:function(e){return(e.id+.5)*n.timelineProperties.cellWidth},y:this.timelineProperties.textYPosition+(1+r)*c(this.timelineFormat.labelFormat.sizeProperty),fill:this.timelineFormat.labelFormat.colorProperty}).append("title").text(function(e){return e.title}),h.exit().remove()},a.prototype.clearData=function(){this.initialized=!1,this.mainGroupElement.selectAll(this.timelineSelectors.CellRect.selector).remove(),this.mainGroupElement.selectAll(this.timelineSelectors.textLabel.selector).remove(),this.rangeText.text(""),this.cursorGroupElement.selectAll(this.timelineSelectors.SelectionCursor.selector).remove(),this.svg.select(this.timelineSelectors.TimelineSlicer.selector).remove(),this.mainGroupElement.selectAll(this.timelineSelectors.textLabel.selector)},a.updateCursors=function(e,t){var i=e.timelineDatapoints[e.selectionStartIndex].datePeriod;e.cursorDataPoints[0].selectionIndex=i.index;var a=e.timelineDatapoints[e.selectionEndIndex].datePeriod;e.cursorDataPoints[1].selectionIndex=a.index+a.fraction},a.fillTimelineFormat=function(t,i){var a={rangeTextFormat:{showProperty:e.DataViewObjects.getValue(t,g,i.TimelineDefaultTimeRangeShow),colorProperty:e.DataViewObjects.getFillColor(t,d,i.DefaultTimeRangeColor),sizeProperty:e.DataViewObjects.getValue(t,m,i.TimelineDefaultTextSize)},cellFormat:{colorInProperty:e.DataViewObjects.getFillColor(t,u,i.TimelineDefaultCellColor),colorOutProperty:e.DataViewObjects.getFillColor(t,p,i.TimelineDefaultCellColorOut)},labelFormat:{showProperty:e.DataViewObjects.getValue(t,v,i.DefaultLabelsShow),colorProperty:e.DataViewObjects.getFillColor(t,f,i.DefaultLabelColor),sizeProperty:e.DataViewObjects.getValue(t,y,i.TimelineDefaultTextSize)},calendarFormat:{firstMonthProperty:e.DataViewObjects.getValue(t,x,1),firstDayProperty:Math.max(1,Math.min(31,e.DataViewObjects.getValue(t,E,i.DefaultFirstDay))),weekDayProperty:Math.max(0,Math.min(6,e.DataViewObjects.getValue(t,b,i.DefaultFirstWeekDay)))}};return a},a.prototype.fillCells=function(e){var t=this,i=this.timelineData.timelineDatapoints,a=this.mainGroupElement.selectAll(this.timelineSelectors.CellRect.selector).data(i);a.attr("fill",function(i){return P.getCellColor(i,t.timelineData,e)})},a.prototype.renderCells=function(e,t,i,a){var r=this,o=e.timelineDatapoints,n=0,l=this.cellsElement.selectAll(this.timelineSelectors.CellRect.selector).data(o);l.enter().append("rect").classed(this.timelineSelectors.CellRect["class"],!0),l.attr({height:s(i.cellHeight),width:function(e){return s(e.datePeriod.fraction*i.cellWidth)},x:function(e){var t=n;return n+=e.datePeriod.fraction*i.cellWidth,s(t)},y:s(i.cellsYPosition),id:function(e){return e.index}});var c=function(a,o){d3.event.preventDefault();var n=r.timelineData.cursorDataPoints,s=d3.event;s.altKey||s.shiftKey?r.timelineData.selectionEndIndex<o?(n[1].selectionIndex=a.datePeriod.index+a.datePeriod.fraction,e.selectionEndIndex=o):(n[0].selectionIndex=a.datePeriod.index,e.selectionStartIndex=o):(e.selectionStartIndex=o,e.selectionEndIndex=o,n[0].selectionIndex=a.datePeriod.index,n[1].selectionIndex=a.datePeriod.index+a.datePeriod.fraction),r.fillCells(t.cellFormat),r.renderCursors(e,t,i.cellHeight,i.cellsYPosition),r.renderTimeRangeText(e,t.rangeTextFormat),r.setSelection(e)};l.on("click",c).on("touchstart",c),this.fillCells(t.cellFormat),l.exit().remove()},a.prototype.dragstarted=function(){this.timelineData.dragging=!0},a.prototype.dragged=function(e){if(this.timelineData.dragging===!0){var t=1,i=d3.select(this.timelineSelectors.TimelineVisual.selector);if(i){var a=i.style("transform");if(void 0!==a&&"none"!==a){var r=a.split("(")[1];t=Number(r.split(", ")[0])}}var o=this.findCursorOverElement(d3.event.x);if(!o)return;var n=o.datapoint,s=o.index;0===e.cursorIndex&&s<=this.timelineData.selectionEndIndex&&(this.timelineData.selectionStartIndex=s,this.timelineData.cursorDataPoints[0].selectionIndex=n.datePeriod.index),1===e.cursorIndex&&s>=this.timelineData.selectionStartIndex&&(this.timelineData.selectionEndIndex=s,this.timelineData.cursorDataPoints[1].selectionIndex=n.datePeriod.index+n.datePeriod.fraction),this.fillCells(this.timelineFormat.cellFormat),this.renderCursors(this.timelineData,this.timelineFormat,this.timelineProperties.cellHeight,this.timelineProperties.cellsYPosition),this.renderTimeRangeText(this.timelineData,this.timelineFormat.rangeTextFormat)}},a.prototype.findCursorOverElement=function(e){var t=this.timelineData.timelineDatapoints||[],i=t.length,a=this.timelineProperties.cellWidth;if(t[0]&&t[1]&&e<=t[1].index*a)return{index:0,datapoint:t[0]};if(t[i-1]&&e>=t[i-1].index*a)return{index:i-1,datapoint:t[i-1]};for(var r=1;i>r;r++){var o=t[r].index*a,n=t[r+1].index*a;if(e>=o&&n>=e)return{index:r,datapoint:t[r]}}return null},a.prototype.dragended=function(){this.setSelection(this.timelineData)},a.prototype.renderCursors=function(e,i,a,r){var o=this,n=this.cursorGroupElement.selectAll(this.timelineSelectors.SelectionCursor.selector).data(e.cursorDataPoints);return n.enter().append("path").classed(this.timelineSelectors.SelectionCursor["class"],!0),n.attr("transform",function(e){return t.SVGUtil.translate(e.selectionIndex*o.timelineProperties.cellWidth,a/2+r)}).attr({d:d3.svg.arc().innerRadius(0).outerRadius(a/2).startAngle(function(e){return e.cursorIndex*Math.PI+Math.PI}).endAngle(function(e){return e.cursorIndex*Math.PI+2*Math.PI})}).call(this.drag),n.exit().remove(),n},a.prototype.renderTimeRangeText=function(e,i){var a=(T.length+2)*this.timelineProperties.elementWidth,r=this.svgWidth-a-this.timelineProperties.leftMargin;if(i.showProperty&&r>0){var o=P.timeRangeText(e),n={label:o,maxWidth:r,fontSize:i.sizeProperty},s=t.dataLabelUtils.getLabelFormattedText(n);this.rangeText.classed(this.timelineSelectors.SelectionRangeContainer["class"],!0),this.rangeText.attr({x:T.length*(this.timelineProperties.elementWidth+this.timelineProperties.leftMargin),y:40,fill:i.colorProperty}).style({"font-size":l(i.sizeProperty)}).text(s).append("title").text(o)}else this.rangeText.text("")},a.prototype.setSelection=function(t){this.requiresNoUpdate=!0;var i=e.data.SQExprBuilder.dateTime(P.getStartSelectionDate(t)),a=e.data.SQExprBuilder.dateTime(new Date(P.getEndSelectionDate(t).getTime()-1)),r=e.data.SQExprBuilder.between(t.columnIdentity,i,a),o=e.data.SemanticFilter.fromSQExpr(r),n={merge:[{objectName:"general",selector:void 0,properties:{filter:o}}]};this.hostServices.persistProperties(n),this.hostServices.onSelect({data:[]})},a.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;switch(e.objectName){case"rangeHeader":this.enumerateRangeHeader(i,this.dataView);break;case"cells":this.enumerateCells(i,this.dataView);break;case"labels":this.enumerateLabels(i,this.dataView);break;case"calendar":this.enumerateCalendar(i,this.dataView);break;case"weekDay":this.enumerateWeekDay(i,this.dataView)}return i.complete()},a.prototype.enumerateRangeHeader=function(t,i){var a=i&&i.metadata?i.metadata.objects:void 0;t.pushInstance({objectName:"rangeHeader",displayName:"Selection Color",selector:null,properties:{show:e.DataViewObjects.getValue(a,g,this.defaultTimelineProperties.TimelineDefaultTimeRangeShow),fontColor:e.DataViewObjects.getFillColor(a,d,this.defaultTimelineProperties.DefaultTimeRangeColor),textSize:e.DataViewObjects.getValue(a,m,this.defaultTimelineProperties.TimelineDefaultTextSize)}})},a.prototype.enumerateCells=function(t,i){var a=i&&i.metadata?i.metadata.objects:void 0;t.pushInstance({objectName:"cells",selector:null,properties:{fillSelected:e.DataViewObjects.getFillColor(a,u,this.defaultTimelineProperties.TimelineDefaultCellColor),fillUnselected:e.DataViewObjects.getFillColor(a,p,this.defaultTimelineProperties.TimelineDefaultCellColorOut)}})},a.prototype.enumerateLabels=function(t,i){var a=i&&i.metadata?i.metadata.objects:void 0;t.pushInstance({objectName:"labels",selector:null,properties:{show:e.DataViewObjects.getValue(a,v,this.defaultTimelineProperties.DefaultLabelsShow),fontColor:e.DataViewObjects.getFillColor(a,f,this.defaultTimelineProperties.DefaultLabelColor),textSize:e.DataViewObjects.getValue(a,y,this.defaultTimelineProperties.TimelineDefaultTextSize)}})},a.prototype.enumerateCalendar=function(t,i){var a=i&&i.metadata?i.metadata.objects:void 0;t.pushInstance({objectName:"calendar",selector:null,properties:{month:Math.max(1,Math.min(12,e.DataViewObjects.getValue(a,x,1))),day:Math.max(1,Math.min(31,e.DataViewObjects.getValue(a,E,1)))}})},a.prototype.enumerateWeekDay=function(t,i){var a=i&&i.metadata?i.metadata.objects:void 0;t.pushInstance({objectName:"weekDay",selector:null,properties:{day:Math.max(0,Math.min(6,e.DataViewObjects.getValue(a,b,0)))}})},a.capabilities={dataRoles:[{name:"Time",kind:e.VisualDataRoleKind.Grouping,displayName:"Time"}],dataViewMappings:[{conditions:[{Time:{max:1}}],categorical:{categories:{"for":{"in":"Time"},dataReductionAlgorithm:{sample:{}}},values:{select:[{bind:{to:"Time"}}]}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},selected:{type:{bool:!0}},filter:{type:{filter:{}},rule:{output:{property:"selected",selector:["Time"]}}}}},calendar:{displayName:"Fiscal Year Start",properties:{month:{displayName:"Month",type:{enumeration:i.Months}},day:{displayName:"Day",type:{numeric:!0}}}},weekDay:{displayName:"First Day of Week",properties:{day:{displayName:"Day",type:{enumeration:i.WeekDays}}}},rangeHeader:{displayName:"Range Header",properties:{show:{displayName:"Show",type:{bool:!0}},fontColor:{displayName:"Font color",type:{fill:{solid:{color:!0}}}},textSize:{displayName:"Text Size",type:{numeric:!0}}}},cells:{displayName:"Cells",properties:{fillSelected:{displayName:"Selected cell color",type:{fill:{solid:{color:!0}}}},fillUnselected:{displayName:"Unselected cell color",type:{fill:{solid:{color:!0}}}}}},labels:{displayName:"Labels",properties:{show:{displayName:"Show",type:{bool:!0}},fontColor:{displayName:"Font color",type:{fill:{solid:{color:!0}}}},textSize:{displayName:"Text Size",type:{numeric:!0}}}}}},a}();i.Timeline=L}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=e.visuals.valueFormatter,o=a.PixelConverter,n="axisGraphicsContext",s="dataPointsContainer",l="x axis",c="y axis",h="#777",u=8,p=4,d=10,m="#666666",g="wf_segoe-ui_normal",f="normal",y=20,v=10,x=20,E=45,b=10,T=20,w={legendSettings:{show:!0,showTitle:!0,labelColor:m,titleText:"",fontSize:u},categoryAxisSettings:{show:!0,labelColor:h,showAxisTitle:!1},valueAxisSettings:{show:!0,labelColor:h,showAxisTitle:!1},dataLabelsSettings:t.dataLabelUtils.getDefaultPointLabelSettings()},S=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.selection=e.selection,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.selection.on("click",function(e,i){t.handleSelection(e,d3.event.ctrlKey)}),this.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var i=this.interactivityService.hasSelection();this.selection.style("fill-opacity",function(a){return t.ColumnUtil.getFillOpacity(a.selected,a.highlight,!a.highlight&&e,!a.selected&&i)})},e}(),R=function(){function i(){this.margin={left:E,right:15,bottom:y,top:10}}return i.prototype.converter=function(a,n,s){if(!(a&&a.categorical&&a.categorical.values&&a.categorical.categories&&n))return null;for(var l,c,h=a.categorical,p=h.categories,d=h.values,m=[],g={dataPoints:[],title:d.source?d.source.displayName:"",fontSize:u},f=0,y=p&&p.length>0?p[0]:null,v=i.Properties.general.formatString,x=!!(d.length>0&&d[0].highlights),E=this.parseSettings(a),b=o.fromPoint(E.dataLabelsSettings.fontSize),T=0;T<d.length;T++){var w=d[T].source.groupName,S=d[T].identity?t.SelectionId.createWithId(d[T].identity):t.SelectionId.createWithMeasure(d[T].source.queryName);w?g.dataPoints.push({label:w,color:n.getColorByIndex(T).value,icon:t.LegendIcon.Box,selected:!1,identity:S}):w=d[T].source.displayName;var R=t.TooltipBuilder.createTooltipInfo(v,{categories:null,values:d},null,null,null,null,T);m[T]={dataPoints:[],tooltipInfo:R,highlight:x,identity:S,selected:!1};var C=d[T].values;if(0!==C.length)for(var A=0;A<C.length;A++){var M=x?d[T].highlights[A]:C[A];M>f&&(f=M),m[T].dataPoints.push({x:A,y:isNaN(M)?0:M,text:w,labelFontSize:b})}}s&&s.applySelectionStateToData(m),l=r.create({format:"g",value:f}),c=r.create({format:r.getFormatString(y.source,i.Properties.general.formatString),value:y.values});for(var H=[],P=this.getTextPropertiesFunction,D=0;D<y.values.length;D++){var _=void 0;if(null!=y.values[D]){_=c.format(y.values[D]);var L=e.TextMeasurementService.measureSvgTextWidth(P(_));L>i.MaxNumberOfAxisXValues&&(i.MaxNumberOfAxisXValues=L)}H.push(_)}return{series:m,legendData:g,valueFormatter:l,categoryFormatter:c,streamGraphSettings:E,categoriesText:H}},i.prototype.parseSettings=function(t){if(!t||!t.metadata)return w;var a=t.metadata.objects,r=_.cloneDeep(w),o=r.categoryAxisSettings;o.show=e.DataViewObjects.getValue(a,i.Properties.categoryAxis.show,o.show),o.labelColor=e.DataViewObjects.getFillColor(a,i.Properties.categoryAxis.labelColor,o.labelColor),o.showAxisTitle=e.DataViewObjects.getValue(a,i.Properties.categoryAxis.showAxisTitle,o.showAxisTitle);var n=r.valueAxisSettings;n.show=e.DataViewObjects.getValue(a,i.Properties.valueAxis.show,n.show),n.labelColor=e.DataViewObjects.getFillColor(a,i.Properties.valueAxis.labelColor,n.labelColor),n.showAxisTitle=e.DataViewObjects.getValue(a,i.Properties.valueAxis.showAxisTitle,n.showAxisTitle);var s=r.dataLabelsSettings;s.show=e.DataViewObjects.getValue(a,i.Properties.labels.show,s.show),s.labelColor=e.DataViewObjects.getFillColor(a,i.Properties.labels.color,s.labelColor),s.fontSize=e.DataViewObjects.getValue(a,i.Properties.labels.fontSize,s.fontSize);var l=r.legendSettings,c=t.categorical.values.source,h=c&&_.isEmpty(l.titleText)?c.displayName:l.titleText;return l.show=e.DataViewObjects.getValue(a,i.Properties.legend.show,l.show),l.showTitle=e.DataViewObjects.getValue(a,i.Properties.legend.showTitle,l.showTitle),l.titleText=e.DataViewObjects.getValue(a,i.Properties.legend.titleText,h),l.labelColor=e.DataViewObjects.getValue(a,i.Properties.legend.labelColor,l.labelColor),l.fontSize=e.DataViewObjects.getValue(a,i.Properties.legend.fontSize,l.fontSize),_.isEmpty(l.titleText)&&(l.titleText=h),r},i.prototype.init=function(e){var a=e.element,r=this.svg=d3.select(a.get(0)).append("svg").classed(i.VisualClassName,!0).style("position","absolute");this.clearCatcher=t.appendClearCatcher(r),this.axisGraphicsContext=r.append("g").classed(n,!0),this.xAxis=this.axisGraphicsContext.append("g").classed(l,!0),this.yAxis=this.axisGraphicsContext.append("g").classed(c,!0),this.dataPointsContainer=r.append("g").classed(s,!0),this.viewport=e.viewport,this.colors=e.style.colorPalette.dataColors,this.behavior=new S;var o=e.interactivity;this.interactivityService=t.createInteractivityService(e.host),this.legend=t.createLegend(a,o&&o.isInteractiveLegend,this.interactivityService,!0)},i.prototype.update=function(e){if(!e.dataViews||!e.dataViews[0]||!e.dataViews[0].categorical)return void this.clearData();this.viewport={width:Math.max(0,e.viewport.width),height:Math.max(0,e.viewport.height)};var i=e.suppressAnimations?0:250,a=this.dataView=e.dataViews[0],r=this.data=this.converter(a,this.colors,this.interactivityService);if(!r||!r.series||!r.series.length)return void this.clearData();this.renderLegend(r),this.renderXAxisLabels(),this.renderYAxisLabels(),this.svg.attr({width:this.viewport.width+"px",height:this.viewport.height+"px"});var o=this.renderChart(r.series,i);t.TooltipManager.addTooltip(o,function(e){return e.data.tooltipInfo});var n=this.interactivityService;if(n){var s={selection:o,clearCatcher:this.clearCatcher,interactivityService:n};n.bind(r.series,this.behavior,s)}},i.prototype.getStreamGraphLabelLayout=function(e,t){var i=this.data.streamGraphSettings.dataLabelsSettings,a=o.fromPoint(i.fontSize);return{labelText:function(e){return e.text},labelLayout:{x:function(t){return e(t.x)},y:function(e){return t(e.y0)}},filter:function(e){return null!=e&&null!=e.text},style:{fill:i.labelColor,"font-size":a}}},i.prototype.renderChart=function(e,a){var r=this,o=d3.layout.stack().values(function(e){return e.dataPoints}),n=this.viewport.width,l=this.viewport.height;this.getWiggle(this.dataView)&&o.offset("wiggle");var c=o(e),h=this.margin,u=d3.scale.linear().domain([0,e[0].dataPoints.length-1]).range([h.left,n-h.right]),d=d3.max(c,function(e){return d3.max(e.dataPoints,function(e){return e.y0+e.y})}),m=d3.min(c,function(e){return d3.min(e.dataPoints,function(e){return e.y0+e.y})}),g=d3.scale.linear().domain([Math.min(m,0),d]).range([l-h.bottom,h.top]).nice(),f=d3.svg.area().interpolate("monotone").x(function(e){return u(e.x)}).y0(function(e){return g(e.y0)}).y1(function(e){return g(e.y0+e.y)}).defined(function(e){return!isNaN(e.y0)&&!isNaN(e.y)}),y=this.dataPointsContainer.selectAll(i.Layer.selector).data(c);if(y.enter().append("path").classed(i.Layer["class"],!0),y.style("fill",function(e,t){return r.colors.getColorByIndex(t).value}).style("fill-opacity",t.ColumnUtil.DefaultOpacity).transition().duration(a).attr("d",function(e){return f(e.dataPoints)}),y.selectAll("path").append("g").classed(s,!0),y.exit().remove(),this.data.streamGraphSettings.dataLabelsSettings.show){var v=d3.scale.linear().domain([0,e[0].dataPoints.length-1]).range([0,n-h.left-h.right]),x=this.getStreamGraphLabelLayout(v,g),E=[];e.forEach(function(e){var t;t=e.dataPoints.filter(function(e){return e&&null!==e.y&&void 0!==e.y}),t.length>0&&(E=E.concat(t))});var b={height:l-h.top-h.bottom,width:n-h.right-h.left},T=t.dataLabelUtils.drawDefaultLabelsForDataPointChart(E,this.svg,x,b);if(T){var w=p+h.left;T.attr("transform",function(e){return t.SVGUtil.translate(w+e.size.width/2,e.size.height/2)})}}else t.dataLabelUtils.cleanDataLabels(this.svg);return this.drawAxis(this.data,u,g),y},i.prototype.drawAxis=function(a,r,o){for(var n=this.margin,s=this.viewport.height-n.bottom,l=this.viewport.width-n.left-n.right,c=this.data.categoriesText,h=d3.svg.axis(),u=i.MaxNumberOfAxisXValues,p=this.getTextPropertiesFunction,m=0;m<c.length;m++)if(null!=c[m]){var g=c[m].toString(),f=e.TextMeasurementService.measureSvgTextWidth(p(g));f>u&&(u=f)}h.scale(r).orient("bottom").ticks(c.length).tickFormat(function(t){var i=c[t];return a.categoryFormatter&&(i=a.categoryFormatter.format(i)),null===t||void 0===t||0!==t&&t!==c.length-1||(i=e.TextMeasurementService.getTailoredTextOrDefault(p(i),2*(t?n.right:n.left))),i});var y=d3.svg.axis().scale(o).orient("left").tickFormat(function(t){var i=t;return a.valueFormatter&&(i=a.valueFormatter.format(i)),i=e.TextMeasurementService.getTailoredTextOrDefault(p(i.toString()),E-d)});this.setMaxTicks(h,l,Math.max(2,Math.round(l/u))),this.setMaxTicks(y,s);var v=this.data.streamGraphSettings.valueAxisSettings;if(v.show){var x=v.labelColor;this.yAxis.attr("transform",t.SVGUtil.translate(n.left,0)).call(y),this.yAxis.selectAll("text").style("fill",x)}else this.yAxis.selectAll("*").remove();var b=this.data.streamGraphSettings.categoryAxisSettings;if(b.show){var x=b.labelColor;this.xAxis.attr("transform",t.SVGUtil.translate(0,s)).call(h),this.xAxis.selectAll("text").style("fill",x)}else this.xAxis.selectAll("*").remove()},i.prototype.renderYAxisLabels=function(){this.axisGraphicsContext.selectAll(i.YAxisLabel.selector).remove();var a=this.data.streamGraphSettings.valueAxisSettings;if(this.margin.left=a.show?E:b,a.showAxisTitle){this.margin.left+=T;var r=this.data.streamGraphSettings.categoryAxisSettings,o=r.show===!0,n=r.showAxisTitle===!0,s=this.margin.top,l=this.viewport.height-s-(o?y:v)-(n?x:0),c=this.dataView.categorical.values,h=c.source?c.source.displayName:this.getYAxisTitleFromValues(c),u=this.getTextPropertiesFunction(h);h=e.TextMeasurementService.getTailoredTextOrDefault(u,l);var p=i.YAxisLabel["class"],d=this.axisGraphicsContext.append("text").style("text-anchor","middle").style("font-family",u.fontFamily).style("font-size",u.fontSize).style("font-style",u.fontStyle).style("font-weight",u.fontWeight).text(h).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":p,transform:"rotate(-90)",fill:a.labelColor,x:-(s+l/2),dy:"1em"})})});d.call(t.AxisHelper.LabelLayoutStrategy.clip,l,e.TextMeasurementService.svgEllipsis)}},i.prototype.getYAxisTitleFromValues=function(e){for(var i=[],a=0;a<e.length;a++)e[a]&&e[a].source&&e[a].source.displayName&&i.push({displayName:e[a].source.displayName});var r=i.map(function(e){return e?e.displayName:""}).filter(function(e,t,i){return""!==e&&i.indexOf(e)===t});return t.valueFormatter.formatListAnd(r)},i.prototype.renderXAxisLabels=function(){this.axisGraphicsContext.selectAll(i.XAxisLabel.selector).remove();var a=this.data.streamGraphSettings.categoryAxisSettings;if(this.margin.bottom=a.show?y:v,a.showAxisTitle&&this.dataView.categorical.categories[0].source){this.margin.bottom+=x;var r=this.data.streamGraphSettings.valueAxisSettings,o=r.show===!0,n=r.showAxisTitle===!0,s=(o?E:b)+(n?T:0),l=this.viewport.width-this.margin.right-s,c=this.viewport.height,h=this.dataView.categorical.categories[0].source.displayName,u=this.getTextPropertiesFunction(h);h=e.TextMeasurementService.getTailoredTextOrDefault(u,l);var p=i.XAxisLabel["class"],d=this.axisGraphicsContext.append("text").style("text-anchor","middle").style("font-family",u.fontFamily).style("font-size",u.fontSize).style("font-weight",u.fontWeight).text(h).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":p,transform:t.SVGUtil.translate(s+l/2,c),fill:a.labelColor,dy:"-0.5em"})})});d.call(t.AxisHelper.LabelLayoutStrategy.clip,l,e.TextMeasurementService.svgEllipsis)}},i.prototype.renderLegend=function(i){var a=i.streamGraphSettings.legendSettings,r=i.legendData;if(this.dataView&&this.dataView.metadata){var o=e.DataViewObjects.getObject(this.dataView.metadata.objects,"legend",{});o.titleText=a.titleText,t.LegendData.update(r,o);var n=o[t.legendProps.position];n&&this.legend.changeOrientation(t.LegendPosition[n]),this.legend.drawLegend(r,_.clone(this.viewport)),t.Legend.positionChartArea(this.svg,this.legend),this.updateViewPort()}},i.prototype.updateViewPort=function(){var e=this.legend.getMargins(),i=this.legend.getOrientation();switch(i){case t.LegendPosition.Top:case t.LegendPosition.TopCenter:case t.LegendPosition.Bottom:case t.LegendPosition.BottomCenter:this.viewport.height=Math.max(0,this.viewport.height-e.height);break;case t.LegendPosition.Left:case t.LegendPosition.LeftCenter:case t.LegendPosition.Right:case t.LegendPosition.RightCenter:this.viewport.width=Math.max(0,this.viewport.width-e.width)}},i.prototype.setMaxTicks=function(e,t,i){var a=void 0===i?this.getTicksByAxis(e).length:Math.min(i,this.getTicksByAxis(e).length);e.scale().domain.toString()===d3.scale.linear().domain.toString()?e.ticks(this.getFittedTickLength(e,t,a)):e.tickValues(this.getFittedTickValues(e,t,a))},i.prototype.getFittedTickLength=function(e,t,i){for(var a=this.getTicksByAxis(e),r=this.getMeasureTickFunction(e,a);i>0&&t>0&&(this.measureTicks(a,r)>t||e.scale().ticks([i]).length>i);i--,a=this.getTicksByAxis(e))e.ticks(i);return i},i.prototype.getFittedTickValues=function(e,t,i){for(var a,r=this.getTicksByAxis(e),o=[],n=this.getMeasureTickFunction(e,r),s=i,l=[];i>0&&t>0;s--,l=[]){switch(s){case 0:return[];case 1:l=[0];break;case 2:l=[0,r.length-1];break;default:for(var c=r.length/(s-1),h=0;s-1>h;h++)l.push(Math.round(c*h));l.push(r.length-1)}var u=l.map(function(e){return[r[e],e]});if(a=t/r.length*2,u.reduce(function(e,t){return o.push([n(e[0])+n(t[0]),(t[1]-e[1])*a]),t}),!o.some(function(e){return e[0]>e[1]}))return u.map(function(e){return e[0]})}return[]},i.prototype.measureTicks=function(e,t){return e.map(function(e){return t(e)}).reduce(function(e,t){return e+t})},i.prototype.getTicksByAxis=function(e){var t=e.scale(),i=null===e.tickValues()?t.ticks?t.ticks.apply(t,e.ticks()):t.domain():e.tickValues();return void 0===i.length?[i]:i},i.prototype.getMeasureTickFunction=function(t,i){var a="top"===t.orient()||"bottom"===t.orient()?e.TextMeasurementService.measureSvgTextWidth:e.TextMeasurementService.measureSvgTextHeight,r=this.getTextPropertiesFunction,o={};return function(e){return o[e]?o[e]:o[e]=a(r(t.tickFormat()(e)))+t.tickPadding()}},i.prototype.getTextPropertiesFunction=function(e){var t=g,i=o.fromPoint(u),a=f;return{text:e,fontFamily:t,fontSize:i,fontWeight:a}},i.prototype.getWiggle=function(t){if(t&&t.metadata){
var i=t.metadata.objects;if(i){var a=e.DataViewObjects.getObject(i,"general",void 0);if(a)return a.wiggle}}return!0},i.prototype.enumerateValueAxisValues=function(e){var t=this.data&&this.data.streamGraphSettings?this.data.streamGraphSettings.valueAxisSettings:w.valueAxisSettings;e.pushInstance({selector:null,objectName:"valueAxis",displayName:"Y-Axis",properties:{show:t.show,showAxisTitle:t.showAxisTitle,labelColor:t.labelColor}})},i.prototype.enumerateCategoryAxisValues=function(e){var t=this.data&&this.data.streamGraphSettings?this.data.streamGraphSettings.categoryAxisSettings:w.categoryAxisSettings;e.pushInstance({selector:null,objectName:"categoryAxis",displayName:"X-Axis",properties:{show:t.show,showAxisTitle:t.showAxisTitle,labelColor:t.labelColor}})},i.prototype.enumerateLegend=function(e){var i=this.data&&this.data.streamGraphSettings?this.data.streamGraphSettings.legendSettings:w.legendSettings;e.pushInstance({selector:null,objectName:"legend",displayName:"Legend",properties:{show:i.show,position:t.LegendPosition[this.legend.getOrientation()],showTitle:i.showTitle,titleText:i.titleText,labelColor:i.labelColor,fontSize:i.fontSize}})},i.prototype.clearData=function(){this.svg.selectAll(i.Layer.selector).remove(),this.legend.drawLegend({dataPoints:[]},this.viewport),this.yAxis.selectAll("*").remove(),this.axisGraphicsContext.selectAll(i.YAxisLabel.selector).remove(),this.xAxis.selectAll("*").remove(),this.axisGraphicsContext.selectAll(i.XAxisLabel.selector).remove(),this.svg.select(".labels").remove()},i.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},i.prototype.enumerateObjectInstances=function(e){var i,a=new t.ObjectEnumerationBuilder,r=this.dataView;switch(this.data&&(i=this.data.streamGraphSettings.dataLabelsSettings?this.data.streamGraphSettings.dataLabelsSettings:w.dataLabelsSettings),e.objectName){case"legend":r&&r.categorical&&r.categorical.values&&r.categorical.values.source&&this.enumerateLegend(a);break;case"categoryAxis":this.enumerateCategoryAxisValues(a);break;case"valueAxis":this.enumerateValueAxisValues(a);break;case"labels":var o={enumeration:a,dataLabelsSettings:i,show:!0,fontSize:!0};t.dataLabelUtils.enumerateDataLabels(o);break;case"general":var n={objectName:"general",displayName:"General",selector:null,properties:{wiggle:this.getWiggle(r)}};a.pushInstance(n)}return a.complete()},i.VisualClassName="streamGraph",i.Properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},legend:{show:{objectName:"legend",propertyName:"show"},showTitle:{objectName:"legend",propertyName:"showTitle"},titleText:{objectName:"legend",propertyName:"titleText"},labelColor:{objectName:"legend",propertyName:"labelColor"},fontSize:{objectName:"legend",propertyName:"fontSize"}},categoryAxis:{show:{objectName:"categoryAxis",propertyName:"show"},labelColor:{objectName:"categoryAxis",propertyName:"labelColor"},showAxisTitle:{objectName:"categoryAxis",propertyName:"showAxisTitle"}},valueAxis:{show:{objectName:"valueAxis",propertyName:"show"},labelColor:{objectName:"valueAxis",propertyName:"labelColor"},showAxisTitle:{objectName:"valueAxis",propertyName:"showAxisTitle"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},fontSize:{objectName:"labels",propertyName:"fontSize"}}},i.Layer={"class":"layer",selector:".layer"},i.XAxisLabel={"class":"xAxisLabel",selector:".xAxisLabel"},i.YAxisLabel={"class":"yAxisLabel",selector:".yAxisLabel"},i.MaxNumberOfAxisXValues=5,i.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Series",kind:e.VisualDataRoleKind.Grouping,displayName:"Series"},{name:"Y",kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Values")}],dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:0}},{Category:{max:1},Series:{min:1,max:1},Y:{max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{bottom:{}}},values:{group:{by:"Series",select:[{"for":{"in":"Y"}}],dataReductionAlgorithm:{bottom:{}}}}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},wiggle:{type:{bool:!0},displayName:"Wiggle"}}},categoryAxis:{displayName:"X-Axis",properties:{show:{displayName:"show",type:{bool:!0}},showAxisTitle:{displayName:"Title",type:{bool:!0}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}}}},valueAxis:{displayName:"Y-Axis",properties:{show:{displayName:"show",type:{bool:!0}},showAxisTitle:{displayName:"Title",type:{bool:!0}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}}}},legend:{displayName:"Legend",properties:{show:{displayName:"show",type:{bool:!0}},position:{displayName:"Position",type:{enumeration:t.legendPosition.type}},showTitle:{displayName:"Title",type:{bool:!0}},titleText:{displayName:"Legend Name",type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},labels:{displayName:"Data Labels",properties:{show:{displayName:"Show",type:{bool:!0}},color:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}}},supportsHighlight:!0},i}();i.StreamGraph=R}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){function r(t){var i=!1;return e.createEnumType(Object.keys(t).filter(function(e,a){return!!(a%2)===i&&t[e]===e&&!void(i===!i)||!!(a%2)!==i}).map(function(e){return{value:e,displayName:e}}))}var o=t.utility.SelectionManager,n=e.visuals.valueFormatter,s=a.CssConstants.createClassAndSelector,l=e.TextMeasurementService;i.createEnumTypeFromEnum=r,function(e){e[e.DateOnly="Date only"]="DateOnly",e[e.TimeOnly="Time only"]="TimeOnly"}(i.PulseChartXAxisDateFormat||(i.PulseChartXAxisDateFormat={}));var c=i.PulseChartXAxisDateFormat;!function(e){e[e.Center="Center"]="Center",e[e.Bottom="Bottom"]="Bottom"}(i.XAxisPosition||(i.XAxisPosition={}));var h=i.XAxisPosition;!function(e){e[e.TopLeft="Top Left"]="TopLeft",e[e.TopRight="Top Right"]="TopRight"}(i.RunnerCounterPosition||(i.RunnerCounterPosition={}));var u=i.RunnerCounterPosition,p=function(){function i(e){e&&e.svg&&(this.svg=e.svg),this.margin=i.DefaultMargin}return i.getProperties=function(e){var t={};for(var i in e.objects){t[i]={};for(var a in e.objects[i].properties)t[i][a]={objectName:i,propertyName:a}}return t},i.GetPopupValueTextProperties=function(e,t){return void 0===t&&(t=12),{text:e||"",fontFamily:"sans-serif",fontSize:t+"px"}},i.GetPopupTitleTextProperties=function(e,t){return void 0===t&&(t=12),{text:e||"",fontFamily:"sans-serif",fontWeight:"bold",fontSize:t+"px"}},i.GetPopupDescriptionTextProperties=function(e,t){return void 0===t&&(t=12),{text:e||"",fontFamily:"sans-serif",fontSize:t+"px"}},i.GetRunnerCounterTextProperties=function(e,t){return void 0===t&&(t=12),{text:e||"",fontFamily:"sans-serif",fontSize:t+"px"}},i.ConvertTextPropertiesToStyle=function(e){return{"font-family":e.fontFamily,"font-weight":e.fontWeight,"font-size":e.fontSize}},i.GetDateTimeFormatString=function(e,t){switch(e){case c.DateOnly:return t;case c.TimeOnly:return"H:mm";default:return""}},i.GetFullWidthOfDateFormat=function(e,i){return i.text=t.valueFormatter.create({format:e}).format(new Date(2e3,10,20,20,20,20)),l.measureSvgTextWidth(i)},i.AddOnTouchClick=function(e,t){var i=function(e,i){d3.event.preventDefault(),t(e,i)};return e.on("click",i).on("touchstart",i)},i.getCategoricalColumnOfRole=function(e,t){var i=function(e){return e.filter(function(e){return e.source&&e.source.roles&&e.source.roles[t]})[0]};return i(e.categorical.categories)||i(e.categorical.values)},i.converter=function(e,a,r){if(!(e&&e.categorical&&e.categorical.values&&e.categorical.values[0]&&e.categorical.values[0].values&&e.categorical.categories))return null;var o=_.mapValues(i.RoleNames,function(t,a){return i.getCategoricalColumnOfRole(e,a)}),s=o.Timestamp;if(!s)return null;var h=!(s.source&&s.source.type&&s.source.type.dateTime),u=i.parseSettings(e,a,o),p=s.values;if(!p||_.isEmpty(e.categorical.values)||!o.Value||_.isEmpty(o.Value.values))return null;var d=Math.min.apply(null,o.Value.values),m=Math.max.apply(null,o.Value.values),g=Math.min.apply(null,p),f=Math.max.apply(null,p);u.xAxis.dateFormat=864e5>f-g&&new Date(f).getDate()===new Date(g).getDate()?c.TimeOnly:c.DateOnly,u.xAxis.formatterOptions={value:h?g:new Date(g),value2:h?f:new Date(f)},u.yAxis.formatterOptions={value:d,value2:m,format:n.getFormatString(o.Value.source,i.DefaultSettings.formatStringProperty)},h?u.xAxis.formatterOptions.format=n.getFormatString(s.source,i.DefaultSettings.formatStringProperty):u.xAxis.formatterOptions.format=i.GetDateTimeFormatString(u.xAxis.dateFormat,s.source.format);var y=70,v=h?60:i.GetFullWidthOfDateFormat(s.source.format,i.GetPopupValueTextProperties())+5,x=l.measureSvgTextHeight(i.GetPopupDescriptionTextProperties("lj",u.popup.fontSize)),E=o.RunnerCounter&&t.valueFormatter.getFormatString(o.RunnerCounter.source,u.formatStringProperty);u.popup.width=Math.max(v+20,u.popup.width);var b=i.DefaultSettings.dots.minSize,T=i.DefaultSettings.dots.maxSize;u.dots&&(b=u.dots.minSize,T=u.dots.maxSize);for(var w=i.createScale(!0,o.EventSize?[d3.min(o.EventSize.values),d3.max(o.EventSize.values)]:[0,0],b,T),S=t.CartesianHelper.getCategoryAxisProperties(e.metadata),R=(t.ColumnUtil.applyUserMinMax(h,e.categorical,S),!(!s.values||!s.source)),C=t.dataLabelUtils.getDefaultLineChartLabelSettings(),A=i.getGapWidths(p),M=Math.max.apply(null,A),H=0,P=0,D=1,L=e.categorical.values&&e.categorical.values.grouped(),N=L[P]&&L[P].values[H]&&L[P].values[H].values,V=L[D]&&L[D].values[H]&&L[D].values[H].values,z=[],I=[],F=0,O=0,k=s.values.length;k>F;F++,O++){var j=p[F],B=t.AxisHelper.normalizeNonFiniteNumber(s.values[F]),G=o.RunnerCounter&&o.RunnerCounter.values&&o.RunnerCounter.values[F],U=t.SelectionIdBuilder.builder().withCategory(s,F).createSelectionId(),W=Math.max((f-g)/i.MaxGapCount,i.MinGapWidth[u.xAxis.dateFormat]),X=A[F],Y=u.gaps.show&&X>0&&X>W+(100-u.gaps.visibleGapsPercentage)*(M-W)/100;if(Y&&I.length>0&&(z.push({displayName:L[P].name,key:U.getKey(),lineIndex:z.length,color:u.series.fill,xCol:s.source,yCol:s.source,data:I,identity:U,selected:!1,labelSettings:C,width:u.series.width,widthOfGap:X}),O=0,I=[]),!h||null!==j&&null!==B){var K=(e.categorical,null),q=o.EventSize&&o.EventSize.values&&o.EventSize.values[F]||0;if(o.EventTitle&&o.EventTitle.values&&o.EventTitle.values[F]||o.EventDescription&&o.EventDescription.values&&o.EventDescription.values[F]){var Z=j;!h&&j&&(Z=t.valueFormatter.create({format:s.source.format}).format(j)),K={value:Z,title:o.EventTitle&&o.EventTitle.values&&o.EventTitle.values[F],description:o.EventDescription&&o.EventDescription.values&&o.EventDescription.values[F]}}var Q={categoryValue:j,value:B,categoryIndex:F,seriesIndex:z.length,tooltipInfo:null,popupInfo:K,selected:!1,identity:U,key:JSON.stringify({ser:U.getKey(),catIdx:F}),labelFill:C.labelColor,labelSettings:C,x:j,y:N&&N[F]||V&&V[F]||0,pointColor:u.series.fill,groupIndex:i.getGroupIndex(F,L),eventSize:o.EventSize?w(q):0,runnerCounterValue:G,runnerCounterFormatString:E};I.push(Q)}}r&&r.applySelectionStateToData(I),I.length>0&&z.push({displayName:L[P].name,key:U.getKey(),lineIndex:z.length,color:u.series.fill,xCol:s.source,yCol:s.source,data:I,identity:U,selected:!1,labelSettings:C,width:u.series.width,widthOfGap:0}),S=t.CartesianHelper.getCategoryAxisProperties(e.metadata);var J=t.CartesianHelper.getValueAxisProperties(e.metadata),$=e.categorical.categories,ee=[];if($)for(var te=0;te<$.length;te++)$[te]&&$[te].source&&$[te].source.displayName&&ee.push({displayName:$[te].source.displayName});var ie=t.converterHelper.createAxesLabels(S,J,s.source,ee);return r&&r.applySelectionStateToData(z),{columns:o,series:z,isScalar:h,dataLabelsSettings:C,axesLabels:{x:ie.xAxisLabel,y:ie.yAxisLabel},hasDynamicSeries:R,categoryMetadata:s.source,categories:p,settings:u,grouped:L,hasHighlights:!!o.Value.highlights,widthOfXAxisLabel:y,widthOfTooltipValueLabel:v,heightOfTooltipDescriptionTextLine:x,runnerCounterHeight:l.measureSvgTextHeight(i.GetRunnerCounterTextProperties("lj",u.runnerCounter.fontSize))}},i.createAxisY=function(e,i,a,r){void 0===r&&(r=!0);var o=t.valueFormatter.create(a),n=Math.max(2,Math.round(i/40)),s=d3.svg.axis().scale(e).ticks(n).outerTickSize(0).tickFormat(o.format);return s},i.createAxisX=function(e,a,r,o,n,s,l){for(var c=i.getXAxisScales(a,e,r),u=new Array(c.length),p=0,d=!1;p<u.length;p++){var m=i.getXAxisValuesToDisplay(c[p],d,e,n,l);if(!d&&s===h.Bottom&&m.length<i.MinimumTicksToRotate){var g=i.getXAxisValuesToDisplay(c[p],!0,e,n,l);if(g.length>m.length){d=!0,p=-1;continue}}u[p]={values:m,scale:c[p],rotate:d}}return o.tickCount=u.length&&5*u.map(function(e){return e.values.length}).reduce(function(e,t){return e+t}),o.value=r.domain()[0],o.value2=r.domain()[1],u.forEach(function(e){var i=e.values.filter(function(e){return null!==e}),a=t.valueFormatter.create(o);e.axis=d3.svg.axis().scale(e.scale).tickValues(i).tickFormat(a.format).outerTickSize(0)}),u},i.getXAxisScales=function(e,t,a){return e.map(function(e){var r=e.data,o=r[0].categoryValue,n=r[r.length-1].categoryValue,s=a(r[0].categoryValue),l=a(r[r.length-1].categoryValue);return i.createScale(t,[o,n],s,l)})},i.getXAxisValuesToDisplay=function(e,t,a,r,o){var n=e,s=t?i.XAxisTickHeight*(t?Math.abs(Math.sin(i.AxisTickRotateAngle*Math.PI/180)):0):o,l=i.XAxisTickSpace;if(e.range()[1]<s)return[];var h=e.invert(e.range()[0]+s/2),u=e.invert(e.range()[1]-s/2),p=e.range()[1]-e.range()[0],d=Math.floor((p+l)/(s+l));t&&(d=Math.min(i.MinimumTicksToRotate,d));var m=[];if(m=a?d3.range(h,u,(u-h)/(100*d)):(r===c.TimeOnly?d3.time.minute:d3.time.day).range(h,u),(!m.length||_.last(m)<u)&&m.push(u),!d)return[];d=Math.min(m.length,d);var g=d3.scale.ordinal().domain(d3.range(d)).rangePoints([0,m.length-1]).range();m=g.map(function(e){return m[Math.round(e)]});for(var f=1;f<m.length;f++){var y=n(m[f-1]),v=n(m[f]);s+l/3>v-y&&m.splice(f--,1)}return m},i.getGroupIndex=function(e,t){for(var i=0;i<t.length;i++)if(t[i].values&&t[i].values[0]&&void 0!==t[i].values[0].values[e]&&null!==t[i].values[0].values[e])return i;return 0},i.getGapWidths=function(e){for(var t=[],i=0,a=0,r=e.length;r>i;i++)a&&e[i]?t.push(e[i]-a):t.push(0),a=e[i];return t},i.createScale=function(e,t,i,a){var r;return r=e?d3.scale.linear():d3.time.scale(),r.domain(t).range([i,a])},Object.defineProperty(i.prototype,"runnerCounterPlaybackButtonsHeight",{get:function(){return Math.max(i.PlaybackButtonsHeight,this.data&&this.data.runnerCounterHeight/2+17)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"popupHeight",{get:function(){return this.data&&this.data.settings&&this.data.settings.popup&&this.data.settings.popup.show&&this.data.settings.popup.height||0},enumerable:!0,configurable:!0}),i.prototype.init=function(a){e.formattingService.initialize(),this.host=a.host,this.selectionManager=new o({hostServices:this.host});var r=this.svg=d3.select(a.element.get(0)).append("svg").classed("pulseChart",!0);this.gaps=r.append("g").classed(i.Gaps["class"],!0),this.yAxis=r.append("g").attr("class","y axis"),this.chart=r.append("g").attr("class",i.Chart["class"]),this.dots=r.append("g").attr("class","dots"),this.animationDot=this.dots.append("circle").classed(i.AnimationDot["class"],!0).attr("display","none"),this.animationHandler=new m(this,r);var n=a.style;this.colors=n&&n.colorPalette?n.colorPalette.dataColors:new t.DataColorPalette},i.prototype.update=function(e){if(e&&e.dataViews&&e.dataViews[0]){this.viewport=$.extend({},e.viewport);var t=e.dataViews[0];if(this.updateData(i.converter(t,this.colors)),!this.validateData(this.data))return void this.clearAll(!0);var a=this.getChartWidth();if(this.calculateXAxisProperties(a),this.data.xScale.ticks(void 0).length<2)return void this.clearAll(!0);var r=this.getChartHeight(this.data.settings.xAxis.show&&this.data.series.some(function(e){return e.xAxisProperties.rotate}));this.calculateYAxisProperties(r),this.size={width:a,height:r},this.updateElements(),this.render(!0)}},i.prototype.updateData=function(e){if(!this.data)return void(this.data=e);var t=this.getDataArrayToCompare(this.data),i=this.getDataArrayToCompare(e);_.isEqual(t,i)||this.clearAll(!1),this.data=e},i.prototype.getDataArrayToCompare=function(e){if(!e||!e.series)return null;var t=_.flatten(e.series.map(function(e){return e.data}));return _.flatten(t.map(function(e){return e&&_.flatten([[e.categoryValue,e.eventSize,e.groupIndex,e.runnerCounterValue,e.y,e.seriesIndex],e.popupInfo&&[e.popupInfo.description,e.popupInfo.title,e.popupInfo.value]])}))},i.prototype.validateData=function(e){return e?!e.categories.some(function(e){return!(e instanceof Date||$.isNumeric(e))}):!1},i.prototype.getChartWidth=function(){var e=this.margin.right;this.data.settings.yAxis&&this.data.settings.yAxis.show&&(e+=i.MaxWidthOfYAxis);var t=this.viewport.width-this.margin.left-e;return Math.max(t,i.DefaultViewport.width)},i.prototype.getChartHeight=function(e){var t=10+(e?this.data.widthOfXAxisLabel*Math.abs(Math.sin(i.AxisTickRotateAngle*Math.PI/180)):3);!this.data.settings.popup.alwaysOnTop&&this.popupHeight&&(t=Math.max(this.margin.bottom+this.popupHeight,t));var a=this.viewport.height-this.margin.top-this.runnerCounterPlaybackButtonsHeight-t-this.popupHeight;return Math.max(a,i.DefaultViewport.height)},i.prototype.updateElements=function(){var e=this.margin.top+this.runnerCounterPlaybackButtonsHeight+this.popupHeight;this.svg.attr(this.viewport),this.svg.style("display",void 0),this.gaps.attr("transform",t.SVGUtil.translate(this.margin.left,e+this.size.height/2)),this.chart.attr("transform",t.SVGUtil.translate(this.margin.left,e)),this.yAxis.attr("transform",t.SVGUtil.translate(this.size.width+this.margin.left,e)),this.dots.attr("transform",t.SVGUtil.translate(this.margin.left,e))},i.prototype.calculateXAxisProperties=function(e){this.data.xScale=i.createScale(this.data.isScalar,[this.data.categories[0],this.data.categories[this.data.categories.length-1]],0,e);var t=i.createAxisX(this.data.isScalar,this.data.series,this.data.xScale,$.extend({},this.data.settings.xAxis.formatterOptions),this.data.settings.xAxis.dateFormat,this.data.settings.xAxis.position,this.data.widthOfXAxisLabel);this.data.series.forEach(function(e,i){e.xAxisProperties=t[i]})},i.prototype.calculateYAxisProperties=function(e){this.data.yScales=this.getYAxisScales(e);var t=[];this.data.yScales.forEach(function(e){return t=t.concat(e.domain())}),this.data.commonYScale=i.createScale(!0,[d3.max(t),d3.min(t)],0,e),this.data.yAxis=i.createAxisY(this.data.commonYScale,e,this.data.settings.yAxis.formatterOptions)},i.prototype.getYAxisScales=function(e){var t=this.data,a=e/t.grouped.length;return t.grouped.map(function(e,t){var r=e.values[0].values.map(function(e){return e||0}),o=Number.MAX_VALUE,n=-Number.MAX_VALUE;if(r.forEach(function(e){o>e&&(o=e),e>n&&(n=e)}),n===o){var s=0===n?1:Math.abs(n/2);n+=s,o-=s}return i.createScale(!0,[n,o],a*t,a*(t+1))})},Object.defineProperty(i.prototype,"autoplayPauseDuration",{get:function(){return 1e3*(this.data&&this.data.settings&&this.data.settings.playback?this.data.settings.playback.autoplayPauseDuration:i.DefaultSettings.playback.autoplayPauseDuration)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isAutoPlay",{get:function(){return this.data&&this.data.settings&&this.data.settings.playback&&this.data.settings.playback.autoplay},enumerable:!0,configurable:!0}),i.prototype.render=function(e){var i,a=t.AnimatorCommon.GetAnimationDuration(this.animator,e),r=this.data;this.lastSelectedPoint=null;var o=r.xScale,n=r.yScales;return this.lineX=d3.svg.line().x(function(e){return o(e.categoryValue)}).y(function(e){return n[e.groupIndex](e.y)}),this.data&&this.data.settings&&this.data.settings.playback&&this.data.settings.playback.color&&this.animationHandler.setControlsColor(this.data.settings.playback.color),this.animationHandler.render(),this.animationHandler.setRunnerCounterValue(),this.renderAxes(r,a),this.renderGaps(r,a),i},i.prototype.renderAxes=function(e,t){this.renderXAxis(e,t),this.renderYAxis(e,t)},i.prototype.renderXAxis=function(e,a){var r,o,n,s=i.DefaultSettings.xAxis.color,l=i.DefaultSettings.xAxis.fontColor;this.data&&this.data.settings&&this.data.settings.xAxis&&(s=this.data.settings.xAxis.color,l=this.data.settings.xAxis.fontColor),r=this.rootSelection.selectAll(i.XAxisNode.selector),o=r.data(e.series),o.enter().insert("g","g."+i.LineContainer["class"]).classed(i.XAxisNode["class"],!0),o.call(function(t){t.forEach(function(t,i){d3.select(t[0]).call(e.series[i].xAxisProperties.axis.orient("bottom"))})}),o.exit().remove(),n=o.selectAll(".tick").selectAll(".axisBox").data([[]]),n.enter().insert("rect","text").classed("axisBox",!0),n.style("display",this.data.settings.xAxis.position===h.Center?"inherit":"none").style("fill",this.data.settings.xAxis.backgroundColor);var c=this.data.settings.xAxis.position===h.Center?-11:0;n.attr({x:-(this.data.widthOfXAxisLabel/2),y:c+"px",width:this.data.widthOfXAxisLabel,height:i.XAxisTickHeight+"px"}),n.exit().remove(),o.style("stroke",this.data.settings.xAxis.position===h.Center?s:"none").style("display",this.data.settings.xAxis.show?"inherit":"none"),o.call(function(e){var t=e.datum().xAxisProperties.rotate,a=t?Math.abs(Math.sin(i.AxisTickRotateAngle*Math.PI/180)):0,r=c+3;e.selectAll("text").attr("transform",function(){return"translate(0, "+(r+9+$(this).width()/2*a)+") rotate("+(t?i.AxisTickRotateAngle:0)+")"}).style("fill",l).style("stroke","none").attr("dy",-9)}),o.selectAll(".domain").style("stroke",s),o.selectAll(".domain").forEach(function(e){$(e).insertBefore($(e).parent().children().first())});var u=this.size.height;switch(this.data.settings.xAxis.position){case h.Center:u/=2;break;case h.Bottom:}o.attr("transform",t.SVGUtil.translate(0,u))},i.prototype.renderYAxis=function(e,t){var a=e.yAxis,r=!1,o=i.DefaultSettings.yAxis.color,n=i.DefaultSettings.yAxis.fontColor;a.orient("right"),this.data&&this.data.settings&&this.data.settings.yAxis&&this.data.settings.yAxis.show&&(r=!0),this.data&&this.data.settings&&this.data.settings.yAxis&&this.data.settings.yAxis&&(o=this.data.settings.yAxis.color,n=this.data.settings.yAxis.fontColor),this.yAxis.call(a).attr("display",r?"inline":"none"),this.yAxis.selectAll(".domain, path, line").style("stroke",o),this.yAxis.selectAll("text").style("fill",n),this.yAxis.selectAll("g.tick line").attr("x1",-this.size.width)},i.prototype.renderChart=function(){var e=this.data,t=this.data.series,a=this.rootSelection=this.chart.selectAll(i.LineNode.selector).data(t),r=a.enter().append("g").classed(i.LineNode["class"],!0);r.append("g").classed(i.LineContainer["class"],!0),r.append("g").classed(i.TooltipContainer["class"],!0),r.append("g").classed(i.DotsContainer["class"],!0),this.animationHandler.isAnimated?this.showAnimationDot():this.hideAnimationDot(),this.drawTooltips(e,this.selectionManager.getSelectionIds()),this.drawDots(e),this.drawLines(e),a.exit().remove()},i.prototype.drawLinesStatic=function(e,t){var a=this,r=i.Line,o=i.LineContainer,n=this.rootSelection,s=n.filter(function(i,a){return!t||e>a}).select(o.selector).selectAll(r.selector).data(function(e){return[e]});s.enter().append("path").classed(r["class"],!0),s.style({fill:"none",stroke:function(e){return e.color},"stroke-width":function(e){return e.width+"px"}}),s.attr("d",function(e){return a.lineX(e.data)}),s.exit().remove()},i.prototype.drawLinesStaticBeforeAnimation=function(e){var t=this,a=i.Line,r=i.LineContainer,o=this.rootSelection;this.animationSelection=o.filter(function(t,i){return i===e}).select(r.selector).selectAll(a.selector).data(function(e){return[e]}),this.animationSelection.enter().append("path").classed(a["class"],!0),this.animationSelection.style({fill:"none",stroke:function(e){return e.color},"stroke-width":function(e){return e.width+"px"}}),this.animationSelection.attr("d",function(e){var i=t.animationHandler.flooredPosition.index;if(0===i)return t.moveAnimationDot(e.data[0]),t.lineX([]);var a=e.data.slice(0,i+1);return t.moveAnimationDot(a[a.length-1]),t.lineX(a)}),this.animationSelection.exit().remove()},i.prototype.moveAnimationDot=function(e){var t=this.data.xScale,i=this.data.yScales;this.animationDot.attr("cx",t(e.x)).attr("cy",i[e.groupIndex](e.y))},i.prototype.playAnimation=function(e){var t=this;void 0===e&&(e=0);var i=this.animationHandler.flooredPosition.index;this.showAnimationDot(),this.animationSelection.transition().delay(e).duration(this.animationDuration).ease("linear").attrTween("d",function(e,a){return t.getInterpolation(e.data,i)}).each("end",function(e){return t.handleSelection(t.animationHandler.flooredPosition)})},i.prototype.pauseAnimation=function(){this.animationSelection&&(this.hideAnimationDot(),this.animationSelection.selectAll("path").transition(),this.animationSelection.transition().duration(0).delay(0))},i.prototype.stopAnimation=function(){this.pauseAnimation(),d3.timer.flush()},i.prototype.findNextPoint=function(e){for(var t=e.series;t<this.data.series.length;t++)for(var i=this.data.series[t],a=t===e.series?Math.floor(e.index+1):0;a<i.data.length;a++)if(i.data[a]&&i.data[a].popupInfo)return{series:t,index:a};return null},i.prototype.findPrevPoint=function(e){for(var t=e.series;t>=0;t--)for(var i=this.data.series[t],a=t===e.series?Math.ceil(e.index-1):i.data.length;a>=0;a--)if(i.data[a]&&i.data[a].popupInfo)return{series:t,index:a};return null},i.prototype.isAnimationSeriesAndIndexLast=function(e){return this.isAnimationSeriesLast(e)&&this.isAnimationIndexLast(e)},i.prototype.isAnimationSeriesLast=function(e){return e.series>=this.data.series.length-1},i.prototype.isAnimationIndexLast=function(e){var t=this.data.series[e.series];return e.index>=t.data.length-1},i.prototype.drawLines=function(e){var t=this.animationHandler.position.series,i=this.animationHandler.isAnimated;this.drawLinesStatic(t,i),i&&this.drawLinesStaticBeforeAnimation(t)},i.prototype.showAnimationDot=function(){if(this.animationHandler.isPlaying){var e=i.DefaultSettings.dots.size;this.data&&this.data.settings&&this.data.settings.dots&&this.data.settings.dots.size&&(e=this.data.settings.dots.size),this.animationDot.attr("display","inline").attr("fill",this.data.settings.dots.color).style("opacity",this.dotOpacity).attr("r",e)}},i.prototype.hideAnimationDot=function(){this.animationDot.attr("display","none")},i.prototype.getInterpolation=function(e,t){var i=this;if(this.data){var a=this.data.xScale,r=this.data.yScales,o=t+1;this.showAnimationDot();var n=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("linear"),s=e.slice(0,t+1).map(function(e){return{x:a(e.x),y:r[e.groupIndex](e.y)}}),l=a(e[t].x),c=a(e[o].x),h=r[e[t].groupIndex](e[t].y),u=r[e[o].groupIndex](e[o].y),p=d3.scale.linear().domain([0,1]).range([t,o]),d=d3.scale.linear().domain([0,1]).range([l,c]),m=d3.scale.linear().domain([0,1]).range([h,u]);return this.animationHandler.setRunnerCounterValue(t),function(e){if(!i.animationHandler.isPlaying)return n(s);var t=d(e),a=m(e);return i.animationDot.attr("cx",t).attr("cy",a),s.push({x:t,y:a}),i.animationHandler.position.index=p(e),n(s)}}},i.prototype.clearSelection=function(){this.data&&this.data.hasHighlights||!this.selectionManager.hasSelection()?this.selectionManager.selectedIds=[]:this.selectionManager.clear(),this.chart.selectAll(i.Tooltip.selector).remove()},i.prototype.handleSelection=function(e){var t=this;if(this.data){var i=this.animationHandler.animationPlayingIndex,a=this.data.series[e.series].data[e.index],r=this.animationHandler.isPlaying&&this.isAnimationSeriesAndIndexLast(e);if((!a||!a.popupInfo)&&this.animationHandler.isPlaying)return void(r?setTimeout(function(){return t.animationHandler.toEnd()},0):this.animationHandler.play(0,!0));r?setTimeout(function(){return t.animationHandler.toEnd()},0):this.animationHandler.pause(),this.selectionManager.select(a.identity).then(function(e){t.setSelection(e),clearTimeout(t.handleSelectionTimeout),t.handleSelectionTimeout=setTimeout(function(){t.animationHandler.animationPlayingIndex===i&&((r||t.animationHandler.isPaused)&&t.clearSelection(),!r&&t.animationHandler.isPaused&&t.animationHandler.play())},t.pauseDuration)})}},Object.defineProperty(i.prototype,"animationDuration",{get:function(){return 1e3/(this.data&&this.data.settings&&this.data.settings.playback?this.data.settings.playback.playSpeed:i.DefaultSettings.playback.playSpeed)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pauseDuration",{get:function(){return 1e3*(this.data&&this.data.settings&&this.data.settings.playback?this.data.settings.playback.pauseDuration:i.DefaultSettings.playback.pauseDuration)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dotOpacity",{get:function(){return 1-(this.data&&this.data.settings&&this.data.settings.dots?this.data.settings.dots.transparency:i.DefaultSettings.dots.transparency)/100},enumerable:!0,configurable:!0}),i.prototype.drawDots=function(e){var t=this;if(e&&e.xScale){var a=e.xScale,r=e.yScales,o=i.Dot,n=i.DotsContainer,s=this.rootSelection,l=this.data.settings.dots.color,c=this.data.settings.dots.size,h=this.animationHandler.isAnimated,u=this.animationHandler.position,p=s.filter(function(e,t){return!h||t<=u.series}).select(n.selector).selectAll(o.selector).data(function(e,t){return _.filter(e.data,function(e,i){return h&&t===u.series&&i>u.index?!1:!!e.popupInfo})});p.enter().append("circle").classed(o["class"],!0),p.attr("cx",function(e){return a(e.categoryValue)}).attr("cy",function(e){return r[e.groupIndex](e.y)}).attr("r",function(e){return e.eventSize||c}).style("fill",l).style("opacity",this.dotOpacity).style("cursor","pointer").call(i.AddOnTouchClick,function(e){d3.event.stopPropagation(),t.selectionManager.select(e.identity,d3.event.ctrlKey).then(function(e){return t.setSelection(e)})}),p.exit().remove()}},i.prototype.renderGaps=function(e,a){var r,o,n,s,l=e.series,c=e.isScalar,h=e.xScale;r=[{left:-4.5,top:-5,height:10,width:3},{left:1.5,top:-5,height:10,width:3}],o=this.gaps.selectAll(i.Gap.selector).data(l.slice(0,l.length-1)),n=o.enter().append("g"),o.attr("transform",function(e,i){var a,r=e.widthOfGap/2,o=e.data[e.data.length-1].categoryValue;return a=h(c?r+o:new Date(r+o.getTime())),t.SVGUtil.translate(a,0)}),s=o.selectAll(i.GapNode.selector).data(r),s.enter().append("rect").attr({x:function(e){return e.left},y:function(e){return e.top},height:function(e){return e.height},width:function(e){return e.width}}).classed(i.GapNode["class"],!0),n.classed(i.Gap["class"],!0),o.exit().remove(),s.exit().remove()},i.prototype.setSelection=function(e){this.data&&(this.drawDots(this.data),this.drawTooltips(this.data,e))},i.prototype.isPopupShow=function(e,t){return this.popupHeight&&e.popupInfo&&t?o.containsSelection(t,e.identity):!1},i.prototype.drawTooltips=function(e,a){var r=this,o=e.xScale,n=e.yScales,s=i.Tooltip,c=i.TooltipContainer,h=this.rootSelection,u=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}),p=i.DefaultTooltipSettings.marginTop,d=this.data.settings.popup.width,m=this.data.settings.popup.height,g=20,f=function(e,t){return r.isHigherMiddle(e,t)?-1*p+g:r.size.height+p},y=h.select(c.selector).selectAll(s.selector).data(function(e){return _.filter(e.data,function(e){return r.isPopupShow(e,a)})});y.enter().append("g").classed(s["class"],!0),y.attr("transform",function(e){var i=o(e.x)-d/2,a=f(e.y,e.groupIndex);return e.popupInfo.offsetX=Math.min(r.viewport.width-r.margin.right-d,Math.max(-r.margin.left,i))-i,t.SVGUtil.translate(i+e.popupInfo.offsetX,a)});var v=y.selectAll(i.TooltipRect.selector).data(function(e){
return[e]});v.enter().append("path").classed(i.TooltipRect["class"],!0),v.attr("display",function(e){return e.popupInfo?"inherit":"none"}).style("fill",this.data.settings.popup.color).attr("d",function(e){var t=[{x:-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*p:0},{x:-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+m):m},{x:d-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+m):m},{x:d-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*p:0}];return u(t)});var x=y.selectAll(i.TooltipTriangle.selector).data(function(e){return[e]});x.enter().append("path").classed(i.TooltipTriangle["class"],!0),x.style("fill",this.data.settings.popup.color).attr("d",function(e){var t=[{x:d/2-5-e.popupInfo.offsetX,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*p:0},{x:d/2-e.popupInfo.offsetX,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p-5):-5},{x:d/2+5-e.popupInfo.offsetX,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*p:0}];return u(t)}).style("stroke-width","1px");var E=y.selectAll(i.TooltipLine.selector).data(function(e){return[e]});E.enter().append("path").classed(i.TooltipLine["class"],!0),E.style("fill",this.data.settings.popup.color).style("stroke",this.data.settings.popup.color).style("stroke-width","1px").attr("d",function(e){var t=[{x:d/2-e.popupInfo.offsetX,y:r.isHigherMiddle(e.y,e.groupIndex)?n[e.groupIndex](e.y)+f(e.y,e.groupIndex)-e.eventSize:n[e.groupIndex](e.y)-f(e.y,e.groupIndex)+e.eventSize},{x:d/2-e.popupInfo.offsetX,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*p:0}];return u(t)});var b=this.data.settings.popup.showTime,T=this.data.settings.popup.showTitle,w=y.selectAll(i.TooltipTimeRect.selector).data(function(e){return[e]}),S={display:b?void 0:"none"};w.enter().append("path").classed(i.TooltipTimeRect["class"],!0),w.style("fill",this.data.settings.popup.timeFill).style(S).attr("d",function(e){var t=[{x:d-r.data.widthOfTooltipValueLabel-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+m):0},{x:d-r.data.widthOfTooltipValueLabel-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+m-i.DefaultTooltipSettings.timeHeight):i.DefaultTooltipSettings.timeHeight},{x:d-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+m-i.DefaultTooltipSettings.timeHeight):i.DefaultTooltipSettings.timeHeight},{x:d-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+m):0}];return u(t)});var R=y.selectAll(i.TooltipTime.selector).data(function(e){return[e]});R.enter().append("text").classed(i.TooltipTime["class"],!0),R.style(i.ConvertTextPropertiesToStyle(i.GetPopupValueTextProperties())).style(S).style("fill",this.data.settings.popup.timeColor).attr("x",function(e){return d-r.data.widthOfTooltipValueLabel}).attr("y",function(e){return r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+m-i.DefaultTooltipSettings.timeHeight+3):i.DefaultTooltipSettings.timeHeight-3}).text(function(e){return e.popupInfo.value});var C={display:T?void 0:"none"},A=y.selectAll(i.TooltipTitle.selector).data(function(e){return[e]});A.enter().append("text").classed(i.TooltipTitle["class"],!0),A.style(C).style(i.ConvertTextPropertiesToStyle(i.GetPopupTitleTextProperties())).style("fill",this.data.settings.popup.fontColor).attr("x",function(e){return i.PopupTextPadding}).attr("y",function(e){return(r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+m-12):12)+i.PopupTextPadding}).text(function(e){if(!e.popupInfo)return"";var t=d-2*i.PopupTextPadding-(b?r.data.widthOfTooltipValueLabel-i.PopupTextPadding:0)-10;return l.getTailoredTextOrDefault(i.GetPopupTitleTextProperties(e.popupInfo.title),t)});var M=function(e){var t=i.PopupTextPadding+r.data.settings.popup.fontSize,a=t+i.DefaultTooltipSettings.timeHeight;return e.popupInfo&&(t=T&&e.popupInfo.title||b&&e.popupInfo.value?a:t),{y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+m-t):t,x:i.PopupTextPadding,width:d-2*i.PopupTextPadding,height:m-t}},H=y.selectAll(i.TooltipDescription.selector).data(function(e){return[e]});H.enter().append("text").classed(i.TooltipDescription["class"],!0),H.style(i.ConvertTextPropertiesToStyle(i.GetPopupDescriptionTextProperties(null,this.data.settings.popup.fontSize))).style("fill",this.data.settings.popup.fontColor).text(function(e){return e.popupInfo&&e.popupInfo.description}).attr("y",function(e){var t=M(e),i=d3.select(this)[0][0];return l.wordBreak(i,t.width,t.height),0}).attr("transform",function(e){var i=M(e);return t.SVGUtil.translate(0,i.y)}),H.selectAll("tspan").attr("x",i.PopupTextPadding),y.exit().remove()},i.prototype.isHigherMiddle=function(e,t){if(this.data.settings.popup.alwaysOnTop)return!0;if(this.data.yScales.length>1)return 0===t;var i=this.data.commonYScale.domain(),a=d3.min(i),r=Math.abs((d3.max(i)-a)/2);return r=0===r?r:a+r,e>=r},i.getObjectsFromDataView=function(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.objects?e.metadata.objects:null},i.parseSettings=function(e,t,a){var r={},o=i.getObjectsFromDataView(e);return r.xAxis=this.getAxisXSettings(o,t),r.yAxis=this.getAxisYSettings(o,t),r.popup=this.getPopupSettings(o,t),r.dots=this.getDotsSettings(o,t),r.series=this.getSeriesSettings(o,t),r.gaps=this.getGapsSettings(o),r.playback=this.getPlaybackSettings(o,t),r.runnerCounter=this.getRunnerCounterSettings(o,t,a),r},i.getPopupSettings=function(a,r){var o=e.DataViewObjects.getValue(a,i.Properties.popup.show,i.DefaultSettings.popup.show),n=e.DataViewObjects.getValue(a,i.Properties.popup.alwaysOnTop,i.DefaultSettings.popup.alwaysOnTop),s=Math.max(i.PopupMinWidth,Math.min(i.PopupMaxWidth,e.DataViewObjects.getValue(a,i.Properties.popup.width,i.DefaultSettings.popup.width))),l=Math.max(i.PopupMinHeight,Math.min(i.PopupMaxHeight,e.DataViewObjects.getValue(a,i.Properties.popup.height,i.DefaultSettings.popup.height))),c=new t.ColorHelper(r,i.Properties.popup.color,i.DefaultSettings.popup.color),h=c.getColorForMeasure(a,""),u=parseInt(e.DataViewObjects.getValue(a,i.Properties.popup.fontSize,i.DefaultSettings.popup.fontSize),10),p=new t.ColorHelper(r,i.Properties.popup.fontColor,i.DefaultSettings.popup.fontColor),d=p.getColorForMeasure(a,""),m=e.DataViewObjects.getValue(a,i.Properties.popup.showTime,i.DefaultSettings.popup.showTime),g=e.DataViewObjects.getValue(a,i.Properties.popup.showTitle,i.DefaultSettings.popup.showTitle),f=new t.ColorHelper(r,i.Properties.popup.timeColor,i.DefaultSettings.popup.timeColor),y=f.getColorForMeasure(a,""),v=new t.ColorHelper(r,i.Properties.popup.timeFill,i.DefaultSettings.popup.timeFill),x=v.getColorForMeasure(a,"");return{show:o,alwaysOnTop:n,width:s,height:l,color:h,fontSize:u,fontColor:d,showTime:m,showTitle:g,timeColor:y,timeFill:x}},i.getDotsSettings=function(a,r){var o=i.Properties.dots,n=i.DefaultSettings.dots,s=new t.ColorHelper(r,o.color,n.color),l=s.getColorForMeasure(a,""),c=Math.max(0,Math.min(9999,e.DataViewObjects.getValue(a,o.minSize,n.minSize))),h=Math.max(c,Math.min(9999,e.DataViewObjects.getValue(a,o.maxSize,n.maxSize))),u=Math.max(c,Math.min(h,e.DataViewObjects.getValue(a,o.size,n.size))),p=Math.max(0,Math.min(100,e.DataViewObjects.getValue(a,o.transparency,n.transparency)));return{color:l,size:u,minSize:c,maxSize:h,transparency:p}},i.getSeriesSettings=function(a,r){var o=Math.max(1,Math.min(100,e.DataViewObjects.getValue(a,i.Properties.series.width,i.DefaultSettings.series.width))),n=new t.ColorHelper(r,i.Properties.series.fill,i.DefaultSettings.series.fill),s=n.getColorForMeasure(a,"");return{width:o,fill:s}},i.getGapsSettings=function(t){var a=e.DataViewObjects.getValue(t,i.Properties.gaps.show,i.DefaultSettings.gaps.show),r=Math.max(1,Math.min(100,e.DataViewObjects.getValue(t,i.Properties.gaps.transparency,i.DefaultSettings.gaps.visibleGapsPercentage)));return{show:a,visibleGapsPercentage:r}},i.getAxisXSettings=function(a,r){var o=i.Properties.xAxis,n=i.DefaultSettings.xAxis,s=new t.ColorHelper(r,o.color,n.color).getColorForMeasure(a,""),l=new t.ColorHelper(r,o.fontColor,n.fontColor).getColorForMeasure(a,""),c=e.DataViewObjects.getValue(a,o.show,n.show),h=e.DataViewObjects.getValue(a,o.position,n.position),u=new t.ColorHelper(r,o.backgroundColor,n.backgroundColor).getColorForMeasure(a,"");return{show:c,position:h,color:s,fontColor:l,backgroundColor:u}},i.getAxisYSettings=function(a,r){var o=i.Properties.yAxis,n=i.DefaultSettings.yAxis,s=new t.ColorHelper(r,o.color,n.color),l=s.getColorForMeasure(a,""),c=new t.ColorHelper(r,o.fontColor,n.fontColor),h=c.getColorForMeasure(a,""),u=e.DataViewObjects.getValue(a,o.show,n.show);return{color:l,fontColor:h,show:u}},i.getPlaybackSettings=function(a,r){var o={},n=i.Properties.playback,s=i.DefaultSettings.playback;o.autoplay=e.DataViewObjects.getValue(a,n.autoplay,s.autoplay),o.playSpeed=Math.max(1,Math.min(99999,e.DataViewObjects.getValue(a,n.playSpeed,s.playSpeed))),o.pauseDuration=Math.max(0,Math.min(9999,e.DataViewObjects.getValue(a,n.pauseDuration,s.pauseDuration))),o.autoplayPauseDuration=Math.max(1,Math.min(9999,e.DataViewObjects.getValue(a,n.autoplayPauseDuration,s.autoplayPauseDuration)));var l=new t.ColorHelper(r,n.color,s.color);o.color=l.getColorForMeasure(a,"");var c=e.DataViewObjects.getValue(a,n.position,"");if(c.length>3)try{o.position=JSON.parse(c)}catch(h){}return o.position=o.position||s.position,o},i.getRunnerCounterSettings=function(a,r,o){var n=e.DataViewObjects.getValue(a,i.Properties.runnerCounter.show,i.DefaultSettings.runnerCounter.show),s=e.DataViewObjects.getValue(a,i.Properties.runnerCounter.label,o.RunnerCounter&&o.RunnerCounter.source&&o.RunnerCounter.source.displayName||i.DefaultSettings.runnerCounter.label),l=e.DataViewObjects.getValue(a,i.Properties.runnerCounter.position,i.DefaultSettings.runnerCounter.position),c=parseInt(e.DataViewObjects.getValue(a,i.Properties.runnerCounter.fontSize,i.DefaultSettings.runnerCounter.fontSize),10),h=new t.ColorHelper(r,i.Properties.runnerCounter.fontColor,i.DefaultSettings.runnerCounter.fontColor).getColorForMeasure(a,"");return{show:n,label:s,position:l,fontSize:c,fontColor:h}},i.prototype.clearAll=function(e){this.gaps.selectAll(i.Gap.selector).remove(),this.animationHandler&&(this.animationHandler.reset(),this.animationHandler.clear()),e&&this.svg.style("display","none"),this.clearChart()},i.prototype.clearChart=function(){this.clearSelection(),this.hideAnimationDot(),this.chart.selectAll(i.Line.selector).remove(),this.chart.selectAll(i.Dot.selector).remove()},i.prototype.clearRedundant=function(e){var t=this;if(this.data){var a=this.chart.selectAll(i.Tooltip.selector).filter(function(i){return i.seriesIndex<e.series||i.seriesIndex===e.series&&t.data.series[i.seriesIndex].data[e.index].value>=i.value}),r=a.data().map(function(e){return e.identity});if(this.clearSelection(),r.length){var o=r.map(function(e){return t.selectionManager.select(e,!0)});$.when.apply(null,o).then(function(e){return t.setSelection(e)})}this.chart.selectAll(i.Line.selector).remove(),this.chart.selectAll(i.Dot.selector).remove()}},i.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;switch(e.objectName){case"general":this.readGeneralInstance(i);break;case"popup":this.readPopupInstance(i);break;case"dots":this.readDotsInstance(i);break;case"xAxis":this.xAxisInstance(i);break;case"yAxis":this.yAxisInstance(i);break;case"series":this.readSeriesInstance(i);break;case"gaps":this.readGapsInstance(i);break;case"playback":this.readPlaybackInstance(i);break;case"runnerCounter":this.readRunnerCounterInstance(i)}return i.complete()},i.prototype.getSettings=function(e){return this.data&&this.data.settings&&this.data.settings[e]?this.data.settings[e]:i.DefaultSettings[e]},i.prototype.readGeneralInstance=function(e){var t={objectName:"general",displayName:"general",selector:null,properties:{}};e.pushInstance(t)},i.prototype.readPopupInstance=function(e){var t=this.getSettings("popup"),i={objectName:"popup",displayName:"popup",selector:null,properties:{show:t.show,alwaysOnTop:t.alwaysOnTop,width:t.width,height:t.height,color:t.color,fontColor:t.fontColor,fontSize:t.fontSize,showTime:t.showTime,showTitle:t.showTitle,timeColor:t.timeColor,timeFill:t.timeFill}};e.pushInstance(i)},i.prototype.readDotsInstance=function(e){var t=this.getSettings("dots"),i={objectName:"dots",displayName:"Dots",selector:null,properties:{color:t.color,size:t.size,minSize:t.minSize,maxSize:t.maxSize,transparency:t.transparency}};e.pushInstance(i)},i.prototype.xAxisInstance=function(e){var t=this.getSettings("xAxis");e.pushInstance({objectName:"xAxis",displayName:"xAxis",selector:null,properties:{show:t.show,position:t.position,color:t.color,fontColor:t.fontColor,backgroundColor:t.backgroundColor}})},i.prototype.yAxisInstance=function(e){var t=this.getSettings("yAxis");e.pushInstance({objectName:"yAxis",displayName:"yAxis",selector:null,properties:{color:t.color,fontColor:t.fontColor,show:t.show}})},i.prototype.readSeriesInstance=function(e){var t=this.getSettings("series"),i={objectName:"series",displayName:"series",selector:null,properties:{fill:t.fill,width:t.width}};e.pushInstance(i)},i.prototype.readGapsInstance=function(e){var t=this.getSettings("gaps"),i={objectName:"gaps",selector:null,properties:{show:t.show,transparency:t.visibleGapsPercentage}};e.pushInstance(i)},i.prototype.readPlaybackInstance=function(e){var t=this.getSettings("playback");e.pushInstance({objectName:"playback",displayName:"playback",selector:null,properties:{autoplay:t.autoplay,playSpeed:t.playSpeed,pauseDuration:t.pauseDuration,autoplayPauseDuration:t.autoplayPauseDuration,color:t.color}})},i.prototype.readRunnerCounterInstance=function(e){var t=this.getSettings("runnerCounter"),i={objectName:"runnerCounter",selector:null,properties:{}};this.data&&this.data.columns&&this.data.columns.RunnerCounter&&(i.properties={show:t.show,label:t.label,position:t.position,fontSize:t.fontSize,fontColor:t.fontColor}),e.pushInstance(i)},i.prototype.destroy=function(){this.data=null,this.clearAll(!0)},i.RoleDisplayNames={Timestamp:"Timestamp",Category:"Category",Value:"Value",EventTitle:"Event Title",EventDescription:"Event Description",EventSize:"Event Size",RunnerCounter:"Runner Counter"},i.RoleNames=_.mapValues(i.RoleDisplayNames,function(e,t){return t}),i.capabilities={dataRoles:[{displayName:i.RoleDisplayNames.Timestamp,name:i.RoleNames.Timestamp,kind:e.VisualDataRoleKind.Grouping},{displayName:i.RoleDisplayNames.Value,name:i.RoleNames.Value,kind:e.VisualDataRoleKind.Measure},{displayName:i.RoleDisplayNames.EventTitle,name:i.RoleNames.EventTitle,kind:e.VisualDataRoleKind.GroupingOrMeasure},{displayName:i.RoleDisplayNames.EventDescription,name:i.RoleNames.EventDescription,kind:e.VisualDataRoleKind.GroupingOrMeasure},{displayName:i.RoleDisplayNames.EventSize,name:i.RoleNames.EventSize,kind:e.VisualDataRoleKind.GroupingOrMeasure},{displayName:i.RoleDisplayNames.RunnerCounter,name:i.RoleNames.RunnerCounter,kind:e.VisualDataRoleKind.GroupingOrMeasure}],dataViewMappings:[{conditions:[{Timestamp:{max:1},Value:{max:1},Category:{max:1},EventTitle:{max:1},EventDescription:{max:1},EventSize:{max:1},RunnerCounter:{max:1}}],categorical:{categories:{"for":{"in":i.RoleNames.Timestamp},dataReductionAlgorithm:{top:{count:1e4}}},values:{group:{by:i.RoleNames.Category,select:[{bind:{to:i.RoleNames.Value}},{bind:{to:i.RoleNames.EventTitle}},{bind:{to:i.RoleNames.EventDescription}},{bind:{to:i.RoleNames.EventSize}},{bind:{to:i.RoleNames.RunnerCounter}}],dataReductionAlgorithm:{top:{}}}}}}],objects:{series:{displayName:"Series",description:"Series",properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},width:{displayName:"Width",type:{numeric:!0}}}},gaps:{displayName:"Gaps",description:"Gaps",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},transparency:{displayName:"Visible gaps",type:{numeric:!0}}}},general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},fill:{displayName:"Background color",type:{fill:{solid:{color:!0}}}}}},popup:{displayName:"Popup",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},alwaysOnTop:{displayName:"Always on top",type:{bool:!0}},width:{displayName:"Width",type:{numeric:!0}},height:{displayName:"Height",type:{numeric:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text size",type:{formatting:{fontSize:!0}}},fontColor:{displayName:"Text color",type:{fill:{solid:{color:!0}}}},showTime:{displayName:"Show time",type:{bool:!0}},showTitle:{displayName:"Show title",type:{bool:!0}},timeColor:{displayName:"Time color",type:{fill:{solid:{color:!0}}}},timeFill:{displayName:"Time fill",type:{fill:{solid:{color:!0}}}}}},dots:{displayName:"Dots",properties:{color:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},minSize:{displayName:"Min Size",type:{numeric:!0}},maxSize:{displayName:"Max Size",type:{numeric:!0}},size:{displayName:"Default Size",type:{numeric:!0}},transparency:{displayName:"Transparency",type:{numeric:!0}}}},xAxis:{displayName:e.data.createDisplayNameGetter("Visual_XAxis"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:"Position",type:{enumeration:r(h)}},fontColor:{displayName:"Font Color",type:{fill:{solid:{color:!0}}}},color:{displayName:"Axis Color",type:{fill:{solid:{color:!0}}}},backgroundColor:{displayName:"Background Color",type:{fill:{solid:{color:!0}}}}}},yAxis:{displayName:e.data.createDisplayNameGetter("Visual_YAxis"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},fontColor:{displayName:"Font Color",type:{fill:{solid:{color:!0}}}},color:{displayName:"Axis Color",type:{fill:{solid:{color:!0}}}}}},playback:{displayName:"Playback",properties:{autoplay:{displayName:"Autoplay",type:{bool:!0}},playSpeed:{displayName:"Speed (dots/sec)",type:{numeric:!0}},pauseDuration:{displayName:"Pause Duration",type:{numeric:!0}},autoplayPauseDuration:{displayName:"Start Delay",type:{numeric:!0}},color:{displayName:"Buttons Color",type:{fill:{solid:{color:!0}}}},position:{displayName:"Position",type:{text:!0}}}},runnerCounter:{displayName:"Runner Counter",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},label:{displayName:"Label",type:{text:!0}},position:{displayName:"Position",type:{enumeration:r(u)}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}},fontColor:{displayName:"Font Color",type:{fill:{solid:{color:!0}}}}}}},sorting:{implicit:{clauses:[{role:i.RoleNames.Timestamp,direction:1}]}},supportsHighlight:!0},i.Properties=i.getProperties(i.capabilities),i.DefaultMargin={top:20,bottom:20,right:25,left:25},i.DefaultViewport={width:50,height:50},i.PlaybackButtonsHeight=26,i.PopupMinHeight=20,i.PopupMinWidth=20,i.PopupMaxHeight=200,i.PopupMaxWidth=2e3,i.MaxWidthOfYAxis=50,i.PopupTextPadding=3,i.XAxisTickSpace=15,i.XAxisTickHeight=16,i.MinimumTicksToRotate=3,i.AxisTickRotateAngle=-35,i.DefaultSettings={precision:0,popup:{show:!0,alwaysOnTop:!1,width:100,height:80,color:"#808181",fontSize:10,fontColor:"white",showTime:!0,showTitle:!0,timeColor:"white",timeFill:"#010101"},dots:{color:"#808181",size:5,minSize:5,maxSize:20,transparency:25},gaps:{show:!1,visibleGapsPercentage:1},series:{fill:"#3779B7",width:2},xAxis:{color:"#777777",fontColor:"#777777",position:h.Center,show:!0,dateFormat:c.TimeOnly,backgroundColor:"#E1F2F7"},yAxis:{color:"#777777",fontColor:"#777777",show:!0},playback:{autoplay:!1,playSpeed:5,pauseDuration:10,autoplayPauseDuration:0,color:"#777",position:null},runnerCounter:{show:!0,label:"",position:u.TopRight,fontSize:13,fontColor:"#777777"},formatStringProperty:i.Properties.general.formatString},i.DefaultTooltipSettings={dataPointColor:"#808181",marginTop:20,timeHeight:15},i.MaxGapCount=100,i.MinGapWidth=_.object([[c.DateOnly,144e4],[c.TimeOnly,6e4]],void 0),i.Chart=s("chart"),i.Line=s("line"),i.LineContainer=s("lineContainer"),i.LineNode=s("lineNode"),i.XAxisNode=s("xAxisNode"),i.Dot=s("dot"),i.DotsContainer=s("dotsContainer"),i.Tooltip=s("Tooltip"),i.TooltipRect=s("tooltipRect"),i.TooltipTriangle=s("tooltipTriangle"),i.Gaps=s("gaps"),i.Gap=s("gap"),i.GapNode=s("gapNode"),i.TooltipLine=s("tooltipLine"),i.TooltipTime=s("tooltipTime"),i.TooltipTimeRect=s("tooltipTimeRect"),i.TooltipTitle=s("tooltipTitle"),i.TooltipDescription=s("tooltipDescription"),i.TooltipContainer=s("tooltipContainer"),i.AnimationDot=s("animationDot"),i}();i.PulseChart=p;var d;!function(e){e[e.Ready=0]="Ready",e[e.Play=1]="Play",e[e.Paused=2]="Paused",e[e.Stopped=3]="Stopped"}(d||(d={}));var m=function(){function e(t,i){var a=this;this.animationPlayingIndex=0,this.runnerCounterTopLeftPosition=180,this.isAutoPlayed=!1,this.isPositionWasSaved=!1,this.chart=t,this.svg=i,this.setDefaultValues();var r=this.container=this.svg.append("g");this.animationPlay=r.append("g").classed(e.AnimationPlay["class"],!0),this.animationPlay.append("circle").attr("cx",12).attr("cy",12).attr("r",10).attr("fill","transparent"),this.animationPlay.call(p.AddOnTouchClick,function(){return a.play()}),this.animationPlay.append("path").attr("d","M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3 17v-10l9 5.146-9 4.854z"),this.animationPause=r.append("g").classed(e.AnimationPause["class"],!0),this.animationPause.append("circle").attr("cx",12).attr("cy",12).attr("r",10).attr("fill","transparent"),this.animationPause.call(p.AddOnTouchClick,function(){return a.stop()}),this.animationPause.append("path").attr("d","M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-1 17h-3v-10h3v10zm5-10h-3v10h3v-10z"),this.animationReset=r.append("g").classed(e.AnimationReset["class"],!0),this.animationReset.append("circle").attr("cx",12).attr("cy",12).attr("r",10).attr("fill","transparent"),this.animationReset.call(p.AddOnTouchClick,function(){return a.reset()}),this.animationReset.append("path").attr("d","M22 12c0 5.514-4.486 10-10 10s-10-4.486-10-10 4.486-10 10-10 10 4.486 10 10zm-22 0c0 6.627 5.373 12 12 12s12-5.373 12-12-5.373-12-12-12-12 5.373-12 12zm13 0l5-4v8l-5-4zm-5 0l5-4v8l-5-4zm-2 4h2v-8h-2v8z"),this.animationPrev=r.append("g").classed(e.AnimationPrev["class"],!0),this.animationPrev.append("circle").attr("cx",12).attr("cy",12).attr("r",10).attr("fill","transparent"),this.animationPrev.call(p.AddOnTouchClick,function(){return a.prev()}),this.animationPrev.append("path").attr("d","M9.5 12l7.5-4.5v9l-7.5-4.5zm-4.5 0l6.5 4v-1.634l-3.943-2.366 3.943-2.366v-1.634l-6.5 4zm17 0c0 5.514-4.486 10-10 10s-10-4.486-10-10 4.486-10 10-10 10 4.486 10 10zm-22 0c0 6.627 5.373 12 12 12s12-5.373 12-12-5.373-12-12-12-12 5.373-12 12z"),this.animationNext=r.append("g").classed(e.AnimationNext["class"],!0),this.animationNext.append("circle").attr("cx",12).attr("cy",12).attr("r",10).attr("fill","transparent"),this.animationNext.call(p.AddOnTouchClick,function(){return a.next()}),this.animationNext.append("path").attr("d","M7 16.5v-9l7.5 4.5-7.5 4.5zm5.5-8.5v1.634l3.943 2.366-3.943 2.366v1.634l6.5-4-6.5-4zm-.5-6c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12z").attr("rotate",180),this.animationToEnd=r.append("g").classed(e.AnimationToEnd["class"],!0),this.animationToEnd.append("circle").attr("cx",12).attr("cy",12).attr("r",10).attr("fill","transparent"),this.animationToEnd.call(p.AddOnTouchClick,function(){return a.toEnd()}),this.animationToEnd.append("path").attr("d","M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-6 16v-8l5 4-5 4zm5 0v-8l5 4-5 4zm7-8h-2v8h2v-8z"),this.runnerCounter=r.append("g").classed(e.RunnerCounter["class"],!0),this.runnerCounterText=this.runnerCounter.append("text"),this.setControlsColor(e.DefaultControlsColor)}return Object.defineProperty(e,"AnimationMinPosition",{get:function(){return{series:0,index:0}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"runnerCounterPosition",{get:function(){return this.chart.data.settings.runnerCounter.position},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxTextWidthOfRunnerCounterValue",{get:function(){var e=this.runnerCounterPosition===u.TopLeft||this.runnerCounterPosition===u.TopRight;return this.chart.viewport.width-(e?this.runnerCounterTopLeftPosition:0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAnimated",{get:function(){return this.animatorState===d.Paused||this.animatorState===d.Play||this.animatorState===d.Stopped},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this.animatorState===d.Play},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPaused",{get:function(){return this.animatorState===d.Paused},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isStopped",{get:function(){return this.animatorState===d.Stopped},enumerable:!0,configurable:!0}),e.prototype.setDefaultValues=function(){this.position=e.AnimationMinPosition,this.animatorState=d.Ready,this.runnerCounterValue=null},e.prototype.render=function(){this.renderControls(),this.disableControls(),this.chart.isAutoPlay||(this.isAutoPlayed=!0,this.savedPosition&&(this.savedPosition=null)),this.chart.isAutoPlay&&this.isAutoPlayed&&this.animatorState===d.Play&&!this.isPositionWasSaved&&!_.isEqual(this.autoPlayPosition,this.savedPosition)&&(this.chart.stopAnimation(),this.isAutoPlayed=!1,this.isPositionWasSaved=!0,this.animatorState=d.Ready),this.animatorState===d.Play?this.play():this.chart.isAutoPlay&&!this.isAutoPlayed&&this.animatorState===d.Ready?(this.autoPlayPosition=this.savedPosition,this.isAutoPlayed=!0,this.savedPosition&&this.savedPosition.series<this.chart.data.series.length&&this.savedPosition.index<this.chart.data.series[this.savedPosition.series].data.length&&(this.position=this.savedPosition),this.play(this.chart.autoplayPauseDuration)):this.chart.renderChart()},e.prototype.setControlsColor=function(e){this.color=e},e.prototype.renderControls=function(){this.show(),this.animationPlay.attr("transform",t.SVGUtil.translate(0,0)).attr("fill",this.color),this.animationPause.attr("transform",t.SVGUtil.translate(30,0)).attr("fill",this.color),this.animationReset.attr("transform",t.SVGUtil.translate(60,0)).attr("fill",this.color),this.animationPrev.attr("transform",t.SVGUtil.translate(90,0)).attr("fill",this.color),this.animationNext.attr("transform",t.SVGUtil.translate(120,0)).attr("fill",this.color),this.animationToEnd.attr("transform",t.SVGUtil.translate(150,0)).attr("fill",this.color),this.runnerCounter.attr("fill",this.color).attr("transform",t.SVGUtil.translate(this.runnerCounterPosition===u.TopLeft?this.runnerCounterTopLeftPosition:this.chart.viewport.width-2,this.chart.data.runnerCounterHeight/2+7)),this.runnerCounterText.style("text-anchor",this.runnerCounterPosition===u.TopLeft?"start":"end"),this.chart.data&&this.chart.data.settings&&(this.runnerCounterText.style(p.ConvertTextPropertiesToStyle(p.GetRunnerCounterTextProperties(null,this.chart.data.settings.runnerCounter.fontSize))),this.runnerCounterText.style("fill",this.chart.data.settings.runnerCounter.fontColor)),this.drawCounterValue()},e.setControlVisiblity=function(t,i,a){void 0===a&&(a=!1),t.style("opacity",i?e.DefaultOpacity:e.DimmedOpacity),i?t.attr("display","inline"):a&&t.attr("display","none")},e.prototype.disableControls=function(){var t=this.chart.data&&this.chart.data.settings&&this.chart.data.settings.runnerCounter.show;switch(e.setControlVisiblity(this.animationReset,!0),e.setControlVisiblity(this.animationToEnd,!0),this.animatorState){case d.Play:e.setControlVisiblity(this.animationPlay,!1),e.setControlVisiblity(this.animationPrev,!0),e.setControlVisiblity(this.animationNext,!0),e.setControlVisiblity(this.animationPause,!0),e.setControlVisiblity(this.runnerCounter,t,!0);break;case d.Paused:e.setControlVisiblity(this.animationPlay,!0),e.setControlVisiblity(this.animationPause,!0),e.setControlVisiblity(this.animationPrev,!0),e.setControlVisiblity(this.animationNext,!0),e.setControlVisiblity(this.runnerCounter,t,!0);break;case d.Stopped:e.setControlVisiblity(this.animationPlay,!0),e.setControlVisiblity(this.animationPrev,!0),e.setControlVisiblity(this.animationNext,!0),e.setControlVisiblity(this.runnerCounter,t,!0),e.setControlVisiblity(this.animationPause,!1);break;case d.Ready:e.setControlVisiblity(this.animationPlay,!0),e.setControlVisiblity(this.animationPrev,!1),e.setControlVisiblity(this.animationNext,!1),e.setControlVisiblity(this.animationPause,!1),e.setControlVisiblity(this.runnerCounter,!1,!0);break;default:e.setControlVisiblity(this.animationPlay,!0),e.setControlVisiblity(this.animationPrev,!1),e.setControlVisiblity(this.animationNext,!1),e.setControlVisiblity(this.animationPause,!1),e.setControlVisiblity(this.runnerCounter,!1,!0)}},e.prototype.show=function(){this.container.style("display","inline")},e.prototype.setRunnerCounterValue=function(e){var i=this.chart.data&&this.chart.data.series&&this.chart.data.series[this.position.series]&&this.chart.data.series[this.position.series].data&&this.chart.data.series[this.position.series].data[$.isNumeric(e)?e:this.flooredPosition.index],a=i&&null!=i.runnerCounterValue?i.runnerCounterValue:"";if(i&&i.runnerCounterFormatString){var r=t.valueFormatter.create({format:i.runnerCounterFormatString});a=r.format(a)}this.runnerCounterValue=this.chart.data.settings.runnerCounter.label+" "+a,this.drawCounterValue()},e.prototype.drawCounterValue=function(){var e=""+this.runnerCounterValue;this.runnerCounterText.text(e),l.svgEllipsis(this.runnerCounterText.node(),this.maxTextWidthOfRunnerCounterValue)},e.prototype.play=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=!1),this.animatorState!==d.Play||t){if(this.animatorState===d.Ready&&(this.animationPlayingIndex++,this.chart.clearChart()),this.chart.isAnimationIndexLast(this.position))return void this.playNext();this.animatorState===d.Paused&&this.chart.clearSelection(),this.animatorState=d.Play,this.chart.renderChart(),this.chart.playAnimation(e),this.disableControls()}},e.prototype.playNext=function(){this.pause(),this.chart.isAnimationSeriesLast(this.position)?(this.setDefaultValues(),this.chart.clearSelection()):(this.position={series:this.position.series+1,index:e.AnimationMinPosition.index},this.play())},e.prototype.pause=function(){this.animatorState===d.Play&&(this.animatorState=d.Paused,this.chart.pauseAnimation()),this.disableControls()},e.prototype.reset=function(){this.clearTimeouts(),this.chart.stopAnimation(),this.chart.clearSelection(),this.chart.clearChart(),this.setDefaultValues(),this.animatorState=d.Stopped,this.disableControls(),this.savedPosition=null},e.prototype.next=function(){if(this.isAnimated){this.stop();var e=this.chart.findNextPoint(this.position);e?(this.position=e,this.chart.renderChart()):this.toEnd()}},e.prototype.prev=function(){if(this.isAnimated){this.stop();var e=this.chart.findPrevPoint(this.position);e?(this.chart.clearRedundant(e),this.position=e,this.chart.renderChart()):this.reset()}},e.prototype.toEnd=function(){this.savedPosition=null,this.chart.stopAnimation(),this.chart.clearSelection(),this.chart.clearChart(),this.setDefaultValues(),this.disableControls(),this.chart.renderChart()},e.prototype.stop=function(){this.isAnimated&&(this.drawCounterValue(),this.savedPosition=this.position,this.chart.stopAnimation(),this.animatorState=d.Stopped,this.disableControls())},Object.defineProperty(e.prototype,"position",{get:function(){return this.positionValue},set:function(e){this.positionValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flooredPosition",{get:function(){return this.position&&{series:this.position.series,index:Math.floor(this.position.index)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"savedPosition",{get:function(){return this.chart.data&&this.chart.data.settings&&this.chart.data.settings.playback&&this.chart.data.settings.playback.position;
},set:function(e){this.chart.isAutoPlay||(e=null),this.chart.data&&this.chart.data.settings&&this.chart.data.settings.playback&&(this.isPositionWasSaved=!0,this.chart.data&&this.chart.data.settings&&this.chart.data.settings.playback&&(this.chart.data.settings.playback.position=e),this.chart.host.persistProperties({merge:[{objectName:"playback",selector:null,properties:{position:e&&JSON.stringify(e)||""}}]}))},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.isAnimated&&this.chart.stopAnimation(),this.setDefaultValues(),this.container.style("display","none")},e.prototype.clearTimeouts=function(){clearTimeout(this.chart.handleSelectionTimeout)},e.AnimationPlay=s("animationPlay"),e.AnimationPause=s("animationPause"),e.AnimationReset=s("animationReset"),e.AnimationToEnd=s("animationToEnd"),e.AnimationPrev=s("animationPrev"),e.AnimationNext=s("animationNext"),e.RunnerCounter=s("runnerCounter"),e.DimmedOpacity=.25,e.DefaultOpacity=1,e.DefaultControlsColor="#777",e}();i.PulseAnimator=m}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r,o=e.data.Selector,n=t.utility.SelectionManager,s=a.CssConstants.createClassAndSelector;!function(e){function t(){return atob(i)}var i="PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDMwMCAyMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAyMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4gIDxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+ICAuc3Qwe2ZpbGw6I0YxRjBGMDt9LnN0MXtmaWxsOiNDQ0NDQ0M7fS5zdDJ7ZmlsbDojQkNCRUMwO30uc3Qze2ZpbGw6IzY2Njc2Njt9LnN0NHtmaWxsOiMzMzMzMzM7fS5zdDV7ZmlsbDojOTk5OTk5O30gPC9zdHlsZT4gPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjMwMCIgaGVpZ2h0PSIyMDAiLz48cmVjdCB4PSIzMi40IiB5PSI0Ni41IiBjbGFzcz0ic3QxIiB3aWR0aD0iMTguOCIgaGVpZ2h0PSIxOC44Ii8+PHJlY3QgeD0iNTUuNCIgeT0iNDYuNSIgY2xhc3M9InN0MiIgd2lkdGg9IjE4LjgiIGhlaWdodD0iMTguOCIvPjxyZWN0IHg9Ijc4LjQiIHk9IjQ2LjUiIGNsYXNzPSJzdDMiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIxMDEuNCIgeT0iNDYuNSIgY2xhc3M9InN0MiIgd2lkdGg9IjE4LjgiIGhlaWdodD0iMTguOCIvPjxyZWN0IHg9IjMyLjQiIHk9IjY5IiBjbGFzcz0ic3QyIiB3aWR0aD0iMTguOCIgaGVpZ2h0PSIxOC44Ii8+PHJlY3QgeD0iNTUuNCIgeT0iNjkiIGNsYXNzPSJzdDIiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSI3OC40IiB5PSI2OSIgY2xhc3M9InN0MSIgd2lkdGg9IjE4LjgiIGhlaWdodD0iMTguOCIvPjxyZWN0IHg9IjEwMS40IiB5PSI2OSIgY2xhc3M9InN0MyIgd2lkdGg9IjE4LjgiIGhlaWdodD0iMTguOCIvPjxyZWN0IHg9IjEyNC40IiB5PSI2OSIgY2xhc3M9InN0NCIgd2lkdGg9IjE4LjgiIGhlaWdodD0iMTguOCIvPjxyZWN0IHg9IjMyLjMiIHk9IjkxLjUiIGNsYXNzPSJzdDQiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSI1NS4yIiB5PSI5MS41IiBjbGFzcz0ic3Q0IiB3aWR0aD0iMTguOCIgaGVpZ2h0PSIxOC44Ii8+PHJlY3QgeD0iNzguMiIgeT0iOTEuNSIgY2xhc3M9InN0NCIgd2lkdGg9IjE4LjgiIGhlaWdodD0iMTguOCIvPjxyZWN0IHg9IjEwMS4yIiB5PSI5MS41IiBjbGFzcz0ic3Q0IiB3aWR0aD0iMTguOCIgaGVpZ2h0PSIxOC44Ii8+PHJlY3QgeD0iMTI0LjIiIHk9IjkxLjUiIGNsYXNzPSJzdDMiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIzMi4zIiB5PSIxMTQiIGNsYXNzPSJzdDIiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSI1NS4yIiB5PSIxMTQiIGNsYXNzPSJzdDIiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSI3OC4yIiB5PSIxMTQiIGNsYXNzPSJzdDQiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIxMDEuMiIgeT0iMTE0IiBjbGFzcz0ic3QyIiB3aWR0aD0iMTguOCIgaGVpZ2h0PSIxOC44Ii8+PHJlY3QgeD0iMTI0LjIiIHk9IjExNCIgY2xhc3M9InN0MyIgd2lkdGg9IjE4LjgiIGhlaWdodD0iMTguOCIvPjxyZWN0IHg9IjMyLjQiIHk9IjEzNi4zIiBjbGFzcz0ic3QzIiB3aWR0aD0iMTguOCIgaGVpZ2h0PSIxOC44Ii8+PHJlY3QgeD0iNTUuNCIgeT0iMTM2LjMiIGNsYXNzPSJzdDMiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSI3OC40IiB5PSIxMzYuMyIgY2xhc3M9InN0MiIgd2lkdGg9IjE4LjgiIGhlaWdodD0iMTguOCIvPjxyZWN0IHg9IjEwMS40IiB5PSIxMzYuMyIgY2xhc3M9InN0MyIgd2lkdGg9IjE4LjgiIGhlaWdodD0iMTguOCIvPjxyZWN0IHg9IjEyNC40IiB5PSIxMzYuMyIgY2xhc3M9InN0MyIgd2lkdGg9IjE4LjgiIGhlaWdodD0iMTguOCIvPjxyZWN0IHg9IjMyLjIiIHk9IjE1OC44IiBjbGFzcz0ic3QyIiB3aWR0aD0iMTguOCIgaGVpZ2h0PSIxOC44Ii8+PHJlY3QgeD0iNTUuMiIgeT0iMTU4LjgiIGNsYXNzPSJzdDEiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSI3OC4yIiB5PSIxNTguOCIgY2xhc3M9InN0NCIgd2lkdGg9IjE4LjgiIGhlaWdodD0iMTguOCIvPjxyZWN0IHg9IjEwMS4yIiB5PSIxNTguOCIgY2xhc3M9InN0NCIgd2lkdGg9IjE4LjgiIGhlaWdodD0iMTguOCIvPjxyZWN0IHg9IjEyNC4yIiB5PSIxNTguOCIgY2xhc3M9InN0NCIgd2lkdGg9IjE4LjgiIGhlaWdodD0iMTguOCIvPjxyZWN0IHg9IjMyLjIiIHk9IjE4MS4zIiBjbGFzcz0ic3QyIiB3aWR0aD0iMTguOCIgaGVpZ2h0PSIxOC44Ii8+PHJlY3QgeD0iNTUuMiIgeT0iMTgxLjMiIGNsYXNzPSJzdDMiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSI3OC4yIiB5PSIxODEuMyIgY2xhc3M9InN0MiIgd2lkdGg9IjE4LjgiIGhlaWdodD0iMTguOCIvPjxyZWN0IHg9IjEwMS4yIiB5PSIxODEuMyIgY2xhc3M9InN0MyIgd2lkdGg9IjE4LjgiIGhlaWdodD0iMTguOCIvPjxyZWN0IHg9IjEyNC4yIiB5PSIxODEuMyIgY2xhc3M9InN0MiIgd2lkdGg9IjE4LjgiIGhlaWdodD0iMTguOCIvPjxyZWN0IHg9IjE4MS4zIiB5PSI5MS40IiBjbGFzcz0ic3QzIiB3aWR0aD0iMTguOCIgaGVpZ2h0PSIxOC44Ii8+PHJlY3QgeD0iMjA0LjMiIHk9IjkxLjQiIGNsYXNzPSJzdDIiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIxODEuMyIgeT0iMTEzLjkiIGNsYXNzPSJzdDUiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIyMDQuMyIgeT0iMTEzLjkiIGNsYXNzPSJzdDQiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIyMjcuMyIgeT0iMTEzLjkiIGNsYXNzPSJzdDMiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIyNTAuMyIgeT0iMTEzLjkiIGNsYXNzPSJzdDMiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIxODEuMiIgeT0iMTM2LjQiIGNsYXNzPSJzdDMiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIyMDQuMiIgeT0iMTM2LjQiIGNsYXNzPSJzdDEiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIyMjcuMiIgeT0iMTM2LjQiIGNsYXNzPSJzdDEiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIyNTAuMiIgeT0iMTM2LjQiIGNsYXNzPSJzdDEiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIxODEuMiIgeT0iMTU4LjkiIGNsYXNzPSJzdDEiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIyMDQuMiIgeT0iMTU4LjkiIGNsYXNzPSJzdDMiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIyMjcuMiIgeT0iMTU4LjkiIGNsYXNzPSJzdDMiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIyNTAuMiIgeT0iMTU4LjkiIGNsYXNzPSJzdDMiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIxODEuMyIgeT0iMTgxLjEiIGNsYXNzPSJzdDQiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIyMDQuMyIgeT0iMTgxLjEiIGNsYXNzPSJzdDIiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIyMjcuMyIgeT0iMTgxLjEiIGNsYXNzPSJzdDQiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48cmVjdCB4PSIyNTAuMyIgeT0iMTgxLjEiIGNsYXNzPSJzdDIiIHdpZHRoPSIxOC44IiBoZWlnaHQ9IjE4LjgiLz48L3N2Zz4=";e.getWatermark=t}(r||(r={}));var l=function(){function i(e){this.margin={top:2,right:2,bottom:2,left:2},e&&(this.margin=e.margin||this.margin)}return i.prototype.init=function(e){this.host=e.host,this.selectionManager=new n({hostServices:this.host});var a=e.style;this.colors=a&&a.colorPalette?a.colorPalette.dataColors:new t.DataColorPalette,this.addRootElements(e.element.get(0)),this.setSize(e.viewport),this.updateElements(),this.rootElement.style("margin",t.shapes.Thickness.toCssString(this.margin)),this.addElements(),this.objectCache=new sandDance.ObjectCache,this.objectCache.set("hostBus",new sandDance.Bus("hostBus")),this.objectCache.set("iframeBus",new sandDance.Bus("iframeBus")),this.application=new beachPartyApp.AppClass(this.objectCache,this.saveSettings.bind(this),this.loadSettings.bind(this),this.changeChartType.bind(this),this.onSelect.bind(this),this.rootElement.node()),this.application.run(),this.coreApplication=new beachParty.AppMgrClass(this.objectCache,this.rootElement.node()),this.coreApplication.init(i.Canvas3DSelector["class"],i.Canvas2DSelector["class"],i.SvgSelector["class"],i.FileInfoSelector["class"],this.viewport.width,this.viewport.height,i.DebugPanelItems[0],i.DebugPanelItems[1],i.DebugPanelItems[2],i.DebugPanelItems[3],i.DebugPanelItems[4]),this.application.coreApplication=this.coreApplication},i.prototype.addRootElements=function(e){this.rootElement=d3.select(e).append("div").classed(i.ClassName,!0),this.rootElement.on("DOMAttrModified",function(){d3.event.preventDefault(),d3.event.stopImmediatePropagation(),d3.event.stopPropagation()}),this.onStopPropagationHandler(this.rootElement,["mouseup","mousedown","pointerup","pointerdown","pointermove"]),this.mainElement=this.rootElement.append("div"),this.watermarkElement=d3.select($(this.rootElement.node()).append($(r.getWatermark())).get(0)).select("svg").classed(i.WatermarkElementSelector["class"],!0).style("display","none"),this.updateWatermark(!0)},i.prototype.addElements=function(){this.addFileInfo(),this.addPlayAndIconBarElement(),this.addInsightPanel(),this.addBigBarElement(),this.addLeftPanelElement(),this.addSearchPanelElement(),this.addChartTitle(),this.addViewElement(),this.addChartUxDivElement(),this.addFacetLabelHolderElement(),this.addRightPanelElement(),this.addBottomPanelElement(),this.addDataTipsRoot(),this.addDebugPanelElement()},i.prototype.onStopPropagationHandler=function(e,t){if(e&&t){var i=function(){d3.event.stopPropagation()};t.forEach(function(t){e.on(t,i)})}},i.prototype.addFileInfo=function(){this.mainElement.append("div").classed(i.FileInfoSelector["class"],!0)},i.prototype.addPlayAndIconBarElement=function(){var e,t;e=this.mainElement.append("table").classed(i.PlayAndIconBarSelector["class"],!0).append("tr"),t=e.append("td").classed(i.PlayPanelSelector["class"],!0),t.append("span").text("Stop").classed(i.StopButtonSelector["class"],!0).classed(i.TextButtonSelector["class"],!0),t.append("span").classed(i.PlayExButtonSelector["class"],!0).classed(i.TextButtonSelector["class"],!0),e.append("td").classed(i.IconBarSelector["class"],!0).classed(i.IconBarSelector["class"],!0)},i.prototype.addInsightPanel=function(){var e,t,a,r;e=this.mainElement.append("div").classed(i.InsightPanelSelector["class"],!0),t=e.append("div").classed(i.InsightTitleBarSelector["class"],!0),t.append("div").classed("panelText",!0).style("padding","2px 4px 2px 4px").text("Insights Bar"),r=t.append("div").classed("insightsRightButtons",!0),r.append("div").classed(i.InsightMenuButtonSelector["class"],!0).classed(i.ClickIconSelector["class"],!0).classed(i.InsightBgSelector["class"],!0).classed(i.FnInsightMenuSelector["class"],!0),r.append("div").classed(i.CloseButtonSelector["class"],!0).classed(i.ClickIconSelector["class"],!0).classed(i.InsightCloseButtonSelector["class"],!0).classed(i.InsightBgSelector["class"],!0),t.append("div").classed("insightBar",!0).classed("insightBgxx",!0),a=e.append("div").classed(i.InsightListHolderSelector["class"],!0),a.append("div").classed(i.InsightListSelector["class"],!0)},i.prototype.addBigBarElement=function(){this.mainElement.append("div").append("table").classed(i.BigBarSelector["class"],!0).classed(i.BigBarTopSelector["class"],!0).classed(i.NoSpaceTableSelector["class"],!0)},i.prototype.addSearchPanelElement=function(){var e,t;e=this.mainElement.append("table").attr({"data-disabled":!1}).classed(i.SearchPanelSelector["class"],!0).classed(i.NoSpaceTableSelector["class"],!0),t=e.append("tr"),t.append("td").classed(i.BtSearchColSelector["class"],!0).append("span").classed(i.SearchColSelector["class"],!0),t.append("td").append("input").attr({type:"text",title:"search for the specified text in the selected column (to the left)",placeholder:"Search",tabindex:0}).classed(i.SearchTextSelector["class"],!0)},i.prototype.addLeftPanelElement=function(){var e,t,a;e=this.mainElement.append("div").classed(i.LeftPanelSelector["class"],!0),t=e.append("div").classed(i.YStuffSelector["class"],!0),t.append("div").classed(i.YButtonSelector["class"],!0),t.append("div").classed(i.YBinsSelector["class"],!0),a=e.append("div").classed(i.ZStuffSelector["class"],!0),a.append("div").classed(i.ZButtonSelector["class"],!0),a.append("div").classed(i.ZBinsSelecotr["class"],!0)},i.prototype.addChartTitle=function(){var e=this.mainElement.append("div").classed("chartTitle",!0).style("display","none");e.append("div").classed({titleText:!0,chartTitleText:!0}).style("display","none");var t=e.append("div").classed("titleItemCounts",!0).style("display","none"),i=[["titleItemCount","chartTitleItems"],["titleFilteredCount","chartTitleStats"],["titleSelectedCount","chartTitleStats"]];i.forEach(function(e){t.append("span").classed(e.join(" "),!0)})},i.prototype.addViewElement=function(){this.viewElement=this.mainElement.append("div").classed(i.ChartSelector["class"],!0),this.canvas3dElement=this.viewElement.append("canvas").classed(i.Canvas3DSelector["class"],!0).classed(i.CanvasElementSelector["class"],!0).classed(i.CanvasSelector["class"],!0),this.canvas2dElement=this.viewElement.append("canvas").classed(i.Canvas2DSelector["class"],!0).classed(i.CanvasElementSelector["class"],!0).classed(i.CanvasSelector["class"],!0),this.svgElement=this.viewElement.append("svg").classed(i.SvgSelector["class"],!0).classed(i.CanvasSelector["class"],!0)},i.prototype.addChartUxDivElement=function(){this.viewElement.append("div").classed(i.ChartUxDivSelector["class"],!0)},i.prototype.addFacetLabelHolderElement=function(){this.mainElement.append("div").classed(i.FacetLabelHolderSelector["class"],!0)},i.prototype.addRightPanelElement=function(){var e,t=this,a=[{ids:[null,"colorButton","opacityAdj","colorLegend"]},{ids:[null,"sizeButton","sizeFactorAdj","sizeLegend"]},{ids:["imageMapper","imageButton","imageAdj","shapeLegend"]},{ids:[null,"facetButton","facetBins","facetLegend"]}];e=this.mainElement.append("div").style("display","none").classed(i.RightPanelSelector["class"],!0),a.forEach(function(i){t.addRightPanelItem(e,i.ids)})},i.prototype.addRightPanelItem=function(e,t){void 0===t&&(t=[]);var a,r,o;a=e.append("table").classed(i.ButtonLegendComboSelector["class"],!0),r=a.append("tr").classed(void 0===t[0]?"":t[0],!0),o=a.append("tr"),r.append("td").classed(t[1],!0),r.append("td").classed(t[2],!0).style("display","none"),o.append("td").attr("colspan",2).append("div").classed(t[3],!0).classed(i.LegendSelector["class"],!0).style("display","none")},i.prototype.addBottomPanelElement=function(){var e,t,a;e=this.mainElement.append("div").classed(i.BottomPanelSelector["class"],!0),t=e.append("table").classed(i.XStuffSelector["class"],!0),a=t.append("tr"),a.append("td").classed(i.XButtonSelector["class"],!0),a.append("td").classed(i.XBinsSelector["class"],!0)},i.prototype.addDebugPanelElement=function(){var e;e=this.mainElement.append("div").classed(i.DebugPanelSelector["class"],!0),i.DebugPanelItems.forEach(function(t){e.append("div").classed(t,!0).classed(i.DebugPanelItemSelector["class"],!0)})},i.prototype.addDataTipsRoot=function(){this.mainElement.append("div").classed("dataTipsRoot",!0)},i.prototype.saveSettings=function(e,t){if(e&&this.dataView&&this.dataView.data){var i,a=JSON.stringify(e);i=sandDance.SettingsType[t],this.host.persistProperties({replace:[{objectName:i,displayName:i,selector:null,properties:{settings:a}}]})}},i.prototype.loadSettings=function(e){return this.dataView&&this.dataView.settings?this.dataView.settings[sandDance.SettingsType[e]]:{}},i.prototype.changeChartType=function(e){this.host.persistProperties({replace:[],remove:[],merge:[{objectName:"chart",displayName:"chart",selector:null,properties:{chartType:e}}]})},i.prototype.onSelect=function(e){var t=this,a=[],r=(this.dataView&&this.dataView.settings&&this.dataView.settings.insight||i.DefaultSettings.insight).hasFilter,n=i.DefaultSettings.chart.selectionNumber;if(!e||"insight"!==e.changeSource||r){if(this.dataView&&this.dataView.settings&&this.dataView.settings.chart){var s=this.dataView.settings.chart.selectionNumber;n=s>0?s:n}e&&e.selectedRecords&&e.selectedRecords.forEach(function(e){var i=e.__selectionIndexes;if(null!==i&&void 0!==i){var r=t.getSelectorBySelectionIndex(i);r&&a.push(r)}}),this.setSelection(o.filterFromSelector(a.slice(0,n)))}},i.prototype.getSelectorBySelectionIndex=function(e){return this.dataView&&this.dataView.source&&this.dataView.source.table&&this.dataView.source.table.identity&&this.dataView.source.table.identity[e]?t.SelectionId.createWithId(this.dataView.source.table.identity[e]).getSelector():void 0},i.prototype.setSelection=function(e){var t;t={objectName:i.Properties.general.filter.objectName,selector:void 0,properties:{filter:e}},this.host.persistProperties({merge:[t],remove:[]}),this.host.onSelect({data:[]})},i.prototype.update=function(e){if(e&&e.dataViews&&e.dataViews[0]&&e.dataViews[0].table){var t=this.converter(e.dataViews[0]);this.setSize(e.viewport),this.updateElements(),this.application.update(this.viewport.width,this.viewport.height),this.dataView&&JSON.stringify(this.dataView.data)===JSON.stringify(t.data)||this.application.updateDataView(t.data,this.dataView?void 0:this.updateWatermark.bind(this)),this.dataView&&JSON.stringify(this.dataView.highlights)!==JSON.stringify(t.highlights)&&this.application.setSelection(t.highlights);var i=t.settings.toolbar.show,a=!0,r=!0;(this.viewport.height<=475||this.viewport.width<600)&&(i=!1),this.application._bigBarMgr.isVisibleExternal=i,this.application.playStopInsightButtonsAreVisible||this.application._bigBarMgr.show(i),(this.viewport.height<=400||this.viewport.width<500)&&(a=!1),this.application.legendIsVisible=a,this.application.onLegendsChanged(),(this.viewport.height<=300||this.viewport.width<400)&&(r=!1),this.application.showAxisButtons(r),this.dataView||(this.dataView=t,this.application.loadAppSettings(),this.application.loadLastSession(),this.application.loadInsightSession()),this.dataView=t}},i.prototype.updateWatermark=function(e){void 0===e&&(e=!1),this.rootElement.classed(i.WatermarkSelector["class"],e),this.mainElement.classed(i.InvisibleSelector["class"],e),this.watermarkElement.style("display",e?void 0:"none")},i.prototype.converter=function(e){var t={},i=[];return e&&e.table&&e.table.columns&&e.table.columns.length>0&&e.table.rows&&e.table.columns.forEach(function(a,r){var o=a.displayName;t[o]=e.table.rows.map(function(t,a){return 0===r&&e.table.identity&&i.push(a),t[r]})}),t.__selectionIndexes=i,{settings:this.parseSettings(e),data:t,highlights:this.parseHighlights(e),source:e}},i.prototype.parseHighlights=function(e){var t=[];return e&&e.categorical&&e.categorical.values&&e.categorical.values[0]&&e.categorical.values[0].highlights?(e.categorical.values[0].highlights.forEach(function(e,i){e&&t.push(i)}),t):t},i.prototype.parseSettings=function(e){if(!e||!e.metadata||!e.metadata.objects)return i.DefaultSettings;var t={chart:{},insight:{}},a=e.metadata.objects,r=["application","session","preloads","insightSession"];return r.forEach(function(e){var i;if(a[e]&&a[e].settings)try{i=JSON.parse(a[e].settings)}catch(r){i={}}else i={};t[e]=i}),t.toolbar=this.parseToolbarSettings(a),t},i.prototype.parseToolbarSettings=function(t){var a={},r=i.DefaultSettings.toolbar;return a.show=e.DataViewObjects.getValue(t,i.Properties.toolbar.show,r.show),a},i.prototype.setSize=function(e){var t,i;t=e.height-this.margin.top-this.margin.bottom,i=e.width-this.margin.left-this.margin.right,this.viewport={height:t,width:i}},i.prototype.updateElements=function(){var e=0,t=0;this.viewport&&(e=this.viewport.width,t=this.viewport.height),this.rootElement.style({width:""+e+i.Units,height:""+t+i.Units})},i.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;switch(e.objectName){case"toolbar":this.enumerateToolbar(i)}return i.complete()},i.prototype.enumerateToolbar=function(e){var t=this.dataView&&this.dataView.settings&&this.dataView.settings.toolbar?this.dataView.settings.toolbar:i.DefaultSettings.toolbar;e.pushInstance({objectName:"toolbar",displayName:"toolbar",selector:null,properties:{show:t.show}})},i.prototype.destroy=function(){this.rootElement.remove(),this.rootElement=null,this.coreApplication=null,this.application=null},i.ClassName="sandDance",i.Properties={general:{filter:{objectName:"general",propertyName:"filter"}},chart:{selectionNumber:{objectName:"chart",propertyName:"selectionNumber"}},toolbar:{show:{objectName:"toolbar",propertyName:"show"}},insight:{hasFilter:{objectName:"insight",propertyName:"hasFilter"}}},i.FileInfoSelector=s("fileInfo"),i.PlayAndIconBarSelector=s("playAndIconBar"),i.PlayPanelSelector=s("playPanel"),i.PlayExButtonSelector=s("playExButton"),i.StopButtonSelector=s("stopButton"),i.InsightBgSelector=s("insightBg"),i.TextButtonSelector=s("textButton"),i.IconBarSelector=s("iconBar"),i.InsightPanelSelector=s("insightPanel"),i.InsightTitleBarSelector=s("insightTitleBar"),i.InsightListHolderSelector=s("insightListHolder"),i.InsightListSelector=s("insightList"),i.CloseButtonSelector=s("closeButton"),i.ClickIconSelector=s("clickIcon"),i.InsightCloseButtonSelector=s("insightCloseButton"),i.InsightMenuButtonSelector=s("insightMenuButton"),i.FnInsightMenuSelector=s("fnInsightMenu"),i.SearchPanelSelector=s("searchPanel"),i.BtSearchColSelector=s("btSearchCol"),i.SearchColSelector=s("searchCol"),i.SearchTextSelector=s("searchText"),i.LeftPanelSelector=s("leftPanel"),i.YStuffSelector=s("yStuff"),i.YButtonSelector=s("yButtonOuter"),i.YBinsSelector=s("yBins"),i.ZStuffSelector=s("zStuff"),i.ZButtonSelector=s("zButtonOuter"),i.ZBinsSelecotr=s("zBins"),i.BigBarSelector=s("bigBar"),i.BigBarTopSelector=s("bigBarTop"),i.NoSpaceTableSelector=s("noSpaceTable"),i.ChartSelector=s("myChart"),i.Canvas3DSelector=s("canvas3d"),i.Canvas2DSelector=s("canvas2d"),i.SvgSelector=s("svgDoc"),i.CanvasElementSelector=s("canvasElem"),i.CanvasSelector=s("canvas"),i.ChartUxDivSelector=s("chartUxDiv"),i.FacetLabelHolderSelector=s("facetLabelHolder"),i.RightPanelSelector=s("rightPanel"),i.ButtonLegendComboSelector=s("buttonLegendCombo"),i.LegendSelector=s("legend"),i.BottomPanelSelector=s("bottomPanel"),i.XStuffSelector=s("xStuff"),i.XButtonSelector=s("xButtonOuter"),i.XBinsSelector=s("xBins"),i.DebugPanelSelector=s("debugPanel"),i.DebugPanelItemSelector=s("debugPanel-item"),i.WatermarkSelector=s("sandDanceWatermark"),i.WatermarkElementSelector=s("watermark"),i.InvisibleSelector=s("invisible"),i.Units="px",i.DebugPanelItems=["visStats","gpuStats","hitTestStats","moveStats","drawStats"],i.DefaultSettings={application:{},session:{},preloads:{},insightSession:null,chart:{selectionNumber:250},toolbar:{show:!0},insight:{hasFilter:!1}},i.capabilities={dataRoles:[{displayName:"Values",name:"Values",kind:e.VisualDataRoleKind.GroupingOrMeasure}],dataViewMappings:[{table:{rows:{"for":{"in":"Values"},dataReductionAlgorithm:{window:{count:5e4}}},rowCount:{preferred:{min:1}}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}},selected:{type:{bool:!0}},filter:{type:{filter:{}},rule:{output:{property:"selected",selector:["Values"]}}}}},application:{displayName:"Application",properties:{settings:{displayName:"Settings",type:{text:!0}}}},session:{displayName:"Session",properties:{settings:{displayName:"Settings",type:{text:!0}}}},preloads:{displayName:"Preloads",properties:{settings:{displayName:"Settings",type:{text:!0}}}},insightSession:{displayName:"Insight Session",properties:{settings:{displayName:"Settings",type:{text:!0}}}},chart:{displayName:"Chart",properties:{selectionNumber:{displayName:"Selection number",type:{numeric:!0}}}},toolbar:{displayName:"Toolbar",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}}}},insight:{displayName:"Insight",properties:{hasFilter:{displayName:"Use Filter",type:{bool:!0}}}}},suppressDefaultTitle:!0,supportsSelection:!0},i}();i.SandDance=l}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,i=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var a=t.utility.SelectionManager,r=function(){function i(){this.margin={top:10,right:30,bottom:10,left:10},this.LegendSize=50,this.AxisSize=30}return i.prototype.init=function(e){var r=this;this.hostServices=e.host,this.selectionManager=new a({hostServices:this.hostServices}),this.root=d3.select(e.element.get(0)).append("svg").classed(i.Identity["class"],!0),this.root.on("click",function(e){r.clearSelection()}),this.main=this.root.append("g"),this.axes=this.main.append("g").classed(i.Axes["class"],!0),this.axisX=this.axes.append("g").classed(i.Axis["class"],!0),this.axisY=this.axes.append("g").classed(i.Axis["class"],!0),this.axisY2=this.axes.append("g").classed(i.Axis["class"],!0),this.legends=this.main.append("g").classed(i.Legends["class"],!0),this.line=this.main.append("g").classed(i.Values["class"],!0),this.colors=e.style&&e.style.colorPalette?e.style.colorPalette.dataColors:new t.DataColorPalette},i.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){var t=e.viewport,i=this.model=this.converter(e.dataViews[0],t);this.clearSelection(),this.resize(t),this.draw(i)}},i.prototype.destroy=function(){this.root=null},i.prototype.setIsStopped=function(e){var t={merge:[{objectName:"misc",selector:void 0,properties:{isstopped:e}}]};this.hostServices.persistProperties(t),this.hostServices.onSelect({data:[]})},i.prototype.enumerateObjectInstances=function(e){var t=[];if(!this.model||!this.model.settings)return t;var i=this.model.settings;switch(e.objectName){case"lineoptions":var a={objectName:"lineoptions",displayName:"lineoptions",selector:null,properties:{fill:i.lineFill,lineThickness:i.lineThickness}};t.push(a);break;case"dotoptions":var r={objectName:"dotoptions",displayName:"dotoptions",selector:null,properties:{color:i.dotFill,dotSizeMin:i.dotSizeMin,dotSizeMax:i.dotSizeMax}};t.push(r);break;case"counteroptions":var o={objectName:"counteroptions",displayName:"counteroptions",selector:null,properties:{counterTitle:i.counterTitle}};t.push(o);break;case"misc":var n={objectName:"misc",displayName:"misc",selector:null,properties:{isanimated:i.isanimated,isstopped:i.isstopped,duration:i.duration}};t.push(n)}return t},i.prototype.selectDot=function(e,t){var i=d3.select(e);i.classed("point_selected")?this.clearSelection():(t&&this.selectionManager.select(t),this.root.classed("filtered",!0),this.line.selectAll("circle.point").classed("point_selected",!1),d3.select(e).classed("point_selected",!0)),d3.event.stopPropagation()},i.prototype.clearSelection=function(){this.root.classed("filtered",!1),this.root.selectAll("circle.point").classed("point_selected",!1),this.selectionManager.clear()},i.prototype.converter=function(e,i){if(!(e.categorical&&e.categorical.categories&&e.categorical.categories[0]&&e.categorical.categories[0].values&&e.categorical.categories[0].values.length>0&&e.categorical&&e.categorical.values&&e.categorical.values[0]&&e.categorical.values[0].values&&e.categorical.values[0].values.length>0))return null;var a,r,o,n,s=[],l=this,c=t.AxisHelper.getCategoryValueType(e.categorical.categories[0].source,!0);this.isDateTime=t.AxisHelper.isDateTime(c);var h,u=!0,p=this.parseSettings(e),d=Math.max(0,i.width-this.margin.left-this.margin.right-this.LegendSize-this.AxisSize),m=Math.max(0,i.height-this.margin.top-this.margin.bottom-this.LegendSize),g="";s=e.categorical.categories[0].values,a=e.categorical.categories[0].source,r=d3.extent(s),this.isDateTime?(o=r[0].getTime(),n=r[1].getTime(),o=new Date(o),n=new Date(n+.05*(n-o)),g="MMM dd yyyy",h=t.valueFormatter.create({format:g})):(o=r[0],n=r[1],n+=.05*(n-o),h=t.valueFormatter.create({value:0}));var f=t.AxisHelper.createAxis({pixelSpan:d,dataDomain:[o,n],metaDataColumn:a,formatString:null,outerPadding:0,isCategoryAxis:!0,isScalar:u,isVertical:!1,forcedTickCount:void 0,useTickIntervalForDisplayUnits:!0,getValueFn:function(e,t){return l.isDateTime?h.format(new Date(e)):e}});f.formatter=h,a=e.categorical.values[0].source,s=e.categorical.values[0].values,r=d3.extent(s),o=r[0],n=r[1];for(var y,v=[],x=0,E=0,b=0,T=0;T<e.categorical.categories[0].values.length;T++)E=e.categorical.values[0].values[T],b=e.categorical.categories[0].values[T],x+=E,y=t.SelectionId.createWithId(e.categorical.categories[0].identity[T]),v.push({dot:(E-o)/(n-o),value:E,sum:x,time:b,selector:y});x+=.1*(x-o);var w=t.AxisHelper.createAxis({pixelSpan:m,dataDomain:[o,x],metaDataColumn:a,formatString:null,outerPadding:0,isCategoryAxis:!1,isScalar:!0,isVertical:!0,useTickIntervalForDisplayUnits:!0}),S=t.AxisHelper.createAxis({pixelSpan:m,dataDomain:[o,x],metaDataColumn:a,formatString:null,outerPadding:0,isCategoryAxis:!1,isScalar:!0,isVertical:!0,useTickIntervalForDisplayUnits:!0});return S.axis.orient("right"),{points:v,settings:p,xAxis:f,yAxis:w,yAxis2:S,legends:this.generateAxisLabels(i,p)}},i.prototype.parseSettings=function(a){if(!(a&&a.metadata&&a.metadata.columns&&a.metadata.columns[0]))return null;var r=a.metadata.objects,o=new t.ColorHelper(this.colors,i.Properties.lineoptions.fill,i.DefaultSettings.lineFill),n=new t.ColorHelper(this.colors,i.Properties.dotoptions.color,i.DefaultSettings.dotFill),s=i.DefaultSettings.xAxisTitle,l=i.DefaultSettings.yAxisTitle;a.categorical.categories[0]&&a.categorical.categories[0].source&&a.categorical.categories[0].source.displayName&&a.categorical.values[0]&&a.categorical.values[0].source&&a.categorical.values[0].source.displayName&&(s=a.categorical.categories[0].source.displayName,l=a.categorical.values[0].source.displayName);var c=i.DefaultSettings.lineThickness,h=i.DefaultSettings.dotSizeMin,u=i.DefaultSettings.dotSizeMax,p=i.DefaultSettings.counterTitle,d=i.DefaultSettings.isanimated,m=i.DefaultSettings.isstopped,g=i.DefaultSettings.duration;return r&&(c=e.DataViewObjects.getValue(r,i.Properties.lineoptions.lineThickness,i.DefaultSettings.lineThickness),h=e.DataViewObjects.getValue(r,i.Properties.dotoptions.dotSizeMin,i.DefaultSettings.dotSizeMin),u=e.DataViewObjects.getValue(r,i.Properties.dotoptions.dotSizeMax,i.DefaultSettings.dotSizeMax),p=e.DataViewObjects.getValue(r,i.Properties.counteroptions.counterTitle,i.DefaultSettings.counterTitle),d=e.DataViewObjects.getValue(r,i.Properties.misc.isanimated,i.DefaultSettings.isanimated),m=e.DataViewObjects.getValue(r,i.Properties.misc.isstopped,i.DefaultSettings.isstopped),g=e.DataViewObjects.getValue(r,i.Properties.misc.duration,i.DefaultSettings.duration)),{xAxisTitle:s,yAxisTitle:l,lineFill:o.getColorForMeasure(r,""),lineThickness:c,dotFill:n.getColorForMeasure(r,""),dotSizeMin:h,dotSizeMax:u,counterTitle:p,isstopped:m,isanimated:d,duration:g}},i.prototype.generateAxisLabels=function(e,i){return[{transform:t.SVGUtil.translate((e.width-this.margin.left-this.margin.right)/2,e.height-this.margin.top-this.margin.bottom),text:i.xAxisTitle,dx:"1em",dy:"-1em"},{transform:t.SVGUtil.translateAndRotate(0,(e.height-this.margin.top-this.margin.bottom)/2,0,0,270),text:i.yAxisTitle,dx:"3em"}]},i.prototype.resize=function(e){this.root.attr({height:Math.max(0,e.height),width:Math.max(0,e.width)}),this.main.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top)),this.legends.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top)),this.line.attr("transform",t.SVGUtil.translate(this.margin.left+this.LegendSize,0)),this.axes.attr("transform",t.SVGUtil.translate(this.margin.left+this.LegendSize,0)),this.axisX.attr("transform",t.SVGUtil.translate(0,e.height-this.margin.top-this.margin.bottom-this.LegendSize)),this.axisY2.attr("transform",t.SVGUtil.translate(e.width-this.margin.left-this.margin.right-this.LegendSize-this.AxisSize,0))},i.prototype.draw=function(e){var t=this,i=this;if(this.line.selectAll("*").remove(),this.legends.selectAll("*").remove(),this.axisX.selectAll("*").remove(),this.axisY.selectAll("*").remove(),this.axisY2.selectAll("*").remove(),e&&(this.renderLegends(e),e&&e.points&&e.points.length)){if(this.axisX.call(e.xAxis.axis),this.axisY.call(e.yAxis.axis),this.axisY2.call(e.yAxis2.axis),e.settings.isanimated){var a=this.line.append("g").classed("lineDotChart__playBtn",!0).attr("transform","translate(40, 20)");if(a.append("circle").attr("r",17),e.settings.isstopped)return a.append("path").attr("d","M0 2l10 6-10 6z").attr("transform","translate(-4,-8)"),void a.on("click.lineDotChart__playBt",function(){i.setIsStopped(!1)});a.append("path").attr("d","M0 2l10 6-10 6z").attr("transform-origin","center").attr("transform","translate(6, 8) rotate(180)"),
a.append("rect").attr("width","2").attr("height","12").attr("transform","translate(-7,-6)"),a.on("click.lineDotChart__playBt",function(){i.setIsStopped(!0)})}var r=this.line.append("clipPath").attr("id","lineClip").append("rect").attr("x",0).attr("y",0).attr("width",1).attr("height",1e4),o=d3.svg.line().x(function(t){return e.xAxis.scale(t.time)}).y(function(t){return e.yAxis.scale(t.sum)}),n=this.line.selectAll("path.plot").data([e.points]);n.enter().append("path"),n.classed("plot",!0).attr("stroke",function(t,i){return e.settings.lineFill}).attr("stroke-width",e.settings.lineThickness).attr("d",o);var s=n.node().getTotalLength(),l=n.node().getPointAtLength(0).x,c=n.node().getPointAtLength(s).x;n.attr("clip-path","url("+location.href+"#lineClip)"),e.settings.isanimated?r.attr("x",l).interrupt().transition().ease("linear").duration(1e3*e.settings.duration).attr("width",c-l):r.interrupt().attr("x",l).attr("width",c-l),n.exit().remove();var h=300,u=0,p=this.line.selectAll("circle.point").data(e.points),i=this;p.enter().append("circle").attr("fill",e.settings.dotFill).attr("opacity",.77).attr("r",function(t){return e.settings.dotSizeMin+t.dot*(e.settings.dotSizeMax-e.settings.dotSizeMin)}).classed("point",!0).on("mouseover.point",this.showDataPoint).on("mouseout.point",this.hideDataPoint).on("click.point",function(e){i.selectDot(this,e.selector)}),e.settings.isanimated?p.interrupt().attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(0.005)"}).transition().duration(h).delay(function(i,a){return t.pointDelay(e.points,a,e.settings.duration)}).ease("linear").attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(3.4)"}).transition().duration(h).delay(function(i,a){return t.pointDelay(e.points,a,e.settings.duration)+h}).ease("elastic").attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(1)"}):p.interrupt().attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(1)"}),p.exit().remove();for(var d=0;d<p[0].length;d++)this.addTooltip(e,p[0][d]);var m=this.line.selectAll("text").data(e.points);m.enter().append("text").classed("text",!0).text(function(t,i){return e.settings.counterTitle+" "+(i+1)}).attr("x",c-260).attr("y",30),e.settings.isanimated?m.attr("opacity",0).interrupt().transition().duration(u).delay(function(i,a){return t.pointDelay(e.points,a,e.settings.duration)}).attr("transform","translate(0 0)").attr("opacity",1).transition().duration(u).delay(function(i,a){return e.points[a+1]?t.pointDelay(e.points,a+1,e.settings.duration):Number.POSITIVE_INFINITY}).attr("opacity",0):m.interrupt().attr("transform","translate(0 0)").attr("opacity",function(t,i){return Number(i===e.points.length-1)}),m.exit().remove()}},i.prototype.pointDelay=function(e,t,i){if(!e.length||!e[t]||0===t)return 0;if(this.isDateTime)var a=e[t].time,r=e[0].time.getTime(),o=e[e.length-1].time.getTime(),n=a.getTime();else var a=e[t].time,r=e[0].time,o=e[e.length-1].time,n=a;return 1e3*i*(n-r)/(o-r)},i.prototype.showDataPoint=function(e,t){d3.select(this).classed("show",!0)},i.prototype.hideDataPoint=function(e,t){d3.select(this).classed("show",!1)},i.prototype.addTooltip=function(e,i){var a=d3.select(i),r=a.datum();t.TooltipManager.addTooltip(a,function(t){return[{displayName:e.settings.xAxisTitle,value:e.xAxis.formatter.format(r.time)},{displayName:e.settings.yAxisTitle,value:r.value.toString()}]})},i.prototype.renderLegends=function(e){var t=this.legends.selectAll(i.Legend.selector).data(e.legends);t.enter().append("svg:text"),t.attr("x",0).attr("y",0).attr("dx",function(e){return e.dx}).attr("dy",function(e){return e.dy}).attr("transform",function(e){return e.transform}).text(function(e){return e.text}).classed(i.Legend["class"],!0),t.exit().remove()},i.DefaultSettings={lineFill:"rgb(102, 212, 204)",lineThickness:3,dotFill:"#005c55",dotSizeMin:4,dotSizeMax:38,counterTitle:"Total features",xAxisTitle:"",yAxisTitle:"",duration:20,isanimated:!0,isstopped:!0},i.capabilities={dataRoles:[{name:"Date",kind:e.VisualDataRoleKind.Grouping,displayName:"Date"},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Date:{min:0,max:1},Values:{min:0,max:1},Labels:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Date"},dataReductionAlgorithm:{sample:{}}},values:{"for":{"in":"Values"}}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},lineoptions:{displayName:"Line",properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},lineThickness:{displayName:"Thickness",type:{numeric:!0}}}},dotoptions:{displayName:"Dot",properties:{color:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},dotSizeMin:{displayName:"Min size",type:{numeric:!0}},dotSizeMax:{displayName:"Min size",type:{numeric:!0}}}},counteroptions:{displayName:"Counter",properties:{counterTitle:{displayName:"Title",type:{text:!0}}}},misc:{displayName:"Animation",properties:{isanimated:{displayName:"Animated",type:{bool:!0}},isstopped:{displayName:"Stop on load",type:{bool:!0}},duration:{displayName:"Time",type:{numeric:!0}}}}}},i.Identity={"class":"lineDotChart",selector:".lineDotChart"},i.Axes={"class":"axes",selector:".axes"},i.Axis={"class":"axis",selector:".axis"},i.Legends={"class":"legends",selector:".legends"},i.Legend={"class":"legend",selector:".legend"},i.Values={"class":"line",selector:".line"},i.Properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},lineoptions:{fill:{objectName:"lineoptions",propertyName:"fill"},lineThickness:{objectName:"lineoptions",propertyName:"lineThickness"}},dotoptions:{color:{objectName:"dotoptions",propertyName:"color"},dotSizeMin:{objectName:"dotoptions",propertyName:"dotSizeMin"},dotSizeMax:{objectName:"dotoptions",propertyName:"dotSizeMax"}},counteroptions:{counterTitle:{objectName:"counteroptions",propertyName:"counterTitle"}},misc:{isanimated:{objectName:"misc",propertyName:"isanimated"},isstopped:{objectName:"misc",propertyName:"isstopped"},duration:{objectName:"misc",propertyName:"duration"}}},i}();i.LineDotChart=r}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,i=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(e){var t;!function(t){t.asterPlot={name:"asterPlot",capabilities:e.samples.AsterPlot.capabilities,create:function(){return new e.samples.AsterPlot}},t.tornadoChart={name:"tornadoChart",capabilities:e.samples.TornadoChart.capabilities,create:function(){return new e.samples.TornadoChart}},t.sankeyDiagram={name:"sankeyDiagram",capabilities:e.samples.SankeyDiagram.capabilities,create:function(){return new e.samples.SankeyDiagram}},t.mekkoChart={name:"mekkoChart",watermarkKey:"mekko",capabilities:e.samples.MekkoChart.capabilities,create:function(){return new e.samples.MekkoChart({chartType:0})},customizeQuery:e.ColumnChart.customizeQuery,getSortableRoles:function(t){return e.ColumnChart.getSortableRoles(t)}},t.bulletChart={name:"bulletChart",capabilities:e.samples.BulletChart.capabilities,create:function(){return new e.samples.BulletChart}},t.wordCloud={name:"wordCloud",capabilities:e.samples.WordCloud.capabilities,create:function(){return new e.samples.WordCloud}},t.chicletSlicer={name:"chicletSlicer",capabilities:e.samples.ChicletSlicer.capabilities,create:function(){return new e.samples.ChicletSlicer}},t.chordChart={name:"chordChart",capabilities:e.samples.ChordChart.capabilities,create:function(){return new e.samples.ChordChart}},t.enhancedScatterChart={name:"enhancedScatterChart",capabilities:e.samples.EnhancedScatterChart.capabilities,create:function(){return new e.samples.EnhancedScatterChart}},t.radarChart={name:"radarChart",capabilities:e.samples.RadarChart.capabilities,create:function(){return new e.samples.RadarChart}},t.dotPlot={name:"dotPlot",capabilities:e.samples.DotPlot.capabilities,create:function(){return new e.samples.DotPlot}},t.histogram={name:"histogram",capabilities:e.samples.Histogram.capabilities,create:function(){return new e.samples.Histogram}},t.areaRangeChart={name:"areaRangeChart",capabilities:e.samples.AreaRangeChart.capabilities,create:function(){return new e.samples.AreaRangeChart}},t.timeline={name:"timeline",capabilities:e.samples.Timeline.capabilities,create:function(){return new e.samples.Timeline}},t.forceGraph={name:"forceGraph",capabilities:e.samples.ForceGraph.capabilities,create:function(){return new e.samples.ForceGraph}},t.gantt={name:"gantt",capabilities:e.samples.Gantt.capabilities,create:function(){return new e.samples.Gantt}},t.streamGraph={name:"streamGraph",capabilities:e.samples.StreamGraph.capabilities,create:function(){return new e.samples.StreamGraph}},t.pulseChart={name:"pulseChart",capabilities:e.samples.PulseChart.capabilities,create:function(){return new e.samples.PulseChart}},t.sandDance={name:"sandDance",capabilities:e.samples.SandDance.capabilities,create:function(){return new e.samples.SandDance}},t.lineDotChart={name:"lineDotChart",capabilities:e.samples.LineDotChart.capabilities,create:function(){return new e.samples.LineDotChart}}}(t=e.plugins||(e.plugins={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))}]);